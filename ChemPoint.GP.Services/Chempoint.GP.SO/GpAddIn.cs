using System;
using System.IO;
using System.Collections.Generic;
using System.Text;
using Microsoft.Dexterity.Bridge;
using Microsoft.Dexterity.Applications;
using System.Windows.Forms;
using Chempoint.GP.SO.Properties;
using System.Net.Http;
using System.Threading.Tasks;
using System.Net.Http.Headers;
using Dic4745 = Microsoft.Dexterity.Applications.ChemPointSalesExtDictionary;
using Dic4776 = Microsoft.Dexterity.Applications.AvalaraDictionary;
using Dic2735 = Microsoft.Dexterity.Applications.CreditCardAdvantageDictionary;
using ChemPoint.GP.Entities.Business_Entities.TaskScheduler.HoldEngine;
using System.Runtime.InteropServices;
using Microsoft.Dexterity.Applications.DynamicsDictionary;
using System.Diagnostics;
using System.Collections.ObjectModel;
using System.Linq;
using Chempoint.GP.Model.Interactions.HoldEngine;
using Chempoint.GP.Model.Interactions.Sales;
using ChemPoint.GP.Entities.BaseEntities;
using ChemPoint.GP.XrmServices;
using ChemPoint.GP.Entities.Business_Entities;
using Chempoint.GP.Infrastructure.Logging;
using Chempoint.GP.Model.Interactions.Email;
using System.Configuration;
using Chempoint.GP.Model.Interactions.FTP;
using ChemPoint.GP.Entities.Business_Entities.TaskScheduler.FTP;
using System.Web.Script.Serialization;

public enum ButtonStatus
{
    Ready = 0,
    Pending = 1,
    Processing = 2,
    Completed = 3,
    Failed = 4,
    NotApplicable = 5,
    ZoomShow = 6,
    ZoomHide = 7
}

namespace Chempoint.GP.SO
{
    /// <summary>
    /// Project Name        :   Sales Applciation 
    /// Affected Module     :   Sales
    /// Affected Windows    :   SOP Entry & inquiry,Customer Details Entry,Sop Item detail Entry..
    ///                         Receiavable Transaction Entry and Inquiry
    /// Developed on        :   Jun2016  
    /// Developed by        :   Muthu,Ashok,Raghu and Amit.
    ///-------------------------------------------------------------------------------------------
    ///     Date		Author          Description
    ///-------------------------------------------------------------------------------------------
    /// **Jun2016       Mthangaraj      Initial Creation
    /// **Apr2017       Mthangaraj      Dll Upgrade Regarding GP 2016
    /// </summary>
    public class GPAddIn : IDexterityAddIn
    {
        static Dic4745.SopEntryForm sopEntryForm;
        static Dic4745.SopItemDetailForm sopItemDetailForm;
        static Dic4745.SopCustomerDetailEntryForm sopCustomerDetailEntryForm;
        static Dic4745.SopUserDefinedFieldEntryForm sopUserDefinedFieldEntryForm;
        static SopProcessHoldsEntryForm sopProcessHoldsEntryForm;

        static Dic4745.RmCustomerAddressForm rmCustomerAddressForm;
        static Dic4745.RmCustomerMaintenanceForm rmCustomerMaintenanceForm;
        static Dic4745.SopInquiryForm sopEntryInquiryForm;
        static Dic4745.SopInquiryItemDetailForm sopInquiryItemDetailForm;
        static Dic4745.SopInquiryCustomerDetailForm sopInquiryCustomerDetailForm;
        static Dic4745.SopInquiryUserDefinedForm sopInquiryUserDefinedForm;
        static Dic4745.InCoTermsLookupForm incoTermLookupForm;

        static GP_Lot_Info salesLotInfo = new GP_Lot_Info();
        static GP_Lot_Inquiry salesLotInquiry = new GP_Lot_Inquiry();

        static Dic4745.QuoteWindowLookupForm quoteWindowLookupForm;

        Boolean RegisterSalesEntryMgmt = false;
        Boolean RegisterOrderTypeDetails = false;
        Boolean RegisterincoTermLookupSelect = false;
        string lookupWindowType = string.Empty;
        string expansionWindowType = string.Empty;
        Boolean RegisterCommentLookupSelect = false;
        Boolean RegisterInquiryCustomerMgmt = false;
        Boolean RegisterCommentEntry = false;
        static AddressLookupForm addressLookupForm;
        static Dic4745.AddressEntryForm addressEntryForm;
        Boolean RegisterAddressEntry = false;
        static CommentLookupForm commentLookupForm;
        static SopCommentEntryForm sopCommentEntryForm;
        Boolean RegisterAddressLookupSelect = false;
        Boolean RegisterQuoteLookupSelect = false;
        bool internalInfoEnterFlag = false;
        bool warehouseInfoEnterFlag = false;
        bool carrierInfoEnterFlag = false;
        Boolean RegisterThirdPartyAddressDetails = false;
        Boolean RegisterCustomerPickupAddressDetails = false;
        static Dic4745.OrderTypeDetailsForm orderTypeDetailsForm;
        static Dic4745.ThirdPartyAddressDetailsForm thirdPartyAddressDetailsForm;
        static Dic4745.CustomerPickupAddressDetailsForm customerPickupAddressDetailsForm;
        static TaxScheduleLookupForm taxScheduleLookupForm;
        bool RegisterTaxScheduleLookupSelect = false;
        bool isChangedOrderType = false;
        DateTime ReqShipDate;
        bool isContentLoaded;

        bool quoteNumberInfoEnterFlag = false;
        bool countryOfOriginInfoEnterFlag = false;
        bool eccnNumberInfoEnterFlag = false;
        bool htsNumberInfoEnterFlag = false;
        bool actualShipDateInfoEnterFlag = false;
        bool originatingFrightPriceEnterFlag = false;
        bool updatetoXRMStatusFlag = false;
        string OldPaymentTerm;
        string OldFreightTerm;
        string LocalShipToCountry;
        string LocalShipFromCountry;
        string LocalFinalDestination;
        string LocalShipToCountryCode;
        string LocalShipFromCountryCode;
        string LocalFinalDestinationCode;
        string GPShipToCountry;
        string GPShipFromCountry;
        string GPFinalDestination;
        Dictionary<int, string> ItemList = null;
        Dictionary<int, string> ItemListAfterSave = null;
        Dictionary<int,string> ItemNumberandDescription = null;

        int exportValidation;
        bool isCountryChange = false;
        bool isLineAdded = false;
        string orignNumber;

        static Dic4745.SopPrintOptionsForm sopPrintOptionsForm;
        //Tax enhancement
        bool RegisterVATReferenceLookupSelect = false;
        static Dic4745.AccountVatNumberListLookupForm accountVatNumberListLookupForm;
        static Dic2735.MsoBatchVerificationForm msoBatchVerificationForm;
        bool isVATLookupOpen = false;
        static Dic4745.SopDateEntryForm sopDateEntryForm;
        static string gpServiceConfigurationURL = null;
        static string xrmOrderURL = null;
        static string xrmQuoteURL = null;
        static string xrmCustomerURL = null;
        static string xrmPublishURL = null;
        static string TaxRegNumber = string.Empty;
        static string TaxScheduleID = string.Empty;
        static bool IsValidateServiceSkus = true; //default = true

        //PostingUtility
        static Dic4745.CpSalesPostingManagementForm cpSalesPostingManagementForm;
        static Dic4745.CpLockedUsersForm cpLockedUsersForm;
        static Dic4776.AvaSopTaxUpdateUtilityForm avaSopTaxUpdateUtilityForm;

        Boolean RegisterPostMgmt = false;

        internal Collection<User> lockedUsers;
        string filePath;

        static SopBatchEntryForm sopBatchEntryForm;

        bool isPostingTransactionsReadyBtnClicked = false,
        IsProcessCreditCardReadyBtnClicked = false,
        IsCalTaxOnBatchReadyBtnClicked = false,
        IsBatchNumberToBeFocused = false;
        static string numberOfRecordsFixedByCorrectDropShipBtn = null;

        bool isWarehouseClosureState = false;

        [DllImport("KERNEL32.DLL", EntryPoint = "GetPrivateProfileStringW",
            SetLastError = true,
            CharSet = CharSet.Unicode, ExactSpelling = true,
            CallingConvention = CallingConvention.StdCall)]
        private static extern int GetPrivateProfileString(string lpAppName, string lpKeyName, string lpDefault, string lpReturnString, int nSize, string lpFilename);

        bool isPostLoggingEnabled = false;
        string postingLogFileName = null;
        string postingLogFilePath = null;
        bool isSoLoggingEnabled = false;
        string soLogFileName = null;
        string soLogFilePath = null;

        public void Initialize()
        {
            // Initialize the  form
            sopEntryForm = ChemPointSalesExt.Forms.SopEntry;
            sopItemDetailForm = ChemPointSalesExt.Forms.SopItemDetail;
            sopCustomerDetailEntryForm = ChemPointSalesExt.Forms.SopCustomerDetailEntry;
            sopUserDefinedFieldEntryForm = ChemPointSalesExt.Forms.SopUserDefinedFieldEntry;
            sopProcessHoldsEntryForm = Dynamics.Forms.SopProcessHoldsEntry;

            sopEntryInquiryForm = ChemPointSalesExt.Forms.SopInquiry;
            sopInquiryItemDetailForm = ChemPointSalesExt.Forms.SopInquiryItemDetail;
            sopInquiryCustomerDetailForm = ChemPointSalesExt.Forms.SopInquiryCustomerDetail;
            sopInquiryUserDefinedForm = ChemPointSalesExt.Forms.SopInquiryUserDefined;

            rmCustomerAddressForm = ChemPointSalesExt.Forms.RmCustomerAddress;
            rmCustomerMaintenanceForm = ChemPointSalesExt.Forms.RmCustomerMaintenance;
            sopPrintOptionsForm = ChemPointSalesExt.Forms.SopPrintOptions;
            sopDateEntryForm = ChemPointSalesExt.Forms.SopDateEntry;

            avaSopTaxUpdateUtilityForm = Avalara.Forms.AvaSopTaxUpdateUtility;
            msoBatchVerificationForm = CreditCardAdvantage.Forms.MsoBatchVerification;

            orderTypeDetailsForm = ChemPointSalesExt.Forms.OrderTypeDetails;
            thirdPartyAddressDetailsForm = ChemPointSalesExt.Forms.ThirdPartyAddressDetails;
            customerPickupAddressDetailsForm = ChemPointSalesExt.Forms.CustomerPickupAddressDetails;

            addressLookupForm = Dynamics.Forms.AddressLookup;
            addressEntryForm = ChemPointSalesExt.Forms.AddressEntry;
            commentLookupForm = Dynamics.Forms.CommentLookup;
            sopCommentEntryForm = Dynamics.Forms.SopCommentEntry;
            quoteWindowLookupForm = ChemPointSalesExt.Forms.QuoteWindowLookup;
            accountVatNumberListLookupForm = ChemPointSalesExt.Forms.AccountVatNumberListLookup;
            incoTermLookupForm = ChemPointSalesExt.Forms.InCoTermsLookup;
            cpSalesPostingManagementForm = ChemPointSalesExt.Forms.CpSalesPostingManagement;
            cpLockedUsersForm = ChemPointSalesExt.Forms.CpLockedUsers;
            sopBatchEntryForm = Dynamics.Forms.SopBatchEntry;
            taxScheduleLookupForm = Dynamics.Forms.TaxScheduleLookup;

            //Initialize the Events...
            sopEntryForm.SopEntry.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(SopEntry_OpenBeforeOriginal);
            sopEntryInquiryForm.SopInquiry.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(SopInquiry_OpenBeforeOriginal);

            #region AddressEntry

            addressEntryForm.AddressEntry.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(AddressEntry_OpenBeforeOriginal);
            addressEntryForm.AddressEntry.OpenAfterOriginal += new EventHandler(AddressEntry_OpenAfterOriginal);

            #endregion AddressEntry

            #region CommentEntry

            sopCommentEntryForm.SopCommentEntry.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(SopCommentEntry_OpenBeforeOriginal);

            #endregion CommentEntry

            #region QuoteEntry

            quoteWindowLookupForm.QuoteLookup.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(QuoteLookup_OpenBeforeOriginal);
            quoteWindowLookupForm.QuoteLookup.OpenAfterOriginal += new EventHandler(QuoteLookup_OpenAfterOriginal);

            #endregion QuoteEntry

            #region OrderType

            orderTypeDetailsForm.OrderTypeDetails.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(OrderTypeDetails_OpenBeforeOriginal);
            orderTypeDetailsForm.OrderTypeDetails.OpenAfterOriginal += new EventHandler(OrderTypeDetails_OpenAfterOriginal);

            #endregion Order Type

            #region 3rdParty

            thirdPartyAddressDetailsForm.ThirdPartyAddress.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(ThirdPartyAddress_OpenBeforeOriginal);
            thirdPartyAddressDetailsForm.ThirdPartyAddress.OpenAfterOriginal += new EventHandler(ThirdPartyAddress_OpenAfterOriginal);

            #endregion 3rdparty

            #region CustomerPickupAddress

            customerPickupAddressDetailsForm.CustomerPickupAddress.OpenBeforeOriginal += CustomerPickupAddress_OpenBeforeOriginal;
            customerPickupAddressDetailsForm.CustomerPickupAddress.OpenAfterOriginal += CustomerPickupAddress_OpenAfterOriginal;

            #endregion CustomerPickupAddress

            #region IncoTerm

            incoTermLookupForm.InCoTermsLookup.OpenBeforeOriginal += InCoTermsLookup_OpenBeforeOriginal;
            incoTermLookupForm.InCoTermsLookup.OpenAfterOriginal += new EventHandler(InCoTermsLookup_OpenAfterOriginal);

            #endregion IncoTerm

            #region Posting Utility

            sopBatchEntryForm.AddMenuHandler(SalesPostingManagementWindow, "Sales Posting Management", "O");
            cpSalesPostingManagementForm.CpSalesPostingManagement.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(CpSalesPostingManagement_OpenBeforeOriginal);

            #endregion Posting Utility

            #region rmCustomerMaintenanceForm
            rmCustomerMaintenanceForm.RmCustomerMaintenance.CustomerNumber.Change += new EventHandler(CustomerNumber_Change);
            #endregion rmCustomerMaintenanceForm

            #region WarehouseClosure

            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.LeaveAfterOriginal += new EventHandler(CpReqShipDate_Change);
            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.LeaveAfterOriginal += new EventHandler(CpCurSchedDel_Change);

            #endregion

            //CPservice Configuration 
            string getCurrentDirectoryPath = @Directory.GetCurrentDirectory();
            string iniFilePath = getCurrentDirectoryPath + "\\Data\\Dex.ini";

            List<string> categories = GetCategories(iniFilePath);
            foreach (string category in categories)
            {
                //Get the key values
                gpServiceConfigurationURL = GetIniFileString(iniFilePath, category, "GPSERVICE", "");
                xrmOrderURL = GetIniFileString(iniFilePath, category, "ORDERURL", "");
                xrmCustomerURL = GetIniFileString(iniFilePath, category, "CUSTOMERURL", "");
                xrmQuoteURL = GetIniFileString(iniFilePath, category, "QUOTEURL", "");
                xrmPublishURL = GetIniFileString(iniFilePath, category, "POCRMSERVICE", "");

                isPostLoggingEnabled = Convert.ToBoolean(GetIniFileString(iniFilePath, category, "ISPOSTINGLOGENABLED", ""));
                postingLogFileName = GetIniFileString(iniFilePath, category, "POSTINGLOGFILENAME", "");
                postingLogFilePath = GetIniFileString(iniFilePath, category, "POSTINGLOGFILEPATH", "");

                isSoLoggingEnabled = Convert.ToBoolean(GetIniFileString(iniFilePath, category, "ISSOLOGENABLED", ""));
                soLogFileName = GetIniFileString(iniFilePath, category, "SOLOGFILENAME", "");
                soLogFilePath = GetIniFileString(iniFilePath, category, "SOLOGFILEPATH", "");

            }
        }





        #region SalesOrderEntry

        void SopEntry_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (RegisterSalesEntryMgmt == false)
                {
                    #region SOP Entry Changes

                    // calling dex script for getting SOP Entry Date 
                    sopEntryForm.SopEntry.LocalIsAddressDisplay.Change += new EventHandler(SOPLocalIsAddressDisplay_Change);
                    sopEntryForm.SopEntry.LocalIsAddressSave.Change += new EventHandler(SopEntryLocalIsAddressSave_Change);
                    sopEntryForm.SopEntry.LocalIsThirdPartyAddressDisplay.Change += new EventHandler(SOPLocalIsThirdPartyAddressDisplay_Change);

                    //Open Xrm 
                    sopEntryForm.SopEntry.ZoomButton.ClickAfterOriginal += new EventHandler(OpenXrm_ClickAfterOriginal);
                    sopItemDetailForm.SopItemDetail.ZoomButtons14.ClickAfterOriginal += new EventHandler(OpenQuote_ClickAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.ZoomButtons2.ClickAfterOriginal += new EventHandler(OpenCustomer_ClickAfterOriginal);

                    //Sop Entry Cancel order (Order Void)
                    sopEntryForm.SopEntry.LocalNumberVoided.Change += new EventHandler(LocalNumberVoided_Change);
                    sopEntryForm.SopEntry.LocalConfirmProcess.Change += new EventHandler(LocalConfirmProcess_Change);
                    sopEntryForm.SopEntry.ActionButton.EnterBeforeOriginal += new System.ComponentModel.CancelEventHandler(ActionButton_EnterBeforeOriginal);
                    ChemPointSalesExt.Procedures.ValidateHeaderAndLineFreightDetails.InvokeBeforeOriginal += ValidateHeaderAndLineFreightDetails_InvokeBeforeOriginal;
                    ChemPointSalesExt.Procedures.ValidateHeaderAndLineFreightDetails.InvokeAfterOriginal += ValidateHeaderAndLineFreightDetails_InvokeAfterOriginal;

                    //tobeCancelled 
                    sopEntryForm.SopEntry.TobeCancelled.LeaveAfterOriginal += new EventHandler(TobeCancelledAndExcludeServiceSkus_LeaveAfterOriginal);
                    //ExcludeServiceSkus 
                    //sopEntryForm.SopEntry.ExcludeServiceSkus.LeaveAfterOriginal += new EventHandler(TobeCancelledAndExcludeServiceSkus_LeaveAfterOriginal);
                    sopEntryForm.SopEntry.CustomizeServiceSkUs.LeaveAfterOriginal += TobeCancelledAndExcludeServiceSkus_LeaveAfterOriginal;
                    //LocationCode_Change
                    ChemPointSalesExt.Procedures.TriggerSopEntryHdrLocationCode.InvokeBeforeOriginal += TriggerSopEntryHdrLocationCode_InvokeBeforeOriginal;


                    #region Date Change

                    sopEntryForm.SopEntry.ExpansionButton2.ClickAfterOriginal += new EventHandler(ExpansionButton2ClickAfterOriginal);

                    #endregion Date Change

                    #endregion SOP Entry Changes

                    #region SOP Customer Detail Changes

                    //Address Lookup
                    addressLookupForm.AddressLookup.CloseAfterOriginal += new EventHandler(AddressLookup_CloseAfterOriginal);
                    commentLookupForm.CommentLookup.CloseAfterOriginal += new EventHandler(CommentLookup_CloseAfterOriginal);
                    taxScheduleLookupForm.TaxScheduleLookup.CloseAfterOriginal += new EventHandler(TaxScheduleLookup_CloseAfterOriginal);

                    sopCustomerDetailEntryForm.Procedures.OpenFinish.InvokeBeforeOriginal += OpenFinish_InvokeBeforeOriginal;
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.OpenAfterOriginal += new EventHandler(SopCustomerDetailEntry_OpenAfterOriginal);
                    //Address Changes
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCpRgAddressDisplay.Change += new EventHandler(SopCustomerDetailEntryLocalCpRgAddressDisplay_Change);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LookupButton3.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryLookupButton3_ClickAfterOriginal);   // call for Bill To Address
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LookupButton4.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryLookupButton4_ClickAfterOriginal);   // call for Final Destination To Address
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LookupButton11.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryLookupButton11_ClickAfterOriginal); // call for Ship Destination To Address
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.ZoomButton.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryZoomButton_ClickAfterOriginal);         // call for Zoom button for Ship To Address
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalAddressDisplay.ValidateAfterOriginal += new EventHandler(SopCustomerDetailEntryLocalAddressDisplay_ValidateAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.ExpansionButton1.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryExpansionButton1_ClickAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.IncoLookup.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryIncoLookup_ClickAfterOriginal); // call for quote number lookup
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LookupButton6.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryLookupButton6_ClickAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.OkButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(SopCustomerDetailEntryOkButton_ClickBeforeOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.OkButton.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryOkButton_ClickAfterOriginal);
                    //Third Party Address
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.ExpansionButton2.ClickAfterOriginal += new EventHandler(SopCustomerDetailExpansionButton2_ClickAfterOriginal);  // call for third party expansion
                    //Pickup Address
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.ExpansionButton7.ClickAfterOriginal += new EventHandler(SopCustomerDetailExpansionButton7_ClickAfterOriginal);  // call for third party expansion

                    #region Account Header Comment Changes

                    //WH and Carrier -Expansion Button..
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.ExpansionButton5.ClickAfterOriginal += ExpansionButton5_ClickAfterOriginal;
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.ExpansionButton3.ClickAfterOriginal += ExpansionButton3_ClickAfterOriginal;
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.ExpansionButton4.ClickAfterOriginal += ExpansionButton4_ClickAfterOriginal;  // call for carrier comment expansion
                    //Wh lookup -- Customer detail entry window...
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LookupButtons1.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryLookupButtons1_ClickAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.WhLookupButton.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryWhLookupButton_ClickAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierLookupButton.ClickAfterOriginal += new EventHandler(SopCustomerDetailEntryCarrierLookupButton_ClickAfterOriginal);
                    //Internal instruction
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.EnterAfterOriginal += new EventHandler(InternalInstructionId_EnterAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.LeaveAfterOriginal += new EventHandler(InternalInstructionId_LeaveAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Change += new EventHandler(InternalInstructionId_Change);
                    //WH instruction
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.EnterAfterOriginal += new EventHandler(WarehouseInstructionId_EnterAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.LeaveAfterOriginal += new EventHandler(WarehouseInstructionId_LeaveAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Change += new EventHandler(WarehouseInstructionId_Change);
                    // Carrier instruction
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.EnterAfterOriginal += new EventHandler(CarrierInstructionId_EnterAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Change += new EventHandler(CarrierInstructionId_Change);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.LeaveAfterOriginal += new EventHandler(CarrierInstructionId_LeaveAfterOriginal);

                    #endregion Account Header Comment Changes

                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.LeaveAfterOriginal += new EventHandler(CpCustReqDel_LeaveAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.LeaveAfterOriginal += new EventHandler(CpCustReqShip_LeaveAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.LeaveAfterOriginal += new EventHandler(CpCurSchedDel_LeaveAfterOriginal);
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.LeaveAfterOriginal += new EventHandler(CpReqShipDate_LeaveAfterOriginal);

                    isWarehouseClosureState = false;


                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LookupButton12.ClickAfterOriginal += VatReference_LookupButton12_ClickAfterOriginal;

                    accountVatNumberListLookupForm.AccountVatNumberListLookup.CancelButton.ClickAfterOriginal += VatReference_CancelButton_ClickAfterOriginal;
                    accountVatNumberListLookupForm.AccountVatNumberListLookup.CloseAfterOriginal += AccountVatNumberListLookup_CloseAfterOriginal;
                    accountVatNumberListLookupForm.AccountVatNumberListLookup.OpenAfterOriginal += AccountVatNumberListLookup_OpenAfterOriginal;

                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CloseBeforeOriginal += SopCustomerDetailEntry_CloseBeforeOriginal;

                    #endregion SOP Customer Detail Changes

                    #region Account Line Changes

                    // calling dex script for displaying custom item details: call SOP_Item_Detail_Read
                    sopItemDetailForm.SopItemDetail.LocalIsCommentDisplay.Change += new EventHandler(SopItemDetailDisplayExisting_Change);
                    // calling dex script for saving custom item details: invoke Trigger_SOP_Item_Detail_Save
                    sopItemDetailForm.SopItemDetail.LocalIsCommentSave.Change += new EventHandler(SopItemDetailSave_Change);

                    sopItemDetailForm.SopItemDetail.ExpansionButtons3.ClickAfterOriginal += ExpansionButtons3_ClickAfterOriginal;

                    //Line Comment ..
                    sopItemDetailForm.SopItemDetail.ExpansionButton8.ClickAfterOriginal += new EventHandler(SopItemDetailExpansionButton8_ClickAfterOriginal); // call for warehourse comment expansion
                    sopItemDetailForm.SopItemDetail.ExpansionButton9.ClickAfterOriginal += new EventHandler(SopItemDetailExpansionButton9_ClickAfterOriginal);  // call for carrier comment expansion
                    sopItemDetailForm.SopItemDetail.LookupButton12.ClickAfterOriginal += new EventHandler(SopItemDetailLookupButton12_ClickAfterOriginal); // call for warehourse comment lookup
                    sopItemDetailForm.SopItemDetail.LookupButton13.ClickAfterOriginal += new EventHandler(SopItemDetailLookupButton13_ClickAfterOriginal); // call for carrier comment lookup

                    sopItemDetailForm.SopItemDetail.LookupButton11.ClickAfterOriginal += new EventHandler(SopItemDetailLookupButton11_ClickAfterOriginal); // call for quote number lookup
                    sopItemDetailForm.SopItemDetail.LookupButton7.ClickAfterOriginal += new EventHandler(SopItemDetailLookupButton7_ClickAfterOriginal); // call for internal comment lookup

                    sopItemDetailForm.SopItemDetail.WarehouseInstructionId.EnterAfterOriginal += new EventHandler(SopItemDetailWarehouseInstructionId_EnterAfterOriginal);
                    sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Change += new EventHandler(SopItemDetailWarehouseInstructionId_Change);
                    sopItemDetailForm.SopItemDetail.WarehouseInstructionId.LeaveAfterOriginal += new EventHandler(SopItemDetailWarehouseInstructionId_LeaveAfterOriginal);

                    sopItemDetailForm.SopItemDetail.CarrierInstructionId.EnterAfterOriginal += new EventHandler(SopItemDetailCarrierInstructionId_EnterAfterOriginal);
                    sopItemDetailForm.SopItemDetail.CarrierInstructionId.Change += new EventHandler(SopItemDetailCarrierInstructionId_Change);
                    sopItemDetailForm.SopItemDetail.CarrierInstructionId.LeaveAfterOriginal += new EventHandler(SopItemDetailCarrierInstructionId_LeaveAfterOriginal);

                    sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.EnterAfterOriginal += new EventHandler(SopItemDetailPcbSopLineQuoteNmbr_EnterAfterOriginal);
                    sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Change += new EventHandler(SopItemDetailPcbSopLineQuoteNmbr_Change);
                    sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.LeaveAfterOriginal += new EventHandler(SopItemDetailPcbSopLineQuoteNmbr_LeaveAfterOriginal);

                    sopItemDetailForm.SopItemDetail.CountryOfOrigin.EnterAfterOriginal += new EventHandler(SopItemDetailCountryOfOrigin_EnterAfterOriginal);
                    sopItemDetailForm.SopItemDetail.CountryOfOrigin.Change += new EventHandler(SopItemDetailCountryOfOrigin_Change);
                    sopItemDetailForm.SopItemDetail.CountryOfOrigin.LeaveAfterOriginal += new EventHandler(SopItemDetailCountryOfOrigin_LeaveAfterOriginal);

                    sopItemDetailForm.SopItemDetail.CpEccnNumber.EnterAfterOriginal += new EventHandler(SopItemDetailCpEccnNumber_EnterAfterOriginal);
                    sopItemDetailForm.SopItemDetail.CpEccnNumber.Change += new EventHandler(SopItemDetailCpEccnNumber_Change);
                    sopItemDetailForm.SopItemDetail.CpEccnNumber.LeaveAfterOriginal += new EventHandler(SopItemDetailCpEccnNumber_LeaveAfterOriginal);

                    sopItemDetailForm.SopItemDetail.CpHtsNumber.EnterAfterOriginal += new EventHandler(SopItemDetailCpHtsNumber_EnterAfterOriginal);
                    sopItemDetailForm.SopItemDetail.CpHtsNumber.Change += new EventHandler(SopItemDetailCpHtsNumber_Change);
                    sopItemDetailForm.SopItemDetail.CpHtsNumber.LeaveAfterOriginal += new EventHandler(SopItemDetailCpHtsNumber_LeaveAfterOriginal);

                    sopItemDetailForm.SopItemDetail.ActualShipDate.EnterAfterOriginal += new EventHandler(SopItemDetailActualShipDate_EnterAfterOriginal);
                    sopItemDetailForm.SopItemDetail.ActualShipDate.Change += new EventHandler(SopItemDetailActualShipDate_Change);
                    sopItemDetailForm.SopItemDetail.ActualShipDate.LeaveAfterOriginal += new EventHandler(SopItemDetailActualShipDate_LeaveAfterOriginal);

                    sopItemDetailForm.SopItemDetail.OriginatingFreightAmount.EnterAfterOriginal += OriginatingFreightAmount_EnterAfterOriginal;
                    sopItemDetailForm.SopItemDetail.OriginatingFreightAmount.Change += OriginatingFreightAmount_Change;
                    sopItemDetailForm.SopItemDetail.OriginatingFreightAmount.LeaveAfterOriginal += OriginatingFreightAmount_LeaveAfterOriginal;

                    sopItemDetailForm.SopItemDetail.FreightAmount.EnterAfterOriginal += OriginatingFreightAmount_EnterAfterOriginal;
                    sopItemDetailForm.SopItemDetail.FreightAmount.Change += OriginatingFreightAmount_Change;
                    sopItemDetailForm.SopItemDetail.FreightAmount.LeaveAfterOriginal += OriginatingFreightAmount_LeaveAfterOriginal;

                    #endregion SOPLineItemEventRegister

                    #region Order Type Changes

                    sopUserDefinedFieldEntryForm.SopUserDefinedFieldEntry.OpenAfterOriginal += new EventHandler(SopUserDefinedFieldEntry_OpenAfterOriginal);
                    sopUserDefinedFieldEntryForm.SopUserDefinedFieldEntry.ExpansionButton.ClickAfterOriginal += new EventHandler(SopUserDefinedFieldEntryExpansionButton_ClickAfterOriginal);

                    #endregion Order Type Changes

                    #region Sop Hold Changes

                    sopProcessHoldsEntryForm.SopProcessHoldsEntry.CloseAfterOriginal += new EventHandler(SopProcessHoldsEntry_CloseAfterOriginal);

                    #endregion Sop Hold Changes

                    #region Print Window Changes

                    sopEntryForm.SopEntry.PrintButton.ClickAfterOriginal += new EventHandler(PrintButton_ClickAfterOriginal);

                    sopEntryForm.SopEntry.PrintBeforeOriginal += new System.ComponentModel.CancelEventHandler(SopEntryPrintBeforeOriginal);

                    sopPrintOptionsForm.SopPrintOptions.CpPickTicket.ClickAfterOriginal += new EventHandler(CpPickTicket_ClickAfterOriginal);
                    sopPrintOptionsForm.SopPrintOptions.OpenAfterOriginal += new EventHandler(SopPrintOptions_OpenAfterOriginal);
                    sopPrintOptionsForm.SopPrintOptions.LocalPrintPickingTicketCb.Change += new EventHandler(LocalPrintPickingTicketCb_Change);

                    #endregion Print Window Changes

                    #region Freight Amount Subtotal

                    sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.UOfM.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.Qty.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.UnitPrice.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.MarkdownAmount.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.ExtendedPrice.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.QtyCanceled.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.LocationCode.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.PriceLevel.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.TaxScheduleId.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.IvItemTaxable.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.ItemTaxScheduleId.Change += CalculateSubTotal;
                    sopItemDetailForm.SopItemDetail.TaxAmount.Change += CalculateSubTotal;

                    #endregion Freight Amount Subtotal

                    RegisterSalesEntryMgmt = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopEntry_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Could not open Sales Transaction Window : " + ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void DocumentAmountChange()
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopEntryForm.SopEntry.DocumentAmount.Value != sopEntryForm.SopEntry.LocalDocumentAmount.Value)
                {
                    sopEntryForm.SopEntry.LocalIsPriceUpdated.Value = true;
                }

            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DocumentAmountChange Method: " + ex.Message.ToString());
                MessageBox.Show("Could  not able to validate document amount change : " + ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "Completed validating Document Amount for TermHolds");
                logMessage = null;
                sopEntryForm.SopEntry.LocalIsPriceUpdated.Value = false;
            }
        }

        void TriggerSopEntryHdrLocationCode_InvokeBeforeOriginal(object sender, Dic4745.TriggerSopEntryHdrLocationCodeProcedure.InvokeEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                {
                    if (sopEntryForm.SopEntry.LocationCode.Value.ToString().Trim() != "" &&
                        Dynamics.Globals.CompanyId.Value == 1 &&
                        !String.IsNullOrEmpty(sopEntryForm.Tables.SopHdrWork.ShippingMethod.Value))
                    {
                        string oldCarrieraddress = "";
                        string newCarrierAddress = "";
                        int isValid = 0;
                        string carrierName = "";
                        string freightTerm = "";

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                        TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                        if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                        {
                            oldCarrieraddress = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value.ToString().Trim();
                            carrierName = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value.ToString().Trim();
                            freightTerm = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value.ToString().Trim();
                        }
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                        newCarrierAddress = ChemPointSalesExt.Functions.CpCarrierAddressInfo.Invoke(oldCarrieraddress,
                            carrierName,
                            freightTerm,
                            sopEntryForm.SopEntry.LocationCode.Value.ToString().Trim(),
                            sopEntryForm.Tables.SopHdrWork.ShippingMethod.Value.ToString().Trim());

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                        TableError tableErrorTransportationChange = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Change();
                        if (tableErrorTransportationChange == TableError.NoError && tableErrorTransportationChange != TableError.EndOfTable)
                        {
                            if (sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value != newCarrierAddress)
                            {
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value = newCarrierAddress;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IsUpdated.Value = 1;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Save();
                            }
                        }

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                        if (oldCarrieraddress != newCarrierAddress)
                        {
                            ResetThirdPartyAddress(newCarrierAddress);
                        }
                        if (newCarrierAddress == "")
                        {
                            isValid = 0;
                        }
                        else
                        {
                            isValid = 1;
                        }

                        int result = 0;
                        ChemPointSalesExt.Procedures.UpdateThirdPartyAddressDetails.Invoke(ref result, sopEntryForm.SopEntry.SopTypeDatabase.Value,
                            sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim(),
                            sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim(),
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value.ToString().Trim(),
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value.ToString().Trim(),
                            Dynamics.Globals.UserId.Value,
                            Convert.ToInt16(isValid));
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In TriggerSopEntryHdrLocationCode_InvokeBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void PrintButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            PickTicketRequest pickTicketRequest = null;
            PickTicketResponse pickTicketResponse = null;

            SalesOrderEntity salesOrder = null;

            int buttonOperationStatus = 0;
            string pickTicketMessage = string.Empty;
            bool isResult = false;
            bool isRunGPPTProcess = false;
            try
            {
                if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 6 &&
                    sopEntryForm.SopEntry.SopNumber.Value != string.Empty &&
                    sopEntryForm.SopEntry.CustomerNumber != string.Empty &&
                    sopEntryForm.SopEntry.LocationCode != string.Empty)
                {
                    if (sopEntryForm.SopEntry.IsChanged == true)
                    {
                        MessageBox.Show("The order details has been changed. Please save the order first and then reopen to print.", Resources.STR_MESSAGE_TITLE);
                        return;
                    }

                    if (Dynamics.Globals.CompanyId.Value == 1)
                    {
                        SalesOrderRequest shipMgrRequest = new SalesOrderRequest();
                        shipMgrRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                        salesOrder = new SalesOrderEntity();
                        salesOrder.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        salesOrder.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                        shipMgrRequest.SalesOrderEntity = salesOrder;

                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/UpdateOrderDetailsToWarehouseIBoard", shipMgrRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse shipMgrResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (shipMgrResponse.Status == ResponseStatus.Error)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In PrintButton_ClickAfterOriginal Method (UpdateOrderDetailsToWarehouseIBoard): " + shipMgrResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + shipMgrResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not save into ship manager Table");
                                MessageBox.Show("Error: Data does not save into ship manager Table", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }

                    System.Windows.Forms.Cursor.Current = Cursors.WaitCursor;

                    pickTicketRequest = new PickTicketRequest();
                    pickTicketRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                    pickTicketRequest.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    pickTicketRequest.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    pickTicketRequest.CompanyName = Dynamics.Globals.IntercompanyId.Value.ToString().Trim();
                    pickTicketRequest.UserID = Dynamics.Globals.UserId.Value.ToString().Trim();

                    using (HttpClient client = new HttpClient())
                    {
                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                        client.DefaultRequestHeaders.Accept.Clear();
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                        var response = client.PostAsJsonAsync("api/PickTicket/GetOrderPickTicketEligibleDetails", pickTicketRequest); // we need to refer the web.api service url here.
                        if (response.Result.IsSuccessStatusCode)
                        {
                            pickTicketResponse = response.Result.Content.ReadAsAsync<PickTicketResponse>().Result;
                            if (pickTicketResponse.Status == ResponseStatus.Success)
                            {
                                isResult = true;
                            }
                            else
                            {
                                if (!string.IsNullOrWhiteSpace(pickTicketResponse.Message))
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Unknown error occurred and unable to process pick ticket due to " + pickTicketResponse.Message + ". Please contact IT.");
                                    MessageBox.Show("Unknown error occurred and unable to process pick ticket due to " + pickTicketResponse.Message + ". Please contact IT.", Resources.STR_MESSAGE_TITLE);
                                }
                                else
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Unknown error occurred and unable to process pick ticket. Please contact IT.");
                                    MessageBox.Show("Unknown error occurred and unable to process pick ticket. Please contact IT.", Resources.STR_MESSAGE_TITLE);
                                }
                            }
                        }
                        else
                        {
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error occurred while fetching eligiblity status. Please contact IT.");
                            MessageBox.Show("Error occurred while fetching eligiblity status. Please contact IT.", Resources.STR_MESSAGE_TITLE);
                        }
                    }
                    if (isResult && pickTicketResponse != null)
                    {
                        if ((pickTicketResponse.IsEdiIntegratedWarehouse && string.IsNullOrEmpty(pickTicketResponse.EdiPTSendErrorMessage)) || pickTicketResponse.IsXmlIntegratedWarehouse || pickTicketResponse.IsIntegratedCarrier)
                        {
                            pickTicketRequest.WarehouseID = pickTicketResponse.WarehouseId;

                            ChemPointSalesExt.Tables.SopHdrWork.Close();
                            ChemPointSalesExt.Tables.SopHdrWork.Release();
                            ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = pickTicketRequest.SopNumber.ToString().Trim();
                            ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = 6;
                            ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                            TableError tableError = ChemPointSalesExt.Tables.SopHdrWork.Get();
                            if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                            {
                                pickTicketRequest.OrigNumber = ChemPointSalesExt.Tables.SopHdrWork.OriginalNumber.Value.ToString().Trim();
                            }
                            else
                            {
                                pickTicketRequest.OrigNumber = "";
                            }
                            ChemPointSalesExt.Tables.SopHdrWork.Release();
                            ChemPointSalesExt.Tables.SopHdrWork.Close();

                            StringBuilder ptWarehouseName = new StringBuilder();

                            ptWarehouseName.Append(((pickTicketResponse.IsXmlIntegratedWarehouse || pickTicketResponse.IsEdiIntegratedWarehouse) ? pickTicketResponse.WarehouseName.Trim() : ""));
                            if (pickTicketResponse.IsIntegratedCarrier)
                                ptWarehouseName.Append(" " + pickTicketResponse.CarrierId.Trim());

                            if (pickTicketResponse.EdiPTSendOperation == "AwaitingAcknowledgement") //Pick ticket already submitted, waiting for response from warehouse.
                            {
                                pickTicketMessage = "Awaiting responce from warehouse : " + ptWarehouseName.ToString().Trim() + ". Please try after some time.";
                                buttonOperationStatus = ChemPointSalesExt.Functions.PickTicketConfirmationMessage.Invoke(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim(), pickTicketMessage, Convert.ToInt16(DocumentOperationStatus.AwaitingAcknowledgement));
                                if (buttonOperationStatus == 0)
                                {
                                    isRunGPPTProcess = true;
                                }
                            }
                            else if ((pickTicketResponse.IsEdiIntegratedWarehouse && pickTicketResponse.EdiPTSendOperation == "Print") ||
                                     ((pickTicketResponse.IsXmlIntegratedWarehouse || pickTicketResponse.IsIntegratedCarrier) && pickTicketResponse.IsXmlPTSendBefore == false))
                            {
                                pickTicketMessage = "Do you want to send pick ticket to :" + ptWarehouseName.ToString().Trim() + ".";
                                buttonOperationStatus = ChemPointSalesExt.Functions.PickTicketConfirmationMessage.Invoke(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim(), pickTicketMessage, Convert.ToInt16(DocumentOperationStatus.Print));
                                if (buttonOperationStatus == 1)
                                {
                                    CallServiceToPrintPT(pickTicketRequest, "Insert", 1);
                                }
                                else
                                {
                                    isRunGPPTProcess = true;
                                }
                            }
                            else if ((pickTicketResponse.IsEdiIntegratedWarehouse && (pickTicketResponse.EdiPTSendOperation == "ReprintAndCancel" || pickTicketResponse.EdiPTSendOperation == "Reprint")) ||
                                     ((pickTicketResponse.IsXmlIntegratedWarehouse || pickTicketResponse.IsIntegratedCarrier) && pickTicketResponse.IsXmlPTSendBefore == true))
                            {
                                pickTicketMessage = "This order has already been sent to " + ptWarehouseName.ToString().Trim() +
                                                    ".Please ensure you call " + ptWarehouseName.ToString().Trim() + " before Resubmit. Thanks!";
                                buttonOperationStatus = ChemPointSalesExt.Functions.PickTicketConfirmationMessage.Invoke(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim(), pickTicketMessage, Convert.ToInt16(DocumentOperationStatus.ReprintAndCancel));
                                if (buttonOperationStatus == 2 || buttonOperationStatus == 3)
                                {
                                    CallServiceToPrintPT(pickTicketRequest, "Update", 3);
                                }
                                else if (buttonOperationStatus == 4)
                                {
                                    CallServiceToPrintPT(pickTicketRequest, "Delete", 4);
                                }
                                else
                                {
                                    isRunGPPTProcess = true;
                                }
                            }
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(pickTicketResponse.EdiPTSendErrorMessage))
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Unable to print the pick ticket: " + pickTicketResponse.EdiPTSendErrorMessage.ToString());
                                MessageBox.Show("Unable to print the pick ticket :  " + pickTicketResponse.EdiPTSendErrorMessage.ToString(), Resources.STR_MESSAGE_TITLE);
                                isRunGPPTProcess = false;
                            }
                            else
                            {
                                isRunGPPTProcess = true;
                            }
                        }
                    }
                    else
                    {
                        isRunGPPTProcess = true;
                    }
                    if (isRunGPPTProcess)
                    {
                        ChemPointSalesExt.Procedures.SopEntryWindowPrintRunValidate.Invoke();
                    }
                }
                else
                {
                    ChemPointSalesExt.Procedures.SopEntryWindowPrintRunValidate.Invoke();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In PrintButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                System.Windows.Forms.Cursor.Current = Cursors.Arrow;
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        private void CallServiceToPrintPT(PickTicketRequest pickTicketRequest, string transactionType, int operationStatus)
        {
            StringBuilder logMessage = new StringBuilder();

            PickTicketResponse pickTicketResponse = null;

            try
            {
                System.Windows.Forms.Cursor.Current = Cursors.WaitCursor;

                pickTicketRequest.RequestType = transactionType;
                pickTicketRequest.OperationStatus = operationStatus;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/PickTicket/PrintPickTicket", pickTicketRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        pickTicketResponse = response.Result.Content.ReadAsAsync<PickTicketResponse>().Result;
                        if (pickTicketResponse.Status == ResponseStatus.Success)
                        {
                            if (transactionType.Equals("Insert") ||
                                transactionType.Equals("Update"))
                            {
                                MessageBox.Show("Pick Ticket has been sent successfully.", Resources.STR_MESSAGE_TITLE);
                            }
                            else if (transactionType.Equals("Delete"))
                            {
                                MessageBox.Show("Pick Ticket is successfully cancelled.", Resources.STR_MESSAGE_TITLE);
                            }

                            ChemPointSalesExt.Procedures.SopEntryWindowPrintRunValidate.Invoke();
                        }
                        else
                        {
                            if (!string.IsNullOrWhiteSpace(pickTicketResponse.Message))
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Unable to print the pick ticket: " + pickTicketResponse.Message);
                                MessageBox.Show(pickTicketResponse.Message, "Pick Ticket Status");
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Unknown error occurred and unable to process pick ticket. Please contact IT.");
                                MessageBox.Show("Unknown error occurred and unable to process pick ticket. Please contact IT.", "Pick Ticket Status");
                            }
                        }
                    }
                    else
                    {
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error occurred while sending pick ticket. Please contact IT.");
                        MessageBox.Show("Error occurred while sending pick ticket. Please contact IT.", Resources.STR_MESSAGE_TITLE);
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CallServiceToPrintPT Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                System.Windows.Forms.Cursor.Current = Cursors.Arrow;
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// This event will be called when PrintButton of SOP_Entry form is clicked. This will log in auditor logs
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopEntryPrintBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (Dynamics.Globals.CompanyId.Value == 2 &&
                    sopEntryForm.SopEntry.SopTypeDatabase.Value == 6 &&
                    sopEntryForm.SopEntry.SopNumber.Value.Trim() != string.Empty)
                {
                    UpdateSopStatus(sopEntryForm.SopEntry.SopNumber.Value, sopEntryForm.SopEntry.SopTypeDatabase.Value);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopEntryPrintBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void CalculateSubTotal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                ChemPointSalesExt.Functions.PcbSopItemDetailSubtotalDisplay.Invoke(sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.Value, 0, sopItemDetailForm.SopItemDetail.ExtendedPrice.Value);
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CalculateSubTotal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Tobe cancelled and ExcludeServiceSkus Field Value update..
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void TobeCancelledAndExcludeServiceSkus_LeaveAfterOriginal(object sender, EventArgs e)
        {
            string sopNumber = string.Empty, originNumber = string.Empty, notes = string.Empty, timeStamp = string.Empty;
            int sopType, originSopType;
            StringBuilder logMessage = new StringBuilder();
            try
            {

                #region Transportation Details
                
                bool isChanged = false;
                bool isCustomizeServiceSkUs = false;
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                logMessage.AppendLine(DateTime.Now.ToString() + "TobeCancelledAndExcludeServiceSkus_LeaveAfterOriginal Invoked");
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Change();
                if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                {
                    if (sopEntryForm.Tables.SopCustomerDetailTransportationTemp.TobeCancelled.Value != sopEntryForm.SopEntry.TobeCancelled.Value)
                    {
                        logMessage.AppendLine(DateTime.Now.ToString() + "TobeCancelled value Changed");
                        logMessage.AppendLine(DateTime.Now.ToString() + "isChanged" + isChanged.ToString());
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.TobeCancelled.Value = sopEntryForm.SopEntry.TobeCancelled.Value;
                        isChanged = true;
                        logMessage.AppendLine(DateTime.Now.ToString() + "isChanged" + isChanged.ToString());
                    }
                    #region SkuCodeChange
                    if (sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value != sopEntryForm.SopEntry.CustomizeServiceSkUs.Value)
                    {
                        SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                        SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                        AuditInformation auditInformation = new AuditInformation();
                        logMessage.AppendLine(DateTime.Now.ToString() + "CustomizeServiceSkUs value Changed");
                        //sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value = sopEntryForm.SopEntry.CustomizeServiceSkUs.Value;
                        if (!string.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value))
                        {
                            if (sopEntryForm.SopEntry.CustomizeServiceSkUs == true)
                            {
                                timeStamp = DateTime.Now.ToString("MM/dd/yyyy HH:mm:ss", System.Globalization.CultureInfo.InvariantCulture);
                                notes = "User " + Dynamics.Globals.UserId.Value + " turned on Service SKU customization from GP on " + timeStamp;
                                logMessage.AppendLine(DateTime.Now.ToString() + "XRM Notes Value" +notes.ToString());
                                isCustomizeServiceSkUs = true;
                            }
                            else
                            {
                                timeStamp = DateTime.Now.ToString("MM/dd/yyyy HH:mm:ss", System.Globalization.CultureInfo.InvariantCulture);
                                notes = "User " + Dynamics.Globals.UserId.Value + " turned off Service SKU customization from GP on " + timeStamp;
                                logMessage.AppendLine(DateTime.Now.ToString() + "XRM Notes Value" + notes.ToString());
                                isCustomizeServiceSkUs = false;
                            }

                            sopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            sopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            originNumber = sopNumber;
                            logMessage.AppendLine(DateTime.Now.ToString() + "originNumber" + originNumber.ToString());
                            ChemPointSalesExt.Tables.SopHdrWork.Close();
                            ChemPointSalesExt.Tables.SopHdrWork.Release();
                            ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopNumber;
                            ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = 3;
                            ChemPointSalesExt.Tables.SopHdrWork.RangeStart();
                            ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                            ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopNumber;
                            ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = 6;
                            ChemPointSalesExt.Tables.SopHdrWork.RangeEnd();
                            ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                            TableError tableError1 = ChemPointSalesExt.Tables.SopHdrWork.Get();
                            if (tableError1 == TableError.NoError && tableError1 != TableError.EndOfTable)
                            {
                                originNumber = ChemPointSalesExt.Tables.SopHdrWork.OriginalNumber.Value.ToString().Trim();
                                logMessage.AppendLine(DateTime.Now.ToString() + "originNumber in FO" + originNumber.ToString());
                            }
                            

                            ChemPointSalesExt.Tables.SopHdrWork.Release();
                            ChemPointSalesExt.Tables.SopHdrWork.Close();
                            logMessage.AppendLine(DateTime.Now.ToString() + "PublishSalesOrderNotes Method invloked start");
                            if (!string.IsNullOrEmpty(originNumber))
                            {
                                string xrmStatusResult = new XrmService().PublishSalesOrderNotes(originNumber, xrmPublishURL, Dynamics.Globals.UserId.Value, notes, "GP", Dynamics.Globals.IntercompanyId.Value);
                                logMessage.AppendLine(DateTime.Now.ToString() + "PublishSalesOrderNotes Method invloked Sucessfully");
                                if (xrmStatusResult.Trim().Length > 0)
                                {
                                    logMessage.AppendLine(DateTime.Now.ToString() + " - Updating Status  for Sales orders(FO)-Failed to publish the status for Sales orders" + originNumber + "\r\n");
                                }
                            }
                            salesOrderEntity.SopNumber = originNumber;
                            salesOrderEntity.SopType = sopType;
                            auditInformation.CompanyId = Dynamics.Globals.CompanyId.Value;
                            auditInformation.CreatedBy = Dynamics.Globals.UserId.Value.ToString();
                            salesOrderRequest.SalesOrderEntity = salesOrderEntity;
                            salesOrderRequest.AuditInformation = auditInformation;
                            salesOrderRequest.IsCustomizeServiceSkUs = isCustomizeServiceSkUs;
                            
                            // Record Inserted to Audit Log 
                            //Service Call...
                            using (HttpClient client = new HttpClient())
                            {
                                client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                client.DefaultRequestHeaders.Accept.Clear();
                                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                logMessage.AppendLine(DateTime.Now.ToString() + "Before AuditCustomizeServiceSkU Service call");
                                var response = client.PostAsJsonAsync("api/SalesOrderUpdate/AuditCustomizeServiceSkU/", salesOrderRequest); // we need to refer the web.api service url here.
                                if (response.Result.IsSuccessStatusCode)
                                {
                                    SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                    if (salesOrderResponse.Status == ResponseStatus.Success)
                                    {
                                        logMessage.AppendLine(DateTime.Now.ToString() + salesOrderResponse.LogginMessage);
                                    }
                                    else
                                    {
                                        logMessage.AppendLine(DateTime.Now.ToString() + salesOrderResponse.LogginMessage);
                                        logMessage.AppendLine(DateTime.Now.ToString() + "Error in AuditCustomizeServiceSkU Service Method");
                                    }
                                    
                                }
                                else
                                {
                                    logMessage.AppendLine(DateTime.Now.ToString() + "Error in AuditCustomizeServiceSkU Service call");
                                }
                                logMessage.AppendLine(DateTime.Now.ToString() + " AuditCustomizeServiceSkU Service called Successfully");
                            }
                        }
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value = sopEntryForm.SopEntry.CustomizeServiceSkUs.Value;
                        isChanged = true;
                    }

                    #endregion
                    if (isChanged)
                    {
                        // Edited transportation. wrote logic instead of force changes window
                        if (!sopEntryForm.SopEntry.IsChanged)
                            sopEntryForm.SopEntry.IsChanged = true;

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IsUpdated.Value = 1;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Save();
                    }
                }

                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                #endregion Transportation Details
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In TobeCancelledAndExcludeServiceSkus_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// This method tracks whether the sop document void or not. If voids then it updates the status to XRM.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void LocalNumberVoided_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            bool isResult = false;
            try
            {
                // Checks for the voidnumber.
                // Checks whether the SOPTYPE is 4(Return) and 1(quote) as these are Form level values.
                if (sopEntryForm.SopEntry.SopNumber.Value != "" &&
                    sopEntryForm.SopEntry.LocalNumberVoided.Value > 0 &&
                    sopEntryForm.SopEntry.SopTypeDatabase.Value != 4 &&
                    sopEntryForm.SopEntry.SopTypeDatabase.Value != 1)
                {
                    SalesOrderRequest _salesOrderRequest = new SalesOrderRequest();
                    SalesOrderEntity _salesOrderEntity = new SalesOrderEntity();
                    _salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                    _salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    _salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;

                    string originalNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 3 || sopEntryForm.SopEntry.SopTypeDatabase.Value == 6)
                    {
                        ChemPointSalesExt.Tables.SopHdrWork.Close();
                        ChemPointSalesExt.Tables.SopHdrWork.Release();
                        ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                        ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                        TableError tableError = ChemPointSalesExt.Tables.SopHdrWork.Get();
                        if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            if (!String.IsNullOrEmpty(ChemPointSalesExt.Tables.SopHdrWork.OriginalNumber.Value.ToString().Trim()))
                            {
                                originalNumber = ChemPointSalesExt.Tables.SopHdrWork.OriginalNumber.Value.ToString().Trim();
                            }
                            else
                            {
                                originalNumber = "";
                            }
                        }
                        ChemPointSalesExt.Tables.SopHdrWork.Release();
                        ChemPointSalesExt.Tables.SopHdrWork.Close();
                    }

                    _salesOrderEntity.OrigNumber = originalNumber;
                    _salesOrderRequest.SalesOrderEntity = _salesOrderEntity;

                    if (_salesOrderRequest != null)
                    {
                        //Service Call...
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderVoid/SalesOrderVoid/", _salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesOrderResponse.Status == ResponseStatus.Success)
                                {
                                    isResult = true;
                                }
                                else
                                {
                                    isResult = false;
                                }
                            }
                            else
                            {
                                isResult = false;
                            }
                        }
                        if (!isResult)
                        {
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into SaveSopTransactionAddressCodes Table");
                            MessageBox.Show("Error: Data does not saved into SaveSopTransactionAddressCodes Table", Resources.STR_MESSAGE_TITLE);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalNumberVoided_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Could not able to update void status to XRM. " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Fired when IsAddressSave changed Save Header >> AddressID and Comments
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopEntryLocalIsAddressSave_Change(object sender, EventArgs e)
        {
            if (!String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value))
            {
                if (Dynamics.Globals.CompanyId.Value == 1)
                {
                    SaveAllocatedQtyDetails(Resources.STR_SopEntryForm);  // verify Allocated Qty.
                    if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 6)
                        ValidateSOPLineDetails(); //verify if amount mismatched or not (MIsc Amount,Freight,Tax
                }

                ValidateWarehouseClosureDate();

                SaveSopEntryDetails(Resources.STR_SopEntryForm);

                SaveAddressDetails(Resources.STR_SopEntryForm);  // save data into custom address table

                SaveCommentDetails(Resources.STR_SopEntryForm);  // save data into custom comment table

                if(Dynamics.Globals.CompanyId.Value==1)
                {
                    ExportHold(Resources.STR_SopEntryForm);
                }
               
            }
        }

        private void ExportHold(string formName)
        {
            if (formName == Resources.STR_SopEntryForm)
            {
                StringBuilder logMessage = new StringBuilder();
                AuditInformation auditInformation = new AuditInformation();
                HoldEngineRequest holdEngineRequestExport = new HoldEngineRequest();
                HoldEngineResponse holdEngineResponse = new HoldEngineResponse();
                HoldEngineEntity holdEngineEntityExport = new HoldEngineEntity();
                OrderHeader holdorderHeaderExportHold = new OrderHeader();
                string LocationCodeCountry = string.Empty;
                string LocationCodeCC = string.Empty;
                bool isResult = true;
                exportValidation = 0;
                isCountryChange = false;
                isLineAdded = false;
                orignNumber = string.Empty;
                 //ItemListAfterSave.
                 ItemListAfterSave = new Dictionary<int, string>();
                ItemNumberandDescription = new Dictionary<int, string>();
                string dropShip=string.Empty;
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " ExportHold Method start");


                #region ExportHold

                try
                {
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;   // 2: used for Shipto address
                    sopEntryForm.Tables.SalesAddressDetails.Key = 2;
                    TableError tempErrorExport = sopEntryForm.Tables.SalesAddressDetails.GetFirst();
                    while (tempErrorExport == TableError.NoError && tempErrorExport != TableError.EndOfTable)
                    {
                        if (sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value == 2)
                        {
                            holdorderHeaderExportHold.NewShipToCountry = sopEntryForm.Tables.SalesAddressDetails.Country.Value.ToString().Trim();
                            LocalShipToCountryCode = sopEntryForm.Tables.SalesAddressDetails.CountryCode.Value.ToString().Trim();

                        }
                        tempErrorExport = sopEntryForm.Tables.SalesAddressDetails.GetNext();
                    }
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.Close();

                    sopEntryForm.Tables.SopHdrWork.Close();
                    sopEntryForm.Tables.SopHdrWork.Release();
                    sopEntryForm.Tables.SopHdrWork.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopHdrWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SopHdrWork.Key = 1;
                    TableError tableErrorTrm = sopEntryForm.Tables.SopHdrWork.Get();
                    if (tableErrorTrm == TableError.NoError && tableErrorTrm != TableError.EndOfTable)
                    {
                        holdorderHeaderExportHold.NewFinalDestinationCountry = sopEntryForm.Tables.SopHdrWork.Country.Value.ToString().Trim();
                        ReqShipDate = sopEntryForm.Tables.SopHdrWork.RequestedShipDate.Value;
                        orignNumber = sopEntryForm.Tables.SopHdrWork.OriginalNumber.Value;
                        LocalFinalDestinationCode = sopEntryForm.Tables.SopHdrWork.CountryCode.Value.ToString().Trim();
                    }
                    sopEntryForm.Tables.SopHdrWork.Release();
                    sopEntryForm.Tables.SopHdrWork.Close();

                    sopEntryForm.Tables.IvLocationSetp.Close();
                    sopEntryForm.Tables.IvLocationSetp.Release();
                    sopEntryForm.Tables.IvLocationSetp.LocationCode.Value = sopEntryForm.SopEntry.LocationCode.Value;
                    sopEntryForm.Tables.IvLocationSetp.Key = 1;
                    TableError tempErrorExportLocn = sopEntryForm.Tables.IvLocationSetp.Get();
                    if (tempErrorExportLocn == TableError.NoError && tempErrorExportLocn != TableError.EndOfTable)
                    {
                        LocationCodeCountry = sopEntryForm.Tables.IvLocationSetp.Country.Value;
                        dropShip = sopEntryForm.Tables.IvLocationSetp.LocationCode.Value.ToString().Trim();
                        LocalShipFromCountryCode = sopEntryForm.Tables.IvLocationSetp.CountryCode.Value;
                    }
                    sopEntryForm.Tables.IvLocationSetp.Release();
                    sopEntryForm.Tables.IvLocationSetp.Close();



                    //Line.
                    sopEntryForm.Tables.SopLineWork.Close();
                    sopEntryForm.Tables.SopLineWork.Release();
                    sopEntryForm.Tables.SopLineWork.RangeClear();
                    sopEntryForm.Tables.SopLineWork.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopLineWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SopLineWork.LineItemSequence.Clear();
                    sopEntryForm.Tables.SopLineWork.ComponentSequence.Value = 0;
                    sopEntryForm.Tables.SopLineWork.RangeStart();
                    sopEntryForm.Tables.SopLineWork.Key = 1;
                    sopEntryForm.Tables.SopLineWork.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopLineWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SopLineWork.LineItemSequence.Fill();
                    sopEntryForm.Tables.SopLineWork.ComponentSequence.Value = 0;
                    sopEntryForm.Tables.SopLineWork.RangeEnd();
                    sopEntryForm.Tables.SopLineWork.Key = 1;

                    TableError error = sopEntryForm.Tables.SopLineWork.GetFirst();
                    while (error != TableError.EndOfTable && error == TableError.NoError)
                    {
                        if (!sopEntryForm.Tables.SopLineWork.ItemNumber.Value.ToString().StartsWith("8"))
                        {
                            ItemListAfterSave.Add(sopEntryForm.Tables.SopLineWork.LineItemSequence.Value, sopEntryForm.Tables.SopLineWork.ItemNumber.Value.ToString().Trim());
                            ItemNumberandDescription.Add(sopEntryForm.Tables.SopLineWork.LineItemSequence.Value, sopEntryForm.Tables.SopLineWork.ItemDescription.Value.ToString().Trim());
                        }
                        error = sopEntryForm.Tables.SopLineWork.GetNext();
                    }
                    sopEntryForm.Tables.SopLineWork.Release();
                    sopEntryForm.Tables.SopLineWork.Close();


                    //if (ItemList.Count < ItemListAfterSave.Count)
                    //    isLineAdded = true;
                    //else 
                    //if (ItemList.Count > ItemListAfterSave.Count)
                    //    isLineAdded = false;
                    //else
                    //{
                        foreach (var itemNumebr in ItemListAfterSave)
                        {
                            string KeyValue;
                            if (!ItemList.TryGetValue(itemNumebr.Key, out KeyValue))
                            {
                            //ItemList.Values.Any(v => v.Contains(itemNumebr.Value))
                            //if (!itemNumebr.Value.Contains(ItemList.Values.ToString()) && isLineAdded == false)
                            //{
                            if (!ItemList.Values.Any(v => v.Contains(itemNumebr.Value)) && isLineAdded == false)
                            {
                                if (KeyValue != itemNumebr.Value)
                                    {
                                        isLineAdded = true;
                                    }
                                }
                            }
                        }

                    //}

                    CountryCodeChange(holdorderHeaderExportHold.NewShipToCountry, LocationCodeCountry, holdorderHeaderExportHold.NewFinalDestinationCountry);

                    if (LocalShipToCountry != GPShipToCountry || LocalFinalDestination != GPFinalDestination || LocalShipFromCountry != GPShipFromCountry)
                    {
                        isCountryChange = true;
                    }

                    if ((isCountryChange == true || isLineAdded == true) && dropShip != "DROPSHIP")
                    {
                        holdorderHeaderExportHold.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                        holdorderHeaderExportHold.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        holdorderHeaderExportHold.IsLineAdded = isLineAdded;
                        holdorderHeaderExportHold.ShipToCountry = GPShipToCountry; //sopEntryForm.SopEntry.ShipToCountry.Value.ToString().Trim();
                        holdorderHeaderExportHold.ShipToCountryCode = sopEntryForm.SopEntry.ShipToCountryCode.Value;
                        holdorderHeaderExportHold.ShipFromCountry = GPShipFromCountry; //sopEntryForm.SopEntry.ShipFromCountry.Value.ToString().Trim();
                        holdorderHeaderExportHold.ShipFromCountryCode = sopEntryForm.SopEntry.ShipFromCountryCode.Value;
                        holdorderHeaderExportHold.FinalDestinationCountry = GPFinalDestination; //sopEntryForm.SopEntry.FinalDestinationCountry.Value.ToString().Trim();
                        holdorderHeaderExportHold.FinalDestinationCountryCode = sopEntryForm.SopEntry.FinalDestinationCc.Value;
                        holdorderHeaderExportHold.NewShipToCountry = LocalShipToCountry;
                        holdorderHeaderExportHold.NewShipToCountryCode = LocalShipToCountryCode;
                        holdorderHeaderExportHold.NewShipFromCountry = LocalShipFromCountry;
                        holdorderHeaderExportHold.NewShipFromCountryCode = LocalShipFromCountryCode;
                        holdorderHeaderExportHold.NewFinalDestinationCountry = LocalFinalDestination;
                        holdorderHeaderExportHold.NewFinalDestinationCountryCode = LocalFinalDestinationCode;
                        holdEngineRequestExport.CompanyId = 1;
                        holdEngineEntityExport.BatchUserID = Dynamics.Globals.UserId.Value;

                        holdEngineEntityExport.OrderHeader = holdorderHeaderExportHold;
                        holdEngineRequestExport.HoldEngineEntity = holdEngineEntityExport;

                        if (!string.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) &&
                            !string.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString().Trim()))
                        {
                            // Service call ...
                            using (HttpClient client = new HttpClient())
                            {
                                client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                client.DefaultRequestHeaders.Accept.Clear();
                                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                var response = client.PostAsJsonAsync("api/HoldEngine/ProcessExportHold/", holdEngineRequestExport); // we need to refer the web.api service url here.

                                if (response.Result.IsSuccessStatusCode)
                                {
                                    holdEngineResponse = response.Result.Content.ReadAsAsync<HoldEngineResponse>().Result;
                                    exportValidation = holdEngineResponse.Result;
                                    isResult = true;
                                }
                                else
                                {
                                    isResult = false;
                                }
                            }
                            if (!isResult)
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Hold not Applied");
                                MessageBox.Show("Error: Hold not Applied", Resources.STR_MESSAGE_TITLE);
                            }
                            GC.Collect();
                        }
                    }


                    if (exportValidation != 0 && (sopEntryForm.SopEntry.SopTypeDatabase.Value == 3 || sopEntryForm.SopEntry.SopTypeDatabase.Value == 6))
                    {
                        SendEmailRequest sendEmailRequest = new SendEmailRequest();
                        EMailInformation eMailInformation = new EMailInformation();
                        isContentLoaded = false;
                        MessageBox.Show("Before shipment, obtain export approval from the Conformance team. An email has been sent to the Conformance team notifying of the change in country.", Resources.STR_MESSAGE_TITLE);


                        if (exportValidation == 1 )
                        {
                            eMailInformation.Subject = "Country Change on Fulfillment Order | Cur Sched Ship Date: " + ReqShipDate.ToShortDateString() + " | Sales Order: " + orignNumber + "| Fulfillment Number " + holdEngineRequestExport.HoldEngineEntity.OrderHeader.SopNumber;
                            eMailInformation.Body = "Hello Team,<br><br>" +
                                "The subject international fulfillment order has had its country or country code updated by " + Dynamics.Globals.UserId +
                                ". As it is in fulfillment status at the warehouse, no GP hold has been added to the sales order restricting shipment." +
                                "Please urgently review the new country information and coordinate export approval or pause shipment. Please see additional order details below<br><br>";


                            List<string[]> countryChangeslist = new List<string[]>();
                            countryChangeslist.Add(new string[] { "Address Field", "Before Edit", "After Save" });
                            countryChangeslist.Add(new string[] { "Ship To Address:Country", GPShipToCountry, LocalShipToCountry });
                            countryChangeslist.Add(new string[] { "Final Destination Address:Country", GPFinalDestination, LocalFinalDestination });
                            countryChangeslist.Add(new string[] { "Ship From Address:Country", GPShipFromCountry, LocalShipFromCountry });

                            holdEngineRequestExport.CountryDetails = countryChangeslist;
                            sendEmailRequest.EmailInformation = eMailInformation;
                            holdEngineRequestExport.EmailRequest = sendEmailRequest;
                            MailExportServiceCall(holdEngineRequestExport);

                        }
                        if (exportValidation == 2)
                        {
                            eMailInformation.Subject = "New Product added on Fulfillment Order | Cur Sched Ship Date: " + ReqShipDate.ToShortDateString() + " | Sales Order " + orignNumber + "| Fulfillment Number " + holdEngineRequestExport.HoldEngineEntity.OrderHeader.SopNumber;
                            eMailInformation.Body = "Hello Team,<br><br>" +
                                    "The subject internationalfulfillment order has had a new unapproved product(s) added by " + Dynamics.Globals.UserId +
                                    ". As it is in fulfillment status at the warehouse, no GP hold has been added to the sales order restricting shipment." +
                                    "Please urgently review the new product information and coordinate export approval or pause shipment. Please see additional order details below<br><br>";

                            List<string[]> newLineAddedlist = new List<string[]>();
                            newLineAddedlist.Add(new string[] { "SKU Number", "SKU Description" });

                            foreach (var itemNumebr in ItemListAfterSave)
                            {
                                string KeyValue;
                                if (!ItemList.TryGetValue(itemNumebr.Key, out KeyValue))
                                {
                                    if (!itemNumebr.Value.Contains(ItemList.Values.ToString()))
                                    {
                                        string desctiption;
                                        foreach (var itemDesc in ItemNumberandDescription)
                                        {
                                            if (itemNumebr.Key == itemDesc.Key)
                                            {
                                                ItemNumberandDescription.TryGetValue(itemDesc.Key, out desctiption);
                                                newLineAddedlist.Add(new string[] { itemNumebr.Value, desctiption });
                                            }
                                        }
                                    }

                                }
                            }

                            holdEngineRequestExport.CountryDetails = newLineAddedlist;
                            sendEmailRequest.EmailInformation = eMailInformation;
                            holdEngineRequestExport.EmailRequest = sendEmailRequest;
                            MailExportServiceCall(holdEngineRequestExport);
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ProcessExportHold Method: " + ex.Message.ToString());
                }

                #endregion ExportHold



            }
        }


        private void MailExportServiceCall(HoldEngineRequest holdEngineRequestExport)
        {
            bool isResult;
            StringBuilder logMessage = new StringBuilder();
            using (HttpClient client = new HttpClient())
            {
                client.BaseAddress = new Uri(gpServiceConfigurationURL);
                client.DefaultRequestHeaders.Accept.Clear();
                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                var response = client.PostAsJsonAsync("api/HoldEngine/ExportHoldMailingDetails/", holdEngineRequestExport); // we need to refer the web.api service url here.

                if (response.Result.IsSuccessStatusCode)
                {
                    isResult = true;
                }
                else
                {
                    isResult = false;
                }
            }
            if (!isResult)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Mail didn't sent");
                MessageBox.Show("Error: Mail didn't sent", Resources.STR_MESSAGE_TITLE);
            }
            GC.Collect();

        }

        /// <summary>
        /// Valdiate sop hdr change.
        /// </summary>
        private void ValidateSOPLineDetails()
        {
            StringBuilder logMessage = new StringBuilder();
            bool isAmountChanged = false;
            decimal documentAmountDifference = 0.00M;
            try
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " ValidateSOPLineDetails Method start");
                OrderHeader orderHdr = new OrderHeader();
                CustomerInformation customerInfo = new CustomerInformation();
                ChemPointSalesExt.Tables.SopHdrWork.Close();
                ChemPointSalesExt.Tables.SopHdrWork.Release();
                ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                TableError tableError = ChemPointSalesExt.Tables.SopHdrWork.Get();
                if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                {

                    documentAmountDifference = ChemPointSalesExt.Tables.SopHdrWork.DocumentAmount.Value - sopEntryForm.SopEntry.LocalDocumentAmount.Value;
                    // Validate Total Documetn Amount > 10 Incresed or Not
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " DocumentAmountDifference :" + documentAmountDifference);
                    if (documentAmountDifference > 10)
                    {
                        if ((ChemPointSalesExt.Tables.SopHdrWork.FreightAmount.Value > sopEntryForm.SopEntry.LocalNewFreightAmount.Value) ||
                            (ChemPointSalesExt.Tables.SopHdrWork.TaxAmount.Value > sopEntryForm.SopEntry.LocalNewTaxAmount.Value) ||
                            (ChemPointSalesExt.Tables.SopHdrWork.MiscAmount.Value > sopEntryForm.SopEntry.LocalNewMiscAmount.Value))
                        {
                            isAmountChanged = true;
                            orderHdr.SopNumber = ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value.ToString();
                            orderHdr.OrderDate = ChemPointSalesExt.Tables.SopHdrWork.RequestedShipDate.Value;
                            customerInfo.CustomerName = ChemPointSalesExt.Tables.SopHdrWork.CustomerName.Value.ToString().Trim();
                            customerInfo.CustomerId = ChemPointSalesExt.Tables.SopHdrWork.CustomerNumber.Value.ToString().Trim();
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " isAmountChanged = " + isAmountChanged);
                        }
                    }
                }
                ChemPointSalesExt.Tables.SopHdrWork.Release();
                ChemPointSalesExt.Tables.SopHdrWork.Close();


                if (documentAmountDifference > 10)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + "Before FetchSalesOrderLineForTermHold Service Method ");
                    SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                    SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                    SalesOrderInformation salesOrderInfo = new SalesOrderInformation();
                    SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                    List<SalesLineItem> salesLineItems = new List<SalesLineItem>();
                    AuditInformation auditInfo = new AuditInformation();
                    auditInfo.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                    auditInfo.CompanyId = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);

                    sopEntryForm.Tables.SopAllocatedQtyTemp.Close();
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Release();
                    TableError tableError1 = sopEntryForm.Tables.SopAllocatedQtyTemp.GetFirst();
                    while (tableError1 == TableError.NoError && tableError1 != TableError.EndOfTable)
                    {
                        if (sopEntryForm.Tables.SopAllocatedQtyTemp.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value &&
                            sopEntryForm.Tables.SopAllocatedQtyTemp.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                        {
                            if (sopEntryForm.Tables.SopAllocatedQtyTemp.IsUpdated == 1)
                            {
                                SalesLineItem lineItem = new SalesLineItem();
                                lineItem.SopNumber = sopEntryForm.Tables.SopAllocatedQtyTemp.SopNumber.Value.ToString().Trim();
                                lineItem.SopType = sopEntryForm.Tables.SopAllocatedQtyTemp.SopType.Value;
                                lineItem.OrderLineId = sopEntryForm.Tables.SopAllocatedQtyTemp.LineItemSequence.Value;
                                lineItem.ComponentSequenceNumber = sopEntryForm.Tables.SopAllocatedQtyTemp.ComponentSequence.Value;
                                lineItem.ItemNumber = sopEntryForm.Tables.SopAllocatedQtyTemp.ItemNumber.Value.ToString().Trim();
                                lineItem.LocationCode = sopEntryForm.Tables.SopAllocatedQtyTemp.LocationCode.Value.ToString().Trim();
                                lineItem.AllocatedQuantity = sopEntryForm.Tables.SopAllocatedQtyTemp.QtyAllocated.Value;
                                lineItem.Quantity = sopEntryForm.Tables.SopAllocatedQtyTemp.Qty.Value;
                                lineItem.CancelledQuantity = sopEntryForm.Tables.SopAllocatedQtyTemp.QtyCanceled.Value;
                                lineItem.QuantityRemaining = sopEntryForm.Tables.SopAllocatedQtyTemp.QtyRemaining.Value;
                                salesLineItems.Add(lineItem);
                                lineItem = null;
                            }
                        }
                        tableError1 = sopEntryForm.Tables.SopAllocatedQtyTemp.GetNext();
                    }
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Release();
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Close();

                    if ((salesLineItems.Count != 0) || isAmountChanged)
                    {
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + "Before Calling FetchSalesOrderLineForTermHold ");
                        salesOrderDetails.LineItems = salesLineItems;
                        salesOrderInfo.Customer = customerInfo;
                        salesOrderInfo.SalesOrderDetails = salesOrderDetails;
                        salesOrderDetails.OrderHeader = orderHdr;
                        salesOrderEntity.SalesOrderDetails = salesOrderInfo;
                        salesOrderRequest.SalesOrderEntity = salesOrderEntity;
                        salesOrderRequest.AuditInformation = auditInfo;
                        salesOrderRequest.IsSopStatusExecute = isAmountChanged;
                        logMessage.AppendLine("isAmountChanged  " + isAmountChanged);
                        // Service Call for allocated Qty..
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                            logMessage.AppendLine("Before FetchSalesOrderLineForTermHold Service Method  ");
                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/FetchSalesOrderLineForTermHold", salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + "After Calling FetchSalesOrderLineForTermHold ");
                                SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                // Inventory item...
                                if (salesOrderResponse.TermHoldInventoryStatus == ResponseStatus.Success)
                                {
                                    MessageBox.Show("This is a prepayment customer has not yet paid the added Sales Order amount. Contact Credit team regarding the added funds so that added payment can be collected before shipment. ", Resources.STR_MESSAGE_TITLE);
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + "TermHoldInventoryStatus - Success (Invemtory item increased) ");
                                }
                                else if ((salesOrderResponse.TermHoldInventoryStatus == ResponseStatus.NoRecord))
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + "Inventory Sku has no record ");
                                }

                                // Service SKU ...
                                if ((salesOrderResponse.Status == ResponseStatus.NoRecord))
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + "Service Sku has no record ");
                                }
                                else if (salesOrderResponse.Status == ResponseStatus.Success)
                                {
                                    MessageBox.Show("Mail has been successfully sent to Credit Specialist team to collect the remaining Balance ", Resources.STR_MESSAGE_TITLE);
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + "Mail sent successfully ");
                                }
                                else if (salesOrderResponse.Status == ResponseStatus.Error)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveAllocatedQtyDetails Method (SaveAllocatedQtyDetails): " + salesOrderResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into SaveAllocatedQtyDetails Table");
                                MessageBox.Show("Error: Data does not saved into SaveAllocatedQtyDetails Table", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }
                }



            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveAllocatedQtyDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }



        /// <summary>
        /// SaveAllocatedQtyDetails
        /// </summary>
        /// <param name="formName"></param>
        private void SaveAllocatedQtyDetails(string formName)
        {
            if (formName == Resources.STR_SopEntryForm)
            {
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                    SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                    SalesOrderInformation salesOrderInfo = new SalesOrderInformation();
                    SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                    List<SalesLineItem> salesLineItems = new List<SalesLineItem>();
                    AuditInformation auditInfo = new AuditInformation();
                    auditInfo.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                    auditInfo.CompanyId = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);

                    sopEntryForm.Tables.SopAllocatedQtyTemp.Close();
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Release();
                    TableError tableError = sopEntryForm.Tables.SopAllocatedQtyTemp.GetFirst();
                    while (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (sopEntryForm.Tables.SopAllocatedQtyTemp.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value &&
                            sopEntryForm.Tables.SopAllocatedQtyTemp.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                        {
                            if (sopEntryForm.Tables.SopAllocatedQtyTemp.IsUpdated == 1)
                            {
                                SalesLineItem lineItem = new SalesLineItem();
                                lineItem.SopNumber = sopEntryForm.Tables.SopAllocatedQtyTemp.SopNumber.Value.ToString().Trim();
                                lineItem.SopType = sopEntryForm.Tables.SopAllocatedQtyTemp.SopType.Value;
                                lineItem.OrderLineId = sopEntryForm.Tables.SopAllocatedQtyTemp.LineItemSequence.Value;
                                lineItem.ComponentSequenceNumber = sopEntryForm.Tables.SopAllocatedQtyTemp.ComponentSequence.Value;
                                lineItem.ItemNumber = sopEntryForm.Tables.SopAllocatedQtyTemp.ItemNumber.Value.ToString().Trim();
                                lineItem.LocationCode = sopEntryForm.Tables.SopAllocatedQtyTemp.LocationCode.Value.ToString().Trim();
                                lineItem.AllocatedQuantity = sopEntryForm.Tables.SopAllocatedQtyTemp.QtyAllocated.Value;
                                lineItem.Quantity = sopEntryForm.Tables.SopAllocatedQtyTemp.Qty.Value;
                                lineItem.CancelledQuantity = sopEntryForm.Tables.SopAllocatedQtyTemp.QtyCanceled.Value;
                                lineItem.QuantityRemaining = sopEntryForm.Tables.SopAllocatedQtyTemp.QtyRemaining.Value;
                                salesLineItems.Add(lineItem);
                                lineItem = null;
                            }
                        }
                        tableError = sopEntryForm.Tables.SopAllocatedQtyTemp.GetNext();
                    }
                    if (salesLineItems.Count != 0)
                    {
                        salesOrderDetails.LineItems = salesLineItems;
                        salesOrderInfo.SalesOrderDetails = salesOrderDetails;
                        salesOrderEntity.SalesOrderDetails = salesOrderInfo;
                        salesOrderRequest.SalesOrderEntity = salesOrderEntity;
                        salesOrderRequest.AuditInformation = auditInfo;
                        // Service Call for allocated Qty..
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveAllocatedQty", salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesOrderResponse.Status == ResponseStatus.Error)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveAllocatedQtyDetails Method (SaveAllocatedQtyDetails): " + salesOrderResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into SaveAllocatedQtyDetails Table");
                                MessageBox.Show("Error: Data does not saved into SaveAllocatedQtyDetails Table", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }

                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveAllocatedQtyDetails Method: " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }

        /// <summary>
        /// Insert custom address into address details temp table
        /// </summary>
        /// <param name="formName">Specify Form Name</param>
        private void SaveAddressDetails(string formName)
        {
            if (formName == Resources.STR_SopEntryForm)
            {
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    List<AddressInformation> _addressInformationList = new List<AddressInformation>();
                    AddressInformation _addressInformation = null;
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                    sopEntryForm.Tables.SalesAddressDetails.Release();

                    TableError tableError = sopEntryForm.Tables.SalesAddressDetails.GetFirst();
                    while (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (sopEntryForm.Tables.SalesAddressDetails.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value &&
                            sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                        {
                            if (sopEntryForm.Tables.SalesAddressDetails.IsUpdated.Value == 1)   // Fetch only update records and pass it to save procedure
                            {
                                _addressInformation = new AddressInformation();
                                _addressInformation.CustomerID = sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value;
                                _addressInformation.AddressId = sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value;
                                _addressInformation.AddressCode = sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value;
                                _addressInformation.CustomerName = sopEntryForm.Tables.SalesAddressDetails.CustomerName.Value.ToString().Trim();
                                _addressInformation.ShipToName = sopEntryForm.Tables.SalesAddressDetails.ShipToName.Value.ToString().Trim();
                                _addressInformation.ContactName = sopEntryForm.Tables.SalesAddressDetails.ContactPerson.Value.ToString().Trim();
                                _addressInformation.AddressLine1 = sopEntryForm.Tables.SalesAddressDetails.Address1.Value.ToString().Trim();
                                _addressInformation.AddressLine2 = sopEntryForm.Tables.SalesAddressDetails.Address2.Value.ToString().Trim();
                                _addressInformation.AddressLine3 = sopEntryForm.Tables.SalesAddressDetails.Address3.Value.ToString().Trim();
                                _addressInformation.Country = sopEntryForm.Tables.SalesAddressDetails.Country.Value.ToString().Trim();
                                _addressInformation.City = sopEntryForm.Tables.SalesAddressDetails.City.Value.ToString().Trim();
                                _addressInformation.State = sopEntryForm.Tables.SalesAddressDetails.State.Value.ToString().Trim();
                                _addressInformation.ZipCode = sopEntryForm.Tables.SalesAddressDetails.ZipCode.Value.ToString().Trim();
                                _addressInformation.CountryCode = sopEntryForm.Tables.SalesAddressDetails.CountryCode.Value.ToString().Trim();
                                _addressInformation.Phone1 = sopEntryForm.Tables.SalesAddressDetails.Phone1.Value.ToString().Trim();
                                _addressInformation.Phone2 = sopEntryForm.Tables.SalesAddressDetails.Phone2.Value.ToString().Trim();
                                _addressInformation.Phone3 = sopEntryForm.Tables.SalesAddressDetails.Phone3.Value.ToString().Trim();
                                _addressInformation.Fax = sopEntryForm.Tables.SalesAddressDetails.Fax.Value.ToString().Trim();

                                _addressInformationList.Add(_addressInformation);
                                _addressInformation = null;
                            }
                        }
                        tableError = sopEntryForm.Tables.SalesAddressDetails.GetNext();
                    }

                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.Close();

                    if (_addressInformationList.Count > 0)
                    {
                        SalesOrderRequest _salesOrderRequest = new SalesOrderRequest();
                        SalesOrderEntity _salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation _salesOrderInformation = new SalesOrderInformation();
                        SalesOrderDetails _salesOrderDetails = new SalesOrderDetails();
                        OrderHeader _orderHeader = new OrderHeader();
                        AuditInformation _auditInformation = new AuditInformation();

                        _salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        _salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                        _auditInformation.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                        _auditInformation.CompanyId = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);   // chmpt-1 ... cpeur --2

                        _orderHeader.AddressDetails = _addressInformationList;
                        _salesOrderDetails.AuditInformation = _auditInformation;
                        _salesOrderDetails.OrderHeader = _orderHeader;
                        _salesOrderInformation.SalesOrderDetails = _salesOrderDetails;
                        _salesOrderEntity.SalesOrderDetails = _salesOrderInformation;
                        _salesOrderRequest.SalesOrderEntity = _salesOrderEntity;
                        _salesOrderRequest.CompanyID = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveSopTransactionAddressCodes", _salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesOrderResponse.Status == ResponseStatus.Error)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveAddressDetails Method (SaveSopTransactionAddressCodes): " + salesOrderResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into SaveSopTransactionAddressCodes Table");
                                MessageBox.Show("Error: Data does not saved into SaveSopTransactionAddressCodes Table", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveAddressDetails Method: " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }

        /// <summary>
        /// save data into custom comment table
        /// </summary>
        /// <param name="formName">Specify form name</param>
        private void SaveCommentDetails(string formName)
        {
            if (formName == Resources.STR_SopEntryForm)
            {
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    List<SalesInstruction> _lineInstructionList = new List<SalesInstruction>();
                    SalesInstruction _lineInstruction = null;

                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();

                    TableError tableError = sopEntryForm.Tables.SalesHeaderInstructionDetails.GetFirst();
                    while (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value &&
                            sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                        {
                            if (sopEntryForm.Tables.SalesHeaderInstructionDetails.IsUpdated.Value == 1)   // Fetch only update records and pass it to save procedure
                            {
                                _lineInstruction = new SalesInstruction();
                                _lineInstruction.InstructionTypeID = sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value;
                                _lineInstruction.InstructionCode = sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value.ToString().Trim();
                                _lineInstruction.CommentText = sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value.ToString().Trim();

                                _lineInstructionList.Add(_lineInstruction);
                                _lineInstruction = null;
                            }
                        }
                        tableError = sopEntryForm.Tables.SalesHeaderInstructionDetails.GetNext();
                    }

                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();

                    if (_lineInstructionList.Count > 0)
                    {
                        SalesOrderRequest _salesOrderRequest = new SalesOrderRequest();
                        SalesOrderEntity _salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation _salesOrderInformation = new SalesOrderInformation();
                        SalesOrderDetails _salesOrderDetails = new SalesOrderDetails();
                        OrderHeader _orderHeader = new OrderHeader();
                        AuditInformation _auditInformation = new AuditInformation();

                        _salesOrderEntity.SopType = sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value;
                        _salesOrderEntity.SopNumber = sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value;

                        _auditInformation.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                        _auditInformation.CompanyId = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);   // chmpt-1 ... cpeur --2

                        _orderHeader.SalesHeaderInstructionEntity = _lineInstructionList;
                        _salesOrderDetails.AuditInformation = _auditInformation;
                        _salesOrderDetails.OrderHeader = _orderHeader;
                        _salesOrderInformation.SalesOrderDetails = _salesOrderDetails;
                        _salesOrderEntity.SalesOrderDetails = _salesOrderInformation;
                        _salesOrderRequest.SalesOrderEntity = _salesOrderEntity;
                        _salesOrderRequest.CompanyID = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);

                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveHeaderCommentInstruction/", _salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesOrderResponse.Status == ResponseStatus.Error)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveCommentDetails Method (SaveHeaderCommentInstruction): " + salesOrderResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into header comment Table");
                                MessageBox.Show("Error: Data does not saved into header comment Table", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveCommentDetails Method (Sales Entry): " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
            else if (formName == Resources.STR_SopItemDetailForm)
            {
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    List<SalesInstruction> _lineInstructionList = new List<SalesInstruction>();
                    List<SalesLineItem> _lineItemList = new List<SalesLineItem>();
                    SalesInstruction _lineInstruction = null;

                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();

                    TableError tableError = sopItemDetailForm.Tables.SalesLineInstructionDetails.GetFirst();
                    while (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value == sopItemDetailForm.SopItemDetail.SopTypeDatabase &&
                            sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value.ToString().Trim() == sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim() &&

                            sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value == sopItemDetailForm.SopItemDetail.LineItemSequence.Value)
                        {
                            if (sopItemDetailForm.Tables.SalesLineInstructionDetails.IsUpdated.Value == 1

                                &&
                                sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value != 0)   // Fetch only update records and pass it to save procedure
                            {
                                _lineInstruction = new SalesInstruction();

                                _lineInstruction.LineItemSequence = sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value;
                                _lineInstruction.ComponentSequenceNumber = sopItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value;
                                _lineInstruction.InstructionTypeID = sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value;
                                _lineInstruction.InstructionCode = sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value.ToString().Trim();
                                _lineInstruction.CommentText = sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value;

                                _lineInstructionList.Add(_lineInstruction);
                                _lineInstruction = null;
                            }
                        }
                        tableError = sopItemDetailForm.Tables.SalesLineInstructionDetails.GetNext();
                    }
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();

                    if (_lineInstructionList.Count > 0)
                    {
                        SalesOrderRequest _salesOrderRequest = new SalesOrderRequest();
                        SalesOrderEntity _salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation _salesOrderInformation = new SalesOrderInformation();
                        SalesOrderDetails _salesOrderDetails = new SalesOrderDetails();
                        OrderHeader _orderHeader = new OrderHeader();
                        AuditInformation _auditInformation = new AuditInformation();
                        SalesLineItem _lineItem = new SalesLineItem();

                        _salesOrderEntity.SopType = sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value;
                        _salesOrderEntity.SopNumber = sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value;

                        _auditInformation.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                        _auditInformation.CompanyId = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);   // chmpt-1 ... cpeur --2

                        _lineItem.SalesLineInstruction = _lineInstructionList;
                        _lineItemList.Add(_lineItem);
                        _salesOrderDetails.LineItems = _lineItemList;
                        _salesOrderDetails.AuditInformation = _auditInformation;
                        _salesOrderInformation.SalesOrderDetails = _salesOrderDetails;
                        _salesOrderEntity.SalesOrderDetails = _salesOrderInformation;
                        _salesOrderRequest.SalesOrderEntity = _salesOrderEntity;
                        _salesOrderRequest.CompanyID = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);

                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveLineCommentInstruction", _salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesOrderResponse.Status == ResponseStatus.Error)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveCommentDetails Method (SaveLineCommentInstruction): " + salesOrderResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into Line comment Table");
                                MessageBox.Show("Error: Data does not saved into Line comment Table", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveCommentDetails Method (Item Detail Entry): " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }

        private void AddressLookup_CloseAfterOriginal(object sender, EventArgs e)
        {
            lookupWindowType = string.Empty;
        }

        /// <summary>
        /// calling Service to fetch SOp entry window related data ...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void SOPLocalIsAddressDisplay_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 6 || sopEntryForm.SopEntry.SopTypeDatabase.Value == 3)
                {
                    if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 3)
                    {
                        sopEntryForm.SopEntry.TobeCancelled.Show();
                        sopEntryForm.SopEntry.TobeCancelled.Lock();
                    }
                    else
                    {
                        sopEntryForm.SopEntry.TobeCancelled.Show();
                        sopEntryForm.SopEntry.TobeCancelled.Unlock();
                    }
                }
                else
                {
                    sopEntryForm.SopEntry.TobeCancelled.Hide();
                }

                IsValidateServiceSkus = true;
                if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 4 || sopEntryForm.SopEntry.SopTypeDatabase.Value == 5)
                {
                    sopEntryForm.SopEntry.CustomizeServiceSkUs.Show();
                    sopEntryForm.SopEntry.CustomizeServiceSkUs.Lock();
                }
                else
                {
                    sopEntryForm.SopEntry.CustomizeServiceSkUs.Show();
                    sopEntryForm.SopEntry.CustomizeServiceSkUs.Unlock();
                }

                InsertSopEntryDetails(Resources.STR_SopEntryForm);  //load data into temp table for Custom window.

                DisplaySopEntryDetails(Resources.STR_SopEntryForm);  //display data to sopentry window.



            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SOPLocalIsAddressDisplay_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        ///  Fetching Sales order relateed data and assigning to related Temp Table...
        /// </summary>
        /// <param name="formName"></param>
        private void InsertSopEntryDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                #region Insert SOPEntryForm

                if (formName == Resources.STR_SopEntryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryForm.SopEntry.SopType.Value.ToString()))
                    {
                        ClearSopEntryDetails(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                        TaxRegNumber = string.Empty;
                        TaxScheduleID = string.Empty;
                    }

                    else
                    {
                        if (!String.IsNullOrEmpty(sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim()))
                {

                    if (String.IsNullOrEmpty(sopEntryForm.SopEntry.CommentId.Value.ToString().Trim()))
                    {
                        sopEntryForm.SopEntry.CommentId.Value = "Untitled*";
                    }

                    SalesOrderRequest request = null;
                    SalesOrderEntity salesOrder = null;

                    bool isResult = true;
                    SalesOrderInformation salesOrderInformationObj = new SalesOrderInformation();
                    CustomerInformation customerInformationObj = new CustomerInformation();
                    SalesOrderEntity salesCustomerDetailsObj = new SalesOrderEntity();

                            try
                            {
                                request = new SalesOrderRequest();
                    request.CompanyID = Dynamics.Globals.CompanyId.Value;

                    salesOrder = new SalesOrderEntity();
                    salesOrder.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    salesOrder.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    customerInformationObj.CustomerId = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                    salesOrderInformationObj.Customer = customerInformationObj;
                    salesOrder.SalesOrderDetails = salesOrderInformationObj;
                    request.SalesOrderEntity = salesOrder;

                                try
                                {
                                    using (HttpClient client = new HttpClient())
                                    {
                                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                        client.DefaultRequestHeaders.Accept.Clear();
                                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                        var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetSalesOrder/", request); // we need to refer the web.api service url here.

                                        if (response.Result.IsSuccessStatusCode)
                                        {
                                            SalesOrderResponse _salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                            if (_salesOrderResponse.Status == ResponseStatus.Success)
                                            {
                                                isResult = true;
                                                salesCustomerDetailsObj = _salesOrderResponse.SalesOrderDetails;   //Customer detail Entry data response..
                                            }
                                            else
                                            {
                                                isResult = false;
                                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method (GetSalesOrder-SalesEntry): " + _salesOrderResponse.ErrorMessage.ToString());
                                                MessageBox.Show("Error: " + _salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                            }
                                        }
                                        else
                                        {
                                            isResult = false;
                                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not fetch from custom sales details Table-SalesEntry");
                                            MessageBox.Show("Error: Data does not fetch from custom sales details Table", Resources.STR_MESSAGE_TITLE);
                                        }
                                    }
                                }
                                catch (AggregateException aggredateException)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method (AggregateException-SalesEntry): " + aggredateException.Message.ToString());
                                    MessageBox.Show(aggredateException.Message.ToString(), Resources.STR_MESSAGE_TITLE);
                                }
                                catch (Exception ex)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method (Exception-SalesEntry): " + ex.Message.ToString());
                                    MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            catch (Exception ex)
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method (Outer Exception-SalesEntry): " + ex.Message.ToString());
                                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
                            }

                            //Assign response data to Customer detail Window Temp Table...
                            // includded Customer detail Date Entry, Transportation, OrderType and Third party detais....

                                #region Header detail

                            if (salesCustomerDetailsObj != null && isResult)
                            {
                                if (salesCustomerDetailsObj.SalesOrderDetails != null)
                                {
                                    if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails != null)
                                    {
                                        InsertScheduleDates(salesCustomerDetailsObj, Resources.STR_SopEntryForm);
                                        //Assign sop entry local Amount field
                                        InsertTransportationDetails(salesCustomerDetailsObj, Resources.STR_SopEntryForm);
                                        InsertSalesOrderType(salesCustomerDetailsObj, Resources.STR_SopEntryForm);
                                        if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.LineItems != null)
                                        {
                                            InsertAllocatedQty(salesCustomerDetailsObj, Resources.STR_SopEntryForm);
                                        }
                                        if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader != null)
                                        {
                                            InsertThirdPartyDetails(salesCustomerDetailsObj, Resources.STR_SopEntryForm);
                                            InsertAddressDetails(salesCustomerDetailsObj, Resources.STR_SopEntryForm);
                                            InsertHeaderInstructions(salesCustomerDetailsObj, Resources.STR_SopEntryForm);
                                            InsertCustomerPickUpAddress(salesCustomerDetailsObj, Resources.STR_SopEntryForm);
                                            if (Dynamics.Globals.CompanyId.Value == 1 && sopEntryForm.SopEntry.SopTypeDatabase.Value == 2)
                                            {
                                                sopEntryForm.SopEntry.LocalOldPaymentTerm.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.PaymentTerm;
                                                sopEntryForm.SopEntry.LocalOldFreightAmount.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.FreightAmount;
                                                sopEntryForm.SopEntry.LocalOldFreightTerm.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.FreightTerm;
                                                sopEntryForm.SopEntry.LocalOldLocationCode.Value = sopEntryForm.SopEntry.LocationCode.Value;
                                            }
                                        }
                                    }

                                    ValidateServiceSkuDetails();
                                }
                            }

                            #endregion Header detail

                            #region TaxRegNumberAssignEU

                            if (Dynamics.Globals.CompanyId == 2)
                            {
                                ChemPointSalesExt.Tables.SopHdrWork.Close();
                                ChemPointSalesExt.Tables.SopHdrWork.Release();
                                ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                                ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                                ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                                TableError tableError = ChemPointSalesExt.Tables.SopHdrWork.Get();
                                if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                                {
                                    TaxRegNumber = ChemPointSalesExt.Tables.SopHdrWork.TaxRegistrationNumber.Value.ToString().Trim();
                                    TaxScheduleID = ChemPointSalesExt.Tables.SopHdrWork.TaxScheduleId.Value.ToString().Trim();
                                }
                                else
                                {
                                    TaxRegNumber = string.Empty;
                                    TaxScheduleID = string.Empty;
                                }
                                ChemPointSalesExt.Tables.SopHdrWork.Release();
                                ChemPointSalesExt.Tables.SopHdrWork.Close();
                            }

                            #endregion TaxRegNumberAssignEU






                        }
                    }
                }

                #endregion Insert SopEntryForm

                #region Insert SopEntryInquiry

                else if (formName == Resources.STR_SopInquiryForm)
                {
                    if (!String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopNumber.Value) || !String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopType.Value.ToString()))
                    {
                        if (!String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.CustomerNumber.Value.ToString().Trim()))
                        {
                            if (String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.CommentId.Value.ToString().Trim()))
                            {
                                sopEntryInquiryForm.SopInquiry.CommentId.Value = "Untitled*";
                            }

                            SalesOrderRequest request = null;
                            SalesOrderEntity salesOrder = null;

                            bool isResult = true;
                            SalesOrderInformation salesOrderInformationObj = new SalesOrderInformation();
                            CustomerInformation customerInformationObj = new CustomerInformation();
                            SalesOrderEntity salesCustomerDetailsObj = new SalesOrderEntity();

                            try
                            {
                                request = new SalesOrderRequest();
                                request.CompanyID = Dynamics.Globals.CompanyId.Value;

                                salesOrder = new SalesOrderEntity();
                                salesOrder.SopType = sopEntryInquiryForm.SopInquiry.SopType.Value;
                                salesOrder.SopNumber = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();
                                customerInformationObj.CustomerId = sopEntryInquiryForm.SopInquiry.CustomerNumber.Value.ToString().Trim();

                                salesOrderInformationObj.Customer = customerInformationObj;
                                salesOrder.SalesOrderDetails = salesOrderInformationObj;
                                request.SalesOrderEntity = salesOrder;
                                try
                                {
                                    using (HttpClient client = new HttpClient())
                                    {
                                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                        client.DefaultRequestHeaders.Accept.Clear();
                                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                                        var response = Task.Run(async () => await client.PostAsJsonAsync("api/SalesOrderUpdate/GetSalesOrder/", request)).Result; // we need to refer the web.api service url here.
                                        if (response.IsSuccessStatusCode)
                                        {
                                            string content = response.Content.ReadAsStringAsync().Result;
                                            SalesOrderResponse _salesOrderResponse = Newtonsoft.Json.JsonConvert.DeserializeObject<SalesOrderResponse>(content);
                                            if (_salesOrderResponse.Status == ResponseStatus.Success)
                                            {
                                                isResult = true;
                                                salesCustomerDetailsObj = _salesOrderResponse.SalesOrderDetails;   //Customer detail Entry data response..
                                            }
                                            else
                                            {
                                                isResult = false;
                                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method (GetSalesOrder-SalesInquiry): " + _salesOrderResponse.ErrorMessage.ToString());
                                                MessageBox.Show("Error: " + _salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                            }
                                        }
                                        else
                                        {
                                            isResult = false;
                                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not fetch from custom sales details Table-SalesInquiry");
                                            MessageBox.Show("Error: Data does not fetch from custom sales details Table", Resources.STR_MESSAGE_TITLE);
                                        }
                                    }
                                }
                                catch (AggregateException aggregateException)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method (AggregateException-SalesInquiry): " + aggregateException.Message.ToString());
                                    MessageBox.Show(aggregateException.Message.ToString(), Resources.STR_MESSAGE_TITLE);
                                }
                                catch (Exception ex)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method (Exception-SalesInquiry): " + ex.Message.ToString());
                                    MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            catch (Exception ex)
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method (Outer Exception-SalesInquiry): " + ex.Message.ToString());
                                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
                            }

                            #region Header detail

                            if (salesCustomerDetailsObj != null && isResult)
                            {
                                if (salesCustomerDetailsObj.SalesOrderDetails != null)
                                {
                                    if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails != null)
                                    {
                                        InsertScheduleDates(salesCustomerDetailsObj, Resources.STR_SopInquiryForm);
                                        InsertTransportationDetails(salesCustomerDetailsObj, Resources.STR_SopInquiryForm);
                                        InsertSalesOrderType(salesCustomerDetailsObj, Resources.STR_SopInquiryForm);

                                        if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader != null)
                                        {
                                            InsertThirdPartyDetails(salesCustomerDetailsObj, Resources.STR_SopInquiryForm);
                                            InsertAddressDetails(salesCustomerDetailsObj, Resources.STR_SopInquiryForm);
                                            InsertHeaderInstructions(salesCustomerDetailsObj, Resources.STR_SopInquiryForm);
                                            InsertCustomerPickUpAddress(salesCustomerDetailsObj, Resources.STR_SopInquiryForm);
                                        }
                                    }
                                }
                            }

                            #endregion Header detail
                        }
                    }
                }

                #endregion Insert SopEntry Inquiry
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSopEntryDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }



        #region Insert into Temp Table

        /// <summary>
        /// Insert Header instruction (Custoemr Detail Entry Window)
        /// </summary>
        /// <param name="salesCustomerDetailsObj"></param>
        /// <param name="p"></param>
        private void InsertLineInstruction(SalesOrderEntity salesCustomerDetailsObj, string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                #region SOp Item Detail Instruction

                if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.LineItems != null && formName == Resources.STR_SopItemDetailForm)
                {
                    if (String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) || String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()))
                    {
                        ClearLineInstruction(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearLineInstruction(formName, sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value, sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        #region CommentDetails

                        foreach (var lineItemList in salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.LineItems)
                        {
                            foreach (var lineInstructionList in lineItemList.SalesLineInstruction)
                            {
                                if (sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value == lineInstructionList.SopType &&
                                    sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim() == lineInstructionList.SopNumber.ToString().Trim()

                                    &&
                                    sopItemDetailForm.SopItemDetail.LineItemSequence.Value == lineInstructionList.LineItemSequence)
                                {
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = Convert.ToInt16(lineInstructionList.SopType);
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = lineInstructionList.SopNumber.ToString().Trim();
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = Convert.ToInt32(lineInstructionList.LineItemSequence);
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = Convert.ToInt16(lineInstructionList.ComponentSequenceNumber);
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(lineInstructionList.InstructionTypeID);
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value = lineInstructionList.InstructionCode.ToString().Trim();
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Key = 1;

                                    TableError tempError = sopItemDetailForm.Tables.SalesLineInstructionDetails.Change();
                                    if (tempError != TableError.NoError && tempError == TableError.NotFound)
                                    {
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = Convert.ToInt16(lineInstructionList.SopType);
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = lineInstructionList.SopNumber.ToString().Trim();

                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = Convert.ToInt32(lineInstructionList.LineItemSequence);
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = Convert.ToInt16(lineInstructionList.ComponentSequenceNumber);
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(lineInstructionList.InstructionTypeID);
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value = lineInstructionList.InstructionCode.ToString().Trim();
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value = lineInstructionList.CommentText.ToString().Trim();
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.IsUpdated.Value = 1;
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();
                                        sopItemDetailForm.Tables.SalesLineInstructionDetails.Save();
                                    }
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                                }
                            }
                        }

                        #endregion CommentDetails
                    }
                }

                #endregion SOp Item Detail Instruction

                #region Sop Item Detail Inquiry Instruction

                if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.LineItems != null && formName == Resources.STR_SopItemInquiryForm)
                {
                    if (String.IsNullOrEmpty(sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value) || String.IsNullOrEmpty(sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value.ToString()))
                    {
                        ClearLineInstruction(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearLineInstruction(formName, sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value, sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        #region CommentDetails

                        foreach (var lineItemList in salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.LineItems)
                        {
                            foreach (var lineInstructionList in lineItemList.SalesLineInstruction)
                            {
                                if (sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value == lineInstructionList.SopType &&
                                    sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim() == lineInstructionList.SopNumber.ToString().Trim()

                                    &&
                                    sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value == lineInstructionList.LineItemSequence)
                                {
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = Convert.ToInt16(lineInstructionList.SopType);
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = lineInstructionList.SopNumber.ToString().Trim();
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = Convert.ToInt32(lineInstructionList.LineItemSequence);
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = Convert.ToInt16(lineInstructionList.ComponentSequenceNumber);
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(lineInstructionList.InstructionTypeID);
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value = lineInstructionList.InstructionCode.ToString().Trim();

                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Key = 1;
                                    TableError tempError = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Change();
                                    if (tempError != TableError.NoError && tempError == TableError.NotFound)
                                    {
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = Convert.ToInt16(lineInstructionList.SopType);
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = lineInstructionList.SopNumber.ToString().Trim();

                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = Convert.ToInt32(lineInstructionList.LineItemSequence);
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = Convert.ToInt16(lineInstructionList.ComponentSequenceNumber);
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(lineInstructionList.InstructionTypeID);
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value = lineInstructionList.InstructionCode.ToString().Trim();
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value = lineInstructionList.CommentText;
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.IsUpdated.Value = 1;
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();
                                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Save();
                                    }
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                                }
                            }
                        }

                        #endregion CommentDetails
                    }
                }

                #endregion Sop Item Detail Inquiry Instruction
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertLineInstruction Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Insert Allocated Qty Details(Allocated Qty)
        /// </summary>
        /// <param name="salesCustomerDetailsObj"></param>
        /// <param name="p"></param>
        private void InsertAllocatedQty(SalesOrderEntity salesCustomerDetailsObj, string formName)
        {

            StringBuilder logMessage = new StringBuilder();
            ItemList = new Dictionary<int, string>();
            try
            {
                ClearAllocatedQtyTemp(formName);
                sopEntryForm.Tables.SopAllocatedQtyTemp.Close();
                sopEntryForm.Tables.SopAllocatedQtyTemp.Release();

                foreach (var allocatedQtyInfo in salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.LineItems)
                {
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Release();
                    sopEntryForm.Tables.SopAllocatedQtyTemp.SopNumber.Value = allocatedQtyInfo.SopNumber;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.SopType.Value = Convert.ToInt16(allocatedQtyInfo.SopType);
                    sopEntryForm.Tables.SopAllocatedQtyTemp.LineItemSequence.Value = allocatedQtyInfo.OrderLineId;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.ComponentSequence.Value = allocatedQtyInfo.ComponentSequenceNumber;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.ItemNumber.Value = allocatedQtyInfo.ItemNumber;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.LocationCode.Value = allocatedQtyInfo.LocationCode;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.QtyAllocated.Value = allocatedQtyInfo.AllocatedQuantity;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Qty.Value = allocatedQtyInfo.Quantity;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.QtyCanceled.Value = allocatedQtyInfo.CancelledQuantity;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.QtyRemaining.Value = allocatedQtyInfo.QuantityRemaining;
                    sopEntryForm.Tables.SopAllocatedQtyTemp.IsUpdated.Value = 1;
                    TableError tb = sopEntryForm.Tables.SopAllocatedQtyTemp.Save();
                    if (!allocatedQtyInfo.ItemNumber.StartsWith("8"))
                    ItemList.Add(allocatedQtyInfo.OrderLineId,allocatedQtyInfo.ItemNumber);
                }
                sopEntryForm.Tables.SopAllocatedQtyTemp.Release();
                sopEntryForm.Tables.SopAllocatedQtyTemp.Close();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertAllocatedQty Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear Custoemr pick up address from Customer Detail Entry Window
        /// </summary>
        /// <param name="salesCustomerDetailsObj"></param>
        /// <param name="p"></param>
        private void InsertCustomerPickUpAddress(SalesOrderEntity salesCustomerDetailsObj, string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress != null && formName == Resources.STR_SopEntryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                    {
                        ClearCustomerPickUpAddress(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearCustomerPickUpAddress(formName, sopEntryForm.SopEntry.SopTypeDatabase.Value, sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        #region CustomPickupID

                        sopEntryForm.Tables.SalesPickupAddressTemp.Close();

                        sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                        sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                        sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber;

                        sopEntryForm.Tables.SalesPickupAddressTemp.Key = 1;
                        TableError tempError3rdParty = sopEntryForm.Tables.SalesPickupAddressTemp.Change();
                        if (tempError3rdParty != TableError.NoError && tempError3rdParty == TableError.NotFound)
                        {
                            sopEntryForm.Tables.SalesPickupAddressTemp.ThirdPartyAddressId.Value = Convert.ToInt32(salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressId);
                            sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                            sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber.ToString().Trim();
                            //sopEntryForm.Tables.SalesPickupAddressTemp.CustomerNumber.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressId.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.ContactPerson.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.ContactName.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressLine1.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressLine2.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressLine3.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.City.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.City.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.State.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.State.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.ZipCode.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.Country.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.IsUpdated.Value = 0;
                            sopEntryForm.Tables.SalesPickupAddressTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopEntryForm.Tables.SalesPickupAddressTemp.Save();
                        }
                        sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                        sopEntryForm.Tables.SalesPickupAddressTemp.Close();

                        #endregion CustomPickupID
                    }
                }
                else if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress != null && formName == Resources.STR_SopInquiryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopNumber.Value) || sopEntryInquiryForm.SopInquiry.SopType.Value == 0)
                    {
                        ClearCustomerPickUpAddress(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearCustomerPickUpAddress(formName, sopEntryInquiryForm.SopInquiry.SopType.Value, sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        #region CustomPickupID

                        sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();

                        sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                        sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                        sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber;

                        sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Key = 1;
                        TableError tempError3rdParty = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Change();
                        if (tempError3rdParty != TableError.NoError && tempError3rdParty == TableError.NotFound)
                        {
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ThirdPartyAddressId.Value = Convert.ToInt32(salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressId);
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ContactPerson.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.ContactName.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address1.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressLine1.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address2.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressLine2.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address3.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.AddressLine3.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.City.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.City.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.State.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.State.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ZipCode.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.ZipCode.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Country.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerPickupAddress.Country.ToString().Trim();
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.IsUpdated.Value = 0;
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Save();
                        }
                        sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                        sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();

                        #endregion CustomPickupID
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertCustomerPickUpAddress Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Insert Header instruction (Custoemr Detail Entry Window)
        /// </summary>
        /// <param name="salesCustomerDetails"></param>
        /// <param name="p"></param>
        private void InsertHeaderInstructions(SalesOrderEntity salesCustomerDetails, string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.SalesHeaderInstructionEntity != null && formName == Resources.STR_SopEntryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                    {
                        ClearHeaderInstruction(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearHeaderInstruction(formName, sopEntryForm.SopEntry.SopTypeDatabase.Value, sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        #region CommentDetails

                        foreach (var headerComments in salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.SalesHeaderInstructionEntity)
                        {
                            if (sopEntryForm.SopEntry.SopTypeDatabase.Value == headerComments.SopType &&
                                sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() == headerComments.SopNumber.ToString().Trim())
                            {
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = Convert.ToInt16(headerComments.SopType);
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = headerComments.SopNumber.ToString().Trim();
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(headerComments.InstructionTypeID);
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value = headerComments.InstructionCode.ToString().Trim();
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.Key = 1;

                                TableError tempError = sopEntryForm.Tables.SalesHeaderInstructionDetails.Change();
                                if (tempError != TableError.NoError && tempError == TableError.NotFound)
                                {
                                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = Convert.ToInt16(headerComments.SopType);
                                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = headerComments.SopNumber.ToString().Trim();
                                    sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(headerComments.InstructionTypeID);
                                    sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value = headerComments.InstructionCode.ToString().Trim();

                                    sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value = headerComments.CommentText;

                                    sopEntryForm.Tables.SalesHeaderInstructionDetails.IsUpdated.Value = 1;
                                    sopEntryForm.Tables.SalesHeaderInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Save();
                                }
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                            }
                        }

                        #endregion CommentDetails
                    }
                }

                if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.SalesHeaderInstructionEntity != null && formName == Resources.STR_SopInquiryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopType.Value.ToString()))
                    {
                        ClearHeaderInstruction(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearHeaderInstruction(formName, sopEntryInquiryForm.SopInquiry.SopType.Value, sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        #region CommentDetails

                        foreach (var headerComments in salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.SalesHeaderInstructionEntity)
                        {
                            if (sopEntryInquiryForm.SopInquiry.SopType.Value == headerComments.SopType &&
                                sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim() == headerComments.SopNumber.ToString().Trim())
                            {
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = Convert.ToInt16(headerComments.SopType);
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = headerComments.SopNumber.ToString().Trim();
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(headerComments.InstructionTypeID);
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value = headerComments.InstructionCode.ToString().Trim();
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Key = 1;

                                TableError tempError = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Change();
                                if (tempError != TableError.NoError && tempError == TableError.NotFound)
                                {
                                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = Convert.ToInt16(headerComments.SopType);
                                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = headerComments.SopNumber.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(headerComments.InstructionTypeID);
                                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value = headerComments.InstructionCode.ToString().Trim();

                                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value = headerComments.CommentText;

                                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.IsUpdated.Value = 1;
                                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Save();
                                }
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                                sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                            }
                        }

                        #endregion CommentDetails
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertHeaderInstructions Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Insert Address id Details From Customer Detail Entry Window
        /// </summary>
        /// <param name="salesCustomerDetails"></param>
        /// <param name="formName"></param>
        private void InsertAddressDetails(SalesOrderEntity salesCustomerDetails, string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails != null && formName == Resources.STR_SopEntryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) || String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                    {
                        ClearAddressDetails(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearAddressDetails(formName, sopEntryForm.SopEntry.SopTypeDatabase.Value, sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        #region BillTo/ShipTo AddressID

                        foreach (var addressList in salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails)
                        {
                            if (sopEntryForm.SopEntry.SopTypeDatabase.Value == addressList.SopType &&
                                sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() == addressList.SopNumber.ToString().Trim())
                            {
                                sopEntryForm.Tables.SalesAddressDetails.Close();
                                sopEntryForm.Tables.SalesAddressDetails.Release();
                                sopEntryForm.Tables.SalesAddressDetails.SopType.Value = Convert.ToInt16(addressList.SopType);
                                sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = addressList.SopNumber.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = addressList.CustomerID.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = Convert.ToInt16(addressList.AddressId);
                                sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = addressList.AddressCode.ToString().Trim();

                                sopEntryForm.Tables.SalesAddressDetails.Key = 1;
                                TableError tempError = sopEntryForm.Tables.SalesAddressDetails.Change();
                                if (tempError != TableError.NoError && tempError == TableError.NotFound)
                                {
                                    sopEntryForm.Tables.SalesAddressDetails.SopType.Value = Convert.ToInt16(addressList.SopType);
                                    sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = addressList.SopNumber.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = addressList.CustomerID.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = Convert.ToInt16(addressList.AddressId);
                                    sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = addressList.AddressCode.ToString().Trim();

                                    sopEntryForm.Tables.SalesAddressDetails.CustomerName.Value = addressList.CustomerName.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.ShipToName.Value = addressList.ShipToName.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.ContactPerson.Value = addressList.ContactName.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.Address1.Value = addressList.AddressLine1.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.Address2.Value = addressList.AddressLine2.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.Address3.Value = addressList.AddressLine3.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.Country.Value = addressList.Country.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.City.Value = addressList.City.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.State.Value = addressList.State.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.ZipCode.Value = addressList.ZipCode.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.CountryCode.Value = addressList.CountryCode.ToString().Trim();
                                    sopEntryForm.Tables.SalesAddressDetails.Phone1.Value = addressList.Phone1.ToString().Trim();

                                    sopEntryForm.Tables.SalesAddressDetails.Fax.Value = addressList.Fax.ToString().Trim();

                                    sopEntryForm.Tables.SalesAddressDetails.IsUpdated.Value = 1;
                                    sopEntryForm.Tables.SalesAddressDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                    sopEntryForm.Tables.SalesAddressDetails.Save();
                                }
                                sopEntryForm.Tables.SalesAddressDetails.Release();
                                sopEntryForm.Tables.SalesAddressDetails.Close();
                            }
                        }

                        #endregion BillTo/ShipTo AddressID
                    }
                }

                if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails != null && formName == Resources.STR_SopInquiryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopType.Value.ToString()))
                    {
                        ClearAddressDetails(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearAddressDetails(formName, sopEntryInquiryForm.SopInquiry.SopType.Value, sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        #region BillTo/ShipTo AddressID

                        foreach (var addressList in salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails)
                        {
                            if (sopEntryInquiryForm.SopInquiry.SopType.Value == addressList.SopType &&
                                sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim() == addressList.SopNumber.ToString().Trim())
                            {
                                sopEntryInquiryForm.Tables.SalesAddressDetails.Close();
                                sopEntryInquiryForm.Tables.SalesAddressDetails.Release();
                                sopEntryInquiryForm.Tables.SalesAddressDetails.SopType.Value = Convert.ToInt16(addressList.SopType);
                                sopEntryInquiryForm.Tables.SalesAddressDetails.SopNumber.Value = addressList.SopNumber.ToString().Trim();
                                sopEntryInquiryForm.Tables.SalesAddressDetails.CustomerNumber.Value = addressList.CustomerID.ToString().Trim();
                                sopEntryInquiryForm.Tables.SalesAddressDetails.AddressTypeId.Value = Convert.ToInt16(addressList.AddressId);
                                sopEntryInquiryForm.Tables.SalesAddressDetails.AddressCode.Value = addressList.AddressCode.ToString().Trim();

                                sopEntryInquiryForm.Tables.SalesAddressDetails.Key = 1;
                                TableError tempError = sopEntryInquiryForm.Tables.SalesAddressDetails.Change();
                                if (tempError != TableError.NoError && tempError == TableError.NotFound)
                                {
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.SopType.Value = Convert.ToInt16(addressList.SopType);
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.SopNumber.Value = addressList.SopNumber.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.CustomerNumber.Value = addressList.CustomerID.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.AddressTypeId.Value = Convert.ToInt16(addressList.AddressId);
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.AddressCode.Value = addressList.AddressCode.ToString().Trim();

                                    sopEntryInquiryForm.Tables.SalesAddressDetails.CustomerName.Value = addressList.CustomerName.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.ShipToName.Value = addressList.ShipToName.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.ContactPerson.Value = addressList.ContactName.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.Address1.Value = addressList.AddressLine1.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.Address2.Value = addressList.AddressLine2.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.Address3.Value = addressList.AddressLine3.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.Country.Value = addressList.Country.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.City.Value = addressList.City.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.State.Value = addressList.State.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.ZipCode.Value = addressList.ZipCode.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.CountryCode.Value = addressList.CountryCode.ToString().Trim();
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.Phone1.Value = addressList.Phone1.ToString().Trim();

                                    sopEntryInquiryForm.Tables.SalesAddressDetails.Fax.Value = addressList.Fax.ToString().Trim();

                                    sopEntryInquiryForm.Tables.SalesAddressDetails.IsUpdated.Value = 1;
                                    sopEntryInquiryForm.Tables.SalesAddressDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                    sopEntryInquiryForm.Tables.SalesAddressDetails.Save();
                                }
                                sopEntryInquiryForm.Tables.SalesAddressDetails.Release();
                                sopEntryInquiryForm.Tables.SalesAddressDetails.Close();
                            }
                        }

                        #endregion BillTo/ShipTo AddressID
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Assign Thirdparty Address value to Temp Table (Sop Customer Entry Window)
        /// </summary>
        /// <param name="salesCustomerDetails"></param>
        /// <param name="p"></param>
        private void InsertThirdPartyDetails(SalesOrderEntity salesCustomerDetails, string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress != null && formName == Resources.STR_SopEntryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                    {
                        ClearThirdPartyAddress(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearThirdPartyAddress(formName, sopEntryForm.SopEntry.SopTypeDatabase.Value, sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        if (sopEntryForm.SopEntry.SopTypeDatabase.Value == salesCustomerDetails.SopType &&
                            sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() == salesCustomerDetails.SopNumber.ToString().Trim())
                        {
                            #region 3rdParty

                            sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                            sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = salesCustomerDetails.SopNumber;

                            sopEntryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                            TableError tempError3rdParty = sopEntryForm.Tables.ThirdPartyAddressTemp.Change();
                            if (tempError3rdParty != TableError.NoError && tempError3rdParty == TableError.NotFound)
                            {
                                sopEntryForm.Tables.ThirdPartyAddressTemp.ThirdPartyAddressId.Value = Convert.ToInt32(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.AddressId);
                                sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                                sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = salesCustomerDetails.SopNumber.ToString().Trim();

                                sopEntryForm.Tables.ThirdPartyAddressTemp.ContactPerson.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.ContactName.ToString().Trim();
                                sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.AddressLine1.ToString().Trim();
                                sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.AddressLine2.ToString().Trim();
                                sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.AddressLine3.ToString().Trim();
                                sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.City.ToString().Trim();
                                sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.State.ToString().Trim();
                                sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.ZipCode.ToString().Trim();
                                sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.Country.ToString().Trim();
                                sopEntryForm.Tables.ThirdPartyAddressTemp.IsUpdated.Value = 0;
                                sopEntryForm.Tables.ThirdPartyAddressTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryForm.Tables.ThirdPartyAddressTemp.Save();
                            }
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Close();

                            #endregion 3rdParty
                        }
                    }
                }
                else if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress != null && formName == Resources.STR_SopInquiryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopType.Value.ToString()))
                    {
                        ClearThirdPartyAddress(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearThirdPartyAddress(formName, sopEntryInquiryForm.SopInquiry.SopType.Value, sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        if (sopEntryInquiryForm.SopInquiry.SopType.Value == salesCustomerDetails.SopType &&
                            sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim() == salesCustomerDetails.SopNumber.ToString().Trim())
                        {
                            #region 3rdParty

                            sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();
                            sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                            sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                            sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = salesCustomerDetails.SopNumber;

                            sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                            TableError tempError3rdParty = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Change();
                            if (tempError3rdParty != TableError.NoError && tempError3rdParty == TableError.NotFound)
                            {
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ThirdPartyAddressId.Value = Convert.ToInt32(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.AddressId);
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = salesCustomerDetails.SopNumber.ToString().Trim();

                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ContactPerson.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.ContactName.ToString().Trim();
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address1.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.AddressLine1.ToString().Trim();
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address2.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.AddressLine2.ToString().Trim();
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address3.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.AddressLine3.ToString().Trim();
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.City.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.City.ToString().Trim();
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.State.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.State.ToString().Trim();
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.ZipCode.ToString().Trim();
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Country.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Carrier3rdPartyAddress.Country.ToString().Trim();
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.IsUpdated.Value = 0;
                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Save();
                            }
                            sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                            sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();

                            #endregion 3rdParty
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertThirdPartyDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Assign SalesOrderType value to Temp table (SOp Entry Window)...
        /// </summary>
        /// <param name="salesCustomerDetails"></param>
        /// <param name="p"></param>
        private void InsertSalesOrderType(SalesOrderEntity salesCustomerDetails, string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType != null && formName == Resources.STR_SopEntryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                    {
                        ClearOrderTypeDetails(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearOrderTypeDetails(formName, sopEntryForm.SopEntry.SopTypeDatabase.Value, sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        if (sopEntryForm.SopEntry.SopTypeDatabase.Value == salesCustomerDetails.SopType &&
                            sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() == salesCustomerDetails.SopNumber.ToString().Trim())
                        {
                            #region  SalesOrderType

                            sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                            sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                            sopEntryForm.Tables.SalesOrderTypeDetails.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                            sopEntryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = salesCustomerDetails.SopNumber.ToString().Trim();

                            sopEntryForm.Tables.SalesOrderTypeDetails.Key = 1;
                            TableError tempError = sopEntryForm.Tables.SalesOrderTypeDetails.Change();
                            if (tempError != TableError.NoError && tempError == TableError.NotFound)
                            {
                                sopEntryForm.Tables.SalesOrderTypeDetails.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                                sopEntryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = salesCustomerDetails.SopNumber.ToString().Trim();

                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsInternational);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsNaFta);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsDropship);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsBulk);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsI3Order);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsCreditCard);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsCorrective);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsFullTruckLoad);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsConsignment);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsCorrectiveBoo);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsSampleOrder);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsTempControl);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsHazmat);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsFreezeProtect);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsAutoPTEligible);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsCreditEnginePassed);
                                sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsTaxEnginePassed);

                                sopEntryForm.Tables.SalesOrderTypeDetails.IsUpdated.Value = 1;
                                sopEntryForm.Tables.SalesOrderTypeDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryForm.Tables.SalesOrderTypeDetails.Save();
                            }
                            sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                            sopEntryForm.Tables.SalesOrderTypeDetails.Close();

                            #endregion SalesOrderType
                        }
                    }
                }
                else if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType != null && formName == Resources.STR_SopInquiryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopType.Value.ToString()))
                    {
                        ClearOrderTypeDetails(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearOrderTypeDetails(formName, sopEntryInquiryForm.SopInquiry.SopType.Value, sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        if (sopEntryInquiryForm.SopInquiry.SopType.Value == salesCustomerDetails.SopType &&
                            sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim() == salesCustomerDetails.SopNumber.ToString().Trim())
                        {
                            #region  SalesOrderType

                            sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Close();
                            sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Release();
                            sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                            sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = salesCustomerDetails.SopNumber.ToString().Trim();

                            sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Key = 1;
                            TableError tempError = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Change();
                            if (tempError != TableError.NoError && tempError == TableError.NotFound)
                            {
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = salesCustomerDetails.SopNumber.ToString().Trim();

                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsInternational);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsNaFta);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsDropship);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsBulk);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsI3Order);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsCreditCard);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsCorrective);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsFullTruckLoad);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsConsignment);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsCorrectiveBoo);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsSampleOrder);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsTempControl);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsHazmat);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsFreezeProtect);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsAutoPTEligible);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsCreditEnginePassed);
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value = Convert.ToBoolean(salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.SalesOrderType.IsTaxEnginePassed);

                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.IsUpdated.Value = 1;
                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Save();
                            }
                            sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Release();
                            sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Close();

                            #endregion SalesOrderType
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertSalesOrderType Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Assigning TransportationDetails value to Temp table (Customer Detail Entry Window)
        /// </summary>
        /// <param name="salesCustomerDetailsObj"></param>
        /// <param name="p"></param>
        private void InsertTransportationDetails(SalesOrderEntity salesCustomerDetailsObj, string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            isCountryChange = false;
            isLineAdded = false;
            try
            {
                if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader != null && formName == Resources.STR_SopEntryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                    {
                        ClearTransportationDetails(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearTransportationDetails(formName, sopEntryForm.SopEntry.SopTypeDatabase.Value, sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        if (sopEntryForm.SopEntry.SopTypeDatabase.Value == salesCustomerDetailsObj.SopType &&
                            sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() == salesCustomerDetailsObj.SopNumber.ToString().Trim())
                        {
                            #region Transportation Details

                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber.ToString().Trim();

                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                            TableError tempErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Change();
                            if (tempErrorTransportation != TableError.NoError && tempErrorTransportation == TableError.NotFound)
                            {
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber;

                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.FreightTerm;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.IncoTerm;

                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CarrierName;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CarrierAccountNumber;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CarrierPhone;

                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ServiceType;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ImporterofRecord;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomBroker;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.OrderGuid.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.OrderGuid.ToString().Trim();
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomerGuid.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerGuid.ToString().Trim();
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.TobeCancelled.Value = Convert.ToBoolean(salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ToBeCancelled);
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value = Convert.ToBoolean(salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomizeServiceSkus);

                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IsUpdated.Value = 0;
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Save();
                            }
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                            // Empty the sop entry window Amount field and assign the new value
                            sopEntryForm.SopEntry.LocalNewFreightAmount.Value = 0.00M;
                            sopEntryForm.SopEntry.LocalNewMiscAmount.Value = 0.00M;
                            sopEntryForm.SopEntry.LocalNewTaxAmount.Value = 0.00M;
                            sopEntryForm.SopEntry.LocalDocumentAmount.Value = 0.00M;

                            sopEntryForm.SopEntry.LocalNewFreightAmount.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.FreightAmount;
                            sopEntryForm.SopEntry.LocalNewMiscAmount.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.MiscAmount;
                            sopEntryForm.SopEntry.LocalNewTaxAmount.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.TaxAmount;
                            sopEntryForm.SopEntry.LocalDocumentAmount.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.OrderTotalAmount;
                            sopEntryForm.SopEntry.CustomerExemptfromServiceSkus.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.IsCustomerExcempted; //Customer is excempted/not excempted for service SKU

                            if (Dynamics.Globals.CompanyId == 1)
                            {

                                sopEntryForm.SopEntry.ShipFromCountry.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ShipFromCountry;
                                sopEntryForm.SopEntry.ShipFromCountryCode.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ShipFromCountryCode;
                                sopEntryForm.SopEntry.ShipToCountry.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ShipToCountry;
                                sopEntryForm.SopEntry.ShipToCountryCode.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ShipToCountryCode;
                                sopEntryForm.SopEntry.FinalDestinationCountry.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.FinalDestinationCountry;
                                sopEntryForm.SopEntry.FinalDestinationCc.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ShipToCountryCode;
                            }

                            #endregion Transportation Details
                        }
                    }
                }
                else if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader != null && formName == Resources.STR_SopInquiryForm)
                {
                    if (String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopType.Value.ToString()))
                    {
                        ClearTransportationDetails(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                    }
                    else
                    {
                        ClearTransportationDetails(formName, sopEntryInquiryForm.SopInquiry.SopType.Value, sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                        if (sopEntryInquiryForm.SopInquiry.SopType.Value == salesCustomerDetailsObj.SopType &&
                            sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim() == salesCustomerDetailsObj.SopNumber.ToString().Trim())
                        {
                            #region Transportation Details

                            sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                            sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                            sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                            sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber.ToString().Trim();

                            sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                            TableError tempErrorTransportation = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Change();
                            if (tempErrorTransportation != TableError.NoError && tempErrorTransportation == TableError.NotFound)
                            {
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber;
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.FreightTerm;
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.IncoTerm;

                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CarrierName;
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CarrierAccountNumber;
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CarrierPhone;

                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ServiceType;
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ImporterofRecord;
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomBroker;
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.OrderGuid.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.OrderGuid.ToString().Trim();
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomerGuid.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomerGuid.ToString().Trim();
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.TobeCancelled.Value = Convert.ToBoolean(salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.ToBeCancelled);
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value = Convert.ToBoolean(salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.CustomizeServiceSkus);

                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.IsUpdated.Value = 0;
                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Save();
                            }
                            sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                            sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                            sopEntryInquiryForm.SopInquiry.CustomerExemptfromServiceSkus.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderHeader.IsCustomerExcempted; //Customer is excempted/not excempted for service SKU


                            #endregion Transportation Details
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertTransportationDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Assigning OrderSchedule value to Temp table (Customer Detail Entry Window).
        /// </summary>
        /// <param name="salesCustomerDetails"></param>
        private void InsertScheduleDates(SalesOrderEntity salesCustomerDetails, string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule != null)
                {
                    if (formName == Resources.STR_SopEntryForm)
                    {
                        if (String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                        {
                            ClearScheduleDates(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                        }
                        else
                        {
                            //Clear the schedule dates based on SOP type and SOP number.
                            ClearScheduleDates(formName, sopEntryForm.SopEntry.SopTypeDatabase.Value, sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                            if (sopEntryForm.SopEntry.SopTypeDatabase.Value == salesCustomerDetails.SopType &&
                                sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() == salesCustomerDetails.SopNumber.ToString().Trim())
                            {
                                #region Date Details

                                if (sopEntryForm.SopEntry.SopTypeDatabase.Value == salesCustomerDetails.SopType &&
                                    sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() == salesCustomerDetails.SopNumber.ToString().Trim())
                                {
                                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = salesCustomerDetails.SopNumber.ToString().Trim();

                                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                                    TableError tempErrorDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.Change();
                                    if (tempErrorDate != TableError.NoError && tempErrorDate == TableError.NotFound)
                                    {
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = salesCustomerDetails.SopNumber;
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedDeliveryDate;
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedShipDate;
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedDeliveryDate;
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedShipDate;
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalCustomerRequestedDeliveryDate;
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedDeliveryDate;
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedShipDate;

                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.IsUpdated.Value = 0;
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.Save();
                                    }
                                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                                }

                                #endregion Date Details
                            }
                        }
                    }
                    else if (formName == Resources.STR_SopInquiryForm)
                    {
                        if (String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopNumber.Value) || String.IsNullOrEmpty(sopEntryInquiryForm.SopInquiry.SopType.Value.ToString()))
                        {
                            ClearScheduleDates(formName, 0, "");   // pass blank Sop Type and Sop Number to clear all data
                        }
                        else
                        {
                            ClearScheduleDates(formName, sopEntryInquiryForm.SopInquiry.SopType.Value, sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim());  // bypass Sop Number on double insertion

                            if (sopEntryInquiryForm.SopInquiry.SopType.Value == salesCustomerDetails.SopType &&
                                sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim() == salesCustomerDetails.SopNumber.ToString().Trim())
                            {
                                #region Date Details

                                if (sopEntryInquiryForm.SopInquiry.SopType.Value == salesCustomerDetails.SopType &&
                                    sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim() == salesCustomerDetails.SopNumber.ToString().Trim())
                                {
                                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();
                                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = salesCustomerDetails.SopNumber.ToString().Trim();

                                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                                    TableError tempErrorDate = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Change();
                                    if (tempErrorDate != TableError.NoError && tempErrorDate == TableError.NotFound)
                                    {
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = Convert.ToInt16(salesCustomerDetails.SopType);
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = salesCustomerDetails.SopNumber;
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedDeliveryDate;
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedShipDate;
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedDeliveryDate;
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedShipDate;
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalCustomerRequestedDeliveryDate;
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedDeliveryDate;
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value = salesCustomerDetails.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedShipDate;

                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.IsUpdated.Value = 0;
                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                        sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Save();
                                    }
                                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();
                                }

                                #endregion Date Details
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertScheduleDates Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion Insert into Temp Table

        #region Clear Temp Table

        /// <summary>
        /// ClearAllocatedQtyTemp window Temp table field...
        /// </summary>
        /// <param name="formName"></param>
        /// <param name="p1"></param>
        /// <param name="p2"></param>
        private void ClearAllocatedQtyTemp(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Close();
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Release();
                    TableError tempError = sopEntryForm.Tables.SopAllocatedQtyTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        sopEntryForm.Tables.SopAllocatedQtyTemp.Remove();
                        tempError = sopEntryForm.Tables.SopAllocatedQtyTemp.ChangeNext();
                    }
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Close();
                    sopEntryForm.Tables.SopAllocatedQtyTemp.Release();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearAllocatedQtyTemp Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// SoplineInstruction details Clear...
        /// </summary>
        /// <param name="formName"></param>
        /// <param name="p1"></param>
        /// <param name="p2"></param>
        private void ClearLineInstruction(string formName, short sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopItemDetailForm)
                {
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    TableError tempError = sopItemDetailForm.Tables.SalesLineInstructionDetails.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopItemDetailForm.Tables.SalesLineInstructionDetails.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopItemDetailForm.Tables.SalesLineInstructionDetails.Remove();
                        }
                        tempError = sopItemDetailForm.Tables.SalesLineInstructionDetails.ChangeNext();
                    }
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                }
                else if (formName == Resources.STR_SopItemInquiryForm)
                {
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    TableError tempError = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Remove();
                        }
                        tempError = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.ChangeNext();
                    }
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearLineInstruction Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear Customer pick up address ...
        /// </summary>
        /// <param name="formName"></param>
        /// <param name="p1"></param>
        /// <param name="p2"></param>
        private void ClearCustomerPickUpAddress(string formName, int sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    TableError tempError = sopEntryForm.Tables.SalesPickupAddressTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryForm.Tables.SalesPickupAddressTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryForm.Tables.SalesPickupAddressTemp.Remove();
                        }

                        tempError = sopEntryForm.Tables.SalesPickupAddressTemp.ChangeNext();
                    }
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                }
                if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                    TableError tempError = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryInquiryForm.Tables.SalesPickupAddressTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Remove();
                        }

                        tempError = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ChangeNext();
                    }
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearCustomerPickUpAddress Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear Header instruction Details 
        /// </summary>
        /// <param name="formName"></param>
        /// <param name="p1"></param>
        /// <param name="p2"></param>
        private void ClearHeaderInstruction(string formName, int sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    TableError tempError = sopEntryForm.Tables.SalesHeaderInstructionDetails.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryForm.Tables.SalesHeaderInstructionDetails.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryForm.Tables.SalesHeaderInstructionDetails.Remove();
                        }

                        tempError = sopEntryForm.Tables.SalesHeaderInstructionDetails.ChangeNext();
                    }
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                    TableError tempError = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Remove();
                        }

                        tempError = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.ChangeNext();
                    }
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearHeaderInstruction Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear order type Details from Customer detail Entry Window...
        /// </summary>
        /// <param name="formName"></param>
        /// <param name="p1"></param>
        /// <param name="p2"></param>
        private void ClearOrderTypeDetails(string formName, int sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                    sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                    TableError tempError = sopEntryForm.Tables.SalesOrderTypeDetails.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryForm.Tables.SalesOrderTypeDetails.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryForm.Tables.SalesOrderTypeDetails.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryForm.Tables.SalesOrderTypeDetails.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryForm.Tables.SalesOrderTypeDetails.Remove();
                        }

                        tempError = sopEntryForm.Tables.SalesOrderTypeDetails.ChangeNext();
                    }
                    sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                    sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Close();
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Release();
                    TableError tempError = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryInquiryForm.Tables.SalesOrderTypeDetails.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Remove();
                        }

                        tempError = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.ChangeNext();
                    }
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Release();
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearOrderTypeDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear Third party address Temp value...
        /// </summary>
        /// <param name="formName"></param>
        /// <param name="sopType"></param>
        /// <param name="sopNumber"></param>
        private void ClearThirdPartyAddress(string formName, int sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    TableError tempError = sopEntryForm.Tables.ThirdPartyAddressTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryForm.Tables.ThirdPartyAddressTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Remove();
                        }

                        tempError = sopEntryForm.Tables.ThirdPartyAddressTemp.ChangeNext();
                    }
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                    TableError tempError = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Remove();
                        }

                        tempError = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ChangeNext();
                    }
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearThirdPartyAddress Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear all values from address details temp table 
        /// </summary>
        /// <param name="formName">Specify Form Name</param>
        /// <param name="sopType">Specify order type</param>
        /// <param name="sopNumber">Specify order number</param>
        private void ClearAddressDetails(string formName, int sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                    sopEntryForm.Tables.SalesAddressDetails.Release();

                    TableError tempError = sopEntryForm.Tables.SalesAddressDetails.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryForm.Tables.SalesAddressDetails.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryForm.Tables.SalesAddressDetails.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryForm.Tables.SalesAddressDetails.Remove();
                        }

                        tempError = sopEntryForm.Tables.SalesAddressDetails.ChangeNext();
                    }
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Close();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Release();

                    TableError tempError = sopEntryInquiryForm.Tables.SalesAddressDetails.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryInquiryForm.Tables.SalesAddressDetails.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryInquiryForm.Tables.SalesAddressDetails.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryInquiryForm.Tables.SalesAddressDetails.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryInquiryForm.Tables.SalesAddressDetails.Remove();
                        }

                        tempError = sopEntryInquiryForm.Tables.SalesAddressDetails.ChangeNext();
                    }
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Release();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear Transportation Details
        /// </summary>
        /// <param name="formName"></param>
        /// <param name="p1"></param>
        /// <param name="p2"></param>
        private void ClearTransportationDetails(string formName, int sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();

                    TableError tempError = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryForm.Tables.SopCustomerDetailTransportationTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Remove();
                        }

                        tempError = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ChangeNext();
                    }
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();

                    TableError tempError = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Remove();
                        }

                        tempError = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.ChangeNext();
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearTransportationDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear Order Schedule Date 
        /// </summary>
        /// <param name="formName"></param>
        /// <param name="sopType"></param>
        /// <param name="sopNumber"></param>
        private void ClearScheduleDates(string formName, int sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();

                    TableError tempError = sopEntryForm.Tables.SopCustomerDetailDatesTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryForm.Tables.SopCustomerDetailDatesTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.Remove();
                        }

                        tempError = sopEntryForm.Tables.SopCustomerDetailDatesTemp.ChangeNext();
                    }
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();

                    TableError tempError = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.ChangeFirst();
                    while (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Remove();
                        }

                        tempError = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.ChangeNext();
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearScheduleDates Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion Clear Temp Table

        /// <summary>
        /// Display Sop Entry window Date fields...
        /// </summary>
        /// <param name="formName"></param>
        private void DisplaySopEntryDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                    TableError tableErrorQuote = sopEntryForm.Tables.SopCustomerDetailDatesTemp.Get();
                    if (tableErrorQuote == TableError.NoError && tableErrorQuote != TableError.EndOfTable)
                    {
                        sopEntryForm.SopEntry.CpCustReqDel.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value;
                        sopEntryForm.SopEntry.CpCustReqShip.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value;
                        sopEntryForm.SopEntry.CpCurSchedDel.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value;
                        sopEntryForm.SopEntry.CpReqShipDate.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value;
                    }
                    else
                    {
                        sopEntryForm.SopEntry.CpCustReqDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopEntryForm.SopEntry.CpCustReqShip.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopEntryForm.SopEntry.CpCurSchedDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopEntryForm.SopEntry.CpReqShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    }

                    //Display TobeCancelled and ExcludeServiceSkus
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        sopEntryForm.SopEntry.TobeCancelled.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.TobeCancelled.Value;
                        sopEntryForm.SopEntry.CustomizeServiceSkUs.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value;

                    }
                    else
                    {
                        sopEntryForm.SopEntry.TobeCancelled.Value = false;
                        sopEntryForm.SopEntry.CustomizeServiceSkUs.Value = false;

                    }
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                    TableError tableErrorQuote = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Get();
                    if (tableErrorQuote == TableError.NoError && tableErrorQuote != TableError.EndOfTable)
                    {
                        sopEntryInquiryForm.SopInquiry.CpCustReqDel.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value;
                        sopEntryInquiryForm.SopInquiry.CpCustReqShip.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value;
                        sopEntryInquiryForm.SopInquiry.CpCurSchedDel.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value;
                        sopEntryInquiryForm.SopInquiry.CpReqShipDate.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value;
                    }
                    else
                    {
                        sopEntryInquiryForm.SopInquiry.CpCustReqDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopEntryInquiryForm.SopInquiry.CpCustReqShip.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopEntryInquiryForm.SopInquiry.CpCurSchedDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopEntryInquiryForm.SopInquiry.CpReqShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();

                    //Display TobeCancelled and ExcludeServiceSkus
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        sopEntryInquiryForm.SopInquiry.TobeCancelled.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.TobeCancelled.Value;
                        sopEntryInquiryForm.SopInquiry.CustomizeServiceSkUs.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value;
                    }
                    else
                    {
                        sopEntryInquiryForm.SopInquiry.TobeCancelled.Value = false;
                        sopEntryInquiryForm.SopInquiry.CustomizeServiceSkUs.Value = false;
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplaySopEntryDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// SOP Entry main Save - Sop Entry Main winodw field
        /// </summary>
        /// <param name="formName"></param>       

        private void SaveSopEntryDetails(string formName)
        {
            if (formName == Resources.STR_SopEntryForm)
            {
                StringBuilder logMessage = new StringBuilder();

                SalesOrderRequest salesOrderRequest = null;
                bool isResult = true;
                string sopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                try
                {
                    bool isChangedSalesDetails = false;


                    salesOrderRequest = new SalesOrderRequest();
                    salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                    salesOrderRequest.UserID = Dynamics.Globals.UserId.Value.ToString();
                    salesOrderRequest.IsHoldEngineRun = sopEntryForm.SopEntry.LocalIsHoldChanged.Value;
                    salesOrderRequest.IsSopStatusExecute = sopEntryForm.SopEntry.LocalIsInvoiced.Value;
                    //Assign SopEntry Value to Request Object.

                    SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                    SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                    SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                    OrderHeader orderHeader = new OrderHeader();
                    OrderSchedule orderSchedule = new OrderSchedule();
                    SalesOrderType orderType = new SalesOrderType();
                    SalesInstruction salesInstruction = new SalesInstruction();
                    List<SalesInstruction> salesInstructionList = new List<SalesInstruction>();
                    AuditInformation auditInformation = new AuditInformation();
                    HoldEngineRequest holdEngineRequest = new HoldEngineRequest();
                    HoldEngineEntity holdEngineEntity = new HoldEngineEntity();
                    OrderHeader holdorderHeader = new OrderHeader();
                    AddressInformation vatAddressInformation = new ChemPoint.GP.Entities.BaseEntities.AddressInformation();
                    salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    CustomerInformation customerInformaton = new CustomerInformation();

                    #region Date Details

                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();

                    TableError tableErrorDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.GetFirst();
                    while (tableErrorDate == TableError.NoError && tableErrorDate != TableError.EndOfTable)
                    {
                        if (
                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                        {
                            salesOrderEntity.SopType = sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value;
                            salesOrderEntity.SopNumber = sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value.ToString().Trim();
                            orderSchedule.CustomerRequestedDeliveryDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value;
                            orderSchedule.CustomerRequestedShipDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value;
                            orderSchedule.RequestedDeliveryDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value;
                            orderSchedule.RequestedShipDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value;
                            orderSchedule.OriginalCustomerRequestedDeliveryDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value;
                            orderSchedule.OriginalRequestedDeliveryDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value;
                            orderSchedule.OriginalRequestedShipDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value;

                            if (sopEntryForm.Tables.SopCustomerDetailDatesTemp.IsUpdated.Value == 1)
                            {
                                isChangedSalesDetails = true;
                            }
                        }
                        tableErrorDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.GetNext();
                    }
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();

                    #endregion Date Details

                    #region Transportation Details

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();

                    TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.GetFirst();
                    while (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        if (sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value &&
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                        {
                            salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                            orderHeader.FreightTerm = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value;
                            orderHeader.IncoTerm = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value;

                            orderHeader.CarrierName = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value;
                            orderHeader.CarrierAccountNumber = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value;
                            orderHeader.CarrierPhone = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value;
                            orderHeader.ThirdPartyAddressId = 0;
                            orderHeader.ServiceType = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value;
                            orderHeader.ImporterofRecord = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value;
                            orderHeader.CustomBroker = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value;
                            orderHeader.ToBeCancelled = Convert.ToInt16(sopEntryForm.Tables.SopCustomerDetailTransportationTemp.TobeCancelled.Value);  // To cancelled 
                            orderHeader.CustomizeServiceSkus = Convert.ToInt16(sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value);  // ExcludeServiceSkus 


                            if (sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IsUpdated.Value == 1)
                            {
                                isChangedSalesDetails = true;
                            }
                        }
                        tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.GetNext();
                    }
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                    #endregion Transportation Details

                    #region ThirdPartyAddressID

                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();

                    TableError tableError3rdParty = sopEntryForm.Tables.SopCustomerDetailDatesTemp.GetFirst();
                    while (tableError3rdParty == TableError.NoError && tableError3rdParty != TableError.EndOfTable)
                    {
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value &&
                            sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                        {
                            orderHeader.ThirdPartyAddressId = sopEntryForm.Tables.ThirdPartyAddressTemp.ThirdPartyAddressId.Value;
                        }
                        if (sopEntryForm.Tables.SopCustomerDetailDatesTemp.IsUpdated.Value == 1)
                        {
                            isChangedSalesDetails = true;
                        }
                        tableError3rdParty = sopEntryForm.Tables.ThirdPartyAddressTemp.GetNext();
                    }
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();

                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();

                    #endregion ThirdPartyAddressID



                    salesOrderDetails.OrderSchedule = orderSchedule;
                    salesOrderDetails.OrderHeader = orderHeader;
                    salesOrderDetails.AuditInformation = auditInformation;
                    salesOrderInformation.SalesOrderDetails = salesOrderDetails;
                    salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                    salesOrderRequest.SalesOrderEntity = salesOrderEntity;

                    sopEntryForm.Tables.SopHdrWork.Close();
                    sopEntryForm.Tables.SopHdrWork.Release();
                    sopEntryForm.Tables.SopHdrWork.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopHdrWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SopHdrWork.Key = 1;
                    TableError tableErrorTrm = sopEntryForm.Tables.SopHdrWork.Get();
                    if (tableErrorTrm == TableError.NoError && tableErrorTrm != TableError.EndOfTable)
                    {
                        OldPaymentTerm = sopEntryForm.Tables.SopHdrWork.PaymentTermsId.Value.ToString().Trim();
                    }
                    sopEntryForm.Tables.SopHdrWork.Release();
                    sopEntryForm.Tables.SopHdrWork.Close();
                    try
                    {
                        if ((isChangedSalesDetails || isChangedOrderType || sopEntryForm.SopEntry.LocalIsPriceUpdated == true || sopEntryForm.SopEntry.LocalOldPaymentTerm.Value.ToString().Trim() != OldPaymentTerm) && !string.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) &&
                            !string.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString().Trim()))
                        {
                            // Service call ...
                            using (HttpClient client = new HttpClient())
                            {
                                client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                client.DefaultRequestHeaders.Accept.Clear();
                                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveSalesOrder/", salesOrderRequest); // we need to refer the web.api service url here.

                                if (response.Result.IsSuccessStatusCode)
                                {
                                    SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                    if (salesOrderResponse.Status == ResponseStatus.Error)
                                    {
                                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveSopEntryDetails Method (SaveSalesOrder): " + salesOrderResponse.ErrorMessage.ToString());
                                        MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                    }
                                }
                                else
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into custom sales details Table");
                                    MessageBox.Show("Error: Data does not saved into custom sales details Table", Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            GC.Collect();
                        }
                    }
                    catch (Exception ex)
                    {
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveSalesOrder Method: " + ex.Message.ToString());
                    }
                    try
                    {
                        if (!string.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) &&
                            !string.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString().Trim()))
                        {
                            // Service call ...
                            using (HttpClient client = new HttpClient())
                            {
                                client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                client.DefaultRequestHeaders.Accept.Clear();
                                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                                salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                                salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                                salesOrderRequest.SalesOrderEntity = salesOrderEntity;

                                var response = client.PostAsJsonAsync("api/SalesOrderUpdate/DistributeAmountToCashApplyInvoices/", salesOrderRequest); // we need to refer the web.api service url here.

                                if (response.Result.IsSuccessStatusCode)
                                {
                                    SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                    if (salesOrderResponse.Status == ResponseStatus.Error)
                                    {
                                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveSopEntryDetails Method (DistributeAmountToCashApplyInvoices): " + salesOrderResponse.ErrorMessage.ToString());
                                        MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                    }
                                }
                                else
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not distribute for apply to open details");
                                    MessageBox.Show("Error: Data does not distribute for apply to open details", Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            GC.Collect();
                        }
                    }
                    catch (Exception ex)
                    {
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DistributeAmountToCashApplyInvoices Method: " + ex.Message.ToString());
                    }

                    try
                    {
                        if (Dynamics.Globals.CompanyId.Value == 2 && sopEntryForm.SopEntry.SopTypeDatabase.Value == 2)
                        {
                            holdorderHeader.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            holdorderHeader.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            holdorderHeader.LocationCode = sopEntryForm.SopEntry.LocationCode.Value.ToString().Trim();
                            holdorderHeader.SubTotalAmount = sopEntryForm.SopEntry.Subtotal.Value;
                            holdorderHeader.TaxScheduleId = TaxScheduleID;
                            holdorderHeader.TaxRegNumber = TaxRegNumber;
                            holdEngineEntity.BatchUserID = Dynamics.Globals.UserId.Value;

                            sopEntryForm.Tables.SalesAddressDetails.Close();
                            sopEntryForm.Tables.SalesAddressDetails.Release();
                            sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;   // 2: used for Shipto address

                            sopEntryForm.Tables.SalesAddressDetails.Key = 2;
                            TableError tempError = sopEntryForm.Tables.SalesAddressDetails.Get();
                            if (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                            {
                                // set Ship To Address ID from temp table
                                vatAddressInformation.AddressCode = sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value.ToString().Trim();
                            }
                            sopEntryForm.Tables.SalesAddressDetails.Release();
                            sopEntryForm.Tables.SalesAddressDetails.Close();


                            holdorderHeader.ShipToAddress = vatAddressInformation;
                            holdEngineEntity.OrderHeader = holdorderHeader;
                            holdEngineRequest.HoldEngineEntity = holdEngineEntity;

                            if (!string.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) &&
                                !string.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString().Trim()))
                            {
                                // Service call ...
                                using (HttpClient client = new HttpClient())
                                {
                                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                    client.DefaultRequestHeaders.Accept.Clear();
                                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                    var response = client.PostAsJsonAsync("api/HoldEngine/ProcessVATHold/", holdEngineRequest); // we need to refer the web.api service url here.

                                    if (response.Result.IsSuccessStatusCode)
                                    {
                                        isResult = true;
                                    }
                                    else
                                    {
                                        isResult = false;
                                    }
                                }
                                if (!isResult)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Hold not Applied");
                                    MessageBox.Show("Error: Hold not Applied", Resources.STR_MESSAGE_TITLE);
                                }
                                GC.Collect();
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ProcessVATHold Method: " + ex.Message.ToString());
                    }

                    #region freight holds
                    try
                    {
                        if (Dynamics.Globals.CompanyId.Value == 1 && sopEntryForm.SopEntry.SopTypeDatabase.Value == 2 || sopEntryForm.SopEntry.SopTypeDatabase.Value == 6)
                        {
                            sopEntryForm.Tables.SopHdrWork.Close();
                            sopEntryForm.Tables.SopHdrWork.Release();
                            sopEntryForm.Tables.SopHdrWork.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            sopEntryForm.Tables.SopHdrWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            sopEntryForm.Tables.SopHdrWork.Key = 1;
                            TableError tableErrorHdr = sopEntryForm.Tables.SopHdrWork.Get();
                            if (tableErrorHdr == TableError.NoError && tableErrorHdr != TableError.EndOfTable)
                            {
                                OldPaymentTerm = sopEntryForm.Tables.SopHdrWork.PaymentTermsId.Value.ToString().Trim();
                            }
                            sopEntryForm.Tables.SopHdrWork.Release();
                            sopEntryForm.Tables.SopHdrWork.Close();

                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            sopEntryForm.Tables.SopHdrWork.Key = 1;
                            TableError tableErrorHdr1 = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                            if (tableErrorHdr1 == TableError.NoError && tableErrorHdr1 != TableError.EndOfTable)
                            {
                                OldFreightTerm = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value.ToString().Trim();
                            }
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                            sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                            if (
                                sopEntryForm.SopEntry.LocalOldPaymentTerm.Value.ToString().Trim() != OldPaymentTerm ||
                                 sopEntryForm.SopEntry.LocalOldFreightAmount.Value != sopEntryForm.SopEntry.FreightAmount.Value ||
                                 sopEntryForm.SopEntry.LocalOldFreightTerm.Value != OldFreightTerm ||
                                sopEntryForm.SopEntry.LocalOldLocationCode.Value != sopEntryForm.SopEntry.LocationCode.Value ||
                                isChangedOrderType
                                )
                            {
                                //CustomerInformation customerInformaton = new CustomerInformation();

                                holdEngineRequest = new HoldEngineRequest();
                                holdEngineEntity = new HoldEngineEntity();
                                holdorderHeader = new OrderHeader();
                                holdorderHeader.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                                holdorderHeader.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                                customerInformaton.CustomerId = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                                holdEngineEntity.OrderHeader = holdorderHeader;
                                holdEngineEntity.BatchUserID = "batch";
                                holdEngineEntity.CustomerInformation = customerInformaton;
                                holdEngineRequest.HoldEngineEntity = holdEngineEntity;
                                holdEngineRequest.CompanyId = Dynamics.Globals.CompanyId.Value;

                                if (!string.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) &&
                                    !string.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString().Trim()))
                                {
                                    using (HttpClient client = new HttpClient())
                                    {
                                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                        client.DefaultRequestHeaders.Accept.Clear();
                                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                        var response = client.PostAsJsonAsync("api/HoldEngine/ProcessFreightHold/", holdEngineRequest); // we need to refer the web.api service url here.

                                        if (response.Result.IsSuccessStatusCode)
                                        {
                                            isResult = true;
                                        }
                                        else
                                        {
                                            isResult = false;
                                        }
                                    }
                                    if (!isResult)
                                    {
                                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Hold not Applied");
                                        MessageBox.Show("Error: Hold not Applied", Resources.STR_MESSAGE_TITLE);
                                    }
                                    GC.Collect();
                                }
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ProcessFreightHold Method: " + ex.Message.ToString());
                    }
                    #endregion  freight holds

                    

                    try
                    {
                        if (updatetoXRMStatusFlag == true)
                        {
                            string originNumber = string.Empty;
                            ChemPointSalesExt.Tables.SopHdrWork.Close();
                            ChemPointSalesExt.Tables.SopHdrWork.Release();
                            ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopNumber;
                            ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = 3;
                            ChemPointSalesExt.Tables.SopHdrWork.RangeStart();
                            ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                            ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopNumber;
                            ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = 6;
                            ChemPointSalesExt.Tables.SopHdrWork.RangeEnd();
                            ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                            TableError tableError1 = ChemPointSalesExt.Tables.SopHdrWork.Get();
                            if (tableError1 == TableError.NoError && tableError1 != TableError.EndOfTable)
                            {
                                originNumber = ChemPointSalesExt.Tables.SopHdrWork.OriginalNumber.Value.ToString().Trim();
                            }
                            ChemPointSalesExt.Tables.SopHdrWork.Release();
                            ChemPointSalesExt.Tables.SopHdrWork.Close();

                            if (!string.IsNullOrEmpty(originNumber))
                            {
                                string xrmStatusResult = new XrmService().PublishSalesOrderStatus(originNumber, Dynamics.Globals.IntercompanyId.Value, xrmPublishURL, Dynamics.Globals.UserId.Value, "GP");
                                if (xrmStatusResult.Trim().Length > 0)
                                {
                                    //logMessage.AppendLine(DateTime.Now.ToString() + " - Updating Status  for Sales orders(FO)-Failed to publish the status for Sales orders" + originalNumber + " from invoice: " + invoiceNumber + "\r\n");
                                }
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveSopEntryDetails(PublishSalesOrderStatus)Method: " + ex.Message.ToString());
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveSopEntryDetails Method: " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    sopEntryForm.SopEntry.LocalIsHoldChanged.Value = false;
                    sopEntryForm.SopEntry.LocalIsInvoiced.Value = false;
                    sopEntryForm.SopEntry.LocalIsPriceUpdated.Value = false;
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }



        private void CountryCodeChange(string NewShipToCountry, string NewShipFromCountry, string FinalDestinationCountry)
        {
            if (NewShipToCountry.ToUpper() == "USA" || NewShipToCountry.ToUpper() == "UNITED STATES" || NewShipToCountry == "US")
                LocalShipToCountry = "US";
            else if (NewShipToCountry.ToUpper() == "CA" || NewShipToCountry.ToUpper() == "CANADA" || NewShipToCountry.ToUpper() == "CAN")
                LocalShipToCountry = "CA";
            else
                LocalShipToCountry = NewShipToCountry.ToUpper();

            if (NewShipFromCountry.ToUpper() == "USA" || NewShipFromCountry.ToUpper() == "UNITED STATES" || NewShipFromCountry == "US")
                LocalShipFromCountry = "US";
                
            else if (NewShipFromCountry.ToUpper() == "CA" || NewShipFromCountry.ToUpper() == "CANADA" || NewShipFromCountry.ToUpper() == "CAN")
                LocalShipFromCountry = "CA";
            else
                LocalShipFromCountry = NewShipFromCountry.ToUpper();

            if (FinalDestinationCountry.ToUpper() == "USA" || FinalDestinationCountry.ToUpper() == "UNITED STATES" || FinalDestinationCountry == "US")
                LocalFinalDestination = "US";
                
            else if (FinalDestinationCountry.ToUpper() == "CA" || FinalDestinationCountry.ToUpper() == "CANADA" || FinalDestinationCountry.ToUpper() == "CAN")
                LocalFinalDestination = "CA";
                
            else
                LocalFinalDestination = FinalDestinationCountry.ToUpper();
                

            if (sopEntryForm.SopEntry.ShipToCountry.Value.ToUpper() == "USA" || sopEntryForm.SopEntry.ShipToCountry.Value.ToUpper() == "UNITED STATES" || sopEntryForm.SopEntry.ShipToCountry.Value.ToUpper() == "US")
                GPShipToCountry = "US";
            else if (sopEntryForm.SopEntry.ShipToCountry.Value.ToUpper() == "CA" || sopEntryForm.SopEntry.ShipToCountry.Value.ToUpper() == "CANADA" || sopEntryForm.SopEntry.ShipToCountry.Value.ToUpper() == "CAN")
                GPShipToCountry = "CA";
            else
                GPShipToCountry = sopEntryForm.SopEntry.ShipToCountry.Value.ToUpper();

            if (sopEntryForm.SopEntry.ShipFromCountry.Value.ToUpper() == "USA" || sopEntryForm.SopEntry.ShipFromCountry.Value.ToUpper() == "UNITED STATES" || sopEntryForm.SopEntry.ShipFromCountry.Value.ToUpper() == "US")
                GPShipFromCountry = "US";
            else if (sopEntryForm.SopEntry.ShipFromCountry.Value.ToUpper() == "CA" || sopEntryForm.SopEntry.ShipFromCountry.Value.ToUpper() == "CANADA" || sopEntryForm.SopEntry.ShipFromCountry.Value.ToUpper() == "CAN")
                GPShipFromCountry = "CA";
            else
                GPShipFromCountry = sopEntryForm.SopEntry.ShipFromCountry.Value.ToUpper();

            if (sopEntryForm.SopEntry.FinalDestinationCountry.Value.ToUpper() == "USA" || sopEntryForm.SopEntry.FinalDestinationCountry.Value.ToUpper() == "UNITED STATES" || sopEntryForm.SopEntry.FinalDestinationCountry.Value.ToUpper() == "US")
                GPFinalDestination = "US";
            else if (sopEntryForm.SopEntry.FinalDestinationCountry.Value.ToUpper() == "CA" || sopEntryForm.SopEntry.FinalDestinationCountry.Value.ToUpper() == "CANADA" || sopEntryForm.SopEntry.FinalDestinationCountry.Value.ToUpper() == "CAN")
                GPFinalDestination = "CA";
            else
                GPFinalDestination = sopEntryForm.SopEntry.FinalDestinationCountry.Value.ToUpper();
        }


        private void ClearSopEntryDetails(string formName, int sopType, string sopNumber)
        {
            if (formName == Resources.STR_SopEntryForm)
            {
                ClearScheduleDates(formName, sopType, sopNumber);   // pass blank Sop Type and Sop Number to clear all data
                ClearTransportationDetails(formName, sopType, sopNumber);   // pass blank Sop Type and Sop Number to clear all data
                ClearOrderTypeDetails(formName, sopType, sopNumber);   // pass blank Sop Type and Sop Number to clear all data
                ClearThirdPartyAddress(formName, sopType, sopNumber);   // pass blank Sop Type and Sop Number to clear all data
                ClearAddressDetails(formName, sopType, sopNumber);   // pass blank Sop Type and Sop Number to clear all data
                ClearHeaderInstruction(formName, sopType, sopNumber);   // pass blank Sop Type and Sop Number to clear all data
                ClearCustomerPickUpAddress(formName, sopType, sopNumber);   // pass blank Sop Type and Sop Number to clear all data
            }
        }

        /// <summary>
        /// Event which will be called when the Confirm button in the SOP window changes. This
        /// event will refreshes the SOP Entry window once the "Ship Confirment" for an Fullfillment order occurs.
        /// It sets the SOP type as Order for the refreshed window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void LocalConfirmProcess_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                updatetoXRMStatusFlag = false;
                string originalNumber = "";

                // checks the StatusDescription value. 
                if (sopEntryForm.SopEntry.StatusDescription.Value.Contains("Ready to Post"))
                {
                    SalesOrderRequest salesOrderRequest = null;
                    salesOrderRequest = new SalesOrderRequest();
                    salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                    salesOrderRequest.Source = "GP";
                    SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                    AuditInformation auditInformation = new AuditInformation();
                    salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    string invoiceNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    salesOrderRequest.SalesOrderEntity = salesOrderEntity;

                    if (!string.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) &&
                        !string.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString().Trim()))
                    {
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/UpdateOrderDetailsToInvoiceType/", salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesOrderResponse.Status == ResponseStatus.Error)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalConfirmProcess_Change Method (UpdateOrderDetailsToInvoiceType): " + salesOrderResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not process into custom sales details Table");
                                MessageBox.Show("Error: Data does not process into custom sales details Table", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                        GC.Collect();
                    }



                    ChemPointSalesExt.Tables.SopHdrWork.Close();
                    ChemPointSalesExt.Tables.SopHdrWork.Release();
                    ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = 6;
                    ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                    TableError tableError = ChemPointSalesExt.Tables.SopHdrWork.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        originalNumber = ChemPointSalesExt.Tables.SopHdrWork.OriginalNumber.Value.ToString().Trim();
                    }
                    ChemPointSalesExt.Tables.SopHdrWork.Release();
                    ChemPointSalesExt.Tables.SopHdrWork.Close();

                    // sets the sop type value to "Order" type
                    sopEntryForm.SopEntry.SopType.Value = 2;
                    // refreshes the SOP entry window.
                    sopEntryForm.SopEntry.SopType.RunValidate();

                    if (!String.IsNullOrEmpty(originalNumber))
                    {
                        string xrmStatusResult = new XrmService().PublishSalesOrderStatus(originalNumber, Dynamics.Globals.IntercompanyId.Value, xrmPublishURL, Dynamics.Globals.UserId.Value, "GP");
                        if (xrmStatusResult.Trim().Length > 0)
                        {
                            //logMessage.AppendLine(DateTime.Now.ToString() + " - Updating Status  for Sales orders(FO)-Failed to publish the status for Sales orders" + originalNumber + " from invoice: " + invoiceNumber + "\r\n");
                        }
                        //logMessage.AppendLine(DateTime.Now.ToString() + " - Ended updated the status in XRM for order: " + originalNumber + " from invoice: " + invoiceNumber);
                    }

                }
                else if (sopEntryForm.SopEntry.StatusDescription.Value.Contains("Awaiting Shipment"))
                {
                    int sopStatus = 0;
                    ChemPointSalesExt.Tables.SopHdrWork.Close();
                    ChemPointSalesExt.Tables.SopHdrWork.Release();
                    ChemPointSalesExt.Tables.SopHdrWork.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    ChemPointSalesExt.Tables.SopHdrWork.SopType.Value = 6;
                    ChemPointSalesExt.Tables.SopHdrWork.Key = 1;
                    TableError tableError = ChemPointSalesExt.Tables.SopHdrWork.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        sopStatus = Convert.ToInt16(ChemPointSalesExt.Tables.SopHdrWork.SopStatus.Value);
                    }
                    ChemPointSalesExt.Tables.SopHdrWork.Release();
                    ChemPointSalesExt.Tables.SopHdrWork.Close();
                    if (sopStatus != sopEntryForm.SopEntry.SopStatus.Value)
                    {
                        updatetoXRMStatusFlag = true;
                    }
                    else
                        updatetoXRMStatusFlag = false;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalConfirmProcess_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Could not able to update the invoice due to error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event which will be called when the Action button in the SOP window is clicked. 
        /// This event will update the doc type Ids based on the location code country in Europe company.
        /// Following are the updates done by this event. 
        /// -------------------------------------------------------------------------
        /// locn code     County/County Code  TypeID1                 TypeID2
        /// -------------------------------------------------------------------------
        /// Not Dropship  BELGIUM/BE          BELGIUMBCKORD/BEORD     BELGIUM INV
        /// Not Dropship  ITALY/IT            ITALYBCKORD/ITORD       ITALY INV
        /// Not Dropship  United kingdom/GB   GBBCKORD/GBORD          GB INV
        /// Not Dropship  SPAIN/ES            GBBCKORD/ESORD          ES INV
        /// Not Dropship  NETHERLANDS/NL      NLBCKORD/NETHERLANDSORD NETHERLANDS INV 
        /// --------------------------------------------------------------------------
        /// All the updates are to SOP10100 table.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void ActionButton_EnterBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                string orderCCode = "", orderCounty = "";
                // Checks for the companyID. This code is valid only for the company "Chempoint EUROPE"
                // Also checks whether the sopnumber and customerNumber is not empty

                if (Dynamics.Globals.CompanyId.Value == 2 &&
                    Dynamics.Forms.SopEntry.SopEntry.SopNumber.Value != "" &&
                    Dynamics.Forms.SopEntry.SopEntry.CustomerNumber.Value != "")
                {
                    GetCountyDetails(Dynamics.Forms.SopEntry.SopEntry.SopNumber.Value.ToString(), Dynamics.Forms.SopEntry.SopEntry.SopTypeDatabase.Value, out orderCCode, out orderCounty);

                    // Checks for the SOP type. The soptype should be Order(2) or BackOrder(6) for this code to execute.
                    if (Dynamics.Forms.SopEntry.SopEntry.SopType.Value == 2)
                    {
                        // Checks for Belgium Country code. If yes, then it updates the TypeIds with Belgium type
                        if (SO.Properties.Resources.STR_CCBE.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                            SO.Properties.Resources.STR_CountyBE.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                            SO.Properties.Resources.STR_CountyBelgium.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_BELGIUMBKORD, SO.Properties.Resources.STR_BELGIUMINV);
                        }
                        // Checks for Italy Country code. If yes, then it updates the TypeIds with Italy type
                        else if (SO.Properties.Resources.STR_CCIT.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                                 SO.Properties.Resources.STR_CountyIT.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountyItaly.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_ITALYBKORD, SO.Properties.Resources.STR_ITALYINV);
                        }
                        // Checks for GB Country code. If yes, then it updates the TypeIds with GB type
                        else if (SO.Properties.Resources.STR_CCGB.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                                 SO.Properties.Resources.STR_CountyUK.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountyGB.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_GBBKORD, SO.Properties.Resources.STR_GBINV);
                        }
                        // Checks for spain Country code. If yes, then it updates the TypeIds with GB type
                        else if (SO.Properties.Resources.STR_CCES.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                                 SO.Properties.Resources.STR_CountrySpain.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountyES.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_ESBKORD, SO.Properties.Resources.STR_ESINV);
                        }
                        // Checks for NL Country code. If yes, then it updates the TypeIds with GB type
                        else if (SO.Properties.Resources.STR_CCNL.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                                 SO.Properties.Resources.STR_CountryTheNetherlands.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountryNetherlands.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountryNL.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_NLBKORD, SO.Properties.Resources.STR_NLINV);
                        }
                    }
                    else if (Dynamics.Forms.SopEntry.SopEntry.SopTypeDatabase.Value == 6)
                    {
                        // Checks for Belgium Country code. If yes, then it updates the TypeIds with Belgium type
                        if (SO.Properties.Resources.STR_CCBE.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                            SO.Properties.Resources.STR_CountyBE.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                            SO.Properties.Resources.STR_CountyBelgium.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_BELGIUMORD, SO.Properties.Resources.STR_BELGIUMINV);
                        }
                        // Checks for Italy Country code. If yes, then it updates the TypeIds with Italy type
                        else if (SO.Properties.Resources.STR_CCIT.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                                 SO.Properties.Resources.STR_CountyIT.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountyItaly.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_ITALYORD, SO.Properties.Resources.STR_ITALYINV);
                        }
                        // Checks for GB Country code. If yes, then it updates the TypeIds with GB type
                        else if (SO.Properties.Resources.STR_CCGB.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                                 SO.Properties.Resources.STR_CountyUK.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountyGB.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_GBORD, SO.Properties.Resources.STR_GBINV);
                        }
                        // Checks for spain Country code. If yes, then it updates the TypeIds with GB type
                        else if (SO.Properties.Resources.STR_CCES.ToString().Trim().ToUpper() == orderCCode.Trim() ||
                                 SO.Properties.Resources.STR_CountrySpain.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountyES.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_ESORD, SO.Properties.Resources.STR_ESINV);
                        }
                        // Checks for NL Country code. If yes, then it updates the TypeIds with GB type
                        else if (SO.Properties.Resources.STR_CCNL.ToString().Trim().ToUpper() == orderCCode ||
                                 SO.Properties.Resources.STR_CountryTheNetherlands.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountryNetherlands.ToString().Trim().ToUpper() == orderCounty.Trim() ||
                                 SO.Properties.Resources.STR_CountryNL.ToString().Trim().ToUpper() == orderCounty.Trim())
                        {
                            // sets the TypeIds
                            SetSOTypeIds(SO.Properties.Resources.STR_NLORD, SO.Properties.Resources.STR_NLINV);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ActionButton_EnterBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("The system failed to update the Type Ids based on customer location code. Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Sets the Type Ids to the SOP10100 table.
        /// </summary>
        /// <param name="cn"></param>
        /// <param name="sopNumber"></param>
        /// <param name="sopType"></param>
        /// <param name="typeId1"></param>
        /// <param name="typeId2"></param>
        private void SetSOTypeIds(string typeId1, string typeId2)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                //Checks if the type ids are of type typeId1 and typeId2 or not. If not, it updates the type with typeIds.
                if (sopEntryForm.Tables.SopHdrWork.UseDocumentId1.Value.Trim() != typeId1 ||
                    sopEntryForm.Tables.SopHdrWork.UseDocumentId2.Value.Trim() != typeId2)
                {
                    sopEntryForm.Tables.SopHdrWork.UseDocumentId1.Value = typeId1;
                    sopEntryForm.Tables.SopHdrWork.UseDocumentId2.Value = typeId2;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SetSOTypeIds Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void GetCountyDetails(string sopNumber, int sopType, out string ccode, out string county)
        {
            StringBuilder logMessage = new StringBuilder();
            ccode = "";
            county = "";
            try
            {
                SalesOrderRequest countryDetailsRequest = new SalesOrderRequest();
                SalesOrderResponse countryDetailsResponse = new SalesOrderResponse();
                bool recordsExists = false;

                SalesOrderEntity salesOrder = new SalesOrderEntity();
                salesOrder.SopType = sopType;
                salesOrder.SopNumber = sopNumber;
                countryDetailsRequest.SalesOrderEntity = salesOrder;
                countryDetailsRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                //Service Call
                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetCountryDetails", countryDetailsRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        countryDetailsResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                        if (countryDetailsResponse.Status == ResponseStatus.Success)
                        {
                            recordsExists = true;
                        }
                        else
                        {
                            recordsExists = false;
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In GetCountyDetails Method (GetCountryDetails): " + countryDetailsResponse.ErrorMessage.ToString());
                            MessageBox.Show("Error: " + countryDetailsResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                        }
                    }
                    else
                    {
                        recordsExists = false;
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not Fetch country details");
                        MessageBox.Show("Error: Data does not Fetch country details", Resources.STR_MESSAGE_TITLE);
                    }
                }

                if (countryDetailsResponse != null && recordsExists && countryDetailsResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails != null)
                {
                    foreach (var addressDetails in countryDetailsResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails)
                    {
                        ccode = addressDetails.CountryCode.ToString().Trim();
                        county = addressDetails.Country.ToString().Trim();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In GetCountyDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion SalesOrderEntry

        #region SOPInquiry

        void SopInquiry_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (RegisterInquiryCustomerMgmt == false)
                {
                    sopInquiryItemDetailForm.SopInquiryItemDetail.ExpansionButton3.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(ExpansionButton3Inq_ClickAfterOriginal);

                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.OpenAfterOriginal += new EventHandler(SopInquiryCustomerDetail_OpenAfterOriginal);

                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.LocalCpRgAddressDisplay.Change += new EventHandler(SopInquiryCustomerDetailLocalCpRgAddressDisplay_Change);

                    #region OpeninXRM

                    sopEntryInquiryForm.SopInquiry.ZoomButton.ClickAfterOriginal += new EventHandler(InquiryOpenXrm_ClickAfterOriginal);
                    sopInquiryItemDetailForm.SopInquiryItemDetail.ZoomButton.ClickAfterOriginal += new EventHandler(InquiryOpenQuote_ClickAfterOriginal);
                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ZoomButton2.ClickAfterOriginal += new EventHandler(InquiryOpenCustomer_ClickAfterOriginal);

                    #endregion openinXRM

                    #region XRM Account Header Comment Changes

                    // calling dex script for displaying custom addresses: call Trigger_SOP_Inquiry_XRM_Comment_Display
                    sopEntryInquiryForm.SopInquiry.LocalIsCommentDisplay.Change += new EventHandler(SopInquiryLocalIsCommentDisplay_Change);

                    #endregion XRM Account Header Comment Changes

                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LookupButton12.ClickAfterOriginal += VatReference_LookupButton12_ClickAfterOriginal;
                    //accountVatNumberListLookupForm.AccountVatNumberListLookup.RedisplayButton.ClickAfterOriginal += VatReference_RedisplayButton_ClickAfterOriginal;
                    accountVatNumberListLookupForm.AccountVatNumberListLookup.CancelButton.ClickAfterOriginal += VatReference_CancelButton_ClickAfterOriginal;
                    accountVatNumberListLookupForm.AccountVatNumberListLookup.CloseAfterOriginal += AccountVatNumberListLookup_CloseAfterOriginal;
                    accountVatNumberListLookupForm.AccountVatNumberListLookup.OpenAfterOriginal += AccountVatNumberListLookup_OpenAfterOriginal;

                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CloseBeforeOriginal += SopCustomerDetailEntry_CloseBeforeOriginal;

                    #region XRM Account Line Comment Changes

                    // calling dex script for displaying custom addresses: call SOP_Item_Detail_Read
                    sopInquiryItemDetailForm.SopInquiryItemDetail.LocalIsCommentDisplay.Change += new EventHandler(SopInquiryItemDetailLocalIsCommentDisplay_Change);

                    sopInquiryItemDetailForm.SopInquiryItemDetail.ExpansionButton4.ClickAfterOriginal += new EventHandler(SopInquiryItemDetailExpansionButton4_ClickAfterOriginal); // call for warehourse comment expansion
                    sopInquiryItemDetailForm.SopInquiryItemDetail.ExpansionButton5.ClickAfterOriginal += new EventHandler(SopInquiryItemDetailExpansionButton5_ClickAfterOriginal); // call for carrier comment expansion

                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ExpansionButton8.ClickAfterOriginal += CustomerInquiryExpansionButton8_ClickAfterOriginal;
                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ExpansionButton4.ClickAfterOriginal += CustomerInquiryExpansionButton4_ClickAfterOriginal;
                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ExpansionButton5.ClickAfterOriginal += CustomerInquiryExpansionButton5_ClickAfterOriginal;
                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ExpansionButton6.ClickAfterOriginal += new EventHandler(CustomerInquiryExpansionButton6_ClickAfterOriginal); // call for pickup address expansion
                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ExpansionButton7.ClickAfterOriginal += new EventHandler(CustomerInquiryExpansionButton7_ClickAfterOriginal); // call for third party address expansion

                    #endregion XRM Account Line Comment Changes

                    sopEntryInquiryForm.SopInquiryComment.CloseAfterOriginal += new EventHandler(SopInquiryComment_CloseAfterOriginal);

                    //#region XRM Order Type Changes

                    sopInquiryUserDefinedForm.SopInquiryUserDefined.OpenAfterOriginal += new EventHandler(SopInquiryUserDefined_OpenAfterOriginal);
                    sopInquiryUserDefinedForm.SopInquiryUserDefined.ExpansionButton.ClickAfterOriginal += new EventHandler(SopInquiryUserDefinedExpansionButton_ClickAfterOriginal);

                    //#endregion XRM Order Type Changes

                    RegisterInquiryCustomerMgmt = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopInquiry_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        private void CustomerInquiryExpansionButton5_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CarrierInstructionId.Value.ToString().Trim() != "")
                {
                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.Close();
                    }

                    expansionWindowType = Resources.STR_CarrierInstructionID;

                    lookupWindowType = Resources.STR_SopCustomerDetailInquiryForm;

                    ChemPointSalesExt.Procedures.TriggerSopXrmCommentFill.Invoke(10804,
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CarrierInstructionId.Value.ToString().Trim(),
                        "");

                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.CommentText.Value = FetchCommentDetails();
                    }
                }
                else
                {
                    MessageBox.Show("Don't have Warehouse Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerInquiryExpansionButton5_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        private void CustomerInquiryExpansionButton4_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.WarehouseInstructionId.Value.ToString().Trim() != "")
                {
                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.Close();
                    }

                    expansionWindowType = Resources.STR_WarehouseInstructionID;

                    lookupWindowType = Resources.STR_SopCustomerDetailInquiryForm;

                    ChemPointSalesExt.Procedures.TriggerSopXrmCommentFill.Invoke(10804,
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.WarehouseInstructionId.Value.ToString().Trim(),
                        "");

                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.CommentText.Value = FetchCommentDetails();
                    }
                }
                else
                {
                    MessageBox.Show("Don't have Warehouse Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerInquiryExpansionButton4_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        private void CustomerInquiryExpansionButton8_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.InternalInstructions.Value.ToString().Trim() != "")
                {
                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.Close();
                    }

                    expansionWindowType = Resources.STR_InternalInstructionID;

                    lookupWindowType = Resources.STR_SopCustomerDetailInquiryForm;

                    sopEntryInquiryForm.SopInquiry.ExpansionButton10.RunValidate();
                }
                else
                {
                    MessageBox.Show("Don't have internal Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerInquiryExpansionButton8_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CustomerInquiryExpansionButton6_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (customerPickupAddressDetailsForm.CustomerPickupAddress.IsOpen)
                {
                    customerPickupAddressDetailsForm.CustomerPickupAddress.Close();
                }

                expansionWindowType = Resources.STR_SopCustomerDetailInquiryForm;

                customerPickupAddressDetailsForm.CustomerPickupAddress.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerInquiryExpansionButton6_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Third Party Expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CustomerInquiryExpansionButton7_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (thirdPartyAddressDetailsForm.ThirdPartyAddress.IsOpen)
                {
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.Close();
                }

                expansionWindowType = Resources.STR_SopCustomerDetailInquiryForm;

                thirdPartyAddressDetailsForm.ThirdPartyAddress.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerInquiryExpansionButton7_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Open Order in XRM (Inquiry Window)
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void InquiryOpenXrm_ClickAfterOriginal(object sender, EventArgs e)
        {
            OpenOrderInXRM(Resources.STR_SopInquiryForm);
        }

        /// <summary>
        /// OPen Customer in XRM (Inquiry Window)
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void InquiryOpenCustomer_ClickAfterOriginal(object sender, EventArgs e)
        {
            OpenCustomerInXRM(Resources.STR_SopCustomerDetailInquiryForm);
        }

        /// <summary>
        /// Open Quote IN XRM (Inquiry Window)
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void InquiryOpenQuote_ClickAfterOriginal(object sender, EventArgs e)
        {
            OpenQuoteInXRM(Resources.STR_SopItemInquiryForm);
        }

        /// <summary>
        /// Inquiry Address display change...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void SopInquiryCustomerDetailLocalCpRgAddressDisplay_Change(object sender, EventArgs e)
        {
            LocalCpRgAddressDisplay(Resources.STR_SopCustomerDetailInquiryForm);
        }

        /// <summary>
        /// When the expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopInquiryItemDetailExpansionButton4_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopInquiryItemDetailForm.SopInquiryItemDetail.WarehouseInstructionId.Value.ToString().Trim() != "")
                {
                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.Close();
                    }

                    expansionWindowType = Resources.STR_WarehouseInstructionID;

                    lookupWindowType = Resources.STR_SopItemInquiryForm;

                    ChemPointSalesExt.Procedures.TriggerSopXrmCommentFill.Invoke(10807,
                        sopInquiryItemDetailForm.SopInquiryItemDetail.WarehouseInstructionId.Value.ToString().Trim(),
                        "");

                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.CommentText.Value = FetchCommentDetails();
                    }
                }
                else
                {
                    MessageBox.Show("Don't have Warehouse Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopInquiryItemDetailExpansionButton4_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// When the expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopInquiryItemDetailExpansionButton5_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopInquiryItemDetailForm.SopInquiryItemDetail.CarrierInstructionId.Value.ToString().Trim() != "")
                {
                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.Close();
                    }

                    expansionWindowType = Resources.STR_CarrierInstructionID;

                    lookupWindowType = Resources.STR_SopItemInquiryForm;

                    ChemPointSalesExt.Procedures.TriggerSopXrmCommentFill.Invoke(10807,
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CarrierInstructionId.Value.ToString().Trim(),
                        "");

                    if (sopEntryInquiryForm.SopInquiryComment.IsOpen)
                    {
                        sopEntryInquiryForm.SopInquiryComment.CommentText.Value = FetchCommentDetails();
                    }
                }
                else
                {
                    MessageBox.Show("Don't have Carrier Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopInquiryItemDetailExpansionButton5_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event fired when closing the Sales Comment Entry window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopInquiryComment_CloseAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
            lookupWindowType = string.Empty;
        }

        /// <summary>
        /// Method to set the default values on opening the window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopInquiryUserDefined_OpenAfterOriginal(object sender, EventArgs e)
        {
            DisplayOrderTypeDetails(Resources.STR_SopInquiryForm);   // load data into temp table for order type of sales inquiry zoom window window
        }

        /// <summary>
        /// When the expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopInquiryUserDefinedExpansionButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (orderTypeDetailsForm.OrderTypeDetails.IsOpen)
                {
                    orderTypeDetailsForm.OrderTypeDetails.Close();
                }

                expansionWindowType = Resources.STR_SopInquiryForm;

                orderTypeDetailsForm.OrderTypeDetails.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopInquiryUserDefinedExpansionButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Sop Inquiry Entry display
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void SopInquiryLocalIsCommentDisplay_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopEntryInquiryForm.SopInquiry.SopType.Value == 6 || sopEntryInquiryForm.SopInquiry.SopType.Value == 3)
                {
                    if (sopEntryInquiryForm.SopInquiry.SopType.Value == 3)
                    {
                        sopEntryInquiryForm.SopInquiry.TobeCancelled.Show();
                        sopEntryInquiryForm.SopInquiry.TobeCancelled.Lock();
                    }
                    else
                    {
                        sopEntryInquiryForm.SopInquiry.TobeCancelled.Show();
                        sopEntryInquiryForm.SopInquiry.TobeCancelled.Lock();
                    }
                }
                else
                {
                    sopEntryInquiryForm.SopInquiry.TobeCancelled.Hide();
                }

                if (sopEntryInquiryForm.SopInquiry.SopType.Value == 4 || sopEntryInquiryForm.SopInquiry.SopType.Value == 5)
                {
                    sopEntryInquiryForm.SopInquiry.CustomizeServiceSkUs.Show();
                    sopEntryInquiryForm.SopInquiry.CustomizeServiceSkUs.Lock();
                }
                else
                {
                    sopEntryInquiryForm.SopInquiry.CustomizeServiceSkUs.Show();
                    sopEntryInquiryForm.SopInquiry.CustomizeServiceSkUs.Lock();
                }

                InsertSopEntryDetails(Resources.STR_SopInquiryForm);  //load data into temp table for Custom window.

                DisplaySopEntryDetails(Resources.STR_SopInquiryForm);  //display data to sopentry window.
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopInquiryLocalIsCommentDisplay_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Fired when IsCommentDisplay changed on display existing
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopInquiryItemDetailLocalIsCommentDisplay_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                InsertItemDetails(Resources.STR_SopItemInquiryForm);   // load data into quote temp table for sales item detail entry window

                DisplayItemDetails(Resources.STR_SopItemInquiryForm);  // display data into quote temp table for sales item detail entry window
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopInquiryItemDetailLocalIsCommentDisplay_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Display data to customer detail Entry  window from Temp Table.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopInquiryCustomerDetail_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                DisplayCustomerDetailEntry(Resources.STR_SopCustomerDetailInquiryForm);

                DisplayThirdPartyAddress(Resources.STR_SopCustomerDetailInquiryForm);

                DisplayCustomerPickupAddress(Resources.STR_SopCustomerDetailInquiryForm);

                DisplayCommentInstruction(Resources.STR_SopCustomerDetailInquiryForm);

                //Tax enhancements
                if (Dynamics.Globals.IntercompanyId.Value == "CPEUR")
                {
                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.TaxRegistrationNumber.Lock();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopInquiryCustomerDetail_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion SopInquiry

        #region SalesCustomerDetailEntry

        /// <summary>
        /// Display data to customer detail Entry  window from Temp Table.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntry_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                DisplayCustomerDetailEntry(Resources.STR_SalesCustomerDetailForm);    // Display customer Entry window value

                DisplayThirdPartyAddress(Resources.STR_SalesCustomerDetailForm); // Display Thirdparty Address..

                DisplayCustomerPickupAddress(Resources.STR_SalesCustomerDetailForm);

                DisplayCommentInstruction(Resources.STR_SalesCustomerDetailForm); // Display comment instructions...

                //Tax enhancements
                if (Dynamics.Globals.IntercompanyId.Value == "CPEUR")
                {
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxRegistrationNumber.Lock();
                }
                else
                {
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LookupButton12.Hide();
                }

                sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalWhCommentEdited.Hide();
                sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCarrierCommentEdited.Hide();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntry_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            isWarehouseClosureState = true;
        }

        /// <summary>
        /// Display Customer Entry window from Temp table...
        /// </summary>
        /// <param name="formName"></param>
        private void DisplayCustomerDetailEntry(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                #region WorkCustomer Entry

                if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                    TableError tableErrorDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.Get();
                    if (tableErrorDate == TableError.NoError && tableErrorDate != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigCustReqDel.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedDel.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedShip.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value;
                    }
                    else
                    {
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigCustReqDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedShip.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    }
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineFreightTerm.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.Incoterms.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerPickupAddress.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomerPickupAddress.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.Carrier.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierAccount.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierPhone.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierAddr.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.ServiceType.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.ImporterRecord.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value;
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomBroker.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value;
                    }
                    else
                    {
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineFreightTerm.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.Incoterms.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerPickupAddress.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.Carrier.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierAccount.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierPhone.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierAddr.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.ServiceType.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.ImporterRecord.Value = "";
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomBroker.Value = "";
                    }
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                    sopEntryForm.Tables.SalesAddressDetails.Close();
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;   // 2: used for Shipping address

                    sopEntryForm.Tables.SalesAddressDetails.Key = 2;
                    TableError tableError = sopEntryForm.Tables.SalesAddressDetails.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value = sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value.ToString().Trim();
                    }
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                }

                #endregion WorkCustomer Entry

                #region inquiry Customer Entry

                else if (formName == Resources.STR_SopCustomerDetailInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                    TableError tableErrorDate = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Get();
                    if (tableErrorDate == TableError.NoError && tableErrorDate != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpCustReqDel.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpCustReqShip.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpCurSchedDel.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpReqShipDate.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpOrigCustReqDel.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpOrigSchedDel.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpOrigSchedShip.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value;
                    }
                    else
                    {
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpCustReqDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpCustReqShip.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpCurSchedDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpReqShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpOrigCustReqDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpOrigSchedDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpOrigSchedShip.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();

                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineFreightTerm.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.Incoterms.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CustomerPickupAddress.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomerPickupAddress.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineCarrier.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineAccountNum.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineCarrierPhone.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineCarrierAddr.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ServiceType.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ImporterRecord.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value;
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CustomBroker.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value;
                    }
                    else
                    {
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineFreightTerm.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.Incoterms.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CustomerPickupAddress.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineCarrier.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineAccountNum.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineCarrierPhone.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineCarrierAddr.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ServiceType.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ImporterRecord.Value = "";
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CustomBroker.Value = "";
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                    sopEntryInquiryForm.Tables.SalesAddressDetails.Close();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Release();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryInquiryForm.SopInquiry.CustomerNumber.Value.ToString().Trim();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;   // 2: used for Shipping address

                    sopEntryInquiryForm.Tables.SalesAddressDetails.Key = 2;
                    TableError tableError = sopEntryInquiryForm.Tables.SalesAddressDetails.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpShipToAddress.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.AddressCode.Value.ToString().Trim();
                    }
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Release();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Close();
                }

                #endregion inquiry customer Entry
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayCustomerDetailEntry Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method to invoke script before sales customer entry window loaded
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OpenFinish_InvokeBeforeOriginal(object sender, SopCustomerDetailEntryForm.OpenFinishProcedure.InvokeEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                sopEntryForm.Tables.SalesAddressDetails.Close();
                sopEntryForm.Tables.SalesAddressDetails.Release();
                sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 1;   // 1: used for Billing address

                sopEntryForm.Tables.SalesAddressDetails.Key = 2;
                TableError tempError = sopEntryForm.Tables.SalesAddressDetails.Get();
                if (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                {
                    // set Bill To Address ID from temp table
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.PrimaryBilltoAddressCode.Value = sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value.ToString().Trim();
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalAddressDisplay.RunValidate();
                }
                sopEntryForm.Tables.SalesAddressDetails.Release();
                sopEntryForm.Tables.SalesAddressDetails.Close();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OpenFinish_InvokeBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// This event occurs when the address type changed value
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryLocalCpRgAddressDisplay_Change(object sender, EventArgs e)
        {
            LocalCpRgAddressDisplay(Resources.STR_SalesCustomerDetailForm);
        }

        /// <summary>
        /// LocalCpRgAddressDisplay Change
        /// </summary>
        private void LocalCpRgAddressDisplay(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            if (formName == Resources.STR_SalesCustomerDetailForm)
            {
                try
                {
                    if (!String.IsNullOrEmpty(sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerNumber.Value))
                    {
                        if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCpRgAddressDisplay.Value == 0)
                        {
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalAddressDisplay.Value = 0;  // fire bill to address events
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalAddressDisplay.RunValidate();
                        }
                        else if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCpRgAddressDisplay.Value == 1)
                        {
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalAddressDisplay.Value = 1;  // fire ship to address events
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalAddressDisplay.RunValidate();
                        }
                        else if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCpRgAddressDisplay.Value == 2)
                        {
                            DisplayAddressDetails(Resources.STR_SopEntryForm, sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value);  // Displaying custom addresses values
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpRgAddressDisplay Method (SalesEntry): " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
            else if (formName == Resources.STR_SopCustomerDetailInquiryForm)
            {
                try
                {
                    if (!String.IsNullOrEmpty(sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CustomerNumber.Value))
                    {
                        if (sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.LocalCpRgAddressDisplay.Value == 0)
                        {
                            sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.LocalAddressDisplay.Value = 0;  // fire bill to address events
                            sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.LocalAddressDisplay.RunValidate();
                        }
                        else if (sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.LocalCpRgAddressDisplay.Value == 1)
                        {
                            sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.LocalAddressDisplay.Value = 1;  // fire ship to address events
                            sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.LocalAddressDisplay.RunValidate();
                        }
                        else if (sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.LocalCpRgAddressDisplay.Value == 2)
                        {
                            DisplayAddressDetails(Resources.STR_SopInquiryForm, sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CpShipToAddress.Value);  // Displaying custom addresses values
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpRgAddressDisplay Method (Inquiry): " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }

        /// <summary>
        /// fire when user clicked on Bill To Address Id lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryLookupButton3_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                lookupWindowType = Resources.STR_BillToAddressID;
                if (!RegisterAddressLookupSelect)
                {
                    addressLookupForm.AddressLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(AddressLookupSelectButton_ClickBeforeOriginal);
                    RegisterAddressLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryLookupButton3_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// fire when user clicked on Final Destination Address lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryLookupButton4_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                lookupWindowType = Resources.STR_FinalAddressID;
                if (!RegisterAddressLookupSelect)
                {
                    addressLookupForm.AddressLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(AddressLookupSelectButton_ClickBeforeOriginal);
                    RegisterAddressLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryLookupButton4_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// fire when user clicked on Ship To Address Id lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryZoomButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                rmCustomerAddressForm.Procedures.OpenWindow.Invoke(sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerNumber.Value.ToString().Trim(),
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value.ToString().Trim());
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryZoomButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void SopCustomerDetailEntryOkButton_ClickBeforeOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (Dynamics.Globals.CompanyId == 2 && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsChanged)
                {
                    if (!String.IsNullOrEmpty(sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxRegistrationNumber.Value.ToString().Trim()) &&
                        TaxRegNumber.ToString().Trim() != sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxRegistrationNumber.Value.ToString().Trim())
                    {
                        TaxRegNumber = sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxRegistrationNumber.Value.ToString().Trim();
                    }

                    if (!String.IsNullOrEmpty(sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxScheduleId.Value.ToString().Trim()) &&
                        TaxScheduleID.ToString().Trim() != sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxScheduleId.Value.ToString().Trim())
                    {
                        TaxScheduleID = sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxScheduleId.Value.ToString().Trim();

                        SalesOrderRequest _salesOrderRequest = new SalesOrderRequest();
                        SalesOrderEntity _salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation _salesOrderInformation = new SalesOrderInformation();
                        SalesOrderDetails _salesOrderDetails = new SalesOrderDetails();
                        OrderHeader _orderHeader = new OrderHeader();

                        _salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        _salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                        _orderHeader.TaxScheduleId = TaxScheduleID;

                        _salesOrderDetails.OrderHeader = _orderHeader;
                        _salesOrderInformation.SalesOrderDetails = _salesOrderDetails;
                        _salesOrderEntity.SalesOrderDetails = _salesOrderInformation;
                        _salesOrderRequest.SalesOrderEntity = _salesOrderEntity;
                        _salesOrderRequest.CompanyID = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);

                        // Service call ...
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/UpdateTaxScheduleIdToLine/", _salesOrderRequest); // we need to refer the web.api service url here.

                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesOrderResponse.Status == ResponseStatus.Error)
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryOkButton_ClickBeforeOriginal Method (UpdateTaxScheduleIdToLine): " + salesOrderResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                MessageBox.Show("Error: Data does not saved into UpdateTaxScheduleIdToLine Table", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryOkButton_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Assign Customer detail Entry window value to Temp Table...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void SopCustomerDetailEntryOkButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                #region Date Details

                sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                sopEntryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                TableError tableErrorDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.Change();
                if (tableErrorDate == TableError.NoError && tableErrorDate != TableError.EndOfTable)
                {
                    if (sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value ||
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value ||
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value ||
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value)
                    {
                        // Edited dates. wrote logic instead of force changes window
                        if (!sopEntryForm.SopEntry.IsChanged)
                            sopEntryForm.SopEntry.IsChanged = true;
                    }

                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigCustReqDel.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedDel.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedShip.Value;

                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.IsUpdated.Value = 1;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Save();
                }
                else
                {
                    if (tableErrorDate == TableError.NotFound && tableErrorDate != TableError.EndOfTable)
                    {
                        // Edited dates. wrote logic instead of force changes window
                        if (!sopEntryForm.SopEntry.IsChanged)
                            sopEntryForm.SopEntry.IsChanged = true;

                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value;

                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value;
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value;
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value;
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value;
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigCustReqDel.Value;
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedDel.Value;
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedShip.Value;

                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.IsUpdated.Value = 1;
                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.Save();
                    }
                }
                sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();

                #endregion Date Details

                #region Transportation Details

                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Change();
                if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                {
                    if (sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineFreightTerm.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.Incoterms.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomerPickupAddress.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerPickupAddress.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.Carrier.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierAccount.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierPhone.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierAddr.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.ServiceType.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.ImporterRecord.Value ||
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomBroker.Value)
                    {
                        // Edited transportation. wrote logic instead of force changes window
                        if (!sopEntryForm.SopEntry.IsChanged)
                            sopEntryForm.SopEntry.IsChanged = true;
                    }

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineFreightTerm.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.Incoterms.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomerPickupAddress.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerPickupAddress.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.Carrier.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierAccount.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierPhone.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierAddr.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.ServiceType.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.ImporterRecord.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomBroker.Value;

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IsUpdated.Value = 1;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Save();
                }
                else
                {
                    if (tableErrorTransportation == TableError.NotFound && tableErrorTransportation != TableError.EndOfTable)
                    {
                        // Edited transportation. wrote logic instead of force changes window
                        if (!sopEntryForm.SopEntry.IsChanged)
                            sopEntryForm.SopEntry.IsChanged = true;

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value;

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineFreightTerm.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.Incoterms.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomerPickupAddress.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerPickupAddress.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.Carrier.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierAccount.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierPhone.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierAddr.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.ServiceType.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.ImporterRecord.Value;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomBroker.Value;

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IsUpdated.Value = 1;
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Save();
                    }
                }
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                #endregion Transportation Details

                DisplaySopEntryDetails(Resources.STR_SopEntryForm);
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryOkButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            isWarehouseClosureState = false;
        }

        /// <summary>
        /// Third Party Expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailExpansionButton2_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (thirdPartyAddressDetailsForm.ThirdPartyAddress.IsOpen)
                {
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.Close();
                }

                expansionWindowType = Resources.STR_SalesCustomerDetailForm;

                thirdPartyAddressDetailsForm.ThirdPartyAddress.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailExpansionButton2_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// fire when user clicked on Ship To Address Id lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryLookupButton11_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (addressLookupForm.IsOpen)
                {
                    addressLookupForm.Close();
                }
                addressLookupForm.Open();
                // Assigning the customer number to lookup form
                addressLookupForm.AddressLookup.SortBy.Value = 1;
                // select the record
                addressLookupForm.AddressLookup.CustomerNumber.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerNumber.Value;
                addressLookupForm.AddressLookup.AddressCode.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value;
                addressLookupForm.AddressLookup.RedisplayButton.RunValidate();

                lookupWindowType = Resources.STR_ShipToAddressID;
                if (!RegisterAddressLookupSelect)
                {
                    addressLookupForm.AddressLookup.SelectButton.ClickBeforeOriginal += AddressLookupSelectButton_ClickBeforeOriginal;
                    RegisterAddressLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryLookupButton11_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event method called on selecting the address code from lookup window and value returned to from Ship To/ Bill To. Final Destination Address Id field.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AddressLookupSelectButton_ClickBeforeOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(lookupWindowType))
                {
                    if (lookupWindowType == Resources.STR_BillToAddressID && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                    {
                        // Update ship To Address into temp table
                        UpdateAddressDetails(addressLookupForm.AddressLookup.CustomerNumber.Value.ToString().Trim(),
                            1,
                            addressLookupForm.AddressLookup.AddressLookupScroll.AddressCode.Value.ToString().Trim());
                    }
                    else if (lookupWindowType == Resources.STR_ShipToAddressID && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                    {
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value = addressLookupForm.AddressLookup.AddressLookupScroll.AddressCode.Value.ToString();
                        addressLookupForm.Close();

                        // Update ship To Address into temp table
                        UpdateAddressDetails(addressLookupForm.AddressLookup.CustomerNumber.Value.ToString().Trim(),
                            2,
                            addressLookupForm.AddressLookup.AddressLookupScroll.AddressCode.Value.ToString().Trim());

                        // Display updated values
                        DisplayAddressDetails(Resources.STR_SopEntryForm, sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value);
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AddressLookupSelectButton_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Display custom address into sales customer details entry screen
        /// </summary>
        /// <param name="formName">Specify Form Name</param>
        /// <param name="addressCode">Specify address code</param>
        private void DisplayAddressDetails(string formName, string addressCode)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value;
                    sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryForm.SopEntry.CustomerNumber.Value;
                    sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;   // fetch shipping address and load into sales customer details entry window
                    sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = addressCode;

                    sopEntryForm.Tables.SalesAddressDetails.Key = 1;
                    TableError tableError = sopEntryForm.Tables.SalesAddressDetails.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.ShipToName.Value = sopEntryForm.Tables.SalesAddressDetails.ShipToName.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.ContactPerson.Value = sopEntryForm.Tables.SalesAddressDetails.ContactPerson.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.Address1.Value = sopEntryForm.Tables.SalesAddressDetails.Address1.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.Address2.Value = sopEntryForm.Tables.SalesAddressDetails.Address2.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.Address3.Value = sopEntryForm.Tables.SalesAddressDetails.Address3.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.City.Value = sopEntryForm.Tables.SalesAddressDetails.City.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.State.Value = sopEntryForm.Tables.SalesAddressDetails.State.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.ZipCode.Value = sopEntryForm.Tables.SalesAddressDetails.ZipCode.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.Country.Value = sopEntryForm.Tables.SalesAddressDetails.Country.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CountryCode.Value = sopEntryForm.Tables.SalesAddressDetails.CountryCode.Value.ToString().Trim();
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.AddressCode.Value = sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value.ToString();
                        if (addressCode == "")
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.ShipToName.Value = "";
                    }
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Close();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Release();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value;
                    sopEntryInquiryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryInquiryForm.SopInquiry.CustomerNumber.Value;
                    sopEntryInquiryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;   // fetch shipping address and load into sales customer details entry window
                    sopEntryInquiryForm.Tables.SalesAddressDetails.AddressCode.Value = addressCode;

                    sopEntryInquiryForm.Tables.SalesAddressDetails.Key = 1;
                    TableError tableError = sopEntryInquiryForm.Tables.SalesAddressDetails.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ShipToName.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.ShipToName.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ContactPerson.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.ContactPerson.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.Address1.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.Address1.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.Address2.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.Address2.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.Address3.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.Address3.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.City.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.City.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.State.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.State.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ZipCode.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.ZipCode.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.Country.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.Country.Value.ToString().Trim();
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CountryCode.Value = sopEntryInquiryForm.Tables.SalesAddressDetails.CountryCode.Value.ToString().Trim();

                        if (addressCode == "")
                            sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.ShipToName.Value = "";
                    }
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Release();
                    sopEntryInquiryForm.Tables.SalesAddressDetails.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Update custom address from sales customer detail entry screen
        /// </summary>
        /// <param name="customerID">Specify customer number</param>
        /// <param name="addressTypeId">Specify address type. 1: Billing 2: Shipping</param>
        /// <param name="addressCode">Specify address code</param>
        private void UpdateAddressDetails(string customerID, int addressTypeId, string addressCode)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                // load data from address master table for new address code.
                ChemPointSalesExt.Tables.RmCustomerMstrAddr.Close();
                ChemPointSalesExt.Tables.RmCustomerMstrAddr.Release();
                ChemPointSalesExt.Tables.RmCustomerMstrAddr.CustomerNumber.Value = customerID;
                ChemPointSalesExt.Tables.RmCustomerMstrAddr.AddressCode.Value = addressCode;
                ChemPointSalesExt.Tables.RmCustomerMstrAddr.Key = 1;
                TableError tempError = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Get();
                if (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                {
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = customerID;
                    sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = Convert.ToInt16(addressTypeId);  // update for respective address type

                    sopEntryForm.Tables.SalesAddressDetails.Key = 2;
                    TableError tableError = sopEntryForm.Tables.SalesAddressDetails.Change();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        //Pass result for billing address code else check address difference for shipping address code only.

                        if (addressTypeId == 1 || addressTypeId == 2)
                        {
                            // Edited transportation. wrote logic instead of force changes window
                            if (!sopEntryForm.SopEntry.IsChanged)
                                sopEntryForm.SopEntry.IsChanged = true;

                            sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = addressCode;

                            sopEntryForm.Tables.SalesAddressDetails.CustomerName.Value = sopEntryForm.SopEntry.CustomerName.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.ShipToName.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.ShipToName.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.ContactPerson.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.ContactPerson.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.Address1.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Address1.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.Address2.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Address2.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.Address3.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Address3.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.Country.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Country.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.City.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.City.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.State.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.State.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.ZipCode.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Zip.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.CountryCode.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.CountryCode.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.Phone1.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Phone1.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.Phone2.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Phone2.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.Phone3.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Phone3.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.Fax.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.Fax.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = ChemPointSalesExt.Tables.RmCustomerMstrAddr.AddressCode.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.IsUpdated.Value = 1;
                            sopEntryForm.Tables.SalesAddressDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopEntryForm.Tables.SalesAddressDetails.Save();
                        }
                    }
                    sopEntryForm.Tables.SalesAddressDetails.Release();
                    sopEntryForm.Tables.SalesAddressDetails.Close();
                }
                ChemPointSalesExt.Tables.RmCustomerMstrAddr.Release();
                ChemPointSalesExt.Tables.RmCustomerMstrAddr.Close();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In UpdateAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// When the expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryExpansionButton1_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value.ToString().Trim() != "")
                {
                    if (addressEntryForm.AddressEntry.IsOpen)
                    {
                        addressEntryForm.AddressEntry.Close();
                    }

                    expansionWindowType = Resources.STR_ShipToAddressID;

                    addressEntryForm.AddressEntry.Open();
                }
                else
                {
                    MessageBox.Show("Please select the Ship To Address ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryExpansionButton1_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Fire when default address changed and respective radio selected
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryLocalAddressDisplay_ValidateAfterOriginal(object sender, EventArgs e)
        {
            if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCpRgAddressDisplay.Value == 2 && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
            {
                DisplayAddressDetails(Resources.STR_SopEntryForm, sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value);
            }
        }

        /// <summary>
        /// Method fired on before opening the Address Entry window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AddressEntry_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (RegisterAddressEntry == false)
                {
                    addressEntryForm.AddressEntry.CloseAfterOriginal += new EventHandler(AddressEntry_CloseAfterOriginal);
                    addressEntryForm.AddressEntry.OkButton.ClickAfterOriginal += new EventHandler(AddressEntryOkButton_ClickAfterOriginal);
                    addressEntryForm.AddressEntry.CancelButton.ClickAfterOriginal += new EventHandler(AddressEntryCancelButton_ClickAfterOriginal);

                    RegisterAddressEntry = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AddressEntry_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event fired when closing the address entry window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AddressEntry_CloseAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
        }

        /// <summary>
        /// Method to set the address values on opening the window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AddressEntry_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType))
                {
                    if (expansionWindowType == Resources.STR_ShipToAddressID)
                    {
                        sopEntryForm.Tables.SalesAddressDetails.Close();
                        sopEntryForm.Tables.SalesAddressDetails.Release();
                        sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                        sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                        sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;

                        sopEntryForm.Tables.SalesAddressDetails.Key = 2;
                        TableError tableError = sopEntryForm.Tables.SalesAddressDetails.Get();
                        if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            addressEntryForm.AddressEntry.CustomerNumber.Value = sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.AddressCode.Value = sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.ShipToName.Value = sopEntryForm.Tables.SalesAddressDetails.ShipToName.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.AddressContact.Value = sopEntryForm.Tables.SalesAddressDetails.ContactPerson.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.AddressList1.Value = sopEntryForm.Tables.SalesAddressDetails.Address1.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.AddressList2.Value = sopEntryForm.Tables.SalesAddressDetails.Address2.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.AddressList3.Value = sopEntryForm.Tables.SalesAddressDetails.Address3.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.City.Value = sopEntryForm.Tables.SalesAddressDetails.City.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.State.Value = sopEntryForm.Tables.SalesAddressDetails.State.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.ZipCode.Value = sopEntryForm.Tables.SalesAddressDetails.ZipCode.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.CountryCode.Value = sopEntryForm.Tables.SalesAddressDetails.CountryCode.Value.ToString().Trim();
                            addressEntryForm.AddressEntry.Country.Value = sopEntryForm.Tables.SalesAddressDetails.Country.Value.ToString().Trim();

                        }
                        sopEntryForm.Tables.SalesAddressDetails.Release();
                        sopEntryForm.Tables.SalesAddressDetails.Close();

                        addressEntryForm.AddressEntry.CustomerNumber.Lock();
                        addressEntryForm.AddressEntry.AddressCode.Lock();
                        if (!addressEntryForm.AddressEntry.IsEditingStatus.Value)
                        {
                            addressEntryForm.AddressEntry.ShipToName.Lock();
                            addressEntryForm.AddressEntry.AddressContact.Lock();
                            addressEntryForm.AddressEntry.AddressList1.Lock();
                            addressEntryForm.AddressEntry.AddressList2.Lock();
                            addressEntryForm.AddressEntry.AddressList3.Lock();
                            addressEntryForm.AddressEntry.City.Lock();
                            addressEntryForm.AddressEntry.State.Lock();
                            addressEntryForm.AddressEntry.ZipCode.Lock();
                            addressEntryForm.AddressEntry.CountryCode.Lock();
                            addressEntryForm.AddressEntry.Country.Lock();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AddressEntry_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// When the ok button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AddressEntryOkButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType))
                {
                    if (expansionWindowType == Resources.STR_ShipToAddressID)
                    {
                        addressEntryForm.AddressEntry.Close();

                        if (addressEntryForm.AddressEntry.IsEditingStatus.Value)
                        {
                            sopEntryForm.Tables.SalesAddressDetails.Close();
                            sopEntryForm.Tables.SalesAddressDetails.Release();
                            sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = addressEntryForm.AddressEntry.CustomerNumber.Value.ToString().Trim();
                            sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;  // update for respective address type
                            sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = addressEntryForm.AddressEntry.AddressCode.Value.ToString().Trim();

                            sopEntryForm.Tables.SalesAddressDetails.Key = 1;
                            TableError tableError = sopEntryForm.Tables.SalesAddressDetails.Change();
                            if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                            {
                                sopEntryForm.Tables.SalesAddressDetails.ShipToName.Value = addressEntryForm.AddressEntry.ShipToName.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.ContactPerson.Value = addressEntryForm.AddressEntry.AddressContact.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.Address1.Value = addressEntryForm.AddressEntry.AddressList1.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.Address2.Value = addressEntryForm.AddressEntry.AddressList2.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.Address3.Value = addressEntryForm.AddressEntry.AddressList3.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.Country.Value = addressEntryForm.AddressEntry.Country.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.City.Value = addressEntryForm.AddressEntry.City.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.State.Value = addressEntryForm.AddressEntry.State.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.ZipCode.Value = addressEntryForm.AddressEntry.ZipCode.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.CountryCode.Value = addressEntryForm.AddressEntry.CountryCode.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = addressEntryForm.AddressEntry.AddressCode.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesAddressDetails.IsUpdated.Value = 1;
                                sopEntryForm.Tables.SalesAddressDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryForm.Tables.SalesAddressDetails.Save();
                            }
                            sopEntryForm.Tables.SalesAddressDetails.Release();
                            sopEntryForm.Tables.SalesAddressDetails.Close();

                            if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCpRgAddressDisplay.Value == 2 && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                            {
                                DisplayAddressDetails(Resources.STR_SopEntryForm, sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpShipToAddress.Value);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AddressEntryOkButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// When the cancel button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AddressEntryCancelButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType))
                {
                    if (expansionWindowType == Resources.STR_ShipToAddressID)
                    {
                        addressEntryForm.AddressEntry.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AddressEntryCancelButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Update the curshedship when we update CustReqDel
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpCustReqDel_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                string stDate = "1900/01/01";

                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigCustReqDel.Value == DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value != DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigCustReqDel.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value
                )
                {
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigCustReqDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value;
                }

                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value != DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value != DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value != DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCustSchedDelDate.Value)
                {
                    // sets the cur req del date
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value = CPDateUpdate();
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCustSchedDelDate.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value;

                    // updates the orignal date fields
                    UpdateSOPItemDetailOriginalDateFields();

                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCurSchedDelDate.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpCustReqDel_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Update the curshedship when we update CustReqDel
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpCustReqShip_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                string stDate = "1900/01/01";


                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value != DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value != DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value != DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCustSchedDelDate.Value)
                {
                    // sets the cur req del date
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value = CPDateUpdate();
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCustSchedDelDate.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value;

                    // updates the orignal date fields
                    UpdateSOPItemDetailOriginalDateFields();
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCurSchedDelDate.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpCustReqShip_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void CpCurSchedDel_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                // updates the orignal date fields
                UpdateSOPItemDetailOriginalDateFields();
                sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCurSchedDelDate.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value;
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpCurSchedDel_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Update the cur shed ship , origschedship , origscheddel
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpReqShipDate_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                // updates the orignal date fields
                UpdateSOPItemDetailOriginalDateFields();

                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value != DateTime.Parse(Resources.STR_DATE, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value != DateTime.Parse(Resources.STR_DATE, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value != DateTime.Parse(Resources.STR_DATE, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCurSchedShipDate.Value)
                {
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value = CPDateUpdate();

                    // updates the orignal date fields
                    UpdateSOPItemDetailOriginalDateFields();

                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCurSchedShipDate.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value;
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCurSchedDelDate.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value;
                    sopEntryForm.SopEntry.CpReqShipDate.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value;
                    GetCurSchedShipDate();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpReqShipDate_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        private void UpdateSOPItemDetailOriginalDateFields()
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                string stDate = "1900/01/01";
                // check the orig values
                // update orig sched del value

                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedDel.Value == DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCurSchedDelDate.Value)
                {
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedDel.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value;
                }
                // update orig sched ship value
                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedShip.Value == DateTime.Parse(stDate, System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")) &&
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value != sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCurSchedShipDate.Value)
                {
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedShip.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In UpdateSOPItemDetailOriginalDateFields Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Private method to load the Cur Sched Ship date to Sales Date entry if the window is open.
        /// </summary>
        private void GetCurSchedShipDate()
        {
            if (sopDateEntryForm.SopDateEntry.IsOpen)
                sopDateEntryForm.SopDateEntry.RequestedShipDate.Value = sopEntryForm.SopEntry.CpReqShipDate.Value;
        }

        /// <summary>
        /// Update the CpCurSchedDel
        /// </summary>
        public DateTime CPDateUpdate()
        {
            StringBuilder logMessage = new StringBuilder();
            ////datediff
            DateTime calcDate = new DateTime();

            bool isResult = true;

            try
            {
                SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                SalesOrderEntity salesCustomerDetailsObj = new SalesOrderEntity();
                salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                OrderSchedule orderSchedule = new OrderSchedule();

                orderSchedule.RequestedShipDate = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value;
                orderSchedule.CustomerRequestedShipDate = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value;
                orderSchedule.CustomerRequestedDeliveryDate = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value;

                salesOrderDetails.OrderSchedule = orderSchedule;
                salesOrderInformation.SalesOrderDetails = salesOrderDetails;
                salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                salesOrderRequest.SalesOrderEntity = salesOrderEntity;

                // Service call ...
                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetSalesCurSchedDelDate/", salesOrderRequest); // we need to refer the web.api service url here.

                    if (response.Result.IsSuccessStatusCode)
                    {
                        SalesOrderResponse _salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                        if (_salesOrderResponse.Status == ResponseStatus.Success)
                        {
                            isResult = true;
                            salesCustomerDetailsObj = _salesOrderResponse.SalesOrderDetails;   //Customer detail Entry data response..
                        }
                        else
                        {
                            isResult = false;
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CPDateUpdate Method (GetSalesCurSchedDelDate): " + _salesOrderResponse.ErrorMessage.ToString());
                            MessageBox.Show("Error: " + _salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                        }
                    }
                    else
                    {
                        isResult = false;
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Dates does not fetch for delivery date calculation");
                        MessageBox.Show("Error: Dates does not fetch for delivery date calculation", Resources.STR_MESSAGE_TITLE);
                    }
                }

                if (salesCustomerDetailsObj != null && isResult)
                {
                    if (salesCustomerDetailsObj.SalesOrderDetails != null)
                    {
                        if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails != null)
                        {
                            if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule != null)
                            {
                                calcDate = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedDeliveryDate;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CPDateUpdate Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return calcDate;
        }

        void ExpansionButton5_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value.ToString().Trim() != "")
                {
                    if (sopCommentEntryForm.SopCommentEntry.IsOpen)
                    {
                        if (sopCommentEntryForm.SopCommentEntry.LocalSource.Value.ToString().Trim() == "1")
                        {
                            MessageBox.Show("Please close the Sales Comment Entry window before continuing.", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                            return;
                        }

                        sopCommentEntryForm.SopCommentEntry.Close();
                    }

                    expansionWindowType = Resources.STR_InternalInstructionID;

                    lookupWindowType = Resources.STR_SalesCustomerDetailForm;

                    sopEntryForm.SopEntry.ExpansionButton13.RunValidate();
                }
                else
                {
                    MessageBox.Show("Please select internal Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ExpansionButton5_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion SalesCustomerDetailEntry

        #region SOPLineItem

        /// <summary>
        /// Fired when IsCommentDisplay changed on display existing
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailDisplayExisting_Change(object sender, EventArgs e)
        {
            InsertItemDetails(Resources.STR_SopItemDetailForm);   // load data into quote temp table for sales item detail entry window

            DisplayItemDetails(Resources.STR_SopItemDetailForm);  // display data into quote temp table for sales item detail entry window
        }

        /// <summary>
        /// Insert custom quotes into quote details temp table for specified form name
        /// </summary>
        /// <param name="formName">For Example: STR_SopItemDetailForm, STR_SopItemInquiryForm, STR_SopEntryForm and STR_SopInquiryForm</param>
        private void InsertItemDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                #region Insert SopItemDetail

                if (formName == Resources.STR_SopItemDetailForm)
                {
                    sopItemDetailForm.SopItemDetail.LocalWhCommentEdited.Hide();
                    sopItemDetailForm.SopItemDetail.LocalCarrierCommentEdited.Hide();

                    if (String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) || String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) ||
                        String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) || String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                    {
                        ClearItemDetails(formName, 0, "", "", 0);   // pass blank Sop Type, Sop Number, Item number and line seq number to clear all data
                    }
                    else
                    {
                        ClearItemDetails(formName,
                            sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value,
                            sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim(),
                            sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString().Trim(),
                            sopItemDetailForm.SopItemDetail.LineItemSequence.Value);  // bypass line sequence number Number on double insertion

                        if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString().Trim()) && !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString().Trim()))
                        {
                            SalesOrderRequest _salesOrderRequest = new SalesOrderRequest();
                            SalesOrderEntity _salesOrderEntity = new SalesOrderEntity();
                            SalesOrderInformation _salesOrderInformation = new SalesOrderInformation();
                            SalesOrderDetails _salesOrderDetails = new SalesOrderDetails();
                            List<SalesLineItem> _lineItemList = new List<SalesLineItem>();
                            SalesLineItem _lineItem = new SalesLineItem();

                            bool isResult = true;

                            try
                            {
                                _salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                                _lineItem.SopType = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                                _lineItem.SopNumber = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                                _lineItem.OrderLineId = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                                _lineItem.ComponentSequenceNumber = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                                _lineItemList.Add(_lineItem);
                                _salesOrderDetails.LineItems = _lineItemList;
                                _salesOrderInformation.SalesOrderDetails = _salesOrderDetails;
                                _salesOrderEntity.SalesOrderDetails = _salesOrderInformation;
                                _salesOrderRequest.SalesOrderEntity = _salesOrderEntity;

                                // Service call ...
                                using (HttpClient client = new HttpClient())
                                {
                                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                    client.DefaultRequestHeaders.Accept.Clear();
                                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetSalesItemDetail/", _salesOrderRequest); // we need to refer the web.api service url here.
                                    if (response.Result.IsSuccessStatusCode)
                                    {
                                        SalesOrderResponse salesItemDetailResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                        if (salesItemDetailResponse.Status == ResponseStatus.Success)
                                        {
                                            isResult = true;
                                            _salesOrderEntity = salesItemDetailResponse.SalesOrderDetails;
                                        }
                                        else
                                        {
                                            isResult = false;
                                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertItemDetails Method (Item Detail Entry): " + salesItemDetailResponse.ErrorMessage.ToString());
                                            MessageBox.Show("Error: " + salesItemDetailResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                        }
                                    }
                                    else
                                    {
                                        isResult = false;
                                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not fetch from custom item details Table (Item Detail Entry)");
                                        MessageBox.Show("Error: Data does not fetch from custom item details Table", Resources.STR_MESSAGE_TITLE);
                                    }
                                }
                            }
                            catch (Exception exception)
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: " + exception.Message);
                                MessageBox.Show("Error: " + exception.Message, Resources.STR_MESSAGE_TITLE);
                            }
                            finally
                            {
                            }

                            if (_salesOrderEntity != null && isResult)
                            {
                                if (_salesOrderEntity.SalesOrderDetails != null)
                                {
                                    if (_salesOrderEntity.SalesOrderDetails.SalesOrderDetails != null)
                                    {
                                        if (_salesOrderEntity.SalesOrderDetails.SalesOrderDetails.LineItems != null)
                                        {
                                            foreach (var itemDetail in _salesOrderEntity.SalesOrderDetails.SalesOrderDetails.LineItems)
                                            {
                                                if (sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value == itemDetail.SopType &&
                                                    sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim() == itemDetail.SopNumber.ToString().Trim() &&
                                                    sopItemDetailForm.SopItemDetail.LineItemSequence.Value == itemDetail.OrderLineId &&
                                                    sopItemDetailForm.SopItemDetail.ComponentSequence.Value == itemDetail.ComponentSequenceNumber)
                                                {
                                                    #region Quote Details

                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = itemDetail.SopNumber.ToString().Trim();
                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = Convert.ToInt32(itemDetail.OrderLineId);
                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = Convert.ToInt16(itemDetail.ComponentSequenceNumber);

                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Key = 1;
                                                    TableError tempErrorQuote = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Change();
                                                    if (tempErrorQuote != TableError.NoError && tempErrorQuote == TableError.NotFound)
                                                    {
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = itemDetail.SopNumber;

                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = itemDetail.OrderLineId;
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = itemDetail.ComponentSequenceNumber;
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteGuid.Value = itemDetail.QuoteGuid;
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteNumber.Value = itemDetail.QuoteNumber.ToString().Trim();
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteVersion.Value = Convert.ToInt16(itemDetail.QuoteNumberVersion);
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightIncludedPricing.Value = itemDetail.IsFip;
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightQuotePrice.Value = itemDetail.LineFreightAmount;
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.OriginatingFreightAmount.Value = itemDetail.OrginatingFreightPrice;
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.IsUpdated.Value = 0;
                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Save();
                                                    }
                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();

                                                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();

                                                    #endregion Quote Details

                                                    #region Product Details

                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();
                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();
                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value = itemDetail.SopNumber.ToString().Trim();
                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value = Convert.ToInt32(itemDetail.OrderLineId);
                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value = Convert.ToInt16(itemDetail.ComponentSequenceNumber);

                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Key = 1;
                                                    TableError tempErrorProduct = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Change();
                                                    if (tempErrorProduct != TableError.NoError && tempErrorProduct == TableError.NotFound)
                                                    {
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value = itemDetail.SopNumber;
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ItemNumber.Value = itemDetail.ItemNumber;
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value = itemDetail.OrderLineId;
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value = itemDetail.ComponentSequenceNumber;
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ShipWeight.Value = itemDetail.ShipWeight.ToString().Trim();
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.NetWeight.Value = itemDetail.NetWeight.ToString().Trim();
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UnNumber.Value = itemDetail.UnNumber.ToString().Trim();
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.CountryOfOrigin.Value = itemDetail.CountryOfOrigin.ToString().Trim();
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.EccnNumber.Value = itemDetail.EccnNumber.ToString().Trim();
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.HtsNumber.Value = itemDetail.HtsNumber.ToString().Trim();

                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.IsUpdated.Value = 0;
                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Save();
                                                    }
                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();

                                                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();

                                                    #endregion Product Details

                                                    #region Shipment Details

                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();
                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value = itemDetail.SopNumber.ToString().Trim();
                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value = Convert.ToInt32(itemDetail.OrderLineId);
                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value = Convert.ToInt16(itemDetail.ComponentSequenceNumber);

                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Key = 1;
                                                    TableError tempErrorShipment = sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Change();
                                                    if (tempErrorShipment != TableError.NoError && tempErrorShipment == TableError.NotFound)
                                                    {
                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value = itemDetail.SopNumber;
                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ItemNumber.Value = itemDetail.ItemNumber;
                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value = itemDetail.OrderLineId;
                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value = itemDetail.ComponentSequenceNumber;
                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ActualShip.Value = itemDetail.ActualShipDate;

                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.IsUpdated.Value = 0;
                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Save();
                                                    }
                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                                                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();

                                                    #endregion Shipment Details

                                                    InsertLineInstruction(_salesOrderEntity, Resources.STR_SopItemDetailForm);

                                                    if (itemDetail.SalesLineTrackingNumber != null)
                                                    {
                                                        sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.Close();
                                                        sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.Release();

                                                        foreach (var trackingNumberList in itemDetail.SalesLineTrackingNumber)
                                                        {
                                                            sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.Release();
                                                            sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.SopType.Value = Convert.ToInt16(trackingNumberList.SopType);
                                                            sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.SopNumber.Value = trackingNumberList.SopNumber;
                                                            sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.LineItemSequence.Value = trackingNumberList.LineItemSequence;
                                                            sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.ComponentSequence.Value = trackingNumberList.ComponentSequenceNumber;
                                                            sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.LineTrackingNumbers.Value = trackingNumberList.TrackingNumber;
                                                            sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.Save();
                                                        }

                                                        sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.Release();
                                                        sopItemDetailForm.Tables.SopItemDetailsTrackingTemp.Close();

                                                        sopItemDetailForm.Procedures.SopItemDetailFormTrackingScrollFill.Invoke();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }

                #endregion Insert SopItemDetail

                #region Insert SopItemDetailInquiry

                else if (formName == Resources.STR_SopItemInquiryForm)
                {
                    if (String.IsNullOrEmpty(sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value) || String.IsNullOrEmpty(sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value.ToString()) ||
                        String.IsNullOrEmpty(sopInquiryItemDetailForm.SopInquiryItemDetail.ItemNumber.Value.ToString()) || String.IsNullOrEmpty(sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value.ToString()))
                    {
                        ClearItemDetails(formName, 0, "", "", 0);   // pass blank Sop Type, Sop Number, Item number and line seq number to clear all data
                    }
                    else
                    {
                        ClearItemDetails(formName,
                            sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value,
                            sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim(),
                            sopInquiryItemDetailForm.SopInquiryItemDetail.ItemNumber.Value.ToString().Trim(),
                            sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value);  // bypass line sequence number Number on double insertion

                        if (!String.IsNullOrEmpty(sopInquiryItemDetailForm.SopInquiryItemDetail.ItemNumber.Value.ToString().Trim()) && !String.IsNullOrEmpty(sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value.ToString().Trim()))
                        {
                            SalesOrderRequest _salesOrderRequest = new SalesOrderRequest();

                            SalesOrderEntity _salesOrderEntity = new SalesOrderEntity();
                            SalesOrderInformation _salesOrderInformation = new SalesOrderInformation();
                            SalesOrderDetails _salesOrderDetails = new SalesOrderDetails();
                            List<SalesLineItem> _lineItemList = new List<SalesLineItem>();
                            SalesLineItem _lineItem = new SalesLineItem();

                            bool isResult = true;

                            try
                            {
                                _salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                                _lineItem.SopType = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                                _lineItem.SopNumber = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();
                                _lineItem.OrderLineId = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                                _lineItem.ComponentSequenceNumber = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;
                                _lineItemList.Add(_lineItem);
                                _salesOrderDetails.LineItems = _lineItemList;
                                _salesOrderInformation.SalesOrderDetails = _salesOrderDetails;
                                _salesOrderEntity.SalesOrderDetails = _salesOrderInformation;
                                _salesOrderRequest.SalesOrderEntity = _salesOrderEntity;

                                // Service call ...   
                                using (HttpClient client = new HttpClient())
                                {
                                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                    client.DefaultRequestHeaders.Accept.Clear();
                                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetSalesItemDetail/", _salesOrderRequest); // we need to refer the web.api service url here.

                                    if (response.Result.IsSuccessStatusCode)
                                    {
                                        SalesOrderResponse salesItemDetailResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                        if (salesItemDetailResponse.Status == ResponseStatus.Success)
                                        {
                                            isResult = true;
                                            _salesOrderEntity = salesItemDetailResponse.SalesOrderDetails;
                                        }
                                        else
                                        {
                                            isResult = false;
                                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertItemDetails Method (Item Detail Inquiry): " + salesItemDetailResponse.ErrorMessage.ToString());
                                            MessageBox.Show("Error: " + salesItemDetailResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                        }
                                    }
                                    else
                                    {
                                        isResult = false;
                                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not fetch from custom item details Table (Item Detail Inquiry)");
                                        MessageBox.Show("Error: Data does not fetch from custom item details Table", Resources.STR_MESSAGE_TITLE);
                                    }
                                }
                            }
                            catch (Exception exception)
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: " + exception.Message);
                                MessageBox.Show("Error: " + exception.Message, Resources.STR_MESSAGE_TITLE);
                            }
                            finally
                            {
                            }

                            if (_salesOrderEntity != null && isResult)
                            {
                                if (_salesOrderEntity.SalesOrderDetails != null)
                                {
                                    if (_salesOrderEntity.SalesOrderDetails.SalesOrderDetails != null)
                                    {
                                        if (_salesOrderEntity.SalesOrderDetails.SalesOrderDetails.LineItems != null)
                                        {
                                            foreach (var itemDetail in _salesOrderEntity.SalesOrderDetails.SalesOrderDetails.LineItems)
                                            {
                                                if (sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value == itemDetail.SopType &&
                                                    sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim() == itemDetail.SopNumber.ToString().Trim() &&
                                                    sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value == itemDetail.OrderLineId &&
                                                    sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value == itemDetail.ComponentSequenceNumber)
                                                {
                                                    #region Quote Details

                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = itemDetail.SopNumber.ToString().Trim();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = Convert.ToInt32(itemDetail.OrderLineId);
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = Convert.ToInt16(itemDetail.ComponentSequenceNumber);

                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Key = 1;
                                                    TableError tempErrorQuote = sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Change();
                                                    if (tempErrorQuote != TableError.NoError && tempErrorQuote == TableError.NotFound)
                                                    {
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = itemDetail.SopNumber;

                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = itemDetail.OrderLineId;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = itemDetail.ComponentSequenceNumber;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteGuid.Value = itemDetail.QuoteGuid;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteNumber.Value = itemDetail.QuoteNumber.ToString().Trim();
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteVersion.Value = Convert.ToInt16(itemDetail.QuoteNumberVersion);
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightIncludedPricing.Value = itemDetail.IsFip;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightQuotePrice.Value = itemDetail.LineFreightAmount;

                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.IsUpdated.Value = 0;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Save();
                                                    }
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();

                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();

                                                    #endregion Quote Details

                                                    #region Product Details

                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value = itemDetail.SopNumber.ToString().Trim();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value = Convert.ToInt32(itemDetail.OrderLineId);
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value = Convert.ToInt16(itemDetail.ComponentSequenceNumber);

                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Key = 1;
                                                    TableError tempErrorProduct = sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Change();
                                                    if (tempErrorProduct != TableError.NoError && tempErrorProduct == TableError.NotFound)
                                                    {
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value = itemDetail.SopNumber;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ItemNumber.Value = itemDetail.ItemNumber;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value = itemDetail.OrderLineId;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value = itemDetail.ComponentSequenceNumber;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ShipWeight.Value = itemDetail.ShipWeight.ToString().Trim();
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.NetWeight.Value = itemDetail.NetWeight.ToString().Trim();
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UnNumber.Value = itemDetail.UnNumber.ToString().Trim();
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.CountryOfOrigin.Value = itemDetail.CountryOfOrigin.ToString().Trim();
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.EccnNumber.Value = itemDetail.EccnNumber.ToString().Trim();
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.HtsNumber.Value = itemDetail.HtsNumber.ToString().Trim();

                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.IsUpdated.Value = 0;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Save();
                                                    }
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();

                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();

                                                    #endregion Product Details

                                                    #region Shipment Details

                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value = itemDetail.SopNumber.ToString().Trim();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value = Convert.ToInt32(itemDetail.OrderLineId);
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value = Convert.ToInt16(itemDetail.ComponentSequenceNumber);

                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Key = 1;
                                                    TableError tempErrorShipment = sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Change();
                                                    if (tempErrorShipment != TableError.NoError && tempErrorShipment == TableError.NotFound)
                                                    {
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value = Convert.ToInt16(itemDetail.SopType);
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value = itemDetail.SopNumber;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ItemNumber.Value = itemDetail.ItemNumber;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value = itemDetail.OrderLineId;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value = itemDetail.ComponentSequenceNumber;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ActualShip.Value = itemDetail.ActualShipDate;

                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.IsUpdated.Value = 0;
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Save();
                                                    }
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                                                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();

                                                    #endregion Shipment Details

                                                    InsertLineInstruction(_salesOrderEntity, Resources.STR_SopItemInquiryForm);

                                                    if (itemDetail.SalesLineTrackingNumber != null)
                                                    {
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.Close();
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.Release();

                                                        foreach (var trackingNumberList in itemDetail.SalesLineTrackingNumber)
                                                        {
                                                            sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.Release();
                                                            sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.SopType.Value = Convert.ToInt16(trackingNumberList.SopType);
                                                            sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.SopNumber.Value = trackingNumberList.SopNumber;
                                                            sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.LineItemSequence.Value = trackingNumberList.LineItemSequence;
                                                            sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.ComponentSequence.Value = trackingNumberList.ComponentSequenceNumber;
                                                            sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.LineTrackingNumbers.Value = trackingNumberList.TrackingNumber;
                                                            sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.Save();
                                                        }

                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.Release();
                                                        sopInquiryItemDetailForm.Tables.SopItemDetailsTrackingTemp.Close();

                                                        sopInquiryItemDetailForm.Procedures.SopInquiryItemDetailFormTrackingScrollFill.Invoke();
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }

                #endregion Insert SopItemDetailInquiry
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InsertItemDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Clear all values from quote details temp table 
        /// </summary>
        /// <param name="formName">Specify form name</param>
        /// <param name="sopType">Specify order type</param>
        /// <param name="sopNumber">Specify order number</param>
        /// <param name="itemNumber">Specify item number</param>
        /// <param name="lineItemSequence">Specify line sequence</param>
        private void ClearItemDetails(string formName, int sopType, string sopNumber, string itemNumber = "", int lineItemSequence = 0)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopItemDetailForm)
                {
                    #region Quote Details

                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();

                    TableError tempErrorQuote = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ChangeFirst();
                    while (tempErrorQuote == TableError.NoError && tempErrorQuote != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value ||
                             itemNumber == "" || itemNumber != sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ItemNumber.Value.ToString().Trim() ||
                             lineItemSequence == 0 || lineItemSequence != sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Remove();
                        }

                        tempErrorQuote = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ChangeNext();
                    }
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();

                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();

                    #endregion Quote Details

                    #region Product Details

                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();

                    TableError tempErrorProduct = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ChangeFirst();
                    while (tempErrorProduct == TableError.NoError && tempErrorProduct != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value ||
                             itemNumber == "" || itemNumber != sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ItemNumber.Value.ToString().Trim() ||
                             lineItemSequence == 0 || lineItemSequence != sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Remove();
                        }

                        tempErrorProduct = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ChangeNext();
                    }
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();

                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();

                    #endregion Product Details

                    #region Shipment Details

                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();

                    TableError tempErrorShipment = sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ChangeFirst();
                    while (tempErrorShipment == TableError.NoError && tempErrorShipment != TableError.EndOfTable)
                    {
                        //check order type and order number to clear temp data
                        if ((sopNumber == "" || sopNumber != sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value.ToString().Trim() ||
                             sopType == 0 || sopType != sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value ||
                             itemNumber == "" || itemNumber != sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ItemNumber.Value.ToString().Trim() ||
                             lineItemSequence == 0 || lineItemSequence != sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value) &&
                            Dynamics.Globals.UserId.Value.ToString().ToUpper().Trim() == sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.UserId.Value.ToString().ToUpper().Trim())
                        {
                            sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Remove();
                        }

                        tempErrorShipment = sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ChangeNext();
                    }
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();

                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();

                    #endregion Shipment Details
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ClearItemDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Display quote details into sales item detail and inquiry
        /// </summary>
        /// <param name="formName">Specify form name</param>
        private void DisplayItemDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopItemDetailForm)
                {

                    #region Quote Details

                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;

                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Key = 1;
                    TableError tableErrorQuote = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Get();
                    if (tableErrorQuote == TableError.NoError && tableErrorQuote != TableError.EndOfTable)
                    {
                        sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteNumber.Value.ToString().Trim();
                        sopItemDetailForm.SopItemDetail.QuoteVersion.Value = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteVersion.Value;
                        sopItemDetailForm.SopItemDetail.CpFreightIncludedPricing.Value = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightIncludedPricing.Value;
                        sopItemDetailForm.SopItemDetail.FreightQuotePrice.Value = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightQuotePrice.Value;
                        sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.Value = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.OriginatingFreightAmount.Value;
                        sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.RunValidate();
                    }
                    else
                    {
                        sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value = "";
                        sopItemDetailForm.SopItemDetail.QuoteVersion.Value = 0;
                        sopItemDetailForm.SopItemDetail.CpFreightIncludedPricing.Value = false;
                        sopItemDetailForm.SopItemDetail.FreightQuotePrice.Value = 0.00M;
                        sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.Value = 0.00M;
                        sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.RunValidate();
                    }
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();

                    #endregion Quote Details

                    #region Product Details

                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;

                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Key = 1;
                    TableError tableErrorProduct = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Get();
                    if (tableErrorProduct == TableError.NoError && tableErrorProduct != TableError.EndOfTable)
                    {
                        sopItemDetailForm.SopItemDetail.ShipWeight.Value = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ShipWeight.Value.ToString().Trim();
                        sopItemDetailForm.SopItemDetail.NetWeight.Value = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.NetWeight.Value.ToString().Trim();
                        sopItemDetailForm.SopItemDetail.CpUnNumber.Value = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UnNumber.Value;
                        sopItemDetailForm.SopItemDetail.CountryOfOrigin.Value = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.CountryOfOrigin.Value.ToString().Trim();
                        sopItemDetailForm.SopItemDetail.CpEccnNumber.Value = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.EccnNumber.Value;
                        sopItemDetailForm.SopItemDetail.CpHtsNumber.Value = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.HtsNumber.Value;
                    }
                    else
                    {
                        sopItemDetailForm.SopItemDetail.ShipWeight.Value = "0.00000";
                        sopItemDetailForm.SopItemDetail.NetWeight.Value = "0.00000";
                        sopItemDetailForm.SopItemDetail.CpUnNumber.Value = "0";
                        sopItemDetailForm.SopItemDetail.CountryOfOrigin.Value = "";
                        sopItemDetailForm.SopItemDetail.CpEccnNumber.Value = "0";
                        sopItemDetailForm.SopItemDetail.CpHtsNumber.Value = "0";
                    }
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();

                    #endregion Product Details

                    #region Shipment Details

                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;

                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Key = 1;
                    TableError tableErrorShipment = sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Get();
                    if (tableErrorShipment == TableError.NoError && tableErrorShipment != TableError.EndOfTable)
                    {
                        sopItemDetailForm.SopItemDetail.ActualShipDate.Value = sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ActualShip.Value;
                    }
                    else
                    {
                        sopItemDetailForm.SopItemDetail.ActualShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    }
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();

                    #endregion Shipment Details

                    #region Date Details

                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                    TableError tableErrorDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.Get();
                    if (tableErrorDate == TableError.NoError && tableErrorDate != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopItemDetailForm.SopItemDetail.CpCustReqDel.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value;
                        sopItemDetailForm.SopItemDetail.CpCustReqShip.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value;
                        sopItemDetailForm.SopItemDetail.CpCurSchedDel.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value;
                        sopItemDetailForm.SopItemDetail.LocalRequestedShipDate.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value;
                        sopItemDetailForm.SopItemDetail.RequestedShipDate.Value = sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value;
                    }
                    else
                    {
                        sopItemDetailForm.SopItemDetail.CpCustReqDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopItemDetailForm.SopItemDetail.CpCustReqShip.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopItemDetailForm.SopItemDetail.CpCurSchedDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopItemDetailForm.SopItemDetail.LocalRequestedShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopItemDetailForm.SopItemDetail.RequestedShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    }
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();

                    #endregion Date Details

                    #region Transportation Details

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopItemDetailForm.SopItemDetail.PcbSopLineFreightTerm.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value;
                        sopItemDetailForm.SopItemDetail.CustomerPickupAddress.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomerPickupAddress.Value;
                        sopItemDetailForm.SopItemDetail.PcbSopLineCarrier.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value;
                        sopItemDetailForm.SopItemDetail.PcbSopLineCarrierAddr.Value = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value;
                    }
                    else
                    {
                        sopItemDetailForm.SopItemDetail.PcbSopLineFreightTerm.Value = "";
                        sopItemDetailForm.SopItemDetail.CustomerPickupAddress.Value = "";
                        sopItemDetailForm.SopItemDetail.PcbSopLineCarrier.Value = "";
                        sopItemDetailForm.SopItemDetail.PcbSopLineCarrierAddr.Value = "";
                    }
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                    #endregion Transportation Details

                    #region  3rdparty

                    DisplayThirdPartyAddress(Resources.STR_SopItemDetailForm);

                    #endregion 3rdParty

                    #region CustomerPickup

                    DisplayCustomerPickupAddress(Resources.STR_SopItemDetailForm);

                    #endregion CustomerPickup

                    #region LineInstruction

                    DisplayCommentInstruction(Resources.STR_SopItemDetailForm);

                    #endregion LineInstruction
                }
                else if (formName == Resources.STR_SopItemInquiryForm)
                {
                    #region Quote Details

                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;

                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Key = 1;
                    TableError tableErrorQuote = sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Get();
                    if (tableErrorQuote == TableError.NoError && tableErrorQuote != TableError.EndOfTable)
                    {
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineQuoteNmbr.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteNumber.Value.ToString().Trim();
                        sopInquiryItemDetailForm.SopInquiryItemDetail.QuoteVersion.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteVersion.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpFreightIncludedPricing.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightIncludedPricing.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.FreightQuotePrice.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightQuotePrice.Value;
                    }
                    else
                    {
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineQuoteNmbr.Value = "";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.QuoteVersion.Value = 0;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpFreightIncludedPricing.Value = false;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.FreightQuotePrice.Value = 0.00M;
                    }
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();

                    #endregion Quote Details

                    #region Product Details

                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;

                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Key = 1;
                    TableError tableErrorProduct = sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Get();
                    if (tableErrorProduct == TableError.NoError && tableErrorProduct != TableError.EndOfTable)
                    {
                        sopInquiryItemDetailForm.SopInquiryItemDetail.ShipWeight.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ShipWeight.Value.ToString().Trim();
                        sopInquiryItemDetailForm.SopInquiryItemDetail.NetWeight.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.NetWeight.Value.ToString().Trim();
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpUnNumber.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UnNumber.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CountryOfOrigin.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.CountryOfOrigin.Value.ToString().Trim();
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpEccnNumber.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.EccnNumber.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpHtsNumber.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.HtsNumber.Value;
                    }
                    else
                    {
                        sopInquiryItemDetailForm.SopInquiryItemDetail.ShipWeight.Value = "0.00000";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.NetWeight.Value = "0.00000";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpUnNumber.Value = "0";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CountryOfOrigin.Value = "";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpEccnNumber.Value = "0";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpHtsNumber.Value = "0";
                    }
                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();

                    #endregion Product Details

                    #region Shipment Details

                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;

                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Key = 1;
                    TableError tableErrorShipment = sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Get();
                    if (tableErrorShipment == TableError.NoError && tableErrorShipment != TableError.EndOfTable)
                    {
                        sopInquiryItemDetailForm.SopInquiryItemDetail.ActualShipDate.Value = sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ActualShip.Value;
                    }
                    else
                    {
                        sopInquiryItemDetailForm.SopInquiryItemDetail.ActualShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    }
                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();

                    #endregion Shipment Details

                    #region Date Details

                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                    TableError tableErrorDate = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Get();
                    if (tableErrorDate == TableError.NoError && tableErrorDate != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpCustReqDel.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpCustReqShip.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpCurSchedDel.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.RequestedShipDate.Value = sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value;
                    }
                    else
                    {
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpCustReqDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpCustReqShip.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CpCurSchedDel.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        sopInquiryItemDetailForm.SopInquiryItemDetail.RequestedShipDate.Value = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailDatesTemp.Close();

                    #endregion Date Details

                    #region Transportation Details

                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        // set Ship To Address ID from temp table
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineFreightTerm.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CustomerPickupAddress.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomerPickupAddress.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineCarrier.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value;
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineCarrierAddr.Value = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.ThirdPartyAddress.Value;
                    }
                    else
                    {
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineFreightTerm.Value = "";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CustomerPickupAddress.Value = "";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineCarrier.Value = "";
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineCarrierAddr.Value = "";
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                    #endregion Transportation Details

                    #region  3rdparty

                    DisplayThirdPartyAddress(Resources.STR_SopItemInquiryForm);

                    #endregion 3rdParty

                    #region CustomerPickup

                    DisplayCustomerPickupAddress(Resources.STR_SopItemInquiryForm);

                    #endregion CustomerPickup

                    #region LineInstruction

                    DisplayCommentInstruction(Resources.STR_SopItemInquiryForm);

                    #endregion LineInstruction
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayItemDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Fired when IsCommentSave changed on save button
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailSave_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) && !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) &&
                !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) && !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
            {
                try
                {
                    SaveItemDetails(Resources.STR_SopItemDetailForm); // save data into custom quote table

                    SaveCommentDetails(Resources.STR_SopItemDetailForm); // save Line comment details...


                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailSave_Change Method: " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }

        private void GetTotalFreightAmount(string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();
            SalesOrderRequest SalesOrderRequest = null;
            try
            {
                SalesOrderEntity salesLineItem = new SalesOrderEntity();
                SalesOrderRequest = new SalesOrderRequest();
                SalesOrderRequest.CompanyID = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);
                salesLineItem.SopNumber = sopNumber.ToString().Trim();
                SalesOrderRequest.SalesOrderEntity = salesLineItem;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetTotalFreightAmount", SalesOrderRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        SalesOrderResponse salesItemDetailResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                        if (salesItemDetailResponse.Status == ResponseStatus.Error)
                        {
                            MessageBox.Show("Error: " + salesItemDetailResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveItemDetails Method (SaveSalesItemDetail): " + salesItemDetailResponse.ErrorMessage.ToString());
                        }
                    }
                    else
                    {
                        MessageBox.Show("Error: Data does not saved into custom item details Table", Resources.STR_MESSAGE_TITLE);
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into custom item details Table");
                    }
                }
            }
            catch (Exception)
            {

                throw;
            }
        }

        /// <summary>
        /// save data into custom quote table
        /// </summary>
        /// <param name="formName">Specify form name</param>
        private void SaveItemDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();

            if (formName == Resources.STR_SopItemDetailForm)
            {
                SalesOrderRequest lineItemRequest = null;

                try
                {
                    bool isChangedItemDetails = false;
                    lineItemRequest = new SalesOrderRequest();
                    lineItemRequest.CompanyID = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);
                    SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                    SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                    SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                    List<SalesLineItem> lineItemList = new List<SalesLineItem>();
                    SalesLineItem lineItem = new SalesLineItem();
                    List<SalesInstruction> salesLineInstructionList = new List<SalesInstruction>();
                    AuditInformation auditInformation = new AuditInformation();
                    SalesInstruction salesInstruction = new SalesInstruction();

                    lineItem.SopType = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    lineItem.SopNumber = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                    lineItem.OrderLineId = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    lineItem.ComponentSequenceNumber = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                    lineItem.ItemNumber = sopItemDetailForm.SopItemDetail.ItemNumber.Value;
                    lineItem.LineFreightAmount = sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.Value;

                    #region Quote Details

                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();

                    TableError tableErrorQuote = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.GetFirst();
                    while (tableErrorQuote == TableError.NoError && tableErrorQuote != TableError.EndOfTable)
                    {
                        if (sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value == sopItemDetailForm.SopItemDetail.SopTypeDatabase &&
                            sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value.ToString().Trim() == sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim() &&
                            sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value == sopItemDetailForm.SopItemDetail.LineItemSequence.Value &&
                            sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value == sopItemDetailForm.SopItemDetail.ComponentSequence.Value)
                        {
                            if (sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value != 0)   // Fetch only update records and pass it to save procedure
                            {
                                lineItem.QuoteNumber = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteNumber.Value;
                                lineItem.OrginatingFreightPrice = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.OriginatingFreightAmount.Value;
                                if (sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.IsUpdated.Value == 1)
                                {
                                    isChangedItemDetails = true;
                                }
                            }
                        }

                        tableErrorQuote = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.GetNext();
                    }
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();

                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();

                    #endregion Quote Details

                    #region Product Details

                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();

                    TableError tableErrorProduct = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.GetFirst();
                    while (tableErrorProduct == TableError.NoError && tableErrorProduct != TableError.EndOfTable)
                    {
                        if (sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value == sopItemDetailForm.SopItemDetail.SopTypeDatabase &&
                            sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value.ToString().Trim() == sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim() &&
                            sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value == sopItemDetailForm.SopItemDetail.LineItemSequence.Value &&
                            sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value == sopItemDetailForm.SopItemDetail.ComponentSequence.Value)
                        {
                            if (sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ItemNumber.Value.ToString().Trim() != "" &&
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value != 0)   // Fetch only update records and pass it to save procedure
                            {
                                lineItem.ShipWeight = Convert.ToDecimal(sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ShipWeight.Value);
                                lineItem.NetWeight = Convert.ToDecimal(sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.NetWeight.Value);
                                lineItem.UnNumber = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UnNumber.Value.ToString().Trim();
                                lineItem.CountryOfOrigin = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.CountryOfOrigin.Value;
                                lineItem.EccnNumber = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.EccnNumber.Value.ToString().Trim();
                                lineItem.HtsNumber = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.HtsNumber.Value.ToString().Trim();
                                if (sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.IsUpdated.Value == 1)
                                {
                                    isChangedItemDetails = true;
                                }
                            }
                        }

                        tableErrorProduct = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.GetNext();
                    }
                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();

                    sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();

                    #endregion Product Details

                    #region Shipment Details

                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();

                    TableError tableErrorShipment = sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.GetFirst();
                    while (tableErrorShipment == TableError.NoError && tableErrorShipment != TableError.EndOfTable)
                    {
                        if (sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value == sopItemDetailForm.SopItemDetail.SopTypeDatabase &&
                            sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value.ToString().Trim() == sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim() &&
                            sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value == sopItemDetailForm.SopItemDetail.LineItemSequence.Value &&
                            sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value == sopItemDetailForm.SopItemDetail.ComponentSequence.Value)
                        {
                            if (sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value != 0)   // Fetch only update records and pass it to save procedure
                            {
                                DateTime actualShipDate;
                                DateTime.TryParse(sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ActualShip.Value.ToString().Trim(), out actualShipDate);
                                lineItem.ActualShipDate = actualShipDate;
                                if (sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.IsUpdated.Value == 1)
                                {
                                    isChangedItemDetails = true;
                                }
                            }
                        }

                        tableErrorShipment = sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.GetNext();
                    }
                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();

                    sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();

                    #endregion Shipment Details

                    if (isChangedItemDetails)
                    {
                        lineItem.SalesLineInstruction = salesLineInstructionList;
                        lineItem.QuoteNumber = lineItem.QuoteNumber == null ? "" : lineItem.QuoteNumber;
                        lineItem.ShipWeight = lineItem.ShipWeight == null ? 0.00M : lineItem.ShipWeight;
                        lineItem.NetWeight = lineItem.NetWeight == null ? 0.00M : lineItem.NetWeight;
                        lineItem.UnNumber = lineItem.UnNumber == null ? "0" : lineItem.UnNumber;
                        lineItem.CountryOfOrigin = lineItem.CountryOfOrigin == null ? "" : lineItem.CountryOfOrigin;
                        lineItem.EccnNumber = lineItem.EccnNumber == null ? "0" : lineItem.EccnNumber;
                        lineItem.HtsNumber = lineItem.HtsNumber == null ? "0" : lineItem.HtsNumber;
                        lineItem.OrginatingFreightPrice = lineItem.OrginatingFreightPrice == null ? 0.00M : lineItem.OrginatingFreightPrice;
                        if (lineItem.ActualShipDate == DateTime.MinValue)
                            lineItem.ActualShipDate = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));

                        lineItemList.Add(lineItem);
                        salesOrderDetails.LineItems = lineItemList;
                        // salesOrderDetails.AuditInformation = auditInformation;
                        salesOrderInformation.SalesOrderDetails = salesOrderDetails;
                        salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                        lineItemRequest.SalesOrderEntity = salesOrderEntity;
                        
                        // Service call ...
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveSalesItemDetail", lineItemRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesItemDetailResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesItemDetailResponse.Status == ResponseStatus.Error)
                                {
                                    MessageBox.Show("Error: " + salesItemDetailResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveItemDetails Method (SaveSalesItemDetail): " + salesItemDetailResponse.ErrorMessage.ToString());
                                }
                            }
                            else
                            {
                                MessageBox.Show("Error: Data does not saved into custom item details Table", Resources.STR_MESSAGE_TITLE);
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into custom item details Table");
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveItemDetails Method: " + ex.Message.ToString());
                    MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }

        /// <summary>
        /// Quote number enter after (from item detail entry window)
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailPcbSopLineQuoteNmbr_EnterAfterOriginal(object sender, EventArgs e)
        {
            quoteNumberInfoEnterFlag = true;
        }

        /// <summary>
        /// Quote number chagne from ItemdetailEntry window...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailPcbSopLineQuoteNmbr_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                {
                    if (quoteNumberInfoEnterFlag == true)
                    {
                        if (sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value.ToString().Trim() != "")
                        {
                            bool recordsExists = ValidateQuoteDetails(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value,
                                sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim(),
                                sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value.ToString().Trim());  // call validate to check and load window
                            if (recordsExists == false)
                            {
                                MessageBox.Show("Please enter the valid Quote Number or check Quote Number with Item " + sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString().Trim() + " for customer " + sopItemDetailForm.SopItemDetail.CustomerNumber.Value.ToString().Trim() + ".", Resources.STR_MESSAGE_TITLE);
                                sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value = "";
                                sopItemDetailForm.SopItemDetail.QuoteVersion.Value = 0;
                                sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Focus();
                            }
                            else
                            {
                                ResetItemDetails(Resources.STR_SopItemDetailForm, Resources.STR_SopItemQuoteInfo);
                            }
                        }
                        else
                        {
                            sopItemDetailForm.SopItemDetail.QuoteVersion.Value = 0;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailPcbSopLineQuoteNmbr_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method to load quote number on opening the window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private bool ValidateQuoteDetails(int sopType, string sopNumber, string quoteNumber)
        {
            StringBuilder logMessage = new StringBuilder();

            bool recordsExists = false;

            SalesOrderRequest quoteLookupRequest = new SalesOrderRequest();
            SalesOrderResponse quoteLookupResponse = new SalesOrderResponse();
            SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
            SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
            SalesOrderDetails salesOrderDetail = new SalesOrderDetails();
            CustomerInformation customerInformation = new CustomerInformation();
            WarehouseInformation warehouseInformation = new WarehouseInformation();
            SalesLineItem lineItem = new SalesLineItem();
            List<SalesLineItem> lineItemList = new List<SalesLineItem>();

            try
            {
                customerInformation.CustomerId = sopItemDetailForm.SopItemDetail.CustomerNumber.Value.ToString().Trim();
                lineItem.ItemNumber = sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString().Trim();
                lineItem.QuoteNumber = quoteNumber;
                warehouseInformation.WarehouseId = sopItemDetailForm.SopItemDetail.LocationCode.Value.ToString().Trim();
                salesOrderEntity.SopType = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                salesOrderEntity.SopNumber = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();

                quoteLookupRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                lineItemList.Add(lineItem);
                salesOrderDetail.LineItems = lineItemList;
                salesOrderInformation.SalesOrderDetails = salesOrderDetail;
                salesOrderInformation.Customer = customerInformation;
                salesOrderInformation.Warehouse = warehouseInformation;
                salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                quoteLookupRequest.SalesOrderEntity = salesOrderEntity;

                //Service Call
                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/ValidateQuoteNumber", quoteLookupRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        quoteLookupResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                        if (quoteLookupResponse.Status == ResponseStatus.Success)
                        {
                            if (quoteLookupResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.LineItems != null)
                            {
                                if (quoteLookupResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.LineItems.Count > 0)
                                {
                                    recordsExists = true;
                                }
                            }
                        }
                        else
                        {
                            recordsExists = false;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateQuoteDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return recordsExists;
        }

        /// <summary>
        /// Reset custom comment
        /// </summary>
        /// <param name="formName">Specify form Name</param>
        /// <param name="instructionTypeID">Specify address type. 1: Warehouse Instruction Id  2: Carrier Instruction Id</param>
        /// <param name="commentId">Specify comment id number</param>
        private void ResetItemDetails(string formName, string groupType)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (formName == Resources.STR_SopItemDetailForm)
                {
                    if (groupType.Equals(Resources.STR_SopItemQuoteInfo))
                    {
                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;

                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Key = 1;
                        TableError tableErrorQuote = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Change();
                        if (tableErrorQuote == TableError.NoError && tableErrorQuote != TableError.EndOfTable)
                        {
                            if (sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value.ToString().Trim() != sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteNumber.Value.ToString().Trim())
                            {
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteNumber.Value = sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteVersion.Value = sopItemDetailForm.SopItemDetail.QuoteVersion.Value;

                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Save();
                            }
                            else if (sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.Value.ToString().Trim() != sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.OriginatingFreightAmount.Value.ToString().Trim())
                            {
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.OriginatingFreightAmount.Value = sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.Value;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Save();
                            }
                        }
                        else
                        {
                            if (tableErrorQuote == TableError.NotFound && tableErrorQuote != TableError.EndOfTable)
                            {
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ItemNumber.Value = sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString().Trim();
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteNumber.Value = sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value.ToString().Trim();
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteVersion.Value = sopItemDetailForm.SopItemDetail.QuoteVersion.Value;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightIncludedPricing.Value = sopItemDetailForm.SopItemDetail.CpFreightIncludedPricing.Value;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.FreightQuotePrice.Value = sopItemDetailForm.SopItemDetail.FreightQuotePrice.Value;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.OriginatingFreightAmount.Value = sopItemDetailForm.SopItemDetail.PcbSopLineFreightAmt.Value;

                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Save();
                            }
                        }
                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                        sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                    }

                    if (groupType.Equals(Resources.STR_SopItemProductInfo))
                    {
                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();
                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();
                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;

                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Key = 1;
                        TableError tableErrorProduct = sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Change();
                        if (tableErrorProduct == TableError.NoError && tableErrorProduct != TableError.EndOfTable)
                        {
                            if (sopItemDetailForm.SopItemDetail.CountryOfOrigin.Value.ToString().Trim() != sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.CountryOfOrigin.Value.ToString().Trim() ||
                                sopItemDetailForm.SopItemDetail.CpEccnNumber.Value.ToString().Trim() != sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.EccnNumber.Value.ToString().Trim() ||
                                sopItemDetailForm.SopItemDetail.CpHtsNumber.Value.ToString().Trim() != sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.HtsNumber.Value.ToString().Trim())
                            {
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.CountryOfOrigin.Value = sopItemDetailForm.SopItemDetail.CountryOfOrigin.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.EccnNumber.Value = sopItemDetailForm.SopItemDetail.CpEccnNumber.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.HtsNumber.Value = sopItemDetailForm.SopItemDetail.CpHtsNumber.Value;

                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Save();
                            }
                        }
                        else
                        {
                            if (tableErrorProduct == TableError.NotFound && tableErrorProduct != TableError.EndOfTable)
                            {
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ItemNumber.Value = sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString().Trim();
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.ShipWeight.Value = sopItemDetailForm.SopItemDetail.ShipWeight.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.NetWeight.Value = sopItemDetailForm.SopItemDetail.NetWeight.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UnNumber.Value = sopItemDetailForm.SopItemDetail.CpUnNumber.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.CountryOfOrigin.Value = sopItemDetailForm.SopItemDetail.CountryOfOrigin.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.EccnNumber.Value = sopItemDetailForm.SopItemDetail.CpEccnNumber.Value;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.HtsNumber.Value = sopItemDetailForm.SopItemDetail.CpHtsNumber.Value;

                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Save();
                            }
                        }
                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Release();
                        sopItemDetailForm.Tables.SopItemDetailsProductInfoTemp.Close();
                    }

                    if (groupType.Equals(Resources.STR_SopItemShipmentInfo))
                    {
                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();
                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;

                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Key = 1;
                        TableError tableErrorShipment = sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Change();
                        if (tableErrorShipment == TableError.NoError && tableErrorShipment != TableError.EndOfTable)
                        {
                            if (sopItemDetailForm.SopItemDetail.ActualShipDate.Value != sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ActualShip.Value)
                            {
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ActualShip.Value = sopItemDetailForm.SopItemDetail.ActualShipDate.Value;

                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Save();
                            }
                        }
                        else
                        {
                            if (tableErrorShipment == TableError.NotFound && tableErrorShipment != TableError.EndOfTable)
                            {
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ItemNumber.Value = sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString().Trim();
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.ActualShip.Value = sopItemDetailForm.SopItemDetail.ActualShipDate.Value;

                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Save();
                            }
                        }
                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Release();
                        sopItemDetailForm.Tables.SopItemDetailsShipmentDetailsTemp.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ResetItemDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Quote Number after leave
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailPcbSopLineQuoteNmbr_LeaveAfterOriginal(object sender, EventArgs e)
        {
            quoteNumberInfoEnterFlag = false;
        }

        /// <summary>
        ///  CountryOfOrigin Enter
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCountryOfOrigin_EnterAfterOriginal(object sender, EventArgs e)
        {
            countryOfOriginInfoEnterFlag = true;
        }

        /// <summary>
        ///  CountryOfOrigin Change
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCountryOfOrigin_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                {
                    if (countryOfOriginInfoEnterFlag == true)
                    {
                        if (sopItemDetailForm.SopItemDetail.CountryOfOrigin.Value.ToString().Trim() != "")
                        {
                            ResetItemDetails(Resources.STR_SopItemDetailForm, Resources.STR_SopItemProductInfo);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailCountryOfOrigin_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// CountryOfOrigin Leave after
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCountryOfOrigin_LeaveAfterOriginal(object sender, EventArgs e)
        {
            countryOfOriginInfoEnterFlag = false;
        }

        /// <summary>
        /// Eccn Number Enter After 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCpEccnNumber_EnterAfterOriginal(object sender, EventArgs e)
        {
            eccnNumberInfoEnterFlag = true;
        }

        /// <summary>
        /// Eccn Number Chagne 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCpEccnNumber_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                {
                    if (eccnNumberInfoEnterFlag == true)
                    {
                        if (sopItemDetailForm.SopItemDetail.CpEccnNumber.Value.ToString().Trim() != "")
                        {
                            ResetItemDetails(Resources.STR_SopItemDetailForm, Resources.STR_SopItemProductInfo);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailCpEccnNumber_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// ECCN Number change leave 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCpEccnNumber_LeaveAfterOriginal(object sender, EventArgs e)
        {
            eccnNumberInfoEnterFlag = false;
        }

        /// <summary>
        /// HTS Number Change After
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCpHtsNumber_EnterAfterOriginal(object sender, EventArgs e)
        {
            htsNumberInfoEnterFlag = true;
        }

        /// <summary>
        /// HTS Number Change
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCpHtsNumber_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                {
                    if (htsNumberInfoEnterFlag == true)
                    {
                        if (sopItemDetailForm.SopItemDetail.CpHtsNumber.Value.ToString().Trim() != "")
                        {
                            ResetItemDetails(Resources.STR_SopItemDetailForm, Resources.STR_SopItemProductInfo);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailCpHtsNumber_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// HTS Number leave After 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCpHtsNumber_LeaveAfterOriginal(object sender, EventArgs e)
        {
            htsNumberInfoEnterFlag = false;
        }

        /// <summary>
        /// Actual ship date enter 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailActualShipDate_EnterAfterOriginal(object sender, EventArgs e)
        {
            actualShipDateInfoEnterFlag = true;
        }

        /// <summary>
        /// actual ship date change
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailActualShipDate_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                {
                    if (actualShipDateInfoEnterFlag == true)
                    {
                        if (sopItemDetailForm.SopItemDetail.ActualShipDate.Value != DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA")))
                        {
                            ResetItemDetails(Resources.STR_SopItemDetailForm, Resources.STR_SopItemShipmentInfo);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailActualShipDate_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Actual ship date leave after
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailActualShipDate_LeaveAfterOriginal(object sender, EventArgs e)
        {
            actualShipDateInfoEnterFlag = false;
        }

        /// <summary>
        /// OriginatingFrightAmount_leave
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OriginatingFreightAmount_LeaveAfterOriginal(object sender, EventArgs e)
        {
            originatingFrightPriceEnterFlag = false;
        }

        /// <summary>
        /// OriginatingFrightPrice Change
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OriginatingFreightAmount_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopType.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                {
                    if (originatingFrightPriceEnterFlag == true)
                    {
                        if (sopItemDetailForm.SopItemDetail.OriginatingFreightAmount.Value.ToString().Trim() != "")
                        {
                            ResetItemDetails(Resources.STR_SopItemDetailForm, Resources.STR_SopItemQuoteInfo);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OriginatingFreightAmount_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// OriginatingFreightPrice Enter
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OriginatingFreightAmount_EnterAfterOriginal(object sender, EventArgs e)
        {
            originatingFrightPriceEnterFlag = true;
        }

        #endregion SOPLineItem

        #region 3rdPartWindow

        /// <summary>
        /// calling Service to fetch SOp entry window related data ...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void SOPLocalIsThirdPartyAddressDisplay_Change(object sender, EventArgs e)
        {
            if (!String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
            {
                ResetThirdPartyAddress(sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierAddr.Value.ToString().Trim());
            }
        }

        private void ResetThirdPartyAddress(string InputAddress)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                string ContactPerson = "";
                string Address1 = "";
                string Address2 = "";
                string Address3 = "";
                string Country = "";
                string City = "";
                string State = "";
                string Zip = "";

                if (!InputAddress.Equals("") && InputAddress.Contains(","))
                {
                    ContactPerson = "Chempoint";
                    List<string> AddressList = InputAddress.Split(',').Reverse().ToList();
                    switch (AddressList.Count)
                    {
                        case 7:
                            Zip = AddressList[0].ToString();
                            State = AddressList[1].ToString();
                            City = AddressList[2].ToString();
                            Country = AddressList[3].ToString();
                            Address3 = AddressList[4].ToString();
                            Address2 = AddressList[5].ToString();
                            Address1 = AddressList[6].ToString();
                            break;
                        case 6:
                            Zip = AddressList[0].ToString();
                            State = AddressList[1].ToString();
                            City = AddressList[2].ToString();
                            Country = AddressList[3].ToString();
                            Address2 = AddressList[4].ToString();
                            Address1 = AddressList[5].ToString();
                            break;
                        case 5:
                            Zip = AddressList[0].ToString();
                            State = AddressList[1].ToString();
                            City = AddressList[2].ToString();
                            Address2 = AddressList[3].ToString();
                            Address1 = AddressList[4].ToString();
                            break;
                        case 4:
                            Zip = AddressList[0].ToString();
                            State = AddressList[1].ToString();
                            City = AddressList[2].ToString();
                            Address1 = AddressList[3].ToString();
                            break;
                        case 3:
                            Zip = AddressList[0].ToString();
                            State = AddressList[1].ToString();
                            City = AddressList[2].ToString();
                            break;
                        case 2:
                            Address2 = AddressList[0].ToString();
                            Address1 = AddressList[1].ToString();
                            break;
                        case 1:
                            Address1 = AddressList[0].ToString();
                            break;
                        default:
                            break;
                    }
                }

                UpdateThirdPartyAddressDetails(Resources.STR_SalesCustomerDetailForm,
                    sopEntryForm.SopEntry.SopTypeDatabase.Value,
                    sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim(),
                    sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim(),
                    ContactPerson.ToString().Trim(),
                    Address1.ToString().Trim(),
                    Address2.ToString().Trim(),
                    Address3.ToString().Trim(),
                    City.ToString().Trim(),
                    State.ToString().Trim(),
                    Zip.ToString().Trim(),
                    Country.ToString().Trim());
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ResetThirdPartyAddress Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// ThirdParty Window open
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ThirdPartyAddress_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (expansionWindowType == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                    TableError tableError = sopEntryForm.Tables.ThirdPartyAddressTemp.Get();

                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.SopNumber.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.SopTypeDatabase.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value;
                        //thirdPartyAddressDetailsForm.ThirdPartyAddress.CustomerNumber.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.CustomerNumber.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.ContactPerson.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.ContactPerson.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Address1.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Address2.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Address3.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.City.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.State.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.ZipCode.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Country.Value = sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim();
                    }
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                }
                else if (expansionWindowType == Resources.STR_SopCustomerDetailInquiryForm)
                {
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                    TableError tableError = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Get();

                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.SopNumber.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.SopTypeDatabase.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopType.Value;
                        //thirdPartyAddressDetailsForm.ThirdPartyAddress.CustomerNumber.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.CustomerNumber.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.ContactPerson.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ContactPerson.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Address1.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Address2.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Address3.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.City.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.State.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.ZipCode.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim();
                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Country.Value = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim();
                    }
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();

                    thirdPartyAddressDetailsForm.ThirdPartyAddress.ContactPerson.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.Address1.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.Address2.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.Address3.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.City.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.State.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.ZipCode.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.Country.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.SaveButton.Lock();
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.ClearButton.Lock();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ThirdPartyAddress_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event register for 3rd party window before open..
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ThirdPartyAddress_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (RegisterThirdPartyAddressDetails == false)
                {
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.CloseAfterOriginal += ThirdPartyAddress_CloseAfterOriginal;
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.SaveButton.ClickAfterOriginal += ThirdPartySaveButton_ClickAfterOriginal;
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.ClearButton.ClickAfterOriginal += ThirdPartyClearButton_ClickAfterOriginal;
                    thirdPartyAddressDetailsForm.ThirdPartyAddress.CancelButton.ClickAfterOriginal += ThirdPartyCancelButton_ClickAfterOriginal;
                    RegisterThirdPartyAddressDetails = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ThirdPartyAddress_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Save Third Party Window data...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ThirdPartySaveButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType))
                {
                    if (expansionWindowType == Resources.STR_SalesCustomerDetailForm)
                    {
                        bool isChanged = UpdateThirdPartyAddressDetails(Resources.STR_SalesCustomerDetailForm,
                            sopEntryForm.SopEntry.SopTypeDatabase.Value,
                            sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.CustomerNumber.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.ContactPerson.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.Address1.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.Address2.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.Address3.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.City.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.State.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.ZipCode.Value.ToString().Trim(),
                            thirdPartyAddressDetailsForm.ThirdPartyAddress.Country.Value.ToString().Trim());

                        if (isChanged)
                        {
                            bool saveResult = SaveThirdPartyAddressDetails(expansionWindowType); // save data into third party address table 
                            if (saveResult && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                                DisplayThirdPartyAddress(expansionWindowType);
                        }

                        thirdPartyAddressDetailsForm.ThirdPartyAddress.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ThirdPartySaveButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// save custom ThirdParty Address details ...
        /// </summary>
        /// <param name="formName">Specify form name</param>
        private bool SaveThirdPartyAddressDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            bool isResult = false;
            AddressInformation thirdPartyAddressInformation = new AddressInformation();

            try
            {
                SalesOrderRequest thirdPartyRequest = new SalesOrderRequest();
                SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                OrderHeader orderHeader = new OrderHeader();
                AuditInformation auditInformation = new AuditInformation();
                AddressInformation thirdPartAddress = new AddressInformation();

                sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                thirdPartyRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                TableError tableError = sopEntryForm.Tables.ThirdPartyAddressTemp.GetFirst();
                while (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                {
                    if (sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() &&
                        sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value
                    )
                    {
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.IsUpdated.Value == 1)   // Fetch only update records and pass it to save procedure
                        {
                            salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            thirdPartAddress.AddressId = sopEntryForm.Tables.ThirdPartyAddressTemp.ThirdPartyAddressId.Value;
                            thirdPartAddress.ContactName = sopEntryForm.Tables.ThirdPartyAddressTemp.ContactPerson.Value.ToString().Trim();
                            thirdPartAddress.AddressLine1 = sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim();
                            thirdPartAddress.AddressLine2 = sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim();
                            thirdPartAddress.AddressLine3 = sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim();
                            thirdPartAddress.City = sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim();
                            thirdPartAddress.State = sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim();

                            thirdPartAddress.ZipCode = sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim();
                            thirdPartAddress.Country = sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim();

                            auditInformation.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                            auditInformation.CompanyId = Dynamics.Globals.CompanyId.Value;
                        }
                    }
                    tableError = sopEntryForm.Tables.ThirdPartyAddressTemp.GetNext();
                }
                sopEntryForm.Tables.ThirdPartyAddressTemp.Release();

                sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                orderHeader.Carrier3rdPartyAddress = thirdPartAddress;
                salesOrderDetails.AuditInformation = auditInformation;
                salesOrderDetails.OrderHeader = orderHeader;
                salesOrderInformation.SalesOrderDetails = salesOrderDetails;
                salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                thirdPartyRequest.SalesOrderEntity = salesOrderEntity;

                // Service call ...
                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveThirdPartyAddress/", thirdPartyRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                        if (salesOrderResponse.Status == ResponseStatus.Success)
                        {
                            isResult = true;
                        }
                        else
                        {
                            isResult = false;
                            MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveThirdPartyAddressDetails Method (SaveThirdPartyAddress): " + salesOrderResponse.ErrorMessage.ToString());
                        }
                    }
                    else
                    {
                        isResult = false;
                        MessageBox.Show("Error: Data does not saved into custom sales details Table", Resources.STR_MESSAGE_TITLE);
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Data does not saved into custom sales details Table (SaveThirdPartyAddress) ");
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveThirdPartyAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return isResult;
        }

        /// <summary>
        /// Update third party address details for sales item detail entry
        /// </summary>
        /// <param name="sopType">Specify Order Type</param>
        /// <param name="sopNumber">Specify Order Number</param>
        private bool UpdateThirdPartyAddressDetails(string formName, int sopType, string sopNumber,
            string customerID, string contactPerson, string address1, string address2, string address3, string city, string state, string zipCode, string country)
        {
            StringBuilder logMessage = new StringBuilder();
            bool isChanged = false;
            try
            {
                if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value = Convert.ToInt16(sopType);
                    sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = sopNumber;
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                    TableError tableError = sopEntryForm.Tables.ThirdPartyAddressTemp.Change();

                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (

                            sopEntryForm.Tables.ThirdPartyAddressTemp.ContactPerson.Value != contactPerson.ToString().Trim() ||
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value != address1.ToString().Trim() ||
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value != address2.ToString().Trim() ||
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value != address3.ToString().Trim() ||
                            sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value != city.ToString().Trim() ||
                            sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value != state.ToString().Trim() ||
                            sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value != zipCode.ToString().Trim() ||
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value != country.ToString().Trim()

                        )
                        {
                            isChanged = true;
                        }
                        if (isChanged)
                        {

                            sopEntryForm.Tables.ThirdPartyAddressTemp.ContactPerson.Value = contactPerson.ToString().Trim();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value = address1.ToString().Trim();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value = address2.ToString().Trim();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value = address3.ToString().Trim();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value = city.ToString().Trim();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value = state.ToString().Trim();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value = zipCode.ToString().Trim();
                            sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value = country.ToString().Trim();

                            sopEntryForm.Tables.ThirdPartyAddressTemp.IsUpdated.Value = 1;
                            sopEntryForm.Tables.ThirdPartyAddressTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopEntryForm.Tables.ThirdPartyAddressTemp.Save();
                        }
                    }
                    else if (tableError == TableError.NotFound)
                    {
                        sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value = Convert.ToInt16(sopType);
                        sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = sopNumber;

                        sopEntryForm.Tables.ThirdPartyAddressTemp.ContactPerson.Value = contactPerson.ToString().Trim();
                        sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value = address1.ToString().Trim();
                        sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value = address2.ToString().Trim();
                        sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value = address3.ToString().Trim();
                        sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value = city.ToString().Trim();
                        sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value = state.ToString().Trim();
                        sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value = zipCode.ToString().Trim();
                        sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value = country.ToString().Trim();
                        sopEntryForm.Tables.ThirdPartyAddressTemp.ThirdPartyAddressId.Value = 0;
                        sopEntryForm.Tables.ThirdPartyAddressTemp.IsUpdated.Value = 1;
                        sopEntryForm.Tables.ThirdPartyAddressTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                        sopEntryForm.Tables.ThirdPartyAddressTemp.Save();

                        isChanged = true;
                    }

                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In UpdateThirdPartyAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return isChanged;
        }

        /// <summary>
        /// Third party Window close
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ThirdPartyCancelButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            thirdPartyAddressDetailsForm.ThirdPartyAddress.Close();
        }

        /// <summary>
        /// Clear third party window data...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ThirdPartyClearButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            thirdPartyAddressDetailsForm.ThirdPartyAddress.ContactPerson.Clear();
            thirdPartyAddressDetailsForm.ThirdPartyAddress.Address1.Clear();
            thirdPartyAddressDetailsForm.ThirdPartyAddress.Address2.Clear();
            thirdPartyAddressDetailsForm.ThirdPartyAddress.Address3.Clear();
            thirdPartyAddressDetailsForm.ThirdPartyAddress.City.Clear();
            thirdPartyAddressDetailsForm.ThirdPartyAddress.State.Clear();
            thirdPartyAddressDetailsForm.ThirdPartyAddress.ZipCode.Clear();
            thirdPartyAddressDetailsForm.ThirdPartyAddress.Country.Clear();
        }

        /// <summary>
        /// Third Party Address window close
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ThirdPartyAddress_CloseAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
        }

        /// <summary>
        /// Third party address detail Display...
        /// </summary>
        /// <param name="expansionWindowType"></param>
        private void DisplayThirdPartyAddress(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                #region WorkCustomerDetailEntryForm

                if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    ;
                    sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                    TableError tableError = sopEntryForm.Tables.ThirdPartyAddressTemp.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string thirdPartyText = "";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim() + ",";

                        if (thirdPartyText.Trim() != "")
                        {
                            int k = thirdPartyText.ToString().LastIndexOf(",");
                            if (k > 0)
                                thirdPartyText = thirdPartyText.ToString().Substring(0, k);
                        }
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.PcbSopLineCarrierAddr.Value = thirdPartyText;
                    }
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                }

                #endregion WorkCustomerDetailEntryForm

                #region WorkItemDetailEntryForm

                else if (formName == Resources.STR_SopItemDetailForm)
                {
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopEntryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                    TableError tableError = sopEntryForm.Tables.ThirdPartyAddressTemp.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string thirdPartyText = "";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim() + ",";

                        if (thirdPartyText.Trim() != "")
                        {
                            int k = thirdPartyText.ToString().LastIndexOf(",");
                            if (k > 0)
                                thirdPartyText = thirdPartyText.ToString().Substring(0, k);
                        }
                        sopItemDetailForm.SopItemDetail.PcbSopLineCarrierAddr.Value = thirdPartyText;
                    }
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryForm.Tables.ThirdPartyAddressTemp.Close();
                }

                #endregion WorkItemDetailEntryForm

                #region InquiryCustomerDetailEntryForm

                else if (formName == Resources.STR_SopCustomerDetailInquiryForm)
                {
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                    TableError tableError = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string thirdPartyText = "";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim() + ",";

                        if (thirdPartyText.Trim() != "")
                        {
                            int k = thirdPartyText.ToString().LastIndexOf(",");
                            if (k > 0)
                                thirdPartyText = thirdPartyText.ToString().Substring(0, k);
                        }
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.PcbSopLineCarrierAddr.Value = thirdPartyText;
                    }
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();
                }

                #endregion InquiryCustomerDetailEntryForm

                #region InquiryItemDetailEntryForm

                else if (formName == Resources.STR_SopItemInquiryForm)
                {
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Key = 1;
                    TableError tableError = sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string thirdPartyText = "";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address1.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address2.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Address3.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Country.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.City.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.State.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim() != "")
                            thirdPartyText += sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.ZipCode.Value.ToString().Trim() + ",";

                        if (thirdPartyText.Trim() != "")
                        {
                            int k = thirdPartyText.ToString().LastIndexOf(",");
                            if (k > 0)
                                thirdPartyText = thirdPartyText.ToString().Substring(0, k);
                        }
                        sopInquiryItemDetailForm.SopInquiryItemDetail.PcbSopLineCarrierAddr.Value = thirdPartyText;
                    }
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Release();
                    sopEntryInquiryForm.Tables.ThirdPartyAddressTemp.Close();
                }

                #endregion InquiryItemDetailEntryForm
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayThirdPartyAddress Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion 3rdPartyWindow

        #region CommentHeaderInstruction

        /// <summary>
        /// Display CommentInstruction
        /// </summary>
        /// <param name="formName"></param>
        private void DisplayCommentInstruction(string formName)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                #region CustomerCommentInstructionInWork

                if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    // Header Warehouse instruction display...
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value = sopEntryForm.SopEntry.CommentId.Value;

                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    //sopEntryForm.Tables.SalesHeaderInstructionDetails.RangeClear();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = 1;
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.RangeStart();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Key = 2;
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    ;
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Fill();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.RangeEnd();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Key = 2;

                    TableError error = sopEntryForm.Tables.SalesHeaderInstructionDetails.GetFirst();
                    while (error != TableError.EndOfTable && error == TableError.NoError)
                    {
                        if (Convert.ToInt16(sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value) == 1)
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Value = sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value.ToString().Trim();
                        else if (Convert.ToInt16(sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value) == 2)
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Value = sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value.ToString().Trim();
                        error = sopEntryForm.Tables.SalesHeaderInstructionDetails.GetNext();
                    }

                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                }

                #endregion CustomerCommentInstructionInWork

                #region ItemDetailCommentInstructionInWork

                else if (formName == Resources.STR_SopItemDetailForm)
                {
                    //Line Warehouse instruction display...
                    sopEntryForm.Tables.SalesLineInstructionDetails.Close();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.RangeClear();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.ToString().Trim();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = 1;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.RangeStart();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.ToString().Trim();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Fill();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.RangeEnd();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;

                    TableError error = sopItemDetailForm.Tables.SalesLineInstructionDetails.GetFirst();
                    while (error != TableError.EndOfTable && error == TableError.NoError)
                    {
                        if (Convert.ToInt16(sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value) == 1)
                            sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Value = sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value.ToString().Trim();
                        else if (Convert.ToInt16(sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value) == 2)
                            sopItemDetailForm.SopItemDetail.CarrierInstructionId.Value = sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value.ToString().Trim();
                        error = sopItemDetailForm.Tables.SalesLineInstructionDetails.GetNext();
                    }
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();

                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                }

                #endregion ItemDetailCommentInstructionInWork

                #region CustomerCommentInstructionInquiry

                else if (formName == Resources.STR_SopCustomerDetailInquiryForm)
                {
                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.InternalInstructions.Value = sopEntryInquiryForm.SopInquiry.CommentId.Value;

                    //Header Warehouse instruction display...
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                    //sopEntryForm.Tables.SalesHeaderInstructionDetails.RangeClear();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    ;
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = 1;
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.RangeStart();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Key = 2;
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    ;
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Fill();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.RangeEnd();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Key = 2;

                    TableError error = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.GetFirst();
                    while (error != TableError.EndOfTable && error == TableError.NoError)
                    {
                        if (Convert.ToInt16(sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value) == 1)
                            sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.WarehouseInstructionId.Value = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value.ToString().Trim();
                        else if (Convert.ToInt16(sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value) == 2)
                            sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CarrierInstructionId.Value = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value.ToString().Trim();
                        error = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.GetNext();
                    }

                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                }

                #endregion CustomerCommentInstructionInquiry

                #region ItemDetailCommentInstructionInquiry

                else if (formName == Resources.STR_SopItemInquiryForm)
                {
                    //Line Warehouse instruction display...
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.RangeClear();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.ToString().Trim();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = 1;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.RangeStart();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.ToString().Trim();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Fill();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.RangeEnd();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;

                    TableError error = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.GetFirst();
                    while (error != TableError.EndOfTable && error == TableError.NoError)
                    {
                        if (Convert.ToInt16(sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value) == 1)
                            sopInquiryItemDetailForm.SopInquiryItemDetail.WarehouseInstructionId.Value = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value.ToString().Trim();
                        else if (Convert.ToInt16(sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value) == 2)
                            sopInquiryItemDetailForm.SopInquiryItemDetail.CarrierInstructionId.Value = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value.ToString().Trim();
                        error = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.GetNext();
                    }
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();

                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                }

                #endregion ItemDetailCommentInstructioninquiry
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayCommentInstruction Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// WhLookup Button from customer detail entry window
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryLookupButtons1_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                expansionWindowType = Resources.STR_SalesCustomerDetailForm;
                lookupWindowType = Resources.STR_InternalInstructionID;
                if (!RegisterCommentLookupSelect)
                {
                    commentLookupForm.CommentLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(CommentLookupSelectButton_ClickBeforeOriginal);
                    RegisterCommentLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryLookupButtons1_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// WhLookup Button from customer detail entry window
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryWhLookupButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                expansionWindowType = Resources.STR_SalesCustomerDetailForm;
                lookupWindowType = Resources.STR_WarehouseInstructionID;
                if (!RegisterCommentLookupSelect)
                {
                    commentLookupForm.CommentLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(CommentLookupSelectButton_ClickBeforeOriginal);
                    RegisterCommentLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryWhLookupButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// When the expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryCarrierLookupButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                expansionWindowType = Resources.STR_SalesCustomerDetailForm;
                lookupWindowType = Resources.STR_CarrierInstructionID;
                if (!RegisterCommentLookupSelect)
                {
                    commentLookupForm.CommentLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(CommentLookupSelectButton_ClickBeforeOriginal);

                    RegisterCommentLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryCarrierLookupButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event method called on selecting the comment text from lookup window and value returned to from item details entry window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CommentLookupSelectButton_ClickBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(lookupWindowType) && !String.IsNullOrEmpty(expansionWindowType))
                {
                    #region SOpItemDetail

                    if (lookupWindowType == Resources.STR_WarehouseInstructionID &&
                        expansionWindowType == Resources.STR_SopItemDetailForm &&
                        sopItemDetailForm.SopItemDetail.IsOpen)
                    {
                        sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Value = commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim();
                        commentLookupForm.CommentLookup.Close();

                        // Update warehourse instruction details into temp table
                        UpdateCommentDetails(Resources.STR_SopItemDetailForm,
                            1,
                            commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim(),
                            commentLookupForm.CommentLookup.CommentLookupScroll.LocalCommentString.Value,
                            false);
                    }
                    else if (lookupWindowType == Resources.STR_CarrierInstructionID &&
                             expansionWindowType == Resources.STR_SopItemDetailForm &&
                             sopItemDetailForm.SopItemDetail.IsOpen)
                    {
                        sopItemDetailForm.SopItemDetail.CarrierInstructionId.Value = commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim();
                        commentLookupForm.CommentLookup.Close();

                        // Update carrier instruction details into temp table
                        UpdateCommentDetails(Resources.STR_SopItemDetailForm,
                            2,
                            commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim(),
                            commentLookupForm.CommentLookup.CommentLookupScroll.LocalCommentString.Value,
                            false);
                    }

                    #endregion SOpItemDetail

                    #region SopCustomerDetail

                    if (lookupWindowType == Resources.STR_WarehouseInstructionID &&
                        expansionWindowType == Resources.STR_SalesCustomerDetailForm &&
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                    {
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Value = commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim();
                        commentLookupForm.CommentLookup.Close();

                        UpdateCommentDetails(Resources.STR_SalesCustomerDetailForm,
                            1,
                            commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim(),
                            commentLookupForm.CommentLookup.CommentLookupScroll.LocalCommentString.Value,
                            false);
                    }
                    else if (lookupWindowType == Resources.STR_CarrierInstructionID &&
                             expansionWindowType == Resources.STR_SalesCustomerDetailForm &&
                             sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                    {
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Value = commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim();
                        commentLookupForm.CommentLookup.Close();

                        UpdateCommentDetails(Resources.STR_SalesCustomerDetailForm,
                            2,
                            commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim(),
                            commentLookupForm.CommentLookup.CommentLookupScroll.LocalCommentString.Value,
                            false);
                    }
                    else if (lookupWindowType == Resources.STR_InternalInstructionID &&
                             expansionWindowType == Resources.STR_SalesCustomerDetailForm &&
                             sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                    {
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value = commentLookupForm.CommentLookup.CommentLookupScroll.CommentId.Value.ToString().Trim();
                        commentLookupForm.CommentLookup.Close();
                        if (!sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value.ToString().Trim().Equals(sopEntryForm.SopEntry.CommentId.Value.ToString().Trim()))
                        {
                            sopEntryForm.SopEntry.CommentId.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value.ToString().Trim();
                            sopEntryForm.SopEntry.CommentId.RunValidate();
                        }
                    }

                    #endregion SOpCustomerDetail
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CommentLookupSelectButton_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Update custom comment
        /// </summary>
        /// <param name="formName">Specify form Name</param>
        /// <param name="instructionTypeID">Specify address type. 1: Warehouse Instruction Id  2: Carrier Instruction Id</param>
        /// <param name="commentId">Specify comment id number</param>
        /// <param name="commentText">Specify comment text</param>
        /// <param name="isEdited">Specify isEdited to hide or show edit button</param>
        private void UpdateCommentDetails(string formName, int instructionTypeID, string commentId, string commentText, bool isEdited)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                #region WorkItemDetail

                if (formName == Resources.STR_SopItemDetailForm)
                {
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(instructionTypeID);

                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;
                    TableError tableError = sopItemDetailForm.Tables.SalesLineInstructionDetails.Change();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (commentId.ToString().Trim() != sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value.ToString().Trim() ||
                            commentText.ToString().Trim() != sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value.ToString().Trim())
                        {
                            // Edited note. wrote logic instead of force changes window
                            if (!sopItemDetailForm.SopItemDetail.IsChanged)
                                sopItemDetailForm.SopItemDetail.IsChanged = true;

                            if (isEdited)
                            {
                                if (instructionTypeID == 1)
                                    sopItemDetailForm.SopItemDetail.LocalWhCommentEdited.Show();
                                else
                                    sopItemDetailForm.SopItemDetail.LocalCarrierCommentEdited.Show();
                            }
                            else
                            {
                                if (instructionTypeID == 1)
                                    sopItemDetailForm.SopItemDetail.LocalWhCommentEdited.Hide();
                                else
                                    sopItemDetailForm.SopItemDetail.LocalCarrierCommentEdited.Hide();
                            }

                            sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value = commentId;
                            sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value = commentText;

                            sopItemDetailForm.Tables.SalesLineInstructionDetails.IsUpdated.Value = 1;
                            sopItemDetailForm.Tables.SalesLineInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopItemDetailForm.Tables.SalesLineInstructionDetails.Save();
                        }
                    }

                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                }

                #endregion WorkItemDetail

                #region WorkCustomerDetail

                else if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(instructionTypeID);

                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Key = 2;
                    TableError tableError = sopEntryForm.Tables.SalesHeaderInstructionDetails.Change();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (commentId.ToString().Trim() != sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value.ToString().Trim() ||
                            commentText.ToString().Trim() != sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value.ToString().Trim())
                        {
                            // Edited note. wrote logic instead of force changes window
                            if (!sopEntryForm.SopEntry.IsChanged)
                                sopEntryForm.SopEntry.IsChanged = true;

                            if (isEdited)
                            {
                                if (instructionTypeID == 1)
                                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalWhCommentEdited.Show();
                                else
                                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCarrierCommentEdited.Show();
                            }
                            else
                            {
                                if (instructionTypeID == 1)
                                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalWhCommentEdited.Hide();
                                else
                                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCarrierCommentEdited.Hide();
                            }

                            sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value = commentId;
                            sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value = commentText;

                            sopEntryForm.Tables.SalesHeaderInstructionDetails.IsUpdated.Value = 1;
                            sopEntryForm.Tables.SalesHeaderInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopEntryForm.Tables.SalesHeaderInstructionDetails.Save();
                        }
                    }

                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                }

                #endregion WorkCustomerDetail

                #region InquiryItemDetail

                else if (formName == Resources.STR_SopItemInquiryForm)
                {
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(instructionTypeID);

                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;
                    TableError tableError = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Change();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (commentId.ToString().Trim() != sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value.ToString().Trim() ||
                            commentText.ToString().Trim() != sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value.ToString().Trim())
                        {
                            // Edited note. wrote logic instead of force changes window
                            if (!sopInquiryItemDetailForm.SopInquiryItemDetail.IsChanged)
                                sopInquiryItemDetailForm.SopInquiryItemDetail.IsChanged = true;

                            if (isEdited)
                            {
                                if (instructionTypeID == 1)
                                    sopInquiryItemDetailForm.SopInquiryItemDetail.LocalWhCommentEdited.Show();
                                else
                                    sopInquiryItemDetailForm.SopInquiryItemDetail.LocalCarrierCommentEdited.Show();
                            }
                            else
                            {
                                if (instructionTypeID == 1)
                                    sopInquiryItemDetailForm.SopInquiryItemDetail.LocalWhCommentEdited.Hide();
                                else
                                    sopInquiryItemDetailForm.SopInquiryItemDetail.LocalCarrierCommentEdited.Hide();
                            }

                            sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value = commentId;
                            sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value = commentText;

                            sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.IsUpdated.Value = 1;
                            sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Save();
                        }
                    }
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                }

                #endregion InquiryItemDetail

                #region InquiryCustomerDetail

                else if (formName == Resources.STR_SopCustomerDetailInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(instructionTypeID);

                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Key = 2;
                    TableError tableError = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Change();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (commentId.ToString().Trim() != sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value.ToString().Trim() ||
                            commentText.ToString().Trim() != sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value.ToString().Trim())
                        {
                            // Edited note. wrote logic instead of force changes window
                            if (!sopEntryInquiryForm.SopInquiry.IsChanged)
                                sopEntryInquiryForm.SopInquiry.IsChanged = true;

                            if (isEdited)
                            {
                                if (instructionTypeID == 1)
                                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.WarehouseInstructionId.Show();
                                else
                                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CarrierInstructionId.Show();
                            }
                            else
                            {
                                if (instructionTypeID == 1)
                                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.WarehouseInstructionId.Hide();
                                else
                                    sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CarrierInstructionId.Hide();
                            }

                            sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value = commentId;
                            sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value = commentText;

                            sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.IsUpdated.Value = 1;
                            sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Save();
                        }
                    }

                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                }

                #endregion InquiryCustomerDetail
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In UpdateCommentDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Sales Customer Detail Entry Warehouse instruction Expansion button
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ExpansionButton3_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Value.ToString().Trim() != "")
                {
                    if (sopCommentEntryForm.SopCommentEntry.IsOpen)
                    {
                        if (sopCommentEntryForm.SopCommentEntry.LocalSource.Value.ToString().Trim() != "1")
                        {
                            MessageBox.Show("Please close the Sales Comment Entry window before continuing.", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                            return;
                        }
                        sopCommentEntryForm.SopCommentEntry.Close();
                    }

                    expansionWindowType = Resources.STR_WarehouseInstructionID;

                    lookupWindowType = Resources.STR_SalesCustomerDetailForm;

                    ChemPointSalesExt.Procedures.TriggerSopXrmCommentFill.Invoke(1,
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Value.ToString().Trim(),
                        FetchCommentDetails());
                }
                else
                {
                    MessageBox.Show("Please select Warehouse Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ExpansionButton3_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Sales Customer detail entry Carrier instruction Expansion button click...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ExpansionButton4_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Value.ToString().Trim() != "")
                {
                    if (sopCommentEntryForm.SopCommentEntry.IsOpen)
                    {
                        if (sopCommentEntryForm.SopCommentEntry.LocalSource.Value.ToString().Trim() != "1")
                        {
                            MessageBox.Show("Please close the Sales Comment Entry window before continuing.", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                            return;
                        }
                        sopCommentEntryForm.SopCommentEntry.Close();
                    }

                    expansionWindowType = Resources.STR_CarrierInstructionID;

                    lookupWindowType = Resources.STR_SalesCustomerDetailForm;

                    ChemPointSalesExt.Procedures.TriggerSopXrmCommentFill.Invoke(1,
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Value.ToString().Trim(),
                        FetchCommentDetails());
                }
                else
                {
                    MessageBox.Show("Please select the Carrier Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ExpansionButton4_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Fetch Comment Details
        /// </summary>
        private string FetchCommentDetails()
        {
            StringBuilder logMessage = new StringBuilder();

            string commentText = "";
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType) && !String.IsNullOrEmpty(lookupWindowType))
                {
                    short InstructionTypeId = 0;
                    if (expansionWindowType == Resources.STR_WarehouseInstructionID)
                    {
                        InstructionTypeId = 1;
                    }
                    else if (expansionWindowType == Resources.STR_CarrierInstructionID)
                    {
                        InstructionTypeId = 2;
                    }

                    if (InstructionTypeId != 0 && lookupWindowType == Resources.STR_SopItemDetailForm)
                    {
                        sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                        sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                        sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                        sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                        sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                        sopItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                        sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = InstructionTypeId;

                        sopItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;
                        TableError tableError = sopItemDetailForm.Tables.SalesLineInstructionDetails.Get();
                        if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            commentText = sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value.ToString().Trim();
                        }

                        sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                        sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    }
                    else if (InstructionTypeId != 0 && lookupWindowType == Resources.STR_SopItemInquiryForm)
                    {
                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();
                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;
                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = InstructionTypeId;

                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;
                        TableError tableError = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Get();
                        if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            commentText = sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value.ToString().Trim();
                        }

                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                        sopInquiryItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    }
                    else if (InstructionTypeId != 0 && lookupWindowType == Resources.STR_SalesCustomerDetailForm)
                    {
                        sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                        sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                        sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                        sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = InstructionTypeId;

                        sopEntryForm.Tables.SalesHeaderInstructionDetails.Key = 2;
                        TableError tableError = sopEntryForm.Tables.SalesHeaderInstructionDetails.Get();
                        if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            commentText = sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value.ToString().Trim();
                        }

                        sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                        sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                    }
                    else if (InstructionTypeId != 0 && lookupWindowType == Resources.STR_SopCustomerDetailInquiryForm)
                    {
                        sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                        sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                        sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                        sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();
                        sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = InstructionTypeId;

                        sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Key = 2;
                        TableError tableError = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Get();
                        if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            commentText = sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value.ToString().Trim();
                        }

                        sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Release();
                        sopEntryInquiryForm.Tables.SalesHeaderInstructionDetails.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In FetchCommentDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return commentText;
        }

        /// <summary>
        /// Validate comment details 
        /// </summary>
        /// <param name="commentID">Specify comment ID</param>
        /// <returns>true if success else false</returns>
        private bool ValidateCommentDetails(string commentID)
        {
            StringBuilder logMessage = new StringBuilder();

            bool recordsExists = false;
            try
            {
                // load data from SY_Comment_MSTR table
                ChemPointSalesExt.Tables.SyCommentMstr.Close();
                ChemPointSalesExt.Tables.SyCommentMstr.Release();
                ChemPointSalesExt.Tables.SyCommentMstr.CommentId.Value = commentID;

                ChemPointSalesExt.Tables.SyCommentMstr.Key = 1;
                TableError tempError = ChemPointSalesExt.Tables.SyCommentMstr.Get();
                if (tempError == TableError.NotFound)
                {
                    recordsExists = true;
                }
                ChemPointSalesExt.Tables.SyCommentMstr.Release();
                ChemPointSalesExt.Tables.SyCommentMstr.Close();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateCommentDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return recordsExists;
        }

        /// <summary>
        /// Reset custom comment
        /// </summary>
        /// <param name="formName">Specify form Name</param>
        /// <param name="instructionTypeID">Specify address type. 1: Warehouse Instruction Id  2: Carrier Instruction Id</param>
        /// <param name="commentId">Specify comment id number</param>
        private void ResetCommentDetails(string formName, int instructionTypeID, string commentId)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopItemDetailForm)
                {
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(instructionTypeID);

                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Key = 2;
                    TableError tableError = sopItemDetailForm.Tables.SalesLineInstructionDetails.Change();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (commentId != sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value.ToString().Trim())
                        {
                            if (instructionTypeID == 1)
                                sopItemDetailForm.SopItemDetail.LocalWhCommentEdited.Hide();
                            else
                                sopItemDetailForm.SopItemDetail.LocalCarrierCommentEdited.Hide();

                            // load data from SY_Comment_MSTR table
                            ChemPointSalesExt.Tables.SyCommentMstr.Close();
                            ChemPointSalesExt.Tables.SyCommentMstr.Release();
                            ChemPointSalesExt.Tables.SyCommentMstr.CommentId.Value = commentId;

                            ChemPointSalesExt.Tables.SyCommentMstr.Key = 1;
                            TableError tempError = ChemPointSalesExt.Tables.SyCommentMstr.Get();
                            if (tempError == TableError.NotFound)
                            {
                                sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value = "";
                                sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value = "";

                                sopItemDetailForm.Tables.SalesLineInstructionDetails.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SalesLineInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopItemDetailForm.Tables.SalesLineInstructionDetails.Save();
                            }
                            else if (tempError == TableError.NoError)
                            {
                                sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentId.Value = ChemPointSalesExt.Tables.SyCommentMstr.CommentId.Value.ToString().Trim();
                                sopItemDetailForm.Tables.SalesLineInstructionDetails.CommentText.Value = ChemPointSalesExt.Tables.SyCommentMstr.CommentText.Value;

                                sopItemDetailForm.Tables.SalesLineInstructionDetails.IsUpdated.Value = 1;
                                sopItemDetailForm.Tables.SalesLineInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopItemDetailForm.Tables.SalesLineInstructionDetails.Save();
                            }
                            ChemPointSalesExt.Tables.SyCommentMstr.Release();
                            ChemPointSalesExt.Tables.SyCommentMstr.Close();
                        }
                    }

                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Release();
                    sopItemDetailForm.Tables.SalesLineInstructionDetails.Close();
                }
                else if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.InstructionTypeId.Value = Convert.ToInt16(instructionTypeID);

                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Key = 2;
                    TableError tableError = sopEntryForm.Tables.SalesHeaderInstructionDetails.Change();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (commentId.ToString().Trim() != sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value.ToString().Trim())
                        {
                            if (instructionTypeID == 1)
                                sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalWhCommentEdited.Hide();
                            else
                                sopCustomerDetailEntryForm.SopCustomerDetailEntry.LocalCarrierCommentEdited.Hide();

                            // load data from SY_Comment_MSTR table
                            ChemPointSalesExt.Tables.SyCommentMstr.Close();
                            ChemPointSalesExt.Tables.SyCommentMstr.Release();
                            ChemPointSalesExt.Tables.SyCommentMstr.CommentId.Value = commentId;

                            ChemPointSalesExt.Tables.SyCommentMstr.Key = 1;
                            TableError tempError = ChemPointSalesExt.Tables.SyCommentMstr.Get();
                            if (tempError == TableError.NotFound)
                            {
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value = "";
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value = "";

                                sopEntryForm.Tables.SalesHeaderInstructionDetails.IsUpdated.Value = 1;
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryForm.Tables.SalesHeaderInstructionDetails.Save();
                            }
                            else if (tempError == TableError.NoError)
                            {
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentId.Value = ChemPointSalesExt.Tables.SyCommentMstr.CommentId.Value.ToString().Trim();
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.CommentText.Value = ChemPointSalesExt.Tables.SyCommentMstr.CommentText.Value;

                                sopEntryForm.Tables.SalesHeaderInstructionDetails.IsUpdated.Value = 1;
                                sopEntryForm.Tables.SalesHeaderInstructionDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                sopEntryForm.Tables.SalesHeaderInstructionDetails.Save();
                            }
                            ChemPointSalesExt.Tables.SyCommentMstr.Release();
                            ChemPointSalesExt.Tables.SyCommentMstr.Close();
                        }
                    }
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Release();
                    sopEntryForm.Tables.SalesHeaderInstructionDetails.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ResetCommentDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Wharehouse instruction enter field event...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void InternalInstructionId_EnterAfterOriginal(object sender, EventArgs e)
        {
            internalInfoEnterFlag = true;
        }

        /// <summary>
        /// WH instruction Id Field change Event
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void InternalInstructionId_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (!String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                {
                    if (internalInfoEnterFlag == true)
                    {
                        if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value.ToString().Trim() != "")
                        {
                            bool recordsExists = ValidateCommentDetails(sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value.ToString().Trim());  // call validate to check and load window
                            if (recordsExists == true)
                            {
                                MessageBox.Show("Please enter the valid Internal Instruction ID", Resources.STR_MESSAGE_TITLE);
                                sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value = "";
                                sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Focus();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InternalInstructionId_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Warehouse instruction leave after original event...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void InternalInstructionId_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                internalInfoEnterFlag = false;
                if (!sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value.ToString().Trim().Equals(sopEntryForm.SopEntry.CommentId.Value.ToString().Trim()))
                {
                    sopEntryForm.SopEntry.CommentId.Value = sopCustomerDetailEntryForm.SopCustomerDetailEntry.InternalInstructions.Value.ToString().Trim();
                    sopEntryForm.SopEntry.CommentId.RunValidate();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InternalInstructionId_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Wharehouse instruction enter field event...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void WarehouseInstructionId_EnterAfterOriginal(object sender, EventArgs e)
        {
            warehouseInfoEnterFlag = true;
        }

        /// <summary>
        /// WH instruction Id Field change Event
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void WarehouseInstructionId_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (!String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                {
                    if (warehouseInfoEnterFlag == true)
                    {
                        if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Value.ToString().Trim() != "")
                        {
                            bool recordsExists = ValidateCommentDetails(sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Value.ToString().Trim());  // call validate to check and load window
                            if (recordsExists == true)
                            {
                                MessageBox.Show("Please enter the valid Warehouse Instruction ID", Resources.STR_MESSAGE_TITLE);
                                sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Value = "";
                                sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Focus();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In WarehouseInstructionId_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Warehouse instruction leave after original event...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void WarehouseInstructionId_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                warehouseInfoEnterFlag = false;
                ResetCommentDetails(Resources.STR_SalesCustomerDetailForm,
                    1,
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.WarehouseInstructionId.Value.ToString().Trim());
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In WarehouseInstructionId_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Carrier instruction Entry Text box Enter event
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void CarrierInstructionId_EnterAfterOriginal(object sender, EventArgs e)
        {
            carrierInfoEnterFlag = true;
        }

        /// <summary>
        /// Carrier instruction id change from Customerdetail Entry window
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CarrierInstructionId_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (!String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString()))
                {
                    if (carrierInfoEnterFlag == true)
                    {
                        if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Value.ToString().Trim() != "")
                        {
                            bool recordsExists = ValidateCommentDetails(sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Value.ToString().Trim());  // call validate to check and load window
                            if (recordsExists == true)
                            {
                                MessageBox.Show("Please enter the valid Carrier Instruction ID", Resources.STR_MESSAGE_TITLE);
                                sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Value = "";
                                sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Focus();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CarrierInstructionId_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Carrier instruction Enter Leave after original..
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void CarrierInstructionId_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                carrierInfoEnterFlag = false;
                ResetCommentDetails(Resources.STR_SalesCustomerDetailForm,
                    2,
                    sopCustomerDetailEntryForm.SopCustomerDetailEntry.CarrierInstructionId.Value.ToString().Trim());
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CarrierInstructionId_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion CommentHeaderInstruction

        #region CommentEntry

        /// <summary>
        /// Method fired on before opening the Sales Comment Entry window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCommentEntry_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (RegisterCommentEntry == false)
                {
                    sopCommentEntryForm.SopCommentEntry.CloseAfterOriginal += new EventHandler(SopCommentEntry_CloseAfterOriginal);
                    sopCommentEntryForm.SopCommentEntry.OkButtonK.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(SopCommentEntryOkButtonK_ClickBeforeOriginal);

                    RegisterCommentEntry = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCommentEntry_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event fired when closing the Sales Comment entry window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCommentEntry_CloseAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
            lookupWindowType = string.Empty;
        }

        /// <summary>
        /// When the ok button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCommentEntryOkButtonK_ClickBeforeOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType) && !String.IsNullOrEmpty(lookupWindowType))
                {
                    if (expansionWindowType == Resources.STR_WarehouseInstructionID &&
                        lookupWindowType == Resources.STR_SopItemDetailForm &&
                        sopItemDetailForm.SopItemDetail.IsOpen)
                    {
                        // Update warehouse instruction text into temp table
                        UpdateCommentDetails(Resources.STR_SopItemDetailForm,
                            1,
                            sopCommentEntryForm.SopCommentEntry.CommentId.Value.ToString().Trim(),
                            sopCommentEntryForm.SopCommentEntry.CommentText.Value,
                            true);
                    }
                    else if (expansionWindowType == Resources.STR_CarrierInstructionID &&
                             lookupWindowType == Resources.STR_SopItemDetailForm &&
                             sopItemDetailForm.SopItemDetail.IsOpen)
                    {
                        // Update carier instruction text into temp table
                        UpdateCommentDetails(Resources.STR_SopItemDetailForm,
                            2,
                            sopCommentEntryForm.SopCommentEntry.CommentId.Value.ToString().Trim(),
                            sopCommentEntryForm.SopCommentEntry.CommentText.Value,
                            true);
                    }
                    else if (expansionWindowType == Resources.STR_WarehouseInstructionID &&
                             lookupWindowType == Resources.STR_SalesCustomerDetailForm &&
                             sopEntryForm.SopEntry.IsOpen)
                    {
                        // Update warehouse instruction text into temp table
                        UpdateCommentDetails(Resources.STR_SalesCustomerDetailForm,
                            1,
                            sopCommentEntryForm.SopCommentEntry.CommentId.Value.ToString().Trim(),
                            sopCommentEntryForm.SopCommentEntry.CommentText.Value,
                            true);
                    }
                    else if (expansionWindowType == Resources.STR_CarrierInstructionID &&
                             lookupWindowType == Resources.STR_SalesCustomerDetailForm &&
                             sopEntryForm.SopEntry.IsOpen)
                    {
                        // Update warehouse instruction text into temp table
                        UpdateCommentDetails(Resources.STR_SalesCustomerDetailForm,
                            2,
                            sopCommentEntryForm.SopCommentEntry.CommentId.Value.ToString().Trim(),
                            sopCommentEntryForm.SopCommentEntry.CommentText.Value,
                            true);
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCommentEntryOkButtonK_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// When the expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailExpansionButton8_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Value.ToString().Trim() != "")
                {
                    if (sopCommentEntryForm.SopCommentEntry.IsOpen)
                    {
                        if (sopCommentEntryForm.SopCommentEntry.LocalSource.Value.ToString().Trim() != "2")
                        {
                            MessageBox.Show("Please close the Sales Comment Entry window before continuing.", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                            return;
                        }
                        sopCommentEntryForm.SopCommentEntry.Close();
                    }

                    expansionWindowType = Resources.STR_WarehouseInstructionID;

                    lookupWindowType = Resources.STR_SopItemDetailForm;

                    ChemPointSalesExt.Procedures.TriggerSopXrmCommentFill.Invoke(2,
                        sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Value.ToString().Trim(),
                        FetchCommentDetails());
                }
                else
                {
                    MessageBox.Show("Please select Warehouse Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailExpansionButton8_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// When the expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailExpansionButton9_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (sopItemDetailForm.SopItemDetail.CarrierInstructionId.Value.ToString().Trim() != "")
                {
                    if (sopCommentEntryForm.SopCommentEntry.IsOpen)
                    {
                        if (sopCommentEntryForm.SopCommentEntry.LocalSource.Value.ToString().Trim() != "2")
                        {
                            MessageBox.Show("Please close the Sales Comment Entry window before continuing.", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                            return;
                        }
                        sopCommentEntryForm.SopCommentEntry.Close();
                    }

                    expansionWindowType = Resources.STR_CarrierInstructionID;

                    lookupWindowType = Resources.STR_SopItemDetailForm;

                    ChemPointSalesExt.Procedures.TriggerSopXrmCommentFill.Invoke(2,
                        sopItemDetailForm.SopItemDetail.CarrierInstructionId.Value.ToString().Trim(),
                        FetchCommentDetails());
                }
                else
                {
                    MessageBox.Show("Please select the Carrier Instruction ID", Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailExpansionButton9_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// fire when user clicked on warehoures comment lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailLookupButton12_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                expansionWindowType = Resources.STR_SopItemDetailForm;
                lookupWindowType = Resources.STR_WarehouseInstructionID;
                if (!RegisterCommentLookupSelect)
                {
                    commentLookupForm.CommentLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(CommentLookupSelectButton_ClickBeforeOriginal);
                    RegisterCommentLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailLookupButton12_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// fire when user clicked on carrier comment lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailLookupButton13_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                expansionWindowType = Resources.STR_SopItemDetailForm;
                lookupWindowType = Resources.STR_CarrierInstructionID;
                if (!RegisterCommentLookupSelect)
                {
                    commentLookupForm.CommentLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(CommentLookupSelectButton_ClickBeforeOriginal);
                    RegisterCommentLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailLookupButton13_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        ///  This event occurs when the warehouse instruction id receives focus
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailWarehouseInstructionId_EnterAfterOriginal(object sender, EventArgs e)
        {
            warehouseInfoEnterFlag = true;
        }

        /// <summary>
        /// When the change warehouse instruction id
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailWarehouseInstructionId_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                {
                    if (warehouseInfoEnterFlag == true)
                    {
                        if (sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Value.ToString().Trim() != "")
                        {
                            bool recordsExists = ValidateCommentDetails(sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Value.ToString().Trim());  // call validate to check and load window
                            if (recordsExists == true)
                            {
                                MessageBox.Show("Please enter the valid Warehouse Instruction ID", Resources.STR_MESSAGE_TITLE);
                                sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Value = "";
                                sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Focus();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailWarehouseInstructionId_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        ///  This event occurs when the warehouse instruction id leaves focus
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailWarehouseInstructionId_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                warehouseInfoEnterFlag = false;
                ResetCommentDetails(Resources.STR_SopItemDetailForm,
                    1,
                    sopItemDetailForm.SopItemDetail.WarehouseInstructionId.Value.ToString().Trim());
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailWarehouseInstructionId_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        ///  This event occurs when the carrier instruction id receives focus
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCarrierInstructionId_EnterAfterOriginal(object sender, EventArgs e)
        {
            carrierInfoEnterFlag = true;
        }

        /// <summary>
        /// When the change carrier instruction id
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCarrierInstructionId_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopNumber.Value) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString()) &&
                    !String.IsNullOrEmpty(sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString()))
                {
                    if (carrierInfoEnterFlag == true)
                    {
                        if (sopItemDetailForm.SopItemDetail.CarrierInstructionId.Value.ToString().Trim() != "")
                        {
                            bool recordsExists = ValidateCommentDetails(sopItemDetailForm.SopItemDetail.CarrierInstructionId.Value.ToString().Trim());  // call validate to check and load window
                            if (recordsExists == true)
                            {
                                MessageBox.Show("Please enter the valid Carrier Instruction ID", Resources.STR_MESSAGE_TITLE);
                                sopItemDetailForm.SopItemDetail.CarrierInstructionId.Value = "";
                                sopItemDetailForm.SopItemDetail.CarrierInstructionId.Focus();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailCarrierInstructionId_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        ///  This event occurs when the carrier instruction id leaves focus
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailCarrierInstructionId_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                carrierInfoEnterFlag = false;
                ResetCommentDetails(Resources.STR_SopItemDetailForm,
                    2,
                    sopItemDetailForm.SopItemDetail.CarrierInstructionId.Value.ToString().Trim());
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailCarrierInstructionId_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event fired after closing the comment lookup window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CommentLookup_CloseAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
            lookupWindowType = string.Empty;
        }

        #endregion CommentEntry

        #region CPServiceConfiguration

        /// <summary>
        /// Method to get the catagory for the ini file.
        /// </summary>
        /// <param name="iniFile"></param>
        /// <returns></returns>
        private static List<string> GetCategories(string iniFile)
        {
            string returnString = new string(' ', 65536);
            GetPrivateProfileString(null, null, null, returnString, 65536, iniFile);
            List<string> result = new List<string>(returnString.Split('\0'));
            result.RemoveRange(result.Count - 2, 2);
            return result;
        }

        /// <summary>
        /// Method to read the data from dex.ini file
        /// </summary>
        /// <param name="iniFile"></param>
        /// <param name="category"></param>
        /// <param name="key"></param>
        /// <param name="defaultValue"></param>
        /// <returns></returns>
        private static string GetIniFileString(string iniFile, string category, string key, string defaultValue)
        {
            string returnString = new string(' ', 1024);
            GetPrivateProfileString(category, key, defaultValue, returnString, 1024, iniFile);
            return returnString.Split('\0')[0];
        }

        #endregion CPServiceConfiguration

        #region OrderType

        // <summary>
        /// Method to set the order type values on opening the window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OrderTypeDetails_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType))
                {
                    if (expansionWindowType == Resources.STR_SopEntryForm)
                    {
                        //lock order status alone for user-defined entry
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsAutoPtEligible.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Lock();

                        sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                        sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                        sopEntryForm.Tables.SalesOrderTypeDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                        sopEntryForm.Tables.SalesOrderTypeDetails.Key = 1;
                        TableError tableError = sopEntryForm.Tables.SalesOrderTypeDetails.Get();
                        if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsInternational.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsNaFta.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsDropship.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsBulk.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsI3Order.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditCard.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrective.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsConsignment.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsSampleOrder.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTempControl.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsHazmat.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFreezeProtect.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value = sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value;
                        }
                        sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                        sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                    }
                    else if (expansionWindowType == Resources.STR_SopInquiryForm)
                    {
                        //lock save button for inquiry window
                        orderTypeDetailsForm.OrderTypeDetails.SaveButton.Lock();

                        //lock order type for inquiry window
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsInternational.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsNaFta.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsDropship.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsBulk.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsI3Order.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditCard.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrective.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFullTruckLoad.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsConsignment.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsSampleOrder.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTempControl.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsHazmat.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFreezeProtect.Lock();

                        //lock order status for inquiry window
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsAutoPtEligible.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Lock();
                        orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Lock();

                        sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Close();
                        sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Release();
                        sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                        sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                        sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Key = 1;
                        TableError tableError = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Get();
                        if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsInternational.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsNaFta.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsDropship.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsBulk.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsI3Order.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditCard.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrective.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsConsignment.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsSampleOrder.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTempControl.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsHazmat.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFreezeProtect.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value;
                            orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value;
                        }
                        sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Release();
                        sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OrderTypeDetails_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method fired on before opening the order type entry.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OrderTypeDetails_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (RegisterOrderTypeDetails == false)
                {
                    orderTypeDetailsForm.OrderTypeDetails.CloseAfterOriginal += new EventHandler(OrderTypeDetails_CloseAfterOriginal);
                    orderTypeDetailsForm.OrderTypeDetails.SaveButton.ClickAfterOriginal += new EventHandler(OrderTypeDetailsSaveButton_ClickAfterOriginal);
                    orderTypeDetailsForm.OrderTypeDetails.CancelButton.ClickAfterOriginal += new EventHandler(OrderTypeDetailsCancelButton_ClickAfterOriginal);

                    RegisterOrderTypeDetails = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OrderTypeDetails_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event fired when closing the order type window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OrderTypeDetails_CloseAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
        }

        /// <summary>
        /// When the cancel button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OrderTypeDetailsCancelButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            orderTypeDetailsForm.OrderTypeDetails.Close();
        }

        /// <summary>
        /// When the ok button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OrderTypeDetailsSaveButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType))
                {
                    if (expansionWindowType == Resources.STR_SopEntryForm)
                    {
                        bool isChanged = UpdateOrderTypeDetails(sopEntryForm.SopEntry.SopTypeDatabase.Value,
                            sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim());
                        if (isChanged)
                        {
                            bool saveResult = SaveOrderTypeDetails(expansionWindowType);
                            isChangedOrderType = true;
                            if (saveResult && sopUserDefinedFieldEntryForm.SopUserDefinedFieldEntry.IsOpen)
                                DisplayOrderTypeDetails(expansionWindowType);
                        }

                        orderTypeDetailsForm.OrderTypeDetails.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OrderTypeDetailsSaveButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// save custom order type into order type details temp table
        /// </summary>
        /// <param name="formName">Specify form name</param>
        private bool SaveOrderTypeDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();

            SalesOrderRequest request = null;
            SalesOrderEntity salesOrderEntity = null;
            SalesOrderInformation salesOrderInformation = null;
            SalesOrderDetails salesOrderDetail = null;
            SalesOrderType salesOrderType = null;
            AuditInformation auditInformation = new AuditInformation();
            bool isResult = true;

            try
            {
                request = new SalesOrderRequest();
                salesOrderEntity = new SalesOrderEntity();
                salesOrderInformation = new SalesOrderInformation();
                salesOrderDetail = new SalesOrderDetails();
                request.CompanyID = Dynamics.Globals.CompanyId.Value;
                salesOrderType = new SalesOrderType();
                //Assign SopEntry Value to Request Object.

                #region OrderTypeAssign

                salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();



                sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                sopEntryForm.Tables.SalesOrderTypeDetails.Release();

                TableError tableError = sopEntryForm.Tables.SalesOrderTypeDetails.GetFirst();
                while (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                {
                    if (sopEntryForm.Tables.SalesOrderTypeDetails.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                    {
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.IsUpdated.Value == 1)   // Fetch only update records and pass it to save procedure
                        {
                            salesOrderType.IsInternational = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value);
                            salesOrderType.IsNaFta = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value);
                            salesOrderType.IsDropship = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value);
                            salesOrderType.IsBulk = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value);
                            salesOrderType.IsI3Order = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value);
                            salesOrderType.IsCreditCard = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value);
                            salesOrderType.IsCorrective = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value);
                            salesOrderType.IsFullTruckLoad = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value);
                            salesOrderType.IsConsignment = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value);
                            salesOrderType.IsCorrectiveBoo = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value);
                            salesOrderType.IsSampleOrder = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value);
                            salesOrderType.IsTempControl = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value);
                            salesOrderType.IsHazmat = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value);
                            salesOrderType.IsFreezeProtect = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value);
                            salesOrderType.IsAutoPTEligible = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value);
                            salesOrderType.IsCreditEnginePassed = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value);
                            salesOrderType.IsTaxEnginePassed = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value);

                            auditInformation.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                            auditInformation.CompanyId = Dynamics.Globals.CompanyId.Value;
                        }
                    }

                    tableError = sopEntryForm.Tables.SalesOrderTypeDetails.GetNext();
                }
                sopEntryForm.Tables.SalesOrderTypeDetails.Release();

                sopEntryForm.Tables.SalesOrderTypeDetails.Close();

                #endregion OrderTypeAssign

                salesOrderDetail.SalesOrderType = salesOrderType;
                salesOrderDetail.AuditInformation = auditInformation;
                salesOrderInformation.SalesOrderDetails = salesOrderDetail;
                salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                request.SalesOrderEntity = salesOrderEntity;

                if (request != null)
                {
                    // Service call ...
                    using (HttpClient client = new HttpClient())
                    {
                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                        client.DefaultRequestHeaders.Accept.Clear();
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                        var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveOrderTypeDetail", request); // we need to refer the web.api service url here.
                        if (response.Result.IsSuccessStatusCode)
                        {
                            SalesOrderResponse salesOrderTypeResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                            if (salesOrderTypeResponse.Status == ResponseStatus.Success)
                            {
                                isResult = true;
                            }
                            else
                            {
                                isResult = false;
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveOrderTypeDetails Method (SaveOrderTypeDetail): " + salesOrderTypeResponse.ErrorMessage.ToString());
                                MessageBox.Show("Error: " + salesOrderTypeResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            }
                        }
                        else
                        {
                            isResult = false;
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not fetch from custom sales details Table");
                            MessageBox.Show("Error: Data does not fetch from custom sales details Table", Resources.STR_MESSAGE_TITLE);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveOrderTypeDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return isResult;
        }

        /// <summary>
        /// Invoke before script ValidateHeaderAndLineFreightDetails and reject records
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ValidateHeaderAndLineFreightDetails_InvokeBeforeOriginal(object sender, Dic4745.ValidateHeaderAndLineFreightDetailsProcedure.InvokeEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                sopEntryForm.SopEntry.LocalIsPriceUpdated.Value = false;
                bool recordsExists = ValidateAddressDetails();  // call validate to check and load window


                if (recordsExists == true)
                    sopEntryForm.SopEntry.LocalIsAddressValidate.Value = true;
                else
                    sopEntryForm.SopEntry.LocalIsAddressValidate.Value = false;

                DocumentAmountChange();

            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateHeaderAndLineFreightDetails_InvokeBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }


        void ValidateHeaderAndLineFreightDetails_InvokeAfterOriginal(object sender, Dic4745.ValidateHeaderAndLineFreightDetailsProcedure.InvokeEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (IsValidateServiceSkus)
                {
                    ValidateServiceSkuDetails();
                    IsValidateServiceSkus = false;  // stop validation on next iteration for same sop number 
                }


            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateHeaderAndLineFreightDetails_InvokeAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }
        // <summary>
        /// Validate customer address including Bill To Address ID and Ship To Address ID
        /// </summary>
        private bool ValidateServiceSkuDetails()
        {
            StringBuilder logMessage = new StringBuilder();
            bool recordsExists = false;
            try
            {
                if (!string.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) &&
                    !string.IsNullOrEmpty(sopEntryForm.SopEntry.SopTypeDatabase.Value.ToString().Trim()) &&
                    !string.IsNullOrEmpty(sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim()))
                {
                    if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 2 ||
                         sopEntryForm.SopEntry.SopTypeDatabase.Value == 3 ||
                         sopEntryForm.SopEntry.SopTypeDatabase.Value == 6)
                    {
                        bool IsValidateTransportation = false;
                        bool IsValidateOrderType = false;
                        SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                        salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                        //Assign SopEntry Value to Request Object.

                        SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                        SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                        OrderHeader orderHeader = new OrderHeader();
                        SalesOrderType orderType = new SalesOrderType();
                        AuditInformation auditInformation = new AuditInformation();
                        OrderSchedule orderSchedule = new OrderSchedule();

                        orderSchedule.RequestedShipDate = sopEntryForm.SopEntry.CpReqShipDate.Value;

                        salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                        auditInformation.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                        auditInformation.CompanyId = Dynamics.Globals.CompanyId.Value;

                        #region Transportation Details

                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();

                        TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.GetFirst();
                        while (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                        {
                            if (sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value &&
                                sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                            {
                                orderHeader.FreightTerm = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.FreightTerm.Value;
                                orderHeader.IncoTerm = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.IncoTerms.Value;

                                orderHeader.CarrierName = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierName.Value;
                                orderHeader.CarrierAccountNumber = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierAccount.Value;
                                orderHeader.CarrierPhone = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CarrierPhone.Value;
                                orderHeader.ThirdPartyAddressId = 0;
                                orderHeader.ServiceType = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ServiceType.Value;
                                orderHeader.ImporterofRecord = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.ImporterRecord.Value;
                                orderHeader.CustomBroker = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomBroker.Value;
                                orderHeader.ToBeCancelled = Convert.ToInt16(sopEntryForm.Tables.SopCustomerDetailTransportationTemp.TobeCancelled.Value);  // To cancelled


                                orderHeader.CustomizeServiceSkus = Convert.ToInt16(sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomizeServiceSkUs.Value);  // ExcludeServiceSkus                             

                                IsValidateTransportation = true;
                            }
                            tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.GetNext();
                        }
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                        sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();

                        #endregion Transportation Details

                        #region OrderType Details

                        sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                        sopEntryForm.Tables.SalesOrderTypeDetails.Release();

                        TableError tableError = sopEntryForm.Tables.SalesOrderTypeDetails.GetFirst();
                        while (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                        {
                            if (sopEntryForm.Tables.SalesOrderTypeDetails.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value &&
                                sopEntryForm.Tables.SalesOrderTypeDetails.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim())
                            {

                                orderType.IsInternational = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value);
                                orderType.IsNaFta = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value);
                                orderType.IsDropship = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value);
                                orderType.IsBulk = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value);
                                orderType.IsI3Order = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value);
                                orderType.IsCreditCard = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value);
                                orderType.IsCorrective = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value);
                                orderType.IsFullTruckLoad = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value);
                                orderType.IsConsignment = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value);
                                orderType.IsCorrectiveBoo = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value);
                                orderType.IsSampleOrder = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value);
                                orderType.IsTempControl = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value);
                                orderType.IsHazmat = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value);
                                orderType.IsFreezeProtect = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value);
                                orderType.IsAutoPTEligible = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value);
                                orderType.IsCreditEnginePassed = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value);
                                orderType.IsTaxEnginePassed = Convert.ToInt16(sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value);

                                IsValidateOrderType = true;

                            }
                            tableError = sopEntryForm.Tables.SalesOrderTypeDetails.GetNext();
                        }
                        sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                        sopEntryForm.Tables.SalesOrderTypeDetails.Close();

                        #endregion OrderType Details

                        salesOrderDetails.SalesOrderType = orderType;
                        salesOrderDetails.OrderSchedule = orderSchedule;
                        salesOrderDetails.OrderHeader = orderHeader;
                        salesOrderDetails.AuditInformation = auditInformation;
                        salesOrderInformation.SalesOrderDetails = salesOrderDetails;
                        salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                        salesOrderRequest.SalesOrderEntity = salesOrderEntity;

                        if (IsValidateOrderType && IsValidateTransportation)
                        {
                            // Service call ...
                            using (HttpClient client = new HttpClient())
                            {
                                client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                client.DefaultRequestHeaders.Accept.Clear();
                                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                var response = client.PostAsJsonAsync("api/SalesOrderUpdate/ValidateSopTransactionServiceSkuItems/", salesOrderRequest); // we need to refer the web.api service url here.

                                if (response.Result.IsSuccessStatusCode)
                                {
                                    SalesOrderResponse salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                    if (salesOrderResponse.Status == ResponseStatus.Error)
                                    {
                                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateHeaderAndLineFreightDetails_InvokeAfterOriginal Method (ValidateSopTransactionServiceSkuItems): " + salesOrderResponse.ErrorMessage.ToString());
                                        MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                    }
                                    else
                                    {
                                        if (salesOrderResponse.SalesOrderDetails != null)
                                        {
                                            if (salesOrderResponse.SalesOrderDetails.SalesOrderDetails != null)
                                            {
                                                if (salesOrderResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails != null)
                                                {
                                                    if (salesOrderResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.LineItems != null)
                                                    {
                                                        string skuErrorMessage = "";
                                                        foreach (var itemDetail in salesOrderResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.LineItems)
                                                        {
                                                            if (sopEntryForm.SopEntry.SopTypeDatabase.Value == itemDetail.SopType &&
                                                                sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() == itemDetail.SopNumber.ToString().Trim() &&
                                                                itemDetail.LineStatus.ToString().Trim() != "")
                                                            {
                                                                skuErrorMessage += itemDetail.LineStatus.ToString().Trim() + ",";
                                                            }
                                                        }
                                                        if (skuErrorMessage.ToString() != "")
                                                        {
                                                            int k = skuErrorMessage.ToString().LastIndexOf(",");
                                                            if (k > 0)
                                                                skuErrorMessage = skuErrorMessage.ToString().Substring(0, k);

                                                            MessageBox.Show(skuErrorMessage.ToString(), Resources.STR_MESSAGE_TITLE);
                                                            recordsExists = true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not validate for service sku items");
                                    MessageBox.Show("Error: Data does not validate for service sku items", Resources.STR_MESSAGE_TITLE);
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateServiceSkuDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return recordsExists;
        }

        /// <summary>
        /// Validate customer address including Bill To Address ID and Ship To Address ID
        /// </summary>
        private bool ValidateAddressDetails()
        {
            StringBuilder logMessage = new StringBuilder();
            bool recordsExists = false;
            try
            {
                bool IsErrorBillToAddress = false;
                bool IsErrorShipToAddress = false;
                SalesOrderResponse salesOrderResponse = new SalesOrderResponse();

                #region Check Bill To Address

                sopEntryForm.Tables.SalesAddressDetails.Close();
                sopEntryForm.Tables.SalesAddressDetails.Release();
                sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 1;
                sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = "";

                sopEntryForm.Tables.SalesAddressDetails.Key = 1;
                TableError tempError = sopEntryForm.Tables.SalesAddressDetails.Get();
                if (tempError == TableError.NoError && tempError != TableError.EndOfTable)
                {
                    IsErrorBillToAddress = true;
                }
                sopEntryForm.Tables.SalesAddressDetails.Release();
                sopEntryForm.Tables.SalesAddressDetails.Close();

                #endregion Check Bill To Address

                #region Check Ship To Address

                sopEntryForm.Tables.SalesAddressDetails.Close();
                sopEntryForm.Tables.SalesAddressDetails.Release();
                sopEntryForm.Tables.SalesAddressDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                sopEntryForm.Tables.SalesAddressDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                sopEntryForm.Tables.SalesAddressDetails.CustomerNumber.Value = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                sopEntryForm.Tables.SalesAddressDetails.AddressTypeId.Value = 2;
                sopEntryForm.Tables.SalesAddressDetails.AddressCode.Value = "";

                sopEntryForm.Tables.SalesAddressDetails.Key = 1;
                TableError tableError = sopEntryForm.Tables.SalesAddressDetails.Get();
                if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                {
                    IsErrorShipToAddress = true;
                }
                sopEntryForm.Tables.SalesAddressDetails.Release();
                sopEntryForm.Tables.SalesAddressDetails.Close();

                #endregion Check Ship To Address

                //TODO Call service to validate the address.
                if (IsErrorBillToAddress == true || IsErrorShipToAddress == true)
                {
                    try
                    {
                        SalesOrderRequest validateAddressRequest = new SalesOrderRequest();
                        SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                        CustomerInformation customerInformation = new CustomerInformation();

                        customerInformation.CustomerId = sopEntryForm.SopEntry.CustomerNumber.Value.ToString().Trim();
                        validateAddressRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                        salesOrderInformation.Customer = customerInformation;
                        salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                        validateAddressRequest.SalesOrderEntity = salesOrderEntity;

                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/ValidateSopTransactionAddressCodes", validateAddressRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesOrderResponse.Status == ResponseStatus.Success)
                                {
                                    recordsExists = true;
                                }
                                else
                                {
                                    recordsExists = false;
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateAddressDetails Method (ValidateSopTransactionAddressCodes): " + salesOrderResponse.ErrorMessage.ToString());
                                    MessageBox.Show("Error: " + salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                }
                            }
                            else
                            {
                                recordsExists = false;
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not saved into ValidateSopTransactionAddressCodes Table");
                                MessageBox.Show("Error: Data does not saved into ValidateSopTransactionAddressCodes Table", Resources.STR_MESSAGE_TITLE);
                            }

                            if (salesOrderResponse.Status == ResponseStatus.Success &&
                                salesOrderResponse.AddressCount != null && salesOrderResponse.AddressCount.Count > 0 &&
                                salesOrderResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails != null &&
                                salesOrderResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails.Count > 0)
                            {
                                foreach (var addressCount in salesOrderResponse.AddressCount)
                                {
                                    foreach (var addressInformation in salesOrderResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.AddressDetails)
                                    {
                                        if (Convert.ToInt16(addressInformation.AddressId) == 1 && // check for bill
                                            IsErrorBillToAddress && addressCount > 1)   // check address count > 1
                                        {
                                            MessageBox.Show(Resources.STR_MESSAGE_XRM_BILL_ADDRESS, Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                                            recordsExists = true;
                                            IsErrorBillToAddress = false;
                                        }
                                        else if (Convert.ToInt16(addressInformation.AddressId) == 2 &&
                                                 IsErrorShipToAddress && addressCount > 1)
                                        {
                                            MessageBox.Show(Resources.STR_MESSAGE_XRM_SHIP_ADDRESS, Resources.STR_MESSAGE_TITLE, MessageBoxButtons.OK);
                                            recordsExists = true;
                                            IsErrorShipToAddress = false;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    catch (Exception exception)
                    {
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateAddressDetails Method (Exception): " + exception.Message.ToString());
                        MessageBox.Show("Error: " + exception.Message, Resources.STR_MESSAGE_TITLE);
                    }
                    finally
                    {
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ValidateAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return recordsExists;
        }

        /// <summary>
        /// Display custom address into sales user defined entry and inquiry
        /// </summary>
        /// <param name="formName">Specify form name</param>
        private void DisplayOrderTypeDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                #region WorkSOPEntry

                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                    sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                    sopEntryForm.Tables.SalesOrderTypeDetails.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SalesOrderTypeDetails.Key = 1;
                    TableError tableError = sopEntryForm.Tables.SalesOrderTypeDetails.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string orderTypeText = "";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value == true)
                            orderTypeText += "International,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value == true)
                            orderTypeText += "INAFTA,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value == true)
                            orderTypeText += "Dropship,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value == true)
                            orderTypeText += "Bulk,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value == true)
                            orderTypeText += "I3Order,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value == true)
                            orderTypeText += "Credit Card,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value == true)
                            orderTypeText += "Corrective,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value == true)
                            orderTypeText += "Full Truck Load,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value == true)
                            orderTypeText += "Consignment,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value == true)
                            orderTypeText += "Billing Only Order,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value == true)
                            orderTypeText += "Sample Order,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value == true)
                            orderTypeText += "Temp Control,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value == true)
                            orderTypeText += "Hazmat,";
                        if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value == true)
                            orderTypeText += "Freeze Protect,";


                        if (orderTypeText.Trim() != "")
                        {
                            int k = orderTypeText.ToString().LastIndexOf(",");
                            if (k > 0)
                                orderTypeText = orderTypeText.ToString().Substring(0, k);
                        }

                        if (orderTypeText.Trim() == "")
                            orderTypeText = "Standard";

                        FillScrollForOrderType(formName, orderTypeText);      // fill scrolling window
                    }
                    sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                    sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                }

                #endregion WorkSOPEntry

                #region InquirySopEntry

                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Close();
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Release();
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Key = 1;
                    TableError tableError = sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string orderTypeText = "";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value == true)
                            orderTypeText += "International,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value == true)
                            orderTypeText += "INAFTA,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value == true)
                            orderTypeText += "Dropship,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value == true)
                            orderTypeText += "Bulk,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value == true)
                            orderTypeText += "I3Order,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value == true)
                            orderTypeText += "Credit Card,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value == true)
                            orderTypeText += "Corrective,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value == true)
                            orderTypeText += "Full Truck Load,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value == true)
                            orderTypeText += "Consignment,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value == true)
                            orderTypeText += "Billing Only Order,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value == true)
                            orderTypeText += "Sample Order,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value == true)
                            orderTypeText += "Temp Control,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value == true)
                            orderTypeText += "Hazmat,";
                        if (sopEntryInquiryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value == true)
                            orderTypeText += "Freeze Protect,";


                        if (orderTypeText.Trim() != "")
                        {
                            int k = orderTypeText.ToString().LastIndexOf(",");
                            if (k > 0)
                                orderTypeText = orderTypeText.ToString().Substring(0, k);
                        }

                        if (orderTypeText.Trim() == "")
                            orderTypeText = "Standard";

                        FillScrollForOrderType(formName, orderTypeText);      // fill scrolling window
                    }
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Release();
                    sopEntryInquiryForm.Tables.SalesOrderTypeDetails.Close();
                }

                #endregion InquirySopEntry
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayOrderTypeDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Fill order type data into scrolling window
        /// </summary>
        /// <param name="formName">Specify form name</param>
        /// <param name="orderTypeText">Specify order types</param>
        private void FillScrollForOrderType(string formName, string orderTypeText)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Close();
                    sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Release();
                    TableError tableRemove = sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.ChangeFirst();
                    while (tableRemove == TableError.NoError && tableRemove != TableError.EndOfTable)
                    {
                        sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Remove();
                        tableRemove = sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.ChangeNext();
                    }
                    sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Release();
                    sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Close();

                    string[] orderTypeTemp = orderTypeText.ToString().Trim().Split(',');
                    if (orderTypeTemp.Length > 0)
                    {
                        sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Close();
                        sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Release();
                        for (int orderCnt = 0; orderCnt < orderTypeTemp.Length; orderCnt++)
                        {
                            sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.CpOrderType.Value = orderTypeTemp[orderCnt].ToString().Trim();

                            sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Save();
                        }
                        sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Release();
                        sopUserDefinedFieldEntryForm.Tables.SalesOrderTypeDetailsTemp.Close();
                    }
                    // fill invoke
                    sopUserDefinedFieldEntryForm.Procedures.OrderTypeLineScrollFill.Invoke();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Close();
                    sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Release();
                    TableError tableRemove = sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.ChangeFirst();
                    while (tableRemove == TableError.NoError && tableRemove != TableError.EndOfTable)
                    {
                        sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Remove();
                        tableRemove = sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.ChangeNext();
                    }
                    sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Release();
                    sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Close();

                    string[] orderTypeTemp = orderTypeText.ToString().Trim().Split(',');
                    if (orderTypeTemp.Length > 0)
                    {
                        sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Close();
                        sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Release();
                        for (int orderCnt = 0; orderCnt < orderTypeTemp.Length; orderCnt++)
                        {
                            sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                            sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();
                            sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.CpOrderType.Value = orderTypeTemp[orderCnt].ToString().Trim();

                            sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Save();
                        }
                        sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Release();
                        sopInquiryUserDefinedForm.Tables.SalesOrderTypeDetailsTemp.Close();
                    }
                    // fill invoke
                    sopInquiryUserDefinedForm.Procedures.OrderTypeLineScrollFill.Invoke();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In FillScrollForOrderType Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Update order type details for sales user defined entry
        /// </summary>
        /// <param name="sopType">Specify Order Type</param>
        /// <param name="sopNumber">Specify Order Number</param>
        private bool UpdateOrderTypeDetails(int sopType, string sopNumber)
        {
            StringBuilder logMessage = new StringBuilder();

            bool isChanged = false;
            try
            {
                sopEntryForm.Tables.SalesOrderTypeDetails.Close();
                sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                sopEntryForm.Tables.SalesOrderTypeDetails.SopType.Value = Convert.ToInt16(sopType);
                sopEntryForm.Tables.SalesOrderTypeDetails.SopNumber.Value = sopNumber;

                sopEntryForm.Tables.SalesOrderTypeDetails.Key = 1;
                TableError tableError = sopEntryForm.Tables.SalesOrderTypeDetails.Change();
                if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                {
                    if (sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsInternational.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsNaFta.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsDropship.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsBulk.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsI3Order.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditCard.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrective.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsConsignment.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsSampleOrder.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTempControl.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsHazmat.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFreezeProtect.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value ||
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value != orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value)
                    {
                        isChanged = true;
                    }
                    if (isChanged)
                    {
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsInternational.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsInternational.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsNaFta.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsNaFta.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsDropship.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsDropship.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsBulk.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsBulk.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsI3Order.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsI3Order.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditCard.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditCard.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrective.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrective.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFullTruckLoad.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsConsignment.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsConsignment.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCorrectiveBoo.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsSampleOrder.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsSampleOrder.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTempControl.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTempControl.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsHazmat.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsHazmat.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsFreezeProtect.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsFreezeProtect.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsAutoPtEligible.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsCreditEnginePassed.Value;
                        sopEntryForm.Tables.SalesOrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value = orderTypeDetailsForm.OrderTypeDetails.OrdTypeCbIsTaxEnginePassed.Value;

                        sopEntryForm.Tables.SalesOrderTypeDetails.IsUpdated.Value = 1;
                        sopEntryForm.Tables.SalesOrderTypeDetails.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                        sopEntryForm.Tables.SalesOrderTypeDetails.Save();
                    }
                }
                sopEntryForm.Tables.SalesOrderTypeDetails.Release();
                sopEntryForm.Tables.SalesOrderTypeDetails.Close();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In UpdateOrderTypeDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return isChanged;
        }

        /// <summary>
        /// Method to set the order type values on opening the window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopUserDefinedFieldEntry_OpenAfterOriginal(object sender, EventArgs e)
        {
            DisplayOrderTypeDetails(Resources.STR_SopEntryForm);   // load data into temp table for order type of sales user defined entry window
        }

        /// <summary>
        /// When the expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopUserDefinedFieldEntryExpansionButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (orderTypeDetailsForm.OrderTypeDetails.IsOpen)
                {
                    orderTypeDetailsForm.OrderTypeDetails.Close();
                }

                expansionWindowType = Resources.STR_SopEntryForm;

                orderTypeDetailsForm.OrderTypeDetails.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopUserDefinedFieldEntryExpansionButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion OrderType

        #region Tax Enhancement

        void AccountVatNumberListLookup_OpenAfterOriginal(object sender, EventArgs e)
        {
            if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                DisplayLookupValues(sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerNumber.Value.ToString(), 2);
        }

        /// <summary>
        /// close the vat lookup when customer entry is closed
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntry_CloseBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            if (accountVatNumberListLookupForm.IsOpen)
                accountVatNumberListLookupForm.Close();
        }

        /// <summary>
        /// reset lcoal field to empty
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AccountVatNumberListLookup_CloseAfterOriginal(object sender, EventArgs e)
        {
            isVATLookupOpen = false;
            lookupWindowType = string.Empty;
        }

        /// <summary>
        /// fire when user clicked on Ship To Address Id lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void VatReference_LookupButton12_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (!isVATLookupOpen)
                {
                    if (accountVatNumberListLookupForm.IsOpen)
                    {
                        accountVatNumberListLookupForm.Close();
                    }
                    accountVatNumberListLookupForm.Open();

                    // select the record
                    if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                    {

                        accountVatNumberListLookupForm.AccountVatNumberListLookup.RedisplayButton.RunValidate();
                    }
                    accountVatNumberListLookupForm.AccountVatNumberListLookup.LocalCallerId.Value = 1;
                    lookupWindowType = Resources.STR_TaxRegNo;
                    if (RegisterVATReferenceLookupSelect == false)
                    {
                        accountVatNumberListLookupForm.AccountVatNumberListLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(AccountVATNumberLookupSelectButton_ClickBeforeOriginal);
                        RegisterVATReferenceLookupSelect = true;
                    }
                    isVATLookupOpen = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In VatReference_LookupButton12_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event method called on selecting the address code from lookup window and value returned to from Ship To/ Bill To. Final Destination Address Id field.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AccountVATNumberLookupSelectButton_ClickBeforeOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (!string.IsNullOrEmpty(lookupWindowType))
                {
                    if (lookupWindowType == Resources.STR_TaxRegNo && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                    {
                        if (accountVatNumberListLookupForm.AccountVatNumberListLookup.LocalCallerId.Value == 1)
                        {
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxRegistrationNumber.Value = accountVatNumberListLookupForm.AccountVatNumberListLookup.VatReferenceNumber.TaxRegistrationNumber.Value.ToString();
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.TaxRegistrationNumber.RunValidate();
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsChanged = true;
                            accountVatNumberListLookupForm.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AccountVATNumberLookupSelectButton_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// When the cancel button is clicked in the lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void VatReference_CancelButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            lookupWindowType = string.Empty;
            accountVatNumberListLookupForm.Close();
        }

        void VatReference_RedisplayButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                DisplayLookupValues(sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerNumber.Value.ToString(), 2);
        }

        private void DisplayLookupValues(string Custnmbr, int id)
        {
            StringBuilder logMessage = new StringBuilder();

            SalesOrderRequest vatRequest = null;

            SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
            SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
            CustomerInformation customerInformation = new CustomerInformation();
            List<string> vatNumberList = new List<string>();
            try
            {
                vatRequest = new SalesOrderRequest();
                string vatNumber = string.Empty;
                vatNumberList.Add(vatNumber);

                if (id == 2)
                {
                    customerInformation.CustomerId = Custnmbr;
                    salesOrderInformation.Customer = customerInformation;
                    salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                    vatRequest.SalesOrderEntity = salesOrderEntity;
                    vatRequest.CompanyID = Convert.ToInt16(Dynamics.Globals.CompanyId.Value);
                    using (HttpClient client = new HttpClient())
                    {
                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                        client.DefaultRequestHeaders.Accept.Clear();
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
                        var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetVATLookupDetails/", vatRequest); // we need to refer the web.api service url here.
                        if (response.Result.IsSuccessStatusCode)
                        {
                            var vatResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                            if (vatResponse.Status == ResponseStatus.Success)
                            {
                                vatNumberList = vatResponse.SalesOrderDetails.SalesOrderDetails.Customer.VatNumber; //Customer detail Entry data response..

                                string[] vatNumberArray = vatNumberList.ToArray();

                                if (vatNumberList != null && vatNumberList.Count > 0)
                                {
                                    accountVatNumberListLookupForm.Tables.VatReferenceNumberTemp.Close();
                                    accountVatNumberListLookupForm.Tables.VatReferenceNumberTemp.Release();
                                    foreach (var vatDetail in vatNumberList)
                                    {
                                        // vatDetail.
                                        accountVatNumberListLookupForm.Tables.VatReferenceNumberTemp.TaxRegistrationNumber.Value = vatDetail;
                                        accountVatNumberListLookupForm.Tables.VatReferenceNumberTemp.Save();
                                    }

                                    accountVatNumberListLookupForm.Tables.VatReferenceNumberTemp.Close();
                                    accountVatNumberListLookupForm.Tables.VatReferenceNumberTemp.Release();
                                    //Fill details to scrolling window.Call dex procedure to fill the scrolling window.
                                    accountVatNumberListLookupForm.Procedures.AccountVatNumberLookupFormScrollFill.Invoke();
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayLookupValues Method (GetVATLookupDetails): " + vatResponse.ErrorMessage.ToString());
                                MessageBox.Show("Error: " + vatResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            }
                        }
                        else
                        {
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not fetch from custom sales details Table");
                            MessageBox.Show("Error: Data does not fetch from custom sales details Table", Resources.STR_MESSAGE_TITLE);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayLookupValues Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion tax enhancement

        #region PrintWindow

        /// <summary>
        /// When the Picking Ticket checkbox of Sales document print options window is changed
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalPrintPickingTicketCb_Change(object sender, EventArgs e)
        {
            HideGpPrintButton();
        }

        /// <summary>
        /// When the Sales document print options window is opened
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopPrintOptions_OpenAfterOriginal(object sender, EventArgs e)
        {
            HideGpPrintButton();
        }

        /// <summary>
        /// When the print button of Sales document print options window is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpPickTicket_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                //Update the sopstatus after printing pick ticket
                if (sopPrintOptionsForm.SopPrintOptions.SopType.Value == 6 &&
                    sopPrintOptionsForm.SopPrintOptions.SopNumber.Value.Trim() != string.Empty)
                {
                    UpdateSopStatus(sopPrintOptionsForm.SopPrintOptions.SopNumber.Value, sopPrintOptionsForm.SopPrintOptions.SopType.Value);
                }
                //HP 69194 fix end
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpPickTicket_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error while printing pick ticket: " + ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Hide GP print button and replace with custom print button that opens DRM report
        /// </summary>
        void HideGpPrintButton()
        {
            if (sopPrintOptionsForm.SopPrintOptions.LocalPrintPickingTicketCb.Value == true)
            {
                sopPrintOptionsForm.SopPrintOptions.PrintButtonNone.Hide();
                sopPrintOptionsForm.SopPrintOptions.CpPickTicket.Show();
            }
            else
            {
                sopPrintOptionsForm.SopPrintOptions.CpPickTicket.Hide();
                sopPrintOptionsForm.SopPrintOptions.PrintButtonNone.Show();
            }
        }

        //TODO
        /// <summary>
        /// Update the Sop status after printing is done
        /// </summary>
        void UpdateSopStatus(string sopNumber, short sopType)
        {
            StringBuilder logMessage = new StringBuilder();
            SalesOrderRequest salesOrderRequest = null;
            try
            {
                SalesOrderEntity salesOrderEntity = new SalesOrderEntity();

                salesOrderEntity.SopType = sopType;
                salesOrderEntity.SopNumber = sopNumber;
                salesOrderRequest = new SalesOrderRequest();
                salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                salesOrderEntity.SopType = sopType;
                salesOrderEntity.SopNumber = sopNumber;
                salesOrderRequest.SalesOrderEntity = salesOrderEntity;
                // Service call ...
                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/UpdatePrintPickTicketStatus/", salesOrderRequest); // we need to refer the web.api service url here.

                    if (response.Result.IsSuccessStatusCode)
                    {
                        SalesOrderResponse salesItemDetailResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                        if (salesItemDetailResponse.Status == ResponseStatus.Error)
                        {
                            MessageBox.Show("Error: " + salesItemDetailResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In UpdateSopStatus Method (UpdatePrintPickTicketStatus): " + salesItemDetailResponse.ErrorMessage.ToString());
                        }
                    }
                    else
                    {
                        MessageBox.Show("Error: Data does not update to sales order status", Resources.STR_MESSAGE_TITLE);
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not update to sales order status");
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In UpdateSopStatus Method: " + ex.Message.ToString());
                MessageBox.Show("Error: Data does not update to sales order status: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion PrintWindow

        #region DateChange

        /// <summary>
        /// Method to load the Cur Sched Ship date to Sales Date entry.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ExpansionButton2ClickAfterOriginal(object sender, EventArgs e)
        {
            if (sopDateEntryForm.SopDateEntry.IsOpen)
                sopDateEntryForm.SopDateEntry.RequestedShipDate.Value = sopEntryForm.SopEntry.CpReqShipDate.Value;
        }

        #endregion DateChange

        #region OpenInXRM

        /// <summary>
        /// Open Sales Order IN XRM...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OpenXrm_ClickAfterOriginal(object sender, EventArgs e)
        {
            OpenOrderInXRM(Resources.STR_SopEntryForm);
        }

        /// <summary>
        /// Open Quote in XRM
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OpenQuote_ClickAfterOriginal(object sender, EventArgs e)
        {
            OpenQuoteInXRM(Resources.STR_SopItemDetailForm);
        }

        /// <summary>
        /// OPen Customer In XRM.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OpenCustomer_ClickAfterOriginal(object sender, EventArgs e)
        {
            OpenCustomerInXRM(Resources.STR_SalesCustomerDetailForm);
        }

        /// <summary>
        /// Open Sales Order in XRM.
        /// </summary>
        /// <param name="formName"></param>
        private void OpenOrderInXRM(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopEntryForm)
                {
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {

                        if (!string.IsNullOrEmpty(sopEntryForm.Tables.SopCustomerDetailTransportationTemp.OrderGuid.Value.ToString().Trim()))
                        {

                            Process.Start("IExplore.exe", xrmOrderURL + sopEntryForm.Tables.SopCustomerDetailTransportationTemp.OrderGuid.Value.ToString().Trim());
                        }
                        else
                        {
                            MessageBox.Show("SalesOrder (" + sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() + ") not available in XRM");
                        }
                    }

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                }
                else if (formName == Resources.STR_SopInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {

                        if (!string.IsNullOrEmpty(sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.OrderGuid.Value.ToString().Trim()))
                        {

                            Process.Start("IExplore.exe", xrmOrderURL + sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.OrderGuid.Value.ToString().Trim());
                        }
                        else
                        {
                            MessageBox.Show("SalesOrder (" + sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim() + ") not available in XRM");
                        }
                    }

                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OpenOrderInXRM Method: " + ex.Message.ToString());
                MessageBox.Show("Error: Open  order in XRM " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Open Quote in XRM
        /// </summary>
        /// <param name="formName"></param>
        private void OpenQuoteInXRM(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SopItemDetailForm)
                {
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = sopItemDetailForm.SopItemDetail.LineItemSequence.Value;
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = sopItemDetailForm.SopItemDetail.ComponentSequence.Value;

                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Key = 1;
                    TableError tableErrorQuote = sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Get();
                    if (tableErrorQuote == TableError.NoError && tableErrorQuote != TableError.EndOfTable)
                    {
                        if (!string.IsNullOrEmpty(sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteGuid.Value.ToString().Trim()))
                        {

                            Process.Start("IExplore.exe", xrmQuoteURL + sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteGuid.Value.ToString().Trim());
                        }
                        else
                        {
                            MessageBox.Show("Quote not available in XRM");
                        }
                    }
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                    sopItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                }
                else if (formName == Resources.STR_SopItemInquiryForm)
                {
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.LineItemSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value;
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.ComponentSequence.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.ComponentSequence.Value;

                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Key = 1;
                    TableError tableErrorQuote = sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Get();
                    if (tableErrorQuote == TableError.NoError && tableErrorQuote != TableError.EndOfTable)
                    {
                        if (!string.IsNullOrEmpty(sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteGuid.Value.ToString().Trim()))
                        {

                            Process.Start("IExplore.exe", xrmQuoteURL + sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.QuoteGuid.Value.ToString().Trim());
                        }
                        else
                        {
                            MessageBox.Show("Quote not available in XRM");
                        }
                    }
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Release();
                    sopInquiryItemDetailForm.Tables.SopItemDetailsQuoteTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OpenQuoteInXRM Method: " + ex.Message.ToString());
                MessageBox.Show("Error: Open quote in XRM " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Open Customer in XRM...
        /// </summary>
        /// <param name="p"></param>
        private void OpenCustomerInXRM(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        if (!string.IsNullOrEmpty(sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomerGuid.Value.ToString().Trim()))
                        {

                            Process.Start("IExplore.exe", xrmCustomerURL + sopEntryForm.Tables.SopCustomerDetailTransportationTemp.CustomerGuid.Value.ToString().Trim());
                        }
                        else
                        {
                            MessageBox.Show("Customer is not available in XRM");
                        }
                    }
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                }
                else if (formName == Resources.STR_SopCustomerDetailInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Key = 1;
                    TableError tableErrorTransportation = sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Get();
                    if (tableErrorTransportation == TableError.NoError && tableErrorTransportation != TableError.EndOfTable)
                    {
                        if (!string.IsNullOrEmpty(sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomerGuid.Value.ToString().Trim()))
                        {

                            Process.Start("IExplore.exe", xrmCustomerURL + sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.CustomerGuid.Value.ToString().Trim());
                        }
                        else
                        {
                            MessageBox.Show("Customer is not available in XRM");
                        }
                    }
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Release();
                    sopEntryInquiryForm.Tables.SopCustomerDetailTransportationTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OpenCustomerInXRM Method: " + ex.Message.ToString());
                MessageBox.Show("Error: Open customer in XRM " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion OpeninXRM

        #region QuoteLookup

        /// <summary>
        /// Method fired on before opening the Quote lookup window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void QuoteLookup_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (RegisterQuoteLookupSelect == false)
                {
                    quoteWindowLookupForm.QuoteLookup.CloseAfterOriginal += new EventHandler(QuoteLookup_CloseAfterOriginal);
                    quoteWindowLookupForm.QuoteLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(QuoteLookupSelectButton_ClickBeforeOriginal);
                    quoteWindowLookupForm.QuoteLookup.CancelButton.ClickAfterOriginal += new EventHandler(QuoteLookupCancelButton_ClickAfterOriginal);

                    RegisterQuoteLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In QuoteLookup_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event fired when closing the Quote lookup window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void QuoteLookup_CloseAfterOriginal(object sender, EventArgs e)
        {
            lookupWindowType = string.Empty;
        }

        /// <summary>
        /// When the cancel button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void QuoteLookupCancelButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(lookupWindowType))
                {
                    if (lookupWindowType == Resources.STR_SopItemDetailForm)
                    {
                        quoteWindowLookupForm.QuoteLookup.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In QuoteLookupCancelButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method to load quote number on opening the window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void QuoteLookup_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            bool recordsExists = false;
            try
            {
                if (!String.IsNullOrEmpty(lookupWindowType))
                {
                    if (lookupWindowType == Resources.STR_SopItemDetailForm)
                    {
                        SalesOrderRequest quoteLookupRequest = new SalesOrderRequest();
                        SalesOrderResponse quoteLookupResponse = new SalesOrderResponse();
                        SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                        SalesOrderDetails salesOrderDetail = new SalesOrderDetails();
                        CustomerInformation customerInformation = new CustomerInformation();
                        WarehouseInformation warehouseInformation = new WarehouseInformation();
                        SalesLineItem lineItem = new SalesLineItem();
                        List<SalesLineItem> lineItemList = new List<SalesLineItem>();

                        try
                        {
                            customerInformation.CustomerId = sopItemDetailForm.SopItemDetail.CustomerNumber.Value.ToString().Trim();
                            lineItem.ItemNumber = sopItemDetailForm.SopItemDetail.ItemNumber.Value.ToString().Trim();
                            warehouseInformation.WarehouseId = sopItemDetailForm.SopItemDetail.LocationCode.Value.ToString().Trim();
                            quoteLookupRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                            lineItemList.Add(lineItem);
                            salesOrderDetail.LineItems = lineItemList;
                            salesOrderInformation.SalesOrderDetails = salesOrderDetail;
                            salesOrderInformation.Customer = customerInformation;
                            salesOrderInformation.Warehouse = warehouseInformation;
                            salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                            quoteLookupRequest.SalesOrderEntity = salesOrderEntity;

                            //Service Call
                            using (HttpClient client = new HttpClient())
                            {
                                client.BaseAddress = new Uri(gpServiceConfigurationURL);
                                client.DefaultRequestHeaders.Accept.Clear();
                                client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                                var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetQuoteNumber", quoteLookupRequest); // we need to refer the web.api service url here.
                                if (response.Result.IsSuccessStatusCode)
                                {
                                    quoteLookupResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                    if (quoteLookupResponse.Status == ResponseStatus.Success)
                                    {
                                        recordsExists = true;
                                    }
                                    else
                                    {
                                        recordsExists = false;
                                        MessageBox.Show("Error: " + quoteLookupResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In QuoteLookup_OpenAfterOriginal Method (GetQuoteNumber): " + quoteLookupResponse.ErrorMessage.ToString());
                                    }
                                }
                                else
                                {
                                    recordsExists = false;
                                    MessageBox.Show("Error: Data does not Fetch Quote Master Lookup Table", Resources.STR_MESSAGE_TITLE);
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not Fetch Quote Master Lookup Table");
                                }
                            }

                            if (quoteLookupResponse != null && recordsExists && quoteLookupResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.LineItems != null)
                            {
                                quoteWindowLookupForm.Tables.QuoteDetailTemp.Close();
                                quoteWindowLookupForm.Tables.QuoteDetailTemp.Release();

                                foreach (var quoteLookup in quoteLookupResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.LineItems)
                                {
                                    quoteWindowLookupForm.Tables.QuoteDetailTemp.Release();
                                    quoteWindowLookupForm.Tables.QuoteDetailTemp.PcbSopLineQuoteNmbr.Value = quoteLookup.QuoteNumber.ToString().Trim();
                                    quoteWindowLookupForm.Tables.QuoteDetailTemp.QuoteVersion.Value = Convert.ToInt16(quoteLookup.QuoteNumberVersion);
                                    quoteWindowLookupForm.Tables.QuoteDetailTemp.QuoteGuid.Value = quoteLookup.QuoteGuid;
                                    quoteWindowLookupForm.Tables.QuoteDetailTemp.Save();
                                }
                                quoteWindowLookupForm.Tables.QuoteDetailTemp.Release();
                                quoteWindowLookupForm.Tables.QuoteDetailTemp.Close();

                                quoteWindowLookupForm.Procedures.QuoteWindowLookupFormScrollFill.Invoke();
                            }
                        }
                        catch (Exception exception)
                        {
                            MessageBox.Show("Error: " + exception.Message, Resources.STR_MESSAGE_TITLE);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In QuoteLookup_OpenAfterOriginal Method (Exception): " + exception.Message.ToString());
                        }
                        finally
                        {
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In QuoteLookup_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event method called on selecting the quote number and version number from lookup window and value returned to from Quote Number/ version number field.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void QuoteLookupSelectButton_ClickBeforeOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(lookupWindowType))
                {
                    if (lookupWindowType == Resources.STR_SopItemDetailForm && sopItemDetailForm.SopItemDetail.IsOpen)
                    {
                        if (quoteWindowLookupForm.QuoteLookup.QuoteDetailScrollWindow.PcbSopLineQuoteNmbr.Value.ToString().Trim() != "")
                        {
                            sopItemDetailForm.SopItemDetail.PcbSopLineQuoteNmbr.Value = quoteWindowLookupForm.QuoteLookup.QuoteDetailScrollWindow.PcbSopLineQuoteNmbr.Value.ToString();
                            sopItemDetailForm.SopItemDetail.QuoteVersion.Value = quoteWindowLookupForm.QuoteLookup.QuoteDetailScrollWindow.QuoteVersion.Value;
                            sopItemDetailForm.SopItemDetail.QuoteGuid.Value = quoteWindowLookupForm.QuoteLookup.QuoteDetailScrollWindow.QuoteGuid.Value;

                            ResetItemDetails(Resources.STR_SopItemDetailForm, Resources.STR_SopItemQuoteInfo);
                        }
                        quoteWindowLookupForm.QuoteLookup.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In QuoteLookupSelectButton_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// fire when user clicked on warehoures comment lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailLookupButton11_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (quoteWindowLookupForm.QuoteLookup.IsOpen)
                {
                    quoteWindowLookupForm.QuoteLookup.Close();
                }

                lookupWindowType = Resources.STR_SopItemDetailForm;

                quoteWindowLookupForm.QuoteLookup.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopItemDetailLookupButton11_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// fire when user clicked on internal comment lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopItemDetailLookupButton7_ClickAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
            lookupWindowType = string.Empty;
        }

        #endregion QuoteLookup

        #region SalesLotDetails

        void ExpansionButtons3_ClickAfterOriginal(object sender, EventArgs e)
        {
            // checks if the soptype is 1(quote), 2(order) and 5(BO). If so, displays a message 
            if (Dynamics.Globals.CompanyId.Value == 2)
            {
                MessageBox.Show("This window does not support for this company.");
            }
            else if (sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value == 1 ||
                     sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value == 2 ||
                     sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value == 5)
                MessageBox.Show("This window does not support for this SopType.");
            else
            {
                StringBuilder logMessage = new StringBuilder();

                try
                {
                    // opens the salesLotInfo form
                    if (salesLotInfo == null)
                        salesLotInfo = new GP_Lot_Info();
                    else if (salesLotInfo.Created == false)
                    {
                        salesLotInfo = new GP_Lot_Info();
                    }

                    // registers the form close event
                    salesLotInfo.FormClosing += new System.Windows.Forms.FormClosingEventHandler(SalesLotInfo_FormClosing);
                    // Always show and activate the WinForm
                    salesLotInfo.SetDesktopLocation(300, 200);

                    //Check whether the required fileds are entered before opening the window
                    if (sopItemDetailForm.SopItemDetail.ItemNumber.Value == "" ||
                        sopItemDetailForm.SopItemDetail.LineItemSequence.Value.ToString() == "")
                    {
                        MessageBox.Show("Please select the record in Sales Line Detail Form(Sales Entry).", "Microsoft Dynamics GP", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }
                    else
                    {
                        salesLotInfo.Show();
                        salesLotInfo.Activate();
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ExpansionButtons3_ClickAfterOriginal Method: " + ex.Message.ToString());
                    MessageBox.Show("Error while opening Sales Lot Info form: " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }

        void ExpansionButton3Inq_ClickAfterOriginal(object sender, EventArgs e)
        {
            // checks if the soptype is 1(quote), 2(order) and 5(BO). If so, displays a message 
            if (Dynamics.Globals.CompanyId.Value == 2)
            {
                MessageBox.Show("This window does not support for this company.");
            }
            else if (sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value == 1 ||
                     sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value == 2 ||
                     sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value == 5)
                MessageBox.Show("This window does not support for this SopType.");
            else
            {
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    // opens the salesLotInquiry form
                    if (salesLotInquiry == null)
                        salesLotInquiry = new GP_Lot_Inquiry();
                    else if (salesLotInquiry.Created == false)
                    {
                        salesLotInquiry = new GP_Lot_Inquiry();
                    }

                    // registers the form close event
                    salesLotInquiry.FormClosing += new System.Windows.Forms.FormClosingEventHandler(salesLotInquiry_FormClosing);
                    // Always show and activate the WinForm
                    salesLotInquiry.SetDesktopLocation(300, 200);

                    //Check whether the required fileds are entered before opening the window
                    if (sopInquiryItemDetailForm.SopInquiryItemDetail.ItemNumber.Value == "" ||
                        sopInquiryItemDetailForm.SopInquiryItemDetail.LineItemSequence.Value.ToString() == "")
                    {
                        MessageBox.Show("Please select the record in Sales Line Detail Inquiry Form.", "Microsoft Dynamics GP", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }
                    else
                    {
                        salesLotInquiry.Show();
                        salesLotInquiry.Activate();
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ExpansionButton3Inq_ClickAfterOriginal Method: " + ex.Message.ToString());
                    MessageBox.Show("Error while opening Sales Lot Info form (Inquiry): " + ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                    logMessage = null;
                }
            }
        }

        void SalesLotInfo_FormClosing(object sender, System.Windows.Forms.FormClosingEventArgs e)
        {
            if (salesLotInfo != null)
                salesLotInfo = null;
        }

        void salesLotInquiry_FormClosing(object sender, System.Windows.Forms.FormClosingEventArgs e)
        {
            if (salesLotInquiry != null)
                salesLotInquiry = null;
        }

        #endregion SalesLotDetails

        #region CustomerPickUpDetailForm

        /// <summary>
        /// Customer Pickup Address Open before original
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CustomerPickupAddress_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (RegisterCustomerPickupAddressDetails == false)
                {
                    customerPickupAddressDetailsForm.CustomerPickupAddress.CloseAfterOriginal += CustomerPickupAddress_CloseAfterOriginal;
                    customerPickupAddressDetailsForm.CustomerPickupAddress.SaveButton.ClickAfterOriginal += CustomerPickupAddressSave_ClickAfterOriginal;
                    customerPickupAddressDetailsForm.CustomerPickupAddress.ClearButton.ClickAfterOriginal += CustomerPickupAddressClear_ClickAfterOriginal;
                    customerPickupAddressDetailsForm.CustomerPickupAddress.CancelButton.ClickAfterOriginal += CustomerPickupAddressCancel_ClickAfterOriginal;
                    RegisterCustomerPickupAddressDetails = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerPickupAddress_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// customer Pickup Clear
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void CustomerPickupAddressClear_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                customerPickupAddressDetailsForm.CustomerPickupAddress.ContactPerson.Clear();
                customerPickupAddressDetailsForm.CustomerPickupAddress.Address1.Clear();
                customerPickupAddressDetailsForm.CustomerPickupAddress.Address2.Clear();
                customerPickupAddressDetailsForm.CustomerPickupAddress.Address3.Clear();
                customerPickupAddressDetailsForm.CustomerPickupAddress.City.Clear();
                customerPickupAddressDetailsForm.CustomerPickupAddress.State.Clear();
                customerPickupAddressDetailsForm.CustomerPickupAddress.ZipCode.Clear();
                customerPickupAddressDetailsForm.CustomerPickupAddress.Country.Clear();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerPickupAddressClear_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Customer Pickup cancel
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void CustomerPickupAddressCancel_ClickAfterOriginal(object sender, EventArgs e)
        {
            customerPickupAddressDetailsForm.CustomerPickupAddress.Close();
        }

        /// <summary>
        /// Customer Pickup Save
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void CustomerPickupAddressSave_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(expansionWindowType))
                {
                    if (expansionWindowType == Resources.STR_SalesCustomerDetailForm)
                    {
                        bool isChanged = UpdateCustomerPickupAddressDetails(Resources.STR_SalesCustomerDetailForm,
                            sopEntryForm.SopEntry.SopTypeDatabase.Value,
                            sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.CustomerNumber.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.ContactPerson.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.Address1.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.Address2.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.Address3.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.City.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.State.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.ZipCode.Value.ToString().Trim(),
                            customerPickupAddressDetailsForm.CustomerPickupAddress.Country.Value.ToString().Trim());

                        if (isChanged)
                        {
                            bool saveResult = SaveCustomerPickupAddressDetails(expansionWindowType); // save data into third party address table 
                            if (saveResult && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                                DisplayCustomerPickupAddress(expansionWindowType);
                        }

                        customerPickupAddressDetailsForm.CustomerPickupAddress.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerPickupAddressSave_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void CustomerPickupAddress_CloseAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
        }

        /// <summary>
        /// Customer Pickup Open After Original
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CustomerPickupAddress_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (expansionWindowType == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SalesPickupAddressTemp.Key = 1;
                    TableError tableError = sopEntryForm.Tables.SalesPickupAddressTemp.Get();

                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        customerPickupAddressDetailsForm.CustomerPickupAddress.SopNumber.Value = sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.SopTypeDatabase.Value = sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value;

                        customerPickupAddressDetailsForm.CustomerPickupAddress.ContactPerson.Value = sopEntryForm.Tables.SalesPickupAddressTemp.ContactPerson.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.Address1.Value = sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.Address2.Value = sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.Address3.Value = sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.City.Value = sopEntryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.State.Value = sopEntryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.ZipCode.Value = sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.Country.Value = sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim();
                    }
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();

                }
                else if (expansionWindowType == Resources.STR_SopCustomerDetailInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Key = 1;
                    TableError tableError = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Get();

                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        customerPickupAddressDetailsForm.CustomerPickupAddress.SopNumber.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopNumber.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.SopTypeDatabase.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopType.Value;

                        customerPickupAddressDetailsForm.CustomerPickupAddress.ContactPerson.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ContactPerson.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.Address1.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.Address2.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.Address3.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.City.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.State.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.ZipCode.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim();
                        customerPickupAddressDetailsForm.CustomerPickupAddress.Country.Value = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim();
                    }
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();

                    customerPickupAddressDetailsForm.CustomerPickupAddress.ContactPerson.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.Address1.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.Address2.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.Address3.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.City.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.State.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.ZipCode.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.Country.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.SaveButton.Lock();
                    customerPickupAddressDetailsForm.CustomerPickupAddress.ClearButton.Lock();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerPickupAddress_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Display Customer pickup Address in customer detail entry window
        /// </summary>
        /// <param name="formName"></param>
        private void DisplayCustomerPickupAddress(string formName)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    #region 3rdParth

                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SalesPickupAddressTemp.Key = 1;
                    TableError tableError = sopEntryForm.Tables.SalesPickupAddressTemp.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string pickUpAddressText = "";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim() + ",";

                        if (pickUpAddressText.Trim() != "")
                        {
                            int k = pickUpAddressText.ToString().LastIndexOf(",");
                            if (k > 0)
                                pickUpAddressText = pickUpAddressText.ToString().Substring(0, k);
                        }
                        sopCustomerDetailEntryForm.SopCustomerDetailEntry.CustomerPickupAddress.Value = pickUpAddressText;
                    }
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                }
                else if (formName == Resources.STR_SopItemDetailForm)
                {
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value = sopItemDetailForm.SopItemDetail.SopTypeDatabase.Value;
                    sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = sopItemDetailForm.SopItemDetail.SopNumber.Value.ToString().Trim();

                    sopEntryForm.Tables.SalesPickupAddressTemp.Key = 1;
                    TableError tableError = sopEntryForm.Tables.SalesPickupAddressTemp.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string pickUpAddressText = "";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim() + ",";
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim() + ",";

                        if (pickUpAddressText.Trim() != "")
                        {
                            int k = pickUpAddressText.ToString().LastIndexOf(",");
                            if (k > 0)
                                pickUpAddressText = pickUpAddressText.ToString().Substring(0, k);
                        }
                        sopItemDetailForm.SopItemDetail.CustomerPickupAddress.Value = pickUpAddressText;
                    }
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();

                    #endregion 3rdParty
                }
                else if (formName == Resources.STR_SopCustomerDetailInquiryForm)
                {
                    #region 3rdParth

                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopType.Value = sopEntryInquiryForm.SopInquiry.SopType.Value;
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = sopEntryInquiryForm.SopInquiry.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Key = 1;
                    TableError tableError = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string pickUpAddressText = "";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim() + ",";

                        if (pickUpAddressText.Trim() != "")
                        {
                            int k = pickUpAddressText.ToString().LastIndexOf(",");
                            if (k > 0)
                                pickUpAddressText = pickUpAddressText.ToString().Substring(0, k);
                        }
                        sopInquiryCustomerDetailForm.SopInquiryCustomerDetail.CustomerPickupAddress.Value = pickUpAddressText;
                    }
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();
                }
                else if (formName == Resources.STR_SopItemInquiryForm)
                {
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopType.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopType.Value;
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = sopInquiryItemDetailForm.SopInquiryItemDetail.SopNumber.Value.ToString().Trim();

                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Key = 1;
                    TableError tableError = sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Get();
                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        string pickUpAddressText = "";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim() + ",";
                        if (sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim() != "")
                            pickUpAddressText += sopEntryInquiryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim() + ",";

                        if (pickUpAddressText.Trim() != "")
                        {
                            int k = pickUpAddressText.ToString().LastIndexOf(",");
                            if (k > 0)
                                pickUpAddressText = pickUpAddressText.ToString().Substring(0, k);
                        }
                        sopInquiryItemDetailForm.SopInquiryItemDetail.CustomerPickupAddress.Value = pickUpAddressText;
                    }
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryInquiryForm.Tables.SalesPickupAddressTemp.Close();

                    #endregion 3rdParty
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayCustomerPickupAddress Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Update Customer address details for sales item detail entry
        /// </summary>
        /// <param name="sopType">Specify Order Type</param>
        /// <param name="sopNumber">Specify Order Number</param>
        private bool UpdateCustomerPickupAddressDetails(string formName, int sopType, string sopNumber,
            string customerID, string contactPerson, string address1, string address2, string address3, string city, string state, string zipCode, string country)
        {
            StringBuilder logMessage = new StringBuilder();

            bool isChanged = false;
            try
            {
                if (formName == Resources.STR_SalesCustomerDetailForm)
                {
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value = Convert.ToInt16(sopType);
                    sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = sopNumber;
                    sopEntryForm.Tables.SalesPickupAddressTemp.Key = 1;
                    TableError tableError = sopEntryForm.Tables.SalesPickupAddressTemp.Change();

                    if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                    {
                        if (

                            sopEntryForm.Tables.SalesPickupAddressTemp.ContactPerson.Value != contactPerson.ToString().Trim() ||
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value != address1.ToString().Trim() ||
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value != address2.ToString().Trim() ||
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value != address3.ToString().Trim() ||
                            sopEntryForm.Tables.SalesPickupAddressTemp.City.Value != city.ToString().Trim() ||
                            sopEntryForm.Tables.SalesPickupAddressTemp.State.Value != state.ToString().Trim() ||
                            sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value != zipCode.ToString().Trim() ||
                            sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value != country.ToString().Trim()

                        )
                        {
                            isChanged = true;
                        }
                        if (isChanged)
                        {

                            sopEntryForm.Tables.SalesPickupAddressTemp.ContactPerson.Value = contactPerson.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value = address1.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value = address2.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value = address3.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.City.Value = city.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.State.Value = state.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value = zipCode.ToString().Trim();
                            sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value = country.ToString().Trim();

                            sopEntryForm.Tables.SalesPickupAddressTemp.IsUpdated.Value = 1;
                            sopEntryForm.Tables.SalesPickupAddressTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                            sopEntryForm.Tables.SalesPickupAddressTemp.Save();
                        }
                    }
                    else if (tableError == TableError.NotFound)
                    {
                        sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value = Convert.ToInt16(sopType);
                        sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value = sopNumber;

                        sopEntryForm.Tables.SalesPickupAddressTemp.ContactPerson.Value = contactPerson.ToString().Trim();
                        sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value = address1.ToString().Trim();
                        sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value = address2.ToString().Trim();
                        sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value = address3.ToString().Trim();
                        sopEntryForm.Tables.SalesPickupAddressTemp.City.Value = city.ToString().Trim();
                        sopEntryForm.Tables.SalesPickupAddressTemp.State.Value = state.ToString().Trim();
                        sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value = zipCode.ToString().Trim();
                        sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value = country.ToString().Trim();
                        sopEntryForm.Tables.SalesPickupAddressTemp.ThirdPartyAddressId.Value = 0;
                        sopEntryForm.Tables.SalesPickupAddressTemp.IsUpdated.Value = 1;
                        sopEntryForm.Tables.SalesPickupAddressTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                        sopEntryForm.Tables.SalesPickupAddressTemp.Save();

                        isChanged = true;
                    }

                    sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                    sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In UpdateCustomerPickupAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return isChanged;
        }

        /// <summary>
        /// save custom ThirdParty Address details ...
        /// </summary>
        /// <param name="formName">Specify form name</param>
        private bool SaveCustomerPickupAddressDetails(string formName)
        {
            StringBuilder logMessage = new StringBuilder();

            bool isResult = false;
            AddressInformation _addressInformation = new AddressInformation(); // Customer Pickup Address 

            try
            {
                SalesOrderRequest _salesOrderRequest = new SalesOrderRequest();     // Customer Pick up address request...
                SalesOrderEntity _salesOrderEntity = new SalesOrderEntity();
                SalesOrderInformation _salesOrderInformation = new SalesOrderInformation();
                SalesOrderDetails _salesOrderDetails = new SalesOrderDetails();
                OrderHeader _orderHeader = new OrderHeader();
                AuditInformation _auditInformation = new AuditInformation();

                sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                sopEntryForm.Tables.SalesPickupAddressTemp.Release();
                _salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                TableError tableError = sopEntryForm.Tables.SalesPickupAddressTemp.GetFirst();
                while (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                {
                    if (sopEntryForm.Tables.SalesPickupAddressTemp.SopNumber.Value.ToString().Trim() == sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim() &&
                        sopEntryForm.Tables.SalesPickupAddressTemp.SopType.Value == sopEntryForm.SopEntry.SopTypeDatabase.Value
                    )
                    {
                        if (sopEntryForm.Tables.SalesPickupAddressTemp.IsUpdated.Value == 1)   // Fetch only update records and pass it to save procedure
                        {
                            _salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                            _salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                            _addressInformation.AddressId = sopEntryForm.Tables.SalesPickupAddressTemp.ThirdPartyAddressId.Value;
                            _addressInformation.ContactName = sopEntryForm.Tables.SalesPickupAddressTemp.ContactPerson.Value.ToString().Trim();
                            _addressInformation.AddressLine1 = sopEntryForm.Tables.SalesPickupAddressTemp.Address1.Value.ToString().Trim();
                            _addressInformation.AddressLine2 = sopEntryForm.Tables.SalesPickupAddressTemp.Address2.Value.ToString().Trim();
                            _addressInformation.AddressLine3 = sopEntryForm.Tables.SalesPickupAddressTemp.Address3.Value.ToString().Trim();
                            _addressInformation.City = sopEntryForm.Tables.SalesPickupAddressTemp.City.Value.ToString().Trim();
                            _addressInformation.State = sopEntryForm.Tables.SalesPickupAddressTemp.State.Value.ToString().Trim();

                            _addressInformation.ZipCode = sopEntryForm.Tables.SalesPickupAddressTemp.ZipCode.Value.ToString().Trim();
                            _addressInformation.Country = sopEntryForm.Tables.SalesPickupAddressTemp.Country.Value.ToString().Trim();

                            _auditInformation.ModifiedBy = Dynamics.Globals.UserId.Value.ToString().Trim();
                            _auditInformation.CompanyId = Dynamics.Globals.CompanyId.Value;
                        }
                    }
                    tableError = sopEntryForm.Tables.SalesPickupAddressTemp.GetNext();
                }
                sopEntryForm.Tables.SalesPickupAddressTemp.Release();

                sopEntryForm.Tables.SalesPickupAddressTemp.Close();
                _orderHeader.CustomerPickupAddress = _addressInformation;
                _salesOrderDetails.AuditInformation = _auditInformation;
                _salesOrderDetails.OrderHeader = _orderHeader;
                _salesOrderInformation.SalesOrderDetails = _salesOrderDetails;
                _salesOrderEntity.SalesOrderDetails = _salesOrderInformation;
                _salesOrderRequest.SalesOrderEntity = _salesOrderEntity;

                // Service call ...
                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderUpdate/SaveCustomerPickupAddress/", _salesOrderRequest); // we need to refer the web.api service url here.

                    if (response.Result.IsSuccessStatusCode)
                    {
                        SalesOrderResponse _salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                        if (_salesOrderResponse.Status == ResponseStatus.Success)
                        {
                            isResult = true;
                        }
                        else
                        {
                            isResult = false;
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveCustomerPickupAddressDetails Method (SaveCustomerPickupAddress): " + _salesOrderResponse.ErrorMessage.ToString());
                            MessageBox.Show("Error: " + _salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                        }
                    }
                    else
                    {
                        isResult = false;
                        MessageBox.Show("Error: Data does not saved into custom sales details Table", Resources.STR_MESSAGE_TITLE);
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SaveCustomerPickupAddressDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
            return isResult;
        }

        /// <summary>
        /// Customer pick up Address Expansion button is clicked
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailExpansionButton7_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (customerPickupAddressDetailsForm.CustomerPickupAddress.IsOpen)
                {
                    customerPickupAddressDetailsForm.CustomerPickupAddress.Close();
                }

                expansionWindowType = Resources.STR_SalesCustomerDetailForm;

                customerPickupAddressDetailsForm.CustomerPickupAddress.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailExpansionButton7_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion CustomerPickUpDetailForm

        #region IncoTerms

        /// <summary>
        /// fire when user clicked on warehoures comment lookup
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopCustomerDetailEntryIncoLookup_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (incoTermLookupForm.InCoTermsLookup.IsOpen)
                {
                    incoTermLookupForm.InCoTermsLookup.Close();
                }

                lookupWindowType = Resources.STR_SalesCustomerDetailForm;

                incoTermLookupForm.InCoTermsLookup.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryIncoLookup_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// IncoTerm value selection for Custoemr Detail Entry window...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void InCoTermsLookup_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (RegisterincoTermLookupSelect == false)
                {
                    incoTermLookupForm.InCoTermsLookup.CloseAfterOriginal += InCoTermsLookup_CloseAfterOriginal;
                    incoTermLookupForm.InCoTermsLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(InCoTermsLookupSelectButton_ClickBeforeOriginal);
                    incoTermLookupForm.InCoTermsLookup.CancelButton.ClickAfterOriginal += IncoTermCancelButton_ClickAfterOriginal;

                    RegisterincoTermLookupSelect = true;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InCoTermsLookup_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Display custom address into sales customer details entry screen
        /// </summary>
        /// <param name="formName">Specify Form Name</param>
        /// <param name="addressCode">Specify address code</param>
        private void DisplayIncoTermDetails()
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                SalesOrderRequest inCoTermsRequest = new SalesOrderRequest();
                SalesOrderResponse inCoTermsResponse = new SalesOrderResponse();

                try
                {
                    bool recordsExists = false;

                    inCoTermsRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                    //Service Call
                    using (HttpClient client = new HttpClient())
                    {
                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                        client.DefaultRequestHeaders.Accept.Clear();
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                        var response = client.PostAsJsonAsync("api/SalesOrderUpdate/FetchIncoTerm", inCoTermsRequest); // we need to refer the web.api service url here.
                        if (response.Result.IsSuccessStatusCode)
                        {
                            inCoTermsResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                            if (inCoTermsResponse.Status == ResponseStatus.Success)
                            {
                                recordsExists = true;
                            }
                            else
                            {
                                recordsExists = false;
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayIncoTermDetails Method (FetchIncoTerm): " + inCoTermsResponse.ErrorMessage.ToString());
                                MessageBox.Show("Error: " + inCoTermsResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            }
                        }
                        else
                        {
                            recordsExists = false;
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Data does not Fetch Inco Term Lookup Table");
                            MessageBox.Show("Error: Data does not Fetch Inco Term Lookup Table", Resources.STR_MESSAGE_TITLE);
                        }
                    }

                    if (inCoTermsResponse != null && recordsExists && inCoTermsResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Inco != null)
                    {
                        incoTermLookupForm.Tables.IncoTermsTemp.Close();
                        incoTermLookupForm.Tables.IncoTermsTemp.Release();

                        foreach (var incoTermLookup in inCoTermsResponse.SalesOrderDetails.SalesOrderDetails.SalesOrderDetails.OrderHeader.Inco)
                        {
                            incoTermLookupForm.Tables.IncoTermsTemp.Release();
                            incoTermLookupForm.Tables.IncoTermsTemp.Incoterms.Value = incoTermLookup.IncoTerms.ToString().Trim();
                            incoTermLookupForm.Tables.IncoTermsTemp.IncotermsDescription.Value = incoTermLookup.IncoTermsDescription.ToString().Trim();
                            incoTermLookupForm.Tables.IncoTermsTemp.Save();
                        }
                        incoTermLookupForm.Tables.IncoTermsTemp.Release();
                        incoTermLookupForm.Tables.IncoTermsTemp.Close();

                        incoTermLookupForm.Procedures.IncoTermsLookupFormScrollFill.Invoke();
                    }
                }
                catch (Exception exception)
                {
                    MessageBox.Show("Error: " + exception.Message, Resources.STR_MESSAGE_TITLE);
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayIncoTermDetails Method (Exception): " + exception.Message.ToString());
                }
                finally
                {
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In DisplayIncoTermDetails Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void InCoTermsLookup_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(lookupWindowType))
                {
                    if (lookupWindowType == Resources.STR_SalesCustomerDetailForm)
                    {
                        DisplayIncoTermDetails();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InCoTermsLookup_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Inco Term Close....
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void IncoTermCancelButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(lookupWindowType))
                {
                    if (lookupWindowType == Resources.STR_SalesCustomerDetailForm)
                    {
                        incoTermLookupForm.InCoTermsLookup.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In IncoTermCancelButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Inco Term Value selection...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void InCoTermsLookupSelectButton_ClickBeforeOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!String.IsNullOrEmpty(lookupWindowType))
                {
                    if (lookupWindowType == Resources.STR_SalesCustomerDetailForm && sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen)
                    {
                        if (incoTermLookupForm.InCoTermsLookup.IncoTermsScroll.Incoterms.Value.ToString().Trim() != "")
                        {
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.Incoterms.Value = incoTermLookupForm.InCoTermsLookup.IncoTermsScroll.Incoterms.Value.ToString();
                        }
                        incoTermLookupForm.InCoTermsLookup.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In InCoTermsLookupSelectButton_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// IncoTerm lookup window Close...
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void InCoTermsLookup_CloseAfterOriginal(object sender, EventArgs e)
        {
            lookupWindowType = string.Empty;
        }

        #endregion

        #region TaxScheduleID

        void SopCustomerDetailEntryLookupButton6_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (Dynamics.Globals.CompanyId.Value == 2)
                {
                    expansionWindowType = Resources.STR_SalesCustomerDetailForm;
                    lookupWindowType = Resources.STR_TaxScheduleID;
                    if (!RegisterTaxScheduleLookupSelect)
                    {
                        taxScheduleLookupForm.TaxScheduleLookup.SelectButton.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(TaxScheduleLookupSelectButton_ClickBeforeOriginal);
                        RegisterTaxScheduleLookupSelect = true;
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopCustomerDetailEntryLookupButton6_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        void TaxScheduleLookupSelectButton_ClickBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (Dynamics.Globals.CompanyId.Value == 2)
                {
                    if (!String.IsNullOrEmpty(lookupWindowType) && !String.IsNullOrEmpty(expansionWindowType))
                    {
                        if (lookupWindowType == Resources.STR_TaxScheduleID &&
                            expansionWindowType == Resources.STR_SalesCustomerDetailForm &&
                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen &&
                            !String.IsNullOrEmpty(taxScheduleLookupForm.TaxScheduleLookup.TaxScheduleLookupScroll.TaxScheduleId.Value.ToString().Trim()))
                        {
                            if (sopItemDetailForm.SopItemDetail.IsOpen)
                            {
                                if (sopItemDetailForm.SopItemDetail.TaxScheduleId.Value.ToString().Trim() != taxScheduleLookupForm.TaxScheduleLookup.TaxScheduleLookupScroll.TaxScheduleId.Value.ToString().Trim())
                                {
                                    sopItemDetailForm.SopItemDetail.TaxScheduleId.Value = taxScheduleLookupForm.TaxScheduleLookup.TaxScheduleLookupScroll.TaxScheduleId.Value.ToString().Trim();
                                    sopItemDetailForm.SopItemDetail.TaxScheduleId.RunValidate();
                                    sopItemDetailForm.SopItemDetail.IsChanged = true;
                                }
                            }

                            taxScheduleLookupForm.TaxScheduleLookup.Close();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In TaxScheduleLookupSelectButton_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event fired after closing the TaxSchedule lookup window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void TaxScheduleLookup_CloseAfterOriginal(object sender, EventArgs e)
        {
            expansionWindowType = string.Empty;
            lookupWindowType = string.Empty;
        }

        #endregion TaxScheduleID

        #region Sop Hold Entry

        /// <summary>
        /// Event fired after closing the process hold entry window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopProcessHoldsEntry_CloseAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (sopProcessHoldsEntryForm.SopProcessHoldsEntry.LocalAssignedTotal.Value == 0 && sopProcessHoldsEntryForm.SopProcessHoldsEntry.Changed.Value &&
                    !String.IsNullOrEmpty(sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim()) && !String.IsNullOrEmpty(sopEntryForm.SopEntry.CustomerNumber.Value.ToString()))
                {
                    bool isResult = true;

                    try
                    {
                        SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                        SalesOrderEntity salesCustomerDetailsObj = new SalesOrderEntity();
                        salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                        SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                        salesOrderEntity.SopType = sopEntryForm.SopEntry.SopTypeDatabase.Value;
                        salesOrderEntity.SopNumber = sopEntryForm.SopEntry.SopNumber.Value.ToString().Trim();
                        salesOrderRequest.SalesOrderEntity = salesOrderEntity;

                        // Service call ...
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/GetSalesCurSchedShipDate/", salesOrderRequest); // we need to refer the web.api service url here.

                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse _salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (_salesOrderResponse.Status == ResponseStatus.Success)
                                {
                                    isResult = true;
                                    salesCustomerDetailsObj = _salesOrderResponse.SalesOrderDetails;   //Customer detail Entry data response..
                                }
                                else
                                {
                                    isResult = false;
                                    MessageBox.Show("Error: " + _salesOrderResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopProcessHoldsEntry_CloseAfterOriginal Method (GetSalesCurSchedShipDate): " + _salesOrderResponse.ErrorMessage.ToString());
                                }
                            }
                            else
                            {
                                isResult = false;
                                MessageBox.Show("Error: Dates does not fetch for ship date calculation", Resources.STR_MESSAGE_TITLE);
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error: Dates does not fetch for ship date calculation");
                            }
                        }

                        if (salesCustomerDetailsObj != null && isResult)
                        {
                            if (salesCustomerDetailsObj.SalesOrderDetails != null)
                            {
                                if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails != null)
                                {
                                    if (salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule != null)
                                    {
                                        #region Date Details

                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopType.Value = Convert.ToInt16(salesCustomerDetailsObj.SopType);
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.SopNumber.Value = salesCustomerDetailsObj.SopNumber.ToString().Trim();

                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.Key = 1;
                                        TableError tableErrorDate = sopEntryForm.Tables.SopCustomerDetailDatesTemp.Change();
                                        if (tableErrorDate == TableError.NoError && tableErrorDate != TableError.EndOfTable)
                                        {
                                            if (sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value != salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedDeliveryDate ||
                                                sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value != salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedShipDate ||
                                                sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value != salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedDeliveryDate ||
                                                sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value != salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedShipDate ||
                                                sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value != salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalCustomerRequestedDeliveryDate ||
                                                sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value != salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedDeliveryDate ||
                                                sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value != salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedShipDate)
                                            {
                                                // Edited dates. wrote logic instead of force changes window
                                                if (!sopEntryForm.SopEntry.IsChanged)
                                                    sopEntryForm.SopEntry.IsChanged = true;
                                            }

                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqDel.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedDeliveryDate;
                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurCustReqShip.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedShipDate;
                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedDel.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedDeliveryDate;
                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.CurSchedShip.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedShipDate;
                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigCustReqDel.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalCustomerRequestedDeliveryDate;
                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedDel.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedDeliveryDate;
                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.OrigSchedShip.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedShipDate;

                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.IsUpdated.Value = 1;
                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.UserId.Value = Dynamics.Globals.UserId.Value.ToString();

                                            sopEntryForm.Tables.SopCustomerDetailDatesTemp.Save();
                                        }
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.Release();
                                        sopEntryForm.Tables.SopCustomerDetailDatesTemp.Close();

                                        #endregion Date Details

                                        if (sopCustomerDetailEntryForm.SopCustomerDetailEntry.IsOpen &&
                                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.SopNumber.Value.ToString().Trim() == salesCustomerDetailsObj.SopNumber.ToString().Trim())
                                        {
                                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqDel.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedDeliveryDate;
                                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCustReqShip.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.CustomerRequestedShipDate;
                                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedDeliveryDate;
                                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.RequestedShipDate;
                                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigCustReqDel.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalCustomerRequestedDeliveryDate;
                                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedDel.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedDeliveryDate;
                                            sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpOrigSchedShip.Value = salesCustomerDetailsObj.SalesOrderDetails.SalesOrderDetails.OrderSchedule.OriginalRequestedShipDate;
                                        }

                                        DisplaySopEntryDetails(Resources.STR_SopEntryForm);
                                    }
                                }
                            }
                        }
                    }
                    catch (Exception exception)
                    {
                        MessageBox.Show("Error: " + exception.Message, Resources.STR_MESSAGE_TITLE);
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopProcessHoldsEntry_CloseAfterOriginal Method (Exception): " + exception.Message.ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopProcessHoldsEntry_CloseAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error: " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }

        #endregion  Sop Hold Entry

        #region RMCustomerWindow

        void CustomerNumber_Change(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                rmCustomerMaintenanceForm.RmCustomerMaintenance.EligibleForServiceSku.Value = false;
                if (!String.IsNullOrEmpty(rmCustomerMaintenanceForm.RmCustomerMaintenance.CustomerNumber.Value.ToString().Trim()))
                {
                    SalesOrderRequest customerequest = new SalesOrderRequest();
                    SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                    SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                    CustomerInformation customer = new CustomerInformation();
                    SalesOrderResponse salesOrderResponse = new SalesOrderResponse();
                    customer.CustomerId = rmCustomerMaintenanceForm.RmCustomerMaintenance.CustomerNumber.Value.ToString().Trim();
                    salesOrderInformation.Customer = customer;
                    salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                    customerequest.SalesOrderEntity = salesOrderEntity;
                    customerequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                    //Get IsEligible Service SKU...
                    using (HttpClient client = new HttpClient())
                    {
                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                        client.DefaultRequestHeaders.Accept.Clear();
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                        var response = client.PostAsJsonAsync("api/Customer/GetCustomerIsServiceSKUEligible/", customerequest); // we need to refer the web.api service url here.

                        if (response.Result.IsSuccessStatusCode)
                        {
                            salesOrderResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                            if (salesOrderResponse.Status == ResponseStatus.Success)
                            {
                                rmCustomerMaintenanceForm.RmCustomerMaintenance.EligibleForServiceSku.Value = true;
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CustomerNumber_Change Method: " + ex.Message.ToString());
                MessageBox.Show("Could not open Customer Maintenance Window : " + ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "SalesDetails");
                logMessage = null;
            }
        }
        #endregion RMCustomerWindow

        #region PostingUtility

        void SalesPostingManagementWindow(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                cpSalesPostingManagementForm.CpSalesPostingManagement.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SalesPostingManagementWindow Method: " + ex.Message.ToString());
                MessageBox.Show("Could not open Sales Management Posting window : " + ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method fired on opening the Sales Posting management window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpSalesPostingManagement_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();

            try
            {
                if (RegisterPostMgmt == false)
                {
                    cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.LeaveAfterOriginal += new EventHandler(BatchNumber_LeaveAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpInterCmnyReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpCurrencyVatReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpCorrectDropShipReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpDropShipIssuesReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpCalTaxOnBatchReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.ClickBeforeOriginal += new System.ComponentModel.CancelEventHandler(LocalCpProcessCreditCardReadyBtn_ClickBeforeOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpDistributionIssuesReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpServiceSkuIssuesReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.ClickAfterOriginal += new EventHandler(LocalLinkedPaymentsReady_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.ClickAfterOriginal += new EventHandler(LocalFailedPrepaymentReady_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpPostingTransactionsReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.ClickAfterOriginal += new EventHandler(LocalCpSsrsReportReadyBtn_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.ZoomButton2.ClickAfterOriginal += new EventHandler(ZoomButton2_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.CpCloseButton.ClickAfterOriginal += new EventHandler(CpCloseButton_ClickAfterOriginal);
                    cpSalesPostingManagementForm.CpSalesPostingManagement.CloseAfterOriginal += new EventHandler(CpSalesPostingManagement_CloseAfterOriginal);

                    avaSopTaxUpdateUtilityForm.AvaSopTaxUpdateUtility.OpenAfterOriginal += new EventHandler(AvaSopTaxUpdateUtility_OpenAfterOriginal);
                    avaSopTaxUpdateUtilityForm.AvaSopTaxUpdateUtility.CloseAfterOriginal += new EventHandler(AvaSopTaxUpdateUtility_CloseAfterOriginal);

                    sopBatchEntryForm.SopBatchEntry.CloseAfterOriginal += new EventHandler(SopBatchEntry_CloseAfterOriginal);

                    cpLockedUsersForm.CpLockedUsers.OpenAfterOriginal += new EventHandler(CpLockedUsers_OpenAfterOriginal);
                    cpLockedUsersForm.CpLockedUsers.OpenBeforeOriginal += new System.ComponentModel.CancelEventHandler(CpLockedUsers_OpenBeforeOriginal);
                    cpLockedUsersForm.CpLockedUsers.CloseAfterOriginal += new EventHandler(CpLockedUsers_CloseAfterOriginal);
                    cpLockedUsersForm.CpLockedUsers.CpLockedUsersListScroll.LineChangeAfterOriginal += new EventHandler(CpLockedUserScroll_LineChangeAfterOriginal);
                    cpLockedUsersForm.CpLockedUsers.CpPbOk.ClickAfterOriginal += new EventHandler(OkButton_ClickAfterOriginal);

                    msoBatchVerificationForm.MsoBatchVerification.CloseAfterOriginal += new EventHandler(MsoBatchVerification_CloseAfterOriginal);
                    RegisterPostMgmt = true;
                }
                string company = string.Empty;
                company = Dynamics.Globals.IntercompanyId.Value.ToString();
                if (Resources.STR_CHMPT == (company.Trim().ToUpper()))
                {
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVat.Value = Resources.STR_CURRENCYISSUES;
                }
                else if (Resources.STR_CPEUR == (company.Trim().ToUpper()))
                {
                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVat.Value = Resources.STR_VATISSUES;
                }
                DisablePostWindowButtons();
                cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Focus();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpSalesPostingManagement_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }



        /// <summary>
        /// UC 144 - Lock down Sales Batch
        /// Method to focus on OK button after opening window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpLockedUsers_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                cpLockedUsersForm.CpLockedUsers.PullFocus();
                cpLockedUsersForm.CpLockedUsers.CpLockedUsersListScroll.LocalCpClearUser.Focus();
                cpLockedUsersForm.CpLockedUsers.CpLockedUsersListScroll.LocalCpClearUser.RunValidate();
                cpLockedUsersForm.CpLockedUsers.CpPbOk.Focus();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpLockedUsers_OpenAfterOriginal Method: " + ex.ToString());
                MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event fired on closing the sales posting management window.
        /// Sets the marked to post value to 0
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpSalesPostingManagement_CloseAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.UnlockPostingBatch;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                // Service call ...
                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse batchResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (batchResponse.Status == ResponseStatus.Error)
                        {
                            MessageBox.Show("Error: " + batchResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SalesPostingManagementWindow Method (ProcessRequest): " + batchResponse.ErrorMessage.ToString());
                        }
                    }
                    else
                    {
                        MessageBox.Show("Error: Closing post management window", Resources.STR_MESSAGE_TITLE);
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpSalesPostingManagement_CloseAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method to open the sales posting management window from additional menu of Sales batch entyr form.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CPSalesPostingManagementWindow(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                cpSalesPostingManagementForm.CpSalesPostingManagement.Open();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CPSalesPostingManagementWindow Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Event called on batch number change in window
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void BatchNumber_LeaveAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (!string.IsNullOrEmpty(cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString()))
                {
                    DisablePostWindowButtons();
                    OrderBatchPostRequest orderBatchPostRequest = new OrderBatchPostRequest();
                    orderBatchPostRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString().Trim();
                    orderBatchPostRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                    orderBatchPostRequest.UserId = Dynamics.Globals.UserId.Value;
                    orderBatchPostRequest.OperationType = OrderPostOperationType.BatchValidate;

                    // Service call ...
                    using (HttpClient client = new HttpClient())
                    {
                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                        client.DefaultRequestHeaders.Accept.Clear();
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                        var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest/", orderBatchPostRequest); // we need to refer the web.api service url here.                    
                        if (response.Result.IsSuccessStatusCode)
                        {
                            OrderBatchPostResponse responseStatus = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                            if (responseStatus.Status == ResponseStatus.Success)
                            {
                                if (responseStatus.BatchDetails != null)
                                {
                                    cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = responseStatus.BatchDetails.TotalBatchAmount;
                                    cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = responseStatus.BatchDetails.TotalTransInBatch;

                                    if (responseStatus.UsersHoldingBatch != null && responseStatus.UsersHoldingBatch.Count > 0)
                                    {
                                        lockedUsers = responseStatus.UsersHoldingBatch;
                                        cpLockedUsersForm.CpLockedUsers.Open();

                                    }
                                    else
                                    {
                                        orderBatchPostRequest.OperationType = OrderPostOperationType.LockPostingBatch;
                                        var responseBatch = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", orderBatchPostRequest); // we need to refer the web.api service url here.
                                        if (responseBatch.Result.IsSuccessStatusCode)
                                        {
                                            OrderBatchPostResponse responseLock = responseBatch.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                                            if (responseLock.Status == ResponseStatus.Success)
                                            {
                                                LockBatchNumber();
                                                ShowInterCompany(ButtonStatus.Ready);
                                            }
                                            else if (responseLock.Status == ResponseStatus.Error)
                                            {
                                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In BatchNumber_LeaveAfterOriginal Method (ProcessRequest): " + responseLock.ErrorMessage.ToString());
                                                MessageBox.Show(responseLock.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    MessageBox.Show("No Transactions available in batch : " + cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value, Resources.STR_MESSAGE_TITLE);
                                    cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Clear();
                                    cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Focus();
                                }
                            }
                            else if (responseStatus.Status == ResponseStatus.Error)
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In BatchNumber_LeaveAfterOriginal Method (Validate): " + responseStatus.ErrorMessage.ToString());
                                MessageBox.Show("Error : " + responseStatus.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Clear();
                                cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Focus();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In BatchNumber_LeaveAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error while validating batch : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 144 - Lock down Sales Batch
        /// Method to list the users locking the batch.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpLockedUsers_OpenBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            short selecteduser = 0;
            try
            {
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Close();
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Release();
                TableError tableRemove = cpLockedUsersForm.Tables.CpLockedUsersTemp.ChangeFirst();
                while (tableRemove == TableError.NoError && tableRemove != TableError.EndOfTable)
                {
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.Remove();
                    tableRemove = cpLockedUsersForm.Tables.CpLockedUsersTemp.ChangeNext();
                }
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Release();
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Close();

                // Call an factory method to get the instance of corresponding operation
                for (int i = 0; i < lockedUsers.Count; i++)
                {
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.Release();
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.UserId.Value = lockedUsers[i].UserId.Trim();
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.UserName.Value = lockedUsers[i].UserName.Trim();
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.CpClearUser.Value = selecteduser;
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.CompanyId.Value = Convert.ToInt16(lockedUsers[i].CompanyId);
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.Save();
                }

                cpLockedUsersForm.Procedures.CpLockedUsersFormFillScroll.Invoke();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpLockedUsers_OpenBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 144 - Lock down Sales Batch
        /// Method close the window showing the users lockign the batch.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpLockedUsers_CloseAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (IsBatchNumberToBeFocused)
                {
                    cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Focus();
                    IsBatchNumberToBeFocused = false;
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpLockedUsers_CloseAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error in closing the Locked Users List" + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 144 - Lock down Sales Batch
        /// Method to update the selcted radio button (Yes/No) in temp table.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpLockedUserScroll_LineChangeAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                //Store value in temp table
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Close();
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Release();
                cpLockedUsersForm.Tables.CpLockedUsersTemp.UserId.Value = cpLockedUsersForm.CpLockedUsers.CpLockedUsersListScroll.UserId.Value.ToString();
                cpLockedUsersForm.Tables.CpLockedUsersTemp.CompanyId.Value = cpLockedUsersForm.CpLockedUsers.CpLockedUsersListScroll.CompanyId.Value;
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Key = 1;
                TableError tableError = cpLockedUsersForm.Tables.CpLockedUsersTemp.Change();
                if (tableError == TableError.NoError && tableError != TableError.EndOfTable)
                {
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.CpClearUser.Value = cpLockedUsersForm.CpLockedUsers.CpLockedUsersListScroll.LocalCpClearUser.Value;
                    cpLockedUsersForm.Tables.CpLockedUsersTemp.Save();
                }
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Release();
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Close();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpLockedUserScroll_LineChangeAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message.ToString(), Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 144 - Lock down Sales Batch
        /// Method to remove the users for the batch
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void OkButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.RemoveLockedUsers;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                FillUsersListFromScrollToDS(ref batchRequest);

                if (batchRequest.LockedUsers.Count > 0)
                {
                    //Calling method to remove the users locking the batch.
                    using (HttpClient client = new HttpClient())
                    {
                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                        client.DefaultRequestHeaders.Accept.Clear();
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                        var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                        if (response.Result.IsSuccessStatusCode)
                        {
                            OrderBatchPostResponse responseStatus = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                            if (responseStatus.Status == ResponseStatus.Success)
                            {
                                cpLockedUsersForm.Close();
                                if (responseStatus.IsBatchLockCleared)
                                {
                                    batchRequest.OperationType = OrderPostOperationType.LockPostingBatch;
                                    var responseLockPosting = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                                    if (responseLockPosting.Result.IsSuccessStatusCode)
                                    {
                                        OrderBatchPostResponse reslockbatchObj = responseLockPosting.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                                        if (reslockbatchObj.Status == ResponseStatus.Success)
                                        {
                                            LockBatchNumber();
                                            ShowInterCompany(ButtonStatus.Ready);
                                        }
                                        else if (reslockbatchObj.Status == ResponseStatus.Error)
                                        {
                                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OkButton_ClickAfterOriginal Method (ProcessRequest): " + reslockbatchObj.ErrorMessage.ToString());
                                            MessageBox.Show(reslockbatchObj.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                        }
                                    }
                                }
                                else
                                {
                                    IsBatchNumberToBeFocused = true;
                                }
                            }
                            else
                            {
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OkButton_ClickAfterOriginal Method (Fill): " + responseStatus.ErrorMessage.ToString());
                                MessageBox.Show("Error: " + responseStatus.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }
                }
                else
                {
                    IsBatchNumberToBeFocused = true;
                    cpLockedUsersForm.Close();
                }
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In OkButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method to fill the locked users list from scrolling window to Data set.
        /// </summary>
        /// <param name="logMessage"></param>
        /// <returns></returns>
        private void FillUsersListFromScrollToDS(ref OrderBatchPostRequest batchRequest)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Close();
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Release();
                TableError tableRemove = cpLockedUsersForm.Tables.CpLockedUsersTemp.GetFirst();
                while (tableRemove == TableError.NoError && tableRemove != TableError.EndOfTable)
                {
                    if (cpLockedUsersForm.Tables.CpLockedUsersTemp.CpClearUser.Value == 0)
                    {
                        batchRequest.AddLockedUserToBatch(cpLockedUsersForm.Tables.CpLockedUsersTemp.UserId.Value.ToString(),
                            cpLockedUsersForm.Tables.CpLockedUsersTemp.UserName.Value.ToString(),
                            Dynamics.Globals.CompanyId.Value);
                    }
                    tableRemove = cpLockedUsersForm.Tables.CpLockedUsersTemp.GetNext();
                }
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Release();
                cpLockedUsersForm.Tables.CpLockedUsersTemp.Close();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In FillUsersListFromScrollToDS Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 142 - Button 1 - NA & EU - Identify Intercompany Sales Transactions and Move to Review Batch
        /// Event method fired on clicking InterCompany Sales "Ready" button.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpInterCmnyReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                ShowInterCompany(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.IntercompanySalesTransactions;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse interResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (interResponse.Status == ResponseStatus.Success)
                        {
                            ShowInterCompany(ButtonStatus.Completed);
                            ShowCurrencyIssues(ButtonStatus.Ready);

                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = interResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = interResponse.BatchDetails.TotalTransInBatch;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyTxt.Value = Resources.STR_RECORDS_MOVED + interResponse.BatchDetails.NumTranProcessed;
                        }
                        else if (interResponse.Status == ResponseStatus.Error)
                        {
                            ShowInterCompany(ButtonStatus.Failed);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowInterCompany(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpInterCmnyReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Prada - UC 138 - Button 2- NA - Currency Issues & UC 139 - Button 2 - EU - VAT Check
        /// Method fires on clicking Ready button for 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpCurrencyVatReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                ShowCurrencyIssues(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    if (Resources.STR_CHMPT == Dynamics.Globals.IntercompanyId.Value.ToString())
                    {
                        batchRequest.OperationType = OrderPostOperationType.CurrencyIssues;
                    }
                    else if (Resources.STR_CPEUR == Dynamics.Globals.IntercompanyId.Value.ToString())
                    {
                        batchRequest.OperationType = OrderPostOperationType.VatIssues;
                    }

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse currencyResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (currencyResponse.Status == ResponseStatus.Success)
                        {
                            ShowCurrencyIssues(ButtonStatus.Completed);
                            ShowCorrectDropships(ButtonStatus.Ready);
                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = currencyResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = currencyResponse.BatchDetails.TotalTransInBatch;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatTxt.Value = Resources.STR_RECORDS_MOVED + currencyResponse.BatchDetails.NumTranProcessed;
                        }
                        else if (currencyResponse.Status == ResponseStatus.Error)
                        {
                            ShowCurrencyIssues(ButtonStatus.Failed);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowCurrencyIssues(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpCurrencyVatReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 129 - Button 3 - NA & EU - GP Updates "Customer Pickup" to "Cust Carrier" When Ship via Site ID = DROPSHIP
        /// Method called on clicking ready button of Correct Dropships.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpCorrectDropShipReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                OrderBatchPostResponse batchResponse = new OrderBatchPostResponse();
                ShowCorrectDropships(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.CorrectDropships;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse dropshipResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (dropshipResponse.Status == ResponseStatus.Success)
                        {
                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = dropshipResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = dropshipResponse.BatchDetails.TotalTransInBatch;

                            numberOfRecordsFixedByCorrectDropShipBtn = Resources.STR_FIXED_DROPSHIP + dropshipResponse.BatchDetails.NumTranProcessed;

                            batchResponse = MoveMissingShipViaToRevBatch(batchRequest, dropshipResponse);

                            if (batchResponse.Status == ResponseStatus.Success)
                            {
                                ShowCorrectDropships(ButtonStatus.Completed);
                                ShowDropshipIssues(ButtonStatus.Ready);
                            }
                            else if (batchResponse.Status == ResponseStatus.Error)
                            {
                                //To Do Check if the remaining butons need to set
                                ShowCorrectDropships(ButtonStatus.Failed);

                            }

                        }
                        else if (dropshipResponse.Status == ResponseStatus.Error)
                        {
                            //To Do Check if the remaining butons need to set
                            ShowCorrectDropships(ButtonStatus.Failed);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                //To Do Check if the remaining butons need to set
                ShowCorrectDropships(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpCorrectDropShipReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 129 - Button 3 - NA & EU - GP Updates "Customer Pickup" to "Cust Carrier" When Ship via Site ID = DROPSHIP
        /// Method called on clicking ready button of Correct Dropships.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpDropShipIssuesReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                OrderBatchPostResponse batchResponse = new OrderBatchPostResponse();
                ShowDropshipIssues(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.DropShipIssues;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse dropshipResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (dropshipResponse.Status == ResponseStatus.Success)
                        {
                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = dropshipResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = dropshipResponse.BatchDetails.TotalTransInBatch;

                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesTxt.Value =
                                Resources.STR_Moved_DropshipIssue + dropshipResponse.BatchDetails.TotalOrdersWithDropshipIssue + "," +
                                Resources.STR_Moved_AccountNumberIssue + dropshipResponse.BatchDetails.TotalOrdersWithAccountNumberIssue + "," +
                                Resources.STR_Moved_DocumentAmountIssue + dropshipResponse.BatchDetails.TotalOrdersWithDocumentAmountIssue;

                            ShowDropshipIssues(ButtonStatus.Completed);
                            if (Resources.STR_CHMPT == Dynamics.Globals.IntercompanyId.Value.ToString())
                            {
                                ShowCalcTaxOnBatch(ButtonStatus.Ready);
                            }
                            else if (Resources.STR_CPEUR == Dynamics.Globals.IntercompanyId.Value.ToString())
                            {
                                ShowCalcTaxOnBatch(ButtonStatus.NotApplicable);
                                ShowProcessCreditCard(ButtonStatus.NotApplicable);
                                ShowDistributionIssues(ButtonStatus.Ready);
                            }
                        }
                        else if (dropshipResponse.Status == ResponseStatus.Error)
                        {
                            //To Do Check if the remaining butons need to set
                            ShowDropshipIssues(ButtonStatus.Failed);

                        }
                    }
                }
            }
            catch (Exception ex)
            {
                //To Do Check if the remaining butons need to set
                ShowDropshipIssues(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpDropShipIssuesReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }
        /// <summary>
        /// UC 134  NA-Calculate Tax on Batch
        /// Method called on clicking ready button of calculate tax on batch.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpCalTaxOnBatchReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.CadTaxExemptions;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse taxBatchResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (taxBatchResponse.Status == ResponseStatus.Success)
                        {
                            ShowCalcTaxOnBatch(ButtonStatus.Processing);
                            avaSopTaxUpdateUtilityForm.Open();
                            IsCalTaxOnBatchReadyBtnClicked = true;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowCalcTaxOnBatch(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpCalTaxOnBatchReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error while Avalara Tax update utility" + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 134  A-Calculate Tax on Batch
        /// Method called on opening tax update utility.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AvaSopTaxUpdateUtility_OpenAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                if (cpSalesPostingManagementForm.IsOpen)
                {
                    avaSopTaxUpdateUtilityForm.AvaSopTaxUpdateUtility.LocalBatchNumberFrom.Value = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                    avaSopTaxUpdateUtilityForm.AvaSopTaxUpdateUtility.LocalBatchNumberFrom.RunValidate();
                    avaSopTaxUpdateUtilityForm.AvaSopTaxUpdateUtility.LocalBatchNumberTo.Value = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                    avaSopTaxUpdateUtilityForm.AvaSopTaxUpdateUtility.LocalBatchNumberTo.RunValidate();
                    avaSopTaxUpdateUtilityForm.AvaSopTaxUpdateUtility.LocalInvoice.Value = true;
                }
            }
            catch (Exception ex)
            {
                if (cpSalesPostingManagementForm.IsOpen)
                    ShowCalcTaxOnBatch(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AvaSopTaxUpdateUtility_OpenAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error while Avalara Tax update utility" + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 134  NA-Calculate Tax on Batch
        /// Method called on closing tax update utility window.
        /// Modifed for for HP 113437 - CAD Avatax Issue Fix 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void AvaSopTaxUpdateUtility_CloseAfterOriginal(object sender, EventArgs e)
        {
            if (IsCalTaxOnBatchReadyBtnClicked && cpSalesPostingManagementForm.IsOpen)
            {
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    ShowCalcTaxOnBatch(ButtonStatus.Completed);
                    ShowProcessCreditCard(ButtonStatus.Ready);
                    try
                    {
                        // request object
                        OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                        batchRequest.OperationType = OrderPostOperationType.CanadianTaxIssue;
                        batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                        batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                        batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                        batchRequest.UserId = Dynamics.Globals.UserId.Value;

                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                OrderBatchPostResponse taxBatchResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                                if (taxBatchResponse.Status == ResponseStatus.Success)
                                {
                                    cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = taxBatchResponse.BatchDetails.TotalBatchAmount;
                                    cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = taxBatchResponse.BatchDetails.TotalTransInBatch;
                                    cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchTxt.Value = Resources.STR_RECORDS_MOVED + taxBatchResponse.BatchDetails.NumTranProcessed;
                                }
                                else if (taxBatchResponse.Status == ResponseStatus.Error)
                                {
                                    ShowDistributionIssues(ButtonStatus.Failed);
                                }
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        ShowCalcTaxOnBatch(ButtonStatus.Failed);
                        logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AvaSopTaxUpdateUtility_CloseAfterOriginal Method (ProcessRequest): " + ex.Message.ToString());
                        MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
                    }
                    finally
                    {
                        IsCalTaxOnBatchReadyBtnClicked = false;
                    }
                }
                catch (Exception ex)
                {
                    ShowCalcTaxOnBatch(ButtonStatus.Failed);
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In AvaSopTaxUpdateUtility_CloseAfterOriginal Method: " + ex.Message.ToString());
                    MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                    logMessage = null;
                }
            }
        }

        /// <summary>
        /// Button 5 - NA - Process Credit Cards
        /// Method called on clicking ready button of process credit cards.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpProcessCreditCardReadyBtn_ClickBeforeOriginal(object sender, System.ComponentModel.CancelEventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {

                ShowProcessCreditCard(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.ProcessCreditCards;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse creditResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (creditResponse.Status == ResponseStatus.Success)
                        {
                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = creditResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = creditResponse.BatchDetails.TotalTransInBatch;

                            if (creditResponse.IsUsdccTransactionsAvailable == true)
                            {

                                msoBatchVerificationForm.Open();
                            }
                            else
                            {
                                ShowProcessCreditCard(ButtonStatus.Completed);
                                ShowDistributionIssues(ButtonStatus.Ready);
                            }
                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardTxt.Value = Resources.STR_RECORDS_MOVED + creditResponse.BatchDetails.NumTranProcessed;
                            IsProcessCreditCardReadyBtnClicked = true;
                        }
                        else if (creditResponse.Status == ResponseStatus.Error)
                        {
                            ShowProcessCreditCard(ButtonStatus.Failed);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                //To Do Check if the remaining butons need to set
                ShowProcessCreditCard(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpProcessCreditCardReadyBtn_ClickBeforeOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Button 5 - NA - Process Credit Cards
        /// Method called on closing the credit card batch verification window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void MsoBatchVerification_CloseAfterOriginal(object sender, EventArgs e)
        {
            if (IsProcessCreditCardReadyBtnClicked && cpSalesPostingManagementForm.IsOpen)
            {
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    ShowProcessCreditCard(ButtonStatus.Completed);
                    ShowDistributionIssues(ButtonStatus.Ready);
                    IsProcessCreditCardReadyBtnClicked = false;
                }
                catch (Exception ex)
                {
                    ShowProcessCreditCard(ButtonStatus.Failed);
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In MsoBatchVerification_CloseAfterOriginal Method: " + ex.Message.ToString());
                    MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                    logMessage = null;
                }
            }
        }

        /// <summary>
        /// Method called on clicking ready button of distributions issues.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpDistributionIssuesReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                ShowDistributionIssues(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.DistributionIssues;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse distributionResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (distributionResponse.Status == ResponseStatus.Success)
                        {
                            ShowDistributionIssues(ButtonStatus.Completed);
                            ShowServiceSkuIssues(ButtonStatus.Ready);

                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = distributionResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = distributionResponse.BatchDetails.TotalTransInBatch;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssueTxt.Value = Resources.STR_RECORDS_MOVED + distributionResponse.BatchDetails.NumTranProcessed;
                        }
                        else if (distributionResponse.Status == ResponseStatus.Error)
                        {
                            ShowDistributionIssues(ButtonStatus.Failed);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpDistributionIssuesReadyBtn_ClickAfterOriginal Method (ProcessRequest): " + distributionResponse.ErrorMessage.ToString());
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowDistributionIssues(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpDistributionIssuesReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method called on clicking ready button of service sku issues. 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpServiceSkuIssuesReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                ShowServiceSkuIssues(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.ServiceSkuIssue;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse serviceSkuResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (serviceSkuResponse.Status == ResponseStatus.Success)
                        {
                            ShowServiceSkuIssues(ButtonStatus.Completed);
                            ShowLinkedPaymentIssues(ButtonStatus.Ready);

                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = serviceSkuResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = serviceSkuResponse.BatchDetails.TotalTransInBatch;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssueTxt.Value = Resources.STR_RECORDS_MOVED + serviceSkuResponse.BatchDetails.NumTranProcessed;
                        }
                        else if (serviceSkuResponse.Status == ResponseStatus.Error)
                        {
                            ShowServiceSkuIssues(ButtonStatus.Failed);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpServiceSkuIssuesReadyBtn_ClickAfterOriginal Method (ProcessRequest): " + serviceSkuResponse.ErrorMessage.ToString());
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowServiceSkuIssues(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpServiceSkuIssuesReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }


        /// <summary>
        /// Method called on clicking ready button of LocalFailedPrepaymentReady. 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void LocalFailedPrepaymentReady_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                ShowFailedPrePaymentIssues(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.FailedPrepayment;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse postingResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (postingResponse.Status == ResponseStatus.Success)
                        {
                            ShowFailedPrePaymentIssues(ButtonStatus.Completed);
                            ShowPostTransactions(ButtonStatus.Ready);

                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = postingResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = postingResponse.BatchDetails.TotalTransInBatch;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentText.Value = Resources.STR_RECORDS_MOVED + postingResponse.BatchDetails.NumTranProcessed;

                        }
                        else if (postingResponse.Status == ResponseStatus.Error)
                        {
                            ShowFailedPrePaymentIssues(ButtonStatus.Failed);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalFailedPrepaymentReady_ClickAfterOriginal Method (ProcessRequest): " + postingResponse.ErrorMessage.ToString());
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowFailedPrePaymentIssues(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalFailedPrepaymentReady_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error while Batch Posting " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method called on clicking ready button of LocalLinkedPaymentsReady. 
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void LocalLinkedPaymentsReady_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                ShowLinkedPaymentIssues(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.LinkedPayment;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse postingResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (postingResponse.Status == ResponseStatus.Success)
                        {
                            ShowLinkedPaymentIssues(ButtonStatus.Completed);
                            ShowFailedPrePaymentIssues(ButtonStatus.Ready);

                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = postingResponse.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = postingResponse.BatchDetails.TotalTransInBatch;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsText.Value = Resources.STR_RECORDS_MOVED + postingResponse.BatchDetails.NumTranProcessed;

                        }
                        else if (postingResponse.Status == ResponseStatus.Error)
                        {
                            ShowLinkedPaymentIssues(ButtonStatus.Failed);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalLinkedPaymentsReady_ClickAfterOriginal Method (ProcessRequest): " + postingResponse.ErrorMessage.ToString());
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowLinkedPaymentIssues(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalLinkedPaymentsReady_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error while  Batch Posting " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 130 - Button 7 - NA & EU - Post Transactions
        /// Method called on clicking Ready button for Post transctions.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void LocalCpPostingTransactionsReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                ShowPostTransactions(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.PostTransactions;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse postingResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (postingResponse.Status == ResponseStatus.Success)
                        {
                            sopBatchEntryForm.Open();
                            isPostingTransactionsReadyBtnClicked = true;
                            if (sopBatchEntryForm.SopBatchEntry.IsOpen)
                            {
                                sopBatchEntryForm.SopBatchEntry.ClearButton.RunValidate();
                                sopBatchEntryForm.SopBatchEntry.BatchNumber.Value = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                                sopBatchEntryForm.SopBatchEntry.Origin.Value = 1;
                                sopBatchEntryForm.SopBatchEntry.BatchNumber.RunValidate();
                            }
                        }
                        else if (postingResponse.Status == ResponseStatus.Error)
                        {
                            ShowPostTransactions(ButtonStatus.Failed);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpPostingTransactionsReadyBtn_ClickAfterOriginal Method (ProcessRequest): " + postingResponse.ErrorMessage.ToString());
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowPostTransactions(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpPostingTransactionsReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error while Batch Posting " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// UC 130 - Button 7 - NA & EU - Post Transactions
        /// Method called on closing sales batch entry window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void SopBatchEntry_CloseAfterOriginal(object sender, EventArgs e)
        {
            if (isPostingTransactionsReadyBtnClicked && cpSalesPostingManagementForm.IsOpen)
            {
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    ShowPostTransactions(ButtonStatus.Completed);
                    ShowSSRSReport(ButtonStatus.Ready);
                    isPostingTransactionsReadyBtnClicked = false;
                }
                catch (Exception ex)
                {
                    ShowPostTransactions(ButtonStatus.Failed);
                    MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SopBatchEntry_CloseAfterOriginal Method: " + ex.Message.ToString());
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                    logMessage = null;
                }
            }
        }

        void LocalCpSsrsReportReadyBtn_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                System.Windows.Forms.Cursor.Current = Cursors.WaitCursor;

                ShowSSRSReport(ButtonStatus.Processing);
                OrderBatchPostRequest batchRequest = new OrderBatchPostRequest();
                batchRequest.OperationType = OrderPostOperationType.SsrsReport;
                batchRequest.BatchNumber = cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Value.ToString();
                batchRequest.CompanyID = Dynamics.Globals.CompanyId.Value;
                batchRequest.CompanyName = Dynamics.Globals.CompanyName.Value;
                batchRequest.UserId = Dynamics.Globals.UserId.Value;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", batchRequest); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse postingResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (postingResponse.Status == ResponseStatus.Success)
                        {
                            if (postingResponse.IsAllSsrsFileOpened)
                            {
                                MessageBox.Show("Could not able to save report as all available files are in use. Please close few files and retry.", Resources.STR_MESSAGE_TITLE);
                                ShowSSRSReport(ButtonStatus.Ready);
                                postingResponse.IsAllSsrsFileOpened = false;
                            }
                            else
                            {
                                filePath = postingResponse.SsrsReportLink;
                                ShowViewSSRSZoom(ButtonStatus.ZoomShow);
                                ShowSSRSReport(ButtonStatus.Completed);
                            }
                        }
                        else if (postingResponse.Status == ResponseStatus.Error)
                        {
                            ShowSSRSReport(ButtonStatus.Failed);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpSsrsReportReadyBtn_ClickAfterOriginal Method (ProcessRequest): " + postingResponse.ErrorMessage.ToString());
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                ShowSSRSReport(ButtonStatus.Failed);
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In LocalCpSsrsReportReadyBtn_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show("Error while Batch running report " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                System.Windows.Forms.Cursor.Current = Cursors.Arrow;
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method to open the SSRS Report
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void ZoomButton2_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                Process.Start(@filePath);
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In ZoomButton2_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        /// <summary>
        /// Method called when closing sales batch post management window.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        void CpCloseButton_ClickAfterOriginal(object sender, EventArgs e)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {
                cpSalesPostingManagementForm.Close();
            }
            catch (Exception ex)
            {
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpCloseButton_ClickAfterOriginal Method: " + ex.Message.ToString());
                MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }
        }

        #region Private Methods

        /// <summary>
        /// Method created for HP 97272 to move Invoices with no ShipVia to Rev batch.
        /// </summary>
        /// <param name="reqObj"></param>
        /// <param name="resObj"></param>
        private OrderBatchPostResponse MoveMissingShipViaToRevBatch(OrderBatchPostRequest reqObj, OrderBatchPostResponse resObj)
        {
            StringBuilder logMessage = new StringBuilder();
            try
            {

                reqObj.OperationType = OrderPostOperationType.MissingShipVia;

                using (HttpClient client = new HttpClient())
                {
                    client.BaseAddress = new Uri(gpServiceConfigurationURL);
                    client.DefaultRequestHeaders.Accept.Clear();
                    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                    var response = client.PostAsJsonAsync("api/SalesOrderPost/ProcessRequest", reqObj); // we need to refer the web.api service url here.
                    if (response.Result.IsSuccessStatusCode)
                    {
                        OrderBatchPostResponse currencyResponse = response.Result.Content.ReadAsAsync<OrderBatchPostResponse>().Result;
                        if (currencyResponse.Status == ResponseStatus.Success)
                        {

                            cpSalesPostingManagementForm.CpSalesPostingManagement.BatchTotal.Value = resObj.BatchDetails.TotalBatchAmount;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.NumberOfTrx.Value = resObj.BatchDetails.TotalTransInBatch;
                            cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipTxt.Value = numberOfRecordsFixedByCorrectDropShipBtn + Resources.STR_MOVED_MISSING_SHIPVIA + resObj.BatchDetails.NumTranProcessed;
                        }
                        else if (currencyResponse.Status == ResponseStatus.Error)
                        {
                            MessageBox.Show("Error: " + currencyResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                            logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In MoveMissingShipViaToRevBatch Method (ProcessRequest): " + currencyResponse.ErrorMessage.ToString());
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                //Show error message and log it.   
                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In MoveMissingShipViaToRevBatch Method: " + ex.Message.ToString());
                MessageBox.Show("Error : " + ex.Message, Resources.STR_MESSAGE_TITLE);
            }
            finally
            {
                LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                logMessage = null;
            }

            return resObj;
        }

        /// <summary>
        /// Method called to disable the buttons on opening Sales Posting management window
        /// </summary>
        private void DisablePostWindowButtons()
        {
            try
            {
                ShowInterCompany(ButtonStatus.Pending);
                ShowCorrectDropships(ButtonStatus.Pending);
                ShowDropshipIssues(ButtonStatus.Pending);
                ShowCurrencyIssues(ButtonStatus.Pending);
                ShowCalcTaxOnBatch(ButtonStatus.Pending);
                ShowProcessCreditCard(ButtonStatus.Pending);
                ShowDistributionIssues(ButtonStatus.Pending);
                ShowServiceSkuIssues(ButtonStatus.Pending);
                ShowPostTransactions(ButtonStatus.Pending);
                ShowLinkedPaymentIssues(ButtonStatus.Pending);
                ShowFailedPrePaymentIssues(ButtonStatus.Pending);
                ShowSSRSReport(ButtonStatus.Pending);
                ShowViewSSRSZoom(ButtonStatus.ZoomHide);
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to lock the batch number and corresponding lookup.
        /// </summary>
        private void LockBatchNumber()
        {
            try
            {
                cpSalesPostingManagementForm.CpSalesPostingManagement.BatchNumber.Lock();
                cpSalesPostingManagementForm.CpSalesPostingManagement.CpSalesBatchLookUp.Lock();
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the "Intercompany" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowInterCompany(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Focus();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Disable();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Disable();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Disable();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Disable();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCmnyProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpInterCompanySalesPendingBtn.Disable();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the "Currency Issues" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowCurrencyIssues(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Focus();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Disable();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Disable();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Disable();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCurrencyVatReadyBtn.Disable();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the show "Correct Dropships" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowCorrectDropships(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Focus();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Disable();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Disable();

                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Disable();

                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCorrectDropShipReadyBtn.Disable();

                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the show "Dropship Issues" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowDropshipIssues(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Focus();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Disable();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Disable();

                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Disable();

                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDropShipIssuesReadyBtn.Disable();

                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the "Calculate tax on batch" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowCalcTaxOnBatch(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Focus();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.NotApplicable:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpCalTaxOnBatchNotApplicableBtn.Show();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the "Process Credit Cards" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowProcessCreditCard(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Focus();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Hide();
                        break;
                    case ButtonStatus.NotApplicable:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardReadyBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpProcessCreditCardNotApplicableBtn.Show();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the "Distribution Issues" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowDistributionIssues(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Focus();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Disable();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Disable();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Disable();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpDistributionIssuesReadyBtn.Disable();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the "Service Sku Issues" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowServiceSkuIssues(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Focus();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Disable();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Disable();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Disable();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalServiceSkuIssuesReadyBtn.Disable();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }



        /// <summary>
        /// Method to Show the "LinkedPaymentIssues" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowLinkedPaymentIssues(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Focus();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.NotApplicable:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkesPaymentsProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkedPaymentsNotApplicable.Show();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }



        /// <summary>
        /// Method to Show the "LinkedPaymentIssues" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowFailedPrePaymentIssues(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Focus();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Hide();
                        break;
                    case ButtonStatus.NotApplicable:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentFailed.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentCompleted.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentPending.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailePrepaymentProcessing.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalFailedPrepaymentReady.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalLinkPaymentsNotApplicable.Show();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the "Post Transactions" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowPostTransactions(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Focus();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Disable();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Disable();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Disable();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpPostingTransactionsReadyBtn.Disable();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to Show the "SSRS Report" buttons based on the button status passed.
        /// </summary>
        /// <param name="buttonstatus">Buttons Status</param>
        private void ShowSSRSReport(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.Ready:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Enable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Focus();
                        break;
                    case ButtonStatus.Pending:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Disable();
                        break;
                    case ButtonStatus.Processing:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Disable();
                        break;
                    case ButtonStatus.Completed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Disable();
                        break;
                    case ButtonStatus.Failed:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportFailedBtn.Show();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportCompletedBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportPendingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Disable();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportProcessingBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Hide();
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportReadyBtn.Disable();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        /// <summary>
        /// Method to hide/show the SSRS Report Zoom
        /// </summary>
        /// <param name="buttonstatus"></param>
        private void ShowViewSSRSZoom(ButtonStatus buttonstatus)
        {
            try
            {
                switch (buttonstatus)
                {
                    case ButtonStatus.ZoomShow:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportTxt.Value = Resources.STR_GENERATED;
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportViewHyperlink.Value = Resources.STR_VIEW;
                        cpSalesPostingManagementForm.CpSalesPostingManagement.ZoomButton2.Enable();
                        break;
                    case ButtonStatus.ZoomHide:
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportTxt.Value = string.Empty;
                        cpSalesPostingManagementForm.CpSalesPostingManagement.LocalCpSsrsReportViewHyperlink.Value = string.Empty;
                        cpSalesPostingManagementForm.CpSalesPostingManagement.ZoomButton2.Disable();
                        break;
                }
            }
            catch (Exception)
            {
                throw;
            }
        }

        #endregion Private Methods

        #endregion PostingUtility

        #region WarehouseClosure

        public void CpReqShipDate_Change(object sender, EventArgs e)
        {
            if (isWarehouseClosureState == true)
            {

                int validateStatus = 0;
                string wareshouseId = string.Empty;
                string source = string.Empty;
                StringBuilder logMessage = new StringBuilder();
                try
                {
                    if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 2 ||
                             sopEntryForm.SopEntry.SopTypeDatabase.Value == 6)
                    {
                        DateTime curSchedShipDate = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        DateTime curSchedDelDate = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        curSchedShipDate = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpReqShipDate.Value;

                        wareshouseId = sopEntryForm.SopEntry.LocationCode.Value;

                        SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                        SalesOrderEntity salesCustomerDetailsObj = new SalesOrderEntity();
                        salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                        SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                        WarehouseInformation salesWarehouseInformation = new WarehouseInformation();
                        SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                        OrderSchedule orderSchedule = new OrderSchedule();

                        orderSchedule.RequestedShipDate = curSchedShipDate;
                        orderSchedule.RequestedDeliveryDate = curSchedDelDate;

                        salesWarehouseInformation.WarehouseId = wareshouseId;

                        salesOrderDetails.OrderSchedule = orderSchedule;
                        salesOrderInformation.SalesOrderDetails = salesOrderDetails;
                        salesOrderInformation.Warehouse = salesWarehouseInformation;
                        salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                        salesOrderRequest.SalesOrderEntity = salesOrderEntity;



                        // Service call ...
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/ValidateWarehouseClosureDate", salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesResponse.Status == ResponseStatus.Error)
                                {
                                    MessageBox.Show("Error: " + salesResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SalesPostingManagementWindow Method (ProcessRequest): " + salesResponse.ErrorMessage.ToString());
                                }
                                else
                                {
                                    validateStatus = salesResponse.ValidateStatus;
                                    if (validateStatus == 1)
                                    {
                                        MessageBox.Show("Cur Sched Ship Date is set on a warehouse closure date. Please adjust the date to the next best day or work with appropriate parties to execute this exception.", Resources.STR_DynamicsGP);
                                    }
                                    else if (validateStatus == 2)
                                    {
                                        MessageBox.Show("One of the Cur Sched Date is set on a Weekend. Please adjust the date to the next best day or work with appropriate parties to execute this exception.", Resources.STR_DynamicsGP);
                                    }
                                }
                            }
                            else
                            {
                                MessageBox.Show("Error: CpReqShipDate_Change in customer detail entry window", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpSalesPostingManagement_CloseAfterOriginal Method: " + ex.Message.ToString());
                    MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                    logMessage = null;
                }
            }

        }

        public void CpCurSchedDel_Change(object sender, EventArgs e)
        {
            if (isWarehouseClosureState == true)
            {
                int validateStatus = 0;
                string wareshouseId = string.Empty;

                StringBuilder logMessage = new StringBuilder();
                try
                {
                    if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 2 ||
               sopEntryForm.SopEntry.SopTypeDatabase.Value == 6)
                    {
                        DateTime curSchedShipDate = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                        DateTime curSchedDelDate = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));

                        curSchedDelDate = sopCustomerDetailEntryForm.SopCustomerDetailEntry.CpCurSchedDel.Value;

                        wareshouseId = sopEntryForm.SopEntry.LocationCode.Value;

                        SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                        SalesOrderEntity salesCustomerDetailsObj = new SalesOrderEntity();
                        salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                        SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                        SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                        WarehouseInformation salesWarehouseInformation = new WarehouseInformation();
                        SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                        OrderSchedule orderSchedule = new OrderSchedule();

                        orderSchedule.RequestedShipDate = curSchedShipDate;
                        orderSchedule.RequestedDeliveryDate = curSchedDelDate;

                        salesWarehouseInformation.WarehouseId = wareshouseId;

                        salesOrderDetails.OrderSchedule = orderSchedule;
                        salesOrderInformation.SalesOrderDetails = salesOrderDetails;
                        salesOrderInformation.Warehouse = salesWarehouseInformation;
                        salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                        salesOrderRequest.SalesOrderEntity = salesOrderEntity;



                        // Service call ...
                        using (HttpClient client = new HttpClient())
                        {
                            client.BaseAddress = new Uri(gpServiceConfigurationURL);
                            client.DefaultRequestHeaders.Accept.Clear();
                            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                            var response = client.PostAsJsonAsync("api/SalesOrderUpdate/ValidateWarehouseClosureDate", salesOrderRequest); // we need to refer the web.api service url here.
                            if (response.Result.IsSuccessStatusCode)
                            {
                                SalesOrderResponse salesResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                                if (salesResponse.Status == ResponseStatus.Error)
                                {
                                    MessageBox.Show("Error: " + salesResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SalesPostingManagementWindow Method (ProcessRequest): " + salesResponse.ErrorMessage.ToString());
                                }
                                else
                                {
                                    validateStatus = salesResponse.ValidateStatus;
                                    if (validateStatus == 1)
                                    {
                                        MessageBox.Show("Cur Sched Ship Date is set on a warehouse closure date. Please adjust the date to the next best day or work with appropriate parties to execute this exception.", Resources.STR_DynamicsGP);
                                    }
                                    else if (validateStatus == 2)
                                    {
                                        MessageBox.Show("One of the Cur Sched Date is set on a Weekend. Please adjust the date to the next best day or work with appropriate parties to execute this exception.", Resources.STR_DynamicsGP);
                                    }
                                }
                            }
                            else
                            {
                                MessageBox.Show("Error: CpCurSchedDel_Change in customer detail entry window", Resources.STR_MESSAGE_TITLE);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpSalesPostingManagement_CloseAfterOriginal Method: " + ex.Message.ToString());
                    MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                    logMessage = null;
                }
            }

        }

        public void ValidateWarehouseClosureDate()
        {
            if (sopEntryForm.SopEntry.SopTypeDatabase.Value == 2 ||
                sopEntryForm.SopEntry.SopTypeDatabase.Value == 6)
            {
                int validateStatus = 0;
                string wareshouseId = string.Empty;

                StringBuilder logMessage = new StringBuilder();
                try
                {
                    DateTime curSchedShipDate = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    DateTime curSchedDelDate = DateTime.Parse("1900/01/01", System.Globalization.CultureInfo.CreateSpecificCulture("en-CA"));
                    curSchedShipDate = sopEntryForm.SopEntry.CpReqShipDate.Value;
                    curSchedDelDate = sopEntryForm.SopEntry.CpCurSchedDel.Value;

                    wareshouseId = sopEntryForm.SopEntry.LocationCode.Value;





                    SalesOrderRequest salesOrderRequest = new SalesOrderRequest();
                    SalesOrderEntity salesCustomerDetailsObj = new SalesOrderEntity();
                    salesOrderRequest.CompanyID = Dynamics.Globals.CompanyId.Value;

                    SalesOrderEntity salesOrderEntity = new SalesOrderEntity();
                    SalesOrderInformation salesOrderInformation = new SalesOrderInformation();
                    WarehouseInformation salesWarehouseInformation = new WarehouseInformation();
                    SalesOrderDetails salesOrderDetails = new SalesOrderDetails();
                    OrderSchedule orderSchedule = new OrderSchedule();

                    orderSchedule.RequestedShipDate = curSchedShipDate;
                    orderSchedule.RequestedDeliveryDate = curSchedDelDate;

                    salesWarehouseInformation.WarehouseId = wareshouseId;

                    salesOrderDetails.OrderSchedule = orderSchedule;
                    salesOrderInformation.SalesOrderDetails = salesOrderDetails;
                    salesOrderInformation.Warehouse = salesWarehouseInformation;
                    salesOrderEntity.SalesOrderDetails = salesOrderInformation;
                    salesOrderRequest.SalesOrderEntity = salesOrderEntity;



                    // Service call ...
                    using (HttpClient client = new HttpClient())
                    {
                        client.BaseAddress = new Uri(gpServiceConfigurationURL);
                        client.DefaultRequestHeaders.Accept.Clear();
                        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

                        var response = client.PostAsJsonAsync("api/SalesOrderUpdate/ValidateWarehouseClosureDate", salesOrderRequest); // we need to refer the web.api service url here.
                        if (response.Result.IsSuccessStatusCode)
                        {
                            SalesOrderResponse salesResponse = response.Result.Content.ReadAsAsync<SalesOrderResponse>().Result;
                            if (salesResponse.Status == ResponseStatus.Error)
                            {
                                MessageBox.Show("Error: " + salesResponse.ErrorMessage, Resources.STR_MESSAGE_TITLE);
                                logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In SalesPostingManagementWindow Method (ProcessRequest): " + salesResponse.ErrorMessage.ToString());
                            }
                            else
                            {
                                validateStatus = salesResponse.ValidateStatus;
                                if (validateStatus == 1)
                                {
                                    MessageBox.Show("Cur Sched Ship Date is set on a warehouse closure date. Please adjust the date to the next best day or work with appropriate parties to execute this exception.", Resources.STR_DynamicsGP);
                                }
                                else if (validateStatus == 2)
                                {
                                    MessageBox.Show("One of the Cur Sched Date is set on a Weekend. Please adjust the date to the next best day or work with appropriate parties to execute this exception.", Resources.STR_DynamicsGP);
                                }
                            }
                        }
                        else
                        {
                            MessageBox.Show("Error: CpCurSchedDel_Change in customer detail entry window", Resources.STR_MESSAGE_TITLE);
                        }
                    }
                }
                catch (Exception ex)
                {
                    logMessage.AppendLine(DateTime.Now + " - " + Dynamics.Globals.UserId.Value.ToString() + " Error In CpSalesPostingManagement_CloseAfterOriginal Method: " + ex.Message.ToString());
                    MessageBox.Show(ex.Message, Resources.STR_MESSAGE_TITLE);
                }
                finally
                {
                    LogPostProcessDetailsToFile(logMessage.ToString(), "PostingDetails");
                    logMessage = null;
                }
            }

        }

        #endregion

        /// <summary>
        ///Method to move the create  the log file and for todays date and write to log file.
        /// </summary>
        /// <param name="message">log message</param>
        /// <param name="logFileName">Name of the log file</param>
        /// <param name="logFilePath">Path for the log file</param>
        private void LogPostProcessDetailsToFile(string message, string fileType)
        {
            switch (fileType)
            {
                case "SalesDetails":
                    if (isSoLoggingEnabled && message != "")
                        new TextLogger().LogInformationIntoFile(message, soLogFilePath, soLogFileName);
                    break;
                case "PostingDetails":
                    if (isPostLoggingEnabled && message != "")
                        new TextLogger().LogInformationIntoFile(message, postingLogFilePath, postingLogFileName);
                    break;
                default:
                    break;
            }
        }
    }
}
